---
title: 動態引數
ms.date: 03/30/2017
ms.assetid: 122ad479-d306-4602-a943-5aefe711329d
ms.openlocfilehash: dcf6b84889f3bd7d043f736336c39634cd5384c7
ms.sourcegitcommit: 2eceb05f1a5bb261291a1f6a91c5153727ac1c19
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/04/2018
ms.locfileid: "43530437"
---
# <a name="dynamic-arguments"></a><span data-ttu-id="57438-102">動態引數</span><span class="sxs-lookup"><span data-stu-id="57438-102">Dynamic Arguments</span></span>
<span data-ttu-id="57438-103">這個範例示範如何實作活動，由活動消費者 (而不是活動作者) 定義其引數。</span><span class="sxs-lookup"><span data-stu-id="57438-103">This sample demonstrates how to implement an activity for which the arguments are defined by the activity consumer rather than the activity author.</span></span> <span data-ttu-id="57438-104">其執行方式為覆寫執行階段建構活動中繼資料的方式。</span><span class="sxs-lookup"><span data-stu-id="57438-104">It does this by overriding the way the runtime constructs the activity’s metadata.</span></span>  
  
## <a name="sample-details"></a><span data-ttu-id="57438-105">範例詳細資料</span><span class="sxs-lookup"><span data-stu-id="57438-105">Sample details</span></span>  
 <span data-ttu-id="57438-106">在執行之前，執行階段會檢查活動型別的公用成員，以及自動將引數、變數、子活動和活動委派宣告為活動中繼資料的一部分，藉此建置活動的描述。</span><span class="sxs-lookup"><span data-stu-id="57438-106">Prior to execution, the runtime builds a description of an activity by examining the public members of the activity type and automatically declaring arguments, variables, child activities, and activity delegates as part of an activity’s metadata.</span></span> <span data-ttu-id="57438-107">這樣做的目的在於確保工作流程的正確結構以及管理執行階段關聯性和存留期規則。</span><span class="sxs-lookup"><span data-stu-id="57438-107">It does this to ensure correct construction of a workflow as well as to manage run-time relationships and lifetime rules.</span></span> <span data-ttu-id="57438-108">通常活動作者會透過在活動型別 (衍生自 <xref:System.Activities.Argument>) 上指定公用成員的方式定義活動的引數。</span><span class="sxs-lookup"><span data-stu-id="57438-108">Typically an activity author defines the arguments of an activity by specifying public members on the activity type that derive from <xref:System.Activities.Argument>.</span></span> <span data-ttu-id="57438-109">針對每一個衍生自 <xref:System.Activities.Argument> 的公用成員，執行階段會建立 <xref:System.Activities.RuntimeArgument>，並且將它繫結至該成員上使用者提供的引數集。</span><span class="sxs-lookup"><span data-stu-id="57438-109">For each public member that derives from <xref:System.Activities.Argument>, the runtime creates a <xref:System.Activities.RuntimeArgument> and binds it to the user-provided argument set on that member.</span></span> <span data-ttu-id="57438-110">不過，在某些情況下，活動消費者會提供某種判斷引數集的組態。</span><span class="sxs-lookup"><span data-stu-id="57438-110">In some cases, however, the consumer of the activity provides some configuration that determines the set of arguments.</span></span> <span data-ttu-id="57438-111">活動作者會覆寫 <xref:System.Activities.Activity.CacheMetadata%2A> 以自訂建置活動中繼資料的方式，包括與活動相關聯的引數集。</span><span class="sxs-lookup"><span data-stu-id="57438-111">An activity author overrides <xref:System.Activities.Activity.CacheMetadata%2A> to customize the way activity metadata is built, which includes the set of arguments associated with the activity.</span></span>  
  
 <span data-ttu-id="57438-112">這個範例示範如何為叫用方法的活動動態建置引數清單。</span><span class="sxs-lookup"><span data-stu-id="57438-112">This sample demonstrates how to build an argument list dynamically for an activity that invokes a method.</span></span> <span data-ttu-id="57438-113">活動消費者會指定想要叫用的型別和方法名稱，以及要傳遞至該方法的引數集合。</span><span class="sxs-lookup"><span data-stu-id="57438-113">The activity consumer specifies the type and the method name they want to invoke along with a collection of arguments to be passed to that method.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="57438-114">這個範例的目的在於示範如何覆寫 <xref:System.Activities.CodeActivity.CacheMetadata%2A> 以及如何使用 <xref:System.Activities.RuntimeArgument>。</span><span class="sxs-lookup"><span data-stu-id="57438-114">The purpose of this sample is to demonstrate how to override <xref:System.Activities.CodeActivity.CacheMetadata%2A> and how to use <xref:System.Activities.RuntimeArgument>.</span></span> <span data-ttu-id="57438-115">以下提供有關這個活動可以叫用之方法類型的一些注意事項。</span><span class="sxs-lookup"><span data-stu-id="57438-115">There are several caveats with respect to the kinds of methods that this activity can invoke.</span></span> <span data-ttu-id="57438-116">例如，它無法搭配泛型或參數陣列運作。</span><span class="sxs-lookup"><span data-stu-id="57438-116">For example, it does not work with generics or parameter arrays.</span></span> <span data-ttu-id="57438-117">.NET Framework 中隨附的 <xref:System.Activities.Statements.InvokeMethod> 活動會處理這些案例及其他情況。</span><span class="sxs-lookup"><span data-stu-id="57438-117">The <xref:System.Activities.Statements.InvokeMethod> activity that ships in.NET Framework handles these cases and more.</span></span>  
  
 <span data-ttu-id="57438-118">`MethodInvoke` 活動會覆寫 <xref:System.Activities.CodeActivity.CacheMetadata%2A>，並且以建立 <xref:System.Activities.RuntimeArgument> 的方式開始處理方法叫用所產生的任何結果。</span><span class="sxs-lookup"><span data-stu-id="57438-118">The `MethodInvoke` activity overrides <xref:System.Activities.CodeActivity.CacheMetadata%2A> and begins by creating a <xref:System.Activities.RuntimeArgument> to handle any result from the method invocation.</span></span> <span data-ttu-id="57438-119">它會將這個 <xref:System.Activities.RuntimeArgument> 繫結至可公開設定的 <xref:System.Activities.OutArgument> (名為 `Result`)。</span><span class="sxs-lookup"><span data-stu-id="57438-119">It binds this <xref:System.Activities.RuntimeArgument> to the publicly settable <xref:System.Activities.OutArgument> named `Result`.</span></span> <span data-ttu-id="57438-120">如果 `MethodInvoke.Result` 為 `null`，則執行階段會自動在其中填入 <xref:System.Activities.OutArgument>，該引數是以其型別的預設運算式設定。</span><span class="sxs-lookup"><span data-stu-id="57438-120">If `MethodInvoke.Result` is `null`, the runtime automatically populates it with an <xref:System.Activities.OutArgument> configured with the default expression for its type.</span></span> <span data-ttu-id="57438-121">這個行為表示活動作者永遠不必檢查引數屬性是否為 `null`。</span><span class="sxs-lookup"><span data-stu-id="57438-121">This behavior means an activity author never has to check whether an argument property is `null`.</span></span>  
  
 <span data-ttu-id="57438-122">接著，<xref:System.Activities.CodeActivity.CacheMetadata%2A> 覆寫會從使用者提供的 `MethodInfo` 和 `MethodName` 判斷用於引動的 `TargetType`。</span><span class="sxs-lookup"><span data-stu-id="57438-122">Next, the <xref:System.Activities.CodeActivity.CacheMetadata%2A> override determines the `MethodInfo` it uses for invocation from the user-provided `MethodName` and `TargetType`.</span></span> <span data-ttu-id="57438-123">`DetermineMethodInfo` 方法會採用傳遞至 <xref:System.Activities.CodeActivityMetadata> 覆寫的 <xref:System.Activities.CodeActivity.CacheMetadata%2A> 參數，如此任何組態錯誤都可以做為驗證錯誤回報。</span><span class="sxs-lookup"><span data-stu-id="57438-123">The `DetermineMethodInfo` method takes the <xref:System.Activities.CodeActivityMetadata> parameter passed to the <xref:System.Activities.CodeActivity.CacheMetadata%2A> override so that any configuration errors can be reported as validation errors.</span></span> <span data-ttu-id="57438-124">藉由呼叫 `metadata.AddValidationError` 即可達到此目的。</span><span class="sxs-lookup"><span data-stu-id="57438-124">This is done by calling `metadata.AddValidationError`.</span></span>  
  
 <span data-ttu-id="57438-125">一旦設定了 `MethodInfo`，範例就會逐一查看 `MethodInfo` 參數。</span><span class="sxs-lookup"><span data-stu-id="57438-125">Once the `MethodInfo` has been set, the sample iterates over the `MethodInfo` parameters.</span></span> <span data-ttu-id="57438-126">它會針對每一個參數建立 <xref:System.Activities.RuntimeArgument>，並且將它繫結至使用者提供的 `Parameters` 屬性集合中對應的引數。</span><span class="sxs-lookup"><span data-stu-id="57438-126">For each parameter, it creates a <xref:System.Activities.RuntimeArgument> and binds it to the corresponding argument in the user-provided collection from the `Parameters` property.</span></span> <span data-ttu-id="57438-127">最後，<xref:System.Activities.RuntimeArgument> 的集合會透過呼叫 `metadata.SetArgumentsCollection` 的方式與活動產生關聯。</span><span class="sxs-lookup"><span data-stu-id="57438-127">Finally, the collection of <xref:System.Activities.RuntimeArgument>s is associated with the activity by calling `metadata.SetArgumentsCollection`.</span></span>  
  
 <span data-ttu-id="57438-128">請注意，引數可以使用 <xref:System.Activities.RuntimeArgument> (如同 `resultArgument` 的案例) 或是使用者提供的引數 (如同 `Parameters` 集合的案例) 進行解析。</span><span class="sxs-lookup"><span data-stu-id="57438-128">Note that argument resolution can be done using a <xref:System.Activities.RuntimeArgument>, as in the case of `resultArgument` or the user-provided argument, as in the case of the `Parameters` collection.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="57438-129">若要使用這個範例</span><span class="sxs-lookup"><span data-stu-id="57438-129">To use this sample</span></span>  
  
1.  <span data-ttu-id="57438-130">使用 [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] 開啟 [DynamicArguments.sln] 檔案。</span><span class="sxs-lookup"><span data-stu-id="57438-130">Using [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], open the DynamicArguments.sln file.</span></span>  
  
2.  <span data-ttu-id="57438-131">若要建置此方案，請按 CTRL+SHIFT+B。</span><span class="sxs-lookup"><span data-stu-id="57438-131">To build the solution, press CTRL+SHIFT+B.</span></span>  
  
3.  <span data-ttu-id="57438-132">若要執行此方案，請按下 CTRL+F5。</span><span class="sxs-lookup"><span data-stu-id="57438-132">To run the solution, press CTRL+F5.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="57438-133">這些範例可能已安裝在您的電腦上。</span><span class="sxs-lookup"><span data-stu-id="57438-133">The samples may already be installed on your machine.</span></span> <span data-ttu-id="57438-134">請先檢查下列 (預設) 目錄，然後再繼續。</span><span class="sxs-lookup"><span data-stu-id="57438-134">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="57438-135">如果此目錄不存在，請移至[Windows Communication Foundation (WCF) 和.NET Framework 4 的 Windows Workflow Foundation (WF) 範例](https://go.microsoft.com/fwlink/?LinkId=150780)以下載所有 Windows Communication Foundation (WCF) 和[!INCLUDE[wf1](../../../../includes/wf1-md.md)]範例。</span><span class="sxs-lookup"><span data-stu-id="57438-135">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="57438-136">此範例位於下列目錄。</span><span class="sxs-lookup"><span data-stu-id="57438-136">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Basic\CustomActivities\Code-Bodied\DynamicArguments`