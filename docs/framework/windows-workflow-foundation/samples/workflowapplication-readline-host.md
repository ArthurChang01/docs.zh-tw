---
title: WorkflowApplication ReadLine 主機
ms.date: 03/30/2017
ms.assetid: f7b362be-cb42-40d7-b9ef-cfc4aed2455b
ms.openlocfilehash: 8da8a5bb4c80a86fe5ae9e133ea545c00ee17fba
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/04/2018
ms.locfileid: "33518534"
---
# <a name="workflowapplication-readline-host"></a><span data-ttu-id="42d57-102">WorkflowApplication ReadLine 主機</span><span class="sxs-lookup"><span data-stu-id="42d57-102">WorkflowApplication ReadLine Host</span></span>
<span data-ttu-id="42d57-103">這個範例為泛型 ReadLine 主機。</span><span class="sxs-lookup"><span data-stu-id="42d57-103">This sample is a generic ReadLine host.</span></span> <span data-ttu-id="42d57-104">您可以使用包含的 `ReadLine` 活動來載入及執行任何工作流程 (或是與它類似的其他活動，從使用字串繼續的書籤中取得資料)。</span><span class="sxs-lookup"><span data-stu-id="42d57-104">You can load and run any workflow using the included `ReadLine` activity (or other activities like it that get data from bookmarks resumed with strings).</span></span> <span data-ttu-id="42d57-105">來自 `WriteLine` 活動的輸出或是寫入 <xref:System.Activities.Statements.WriteLine.TextWriter%2A> 延伸模組的任何內容都會導向主機視窗。</span><span class="sxs-lookup"><span data-stu-id="42d57-105">Output from the `WriteLine` activity or anything writing to the <xref:System.Activities.Statements.WriteLine.TextWriter%2A> extension is directed to the host window.</span></span> <span data-ttu-id="42d57-106">當執行個體閒置時，該執行個體可用的書籤會出現在下拉式方塊中。</span><span class="sxs-lookup"><span data-stu-id="42d57-106">When an instance is idle, the available bookmarks for that instance appear in a combo box.</span></span> <span data-ttu-id="42d57-107">選取書籤、輸入某些文字並按下繼續書籤按鈕，將會繼續執行工作流程。</span><span class="sxs-lookup"><span data-stu-id="42d57-107">Selecting a bookmark, inputting some text, and pressing the resume bookmark button continue the execution of the workflow.</span></span> <span data-ttu-id="42d57-108">您也可以取消、中止或終止選取的工作流程。</span><span class="sxs-lookup"><span data-stu-id="42d57-108">You can also cancel, abort, or terminate a selected workflow.</span></span> <span data-ttu-id="42d57-109">預設會啟用持續性，您可以關閉主機並將它開啟，執行個體清單就會填入資料庫內所存放的執行個體。</span><span class="sxs-lookup"><span data-stu-id="42d57-109">Persistence is on by default – you can shut down the host and bring it back, and the instance list is populated with the instances stored in the database.</span></span> <span data-ttu-id="42d57-110">追蹤是用來將 <xref:System.Activities.WorkflowApplication> 層級的事件輸出到主機，而且包含了加入活動層級之詳細追蹤的選項。</span><span class="sxs-lookup"><span data-stu-id="42d57-110">Tracking is used to output <xref:System.Activities.WorkflowApplication>-level events to the host with the option to add detailed tracking at the activity level.</span></span>  
  
## <a name="sample-details"></a><span data-ttu-id="42d57-111">範例詳細資料</span><span class="sxs-lookup"><span data-stu-id="42d57-111">Sample Details</span></span>  
 <span data-ttu-id="42d57-112">這個主機有兩層：檢視及執行個體管理員。</span><span class="sxs-lookup"><span data-stu-id="42d57-112">There are two layers to this host: the view and the instance manager.</span></span> <span data-ttu-id="42d57-113">檢視是由 `HostView` 和 `WorkflowApplicationInfo` 類別所組成。</span><span class="sxs-lookup"><span data-stu-id="42d57-113">The view consists of the `HostView` and `WorkflowApplicationInfo` classes.</span></span> <span data-ttu-id="42d57-114">這個主機的一般模式是讓 `HostView` 類別根據 `WorkflowApplicationInfo` 物件顯示可用的選項給使用者，這些物件會合理地保持與其代表的執行個體同步的狀態。</span><span class="sxs-lookup"><span data-stu-id="42d57-114">The general pattern for this host is for the `HostView` class to display available options to the user based on `WorkflowApplicationInfo` objects that are kept reasonably in synchronization with the instances they represent.</span></span> <span data-ttu-id="42d57-115">執行個體管理員層是由 `WorkflowApplicationManager` 類別 (它是所有主機通訊的核心) 與 `WorkflowDefinitionExtension` 類別 (它會保存執行個體以及此執行個體一開始具備的程式定義之間的關聯性) 以及其他幾個類別所組成。</span><span class="sxs-lookup"><span data-stu-id="42d57-115">The instance manager layer consists of the `WorkflowApplicationManager` class, which is the core of all host communications, and the `WorkflowDefinitionExtension` class, which persists the relationship between an instance and the program definition it was started with and a few other classes.</span></span> <span data-ttu-id="42d57-116">`HostView` 呼叫會控制 `WorkflowApplicationManager` 上的作業。</span><span class="sxs-lookup"><span data-stu-id="42d57-116">The `HostView` calls control operations on the `WorkflowApplicationManager`.</span></span> <span data-ttu-id="42d57-117">這些呼叫通常會以非同步方式來維護具有回應性的使用者介面。</span><span class="sxs-lookup"><span data-stu-id="42d57-117">These calls are typically asynchronous to maintain a responsive user interface.</span></span> <span data-ttu-id="42d57-118">當非同步呼叫完成時，`WorkflowApplicationManager` 會透過定義完善的介面 (`IHostView`) 回呼檢視層。</span><span class="sxs-lookup"><span data-stu-id="42d57-118">When the asynchronous calls complete, the `WorkflowApplicationManager` makes calls back into the view layer through a well-defined interface (`IHostView`).</span></span> <span data-ttu-id="42d57-119">`HostView` 類別最常從 `WorkflowApplicationManager` 類別將這些呼叫發送給使用者介面執行緒。</span><span class="sxs-lookup"><span data-stu-id="42d57-119">The `HostView` class most often dispatches these calls from the `WorkflowApplicationManager` class to the user interface thread.</span></span> <span data-ttu-id="42d57-120">文字寫入是針對 <xref:System.Activities.Statements.WriteLine.TextWriter%2A> 類別提供的安全執行緒 `HostView` 物件所執行。</span><span class="sxs-lookup"><span data-stu-id="42d57-120">Text writing is done to thread-safe <xref:System.Activities.Statements.WriteLine.TextWriter%2A> objects provided by the `HostView` class.</span></span> <span data-ttu-id="42d57-121">使用者介面並不是產生事件的唯一項目。</span><span class="sxs-lookup"><span data-stu-id="42d57-121">The user interface is not the only thing generating events.</span></span> <span data-ttu-id="42d57-122">例如，當 <xref:System.Activities.WorkflowApplication> 物件進入 `WorkflowApplicationManager`、`Idle` 或 `Complete` 狀態時，也會指示 `Aborted`。</span><span class="sxs-lookup"><span data-stu-id="42d57-122">The <xref:System.Activities.WorkflowApplication> objects also signal the `WorkflowApplicationManager` when they go `Idle`, `Complete`, or are `Aborted`, for example.</span></span> <span data-ttu-id="42d57-123">`WorkflowApplicationManager` 類別會離開事件執行緒，其方式是將清除或更新工作發送給主機。</span><span class="sxs-lookup"><span data-stu-id="42d57-123">The `WorkflowApplicationManager` class gets off the event thread by dispatching clean up or updating work to the host.</span></span>  
  
 <span data-ttu-id="42d57-124">用來啟動 <xref:System.Activities.WorkflowApplication> 之檔案的記錄可由 `WorkflowDefinitionExtension` 類別來加速。</span><span class="sxs-lookup"><span data-stu-id="42d57-124">The recording of the file used to launch a <xref:System.Activities.WorkflowApplication> is facilitated by the `WorkflowDefinitionExtension` class.</span></span> <span data-ttu-id="42d57-125">它會實作 <xref:System.Activities.Persistence.PersistenceIOParticipant> 介面來參與持續性，並保存工作流程定義的路徑。</span><span class="sxs-lookup"><span data-stu-id="42d57-125">It implements the <xref:System.Activities.Persistence.PersistenceIOParticipant> interface to participate in persistence and persist the path to the workflow definition.</span></span>  
  
 <span data-ttu-id="42d57-126">`WorkflowApplicationManager.Load` 方法會使用預存路徑來具現化用來載入未完成的 <xref:System.Activities.WorkflowApplication> 物件所需的工作流程程式。</span><span class="sxs-lookup"><span data-stu-id="42d57-126">The `WorkflowApplicationManager.Load` method uses the stored path to instantiate the workflow programs required for loading unfinished <xref:System.Activities.WorkflowApplication> objects.</span></span>  
  
#### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="42d57-127">若要安裝、建置及執行範例</span><span class="sxs-lookup"><span data-stu-id="42d57-127">To set up, build, and run the sample</span></span>  
  
1.  <span data-ttu-id="42d57-128">這個範例需要安裝 SQL Express。</span><span class="sxs-lookup"><span data-stu-id="42d57-128">This sample requires SQL Express to be installed.</span></span> <span data-ttu-id="42d57-129">SQL Express 隨附於 [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] 中。</span><span class="sxs-lookup"><span data-stu-id="42d57-129">SQL Express comes with [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].</span></span>  
  
2.  <span data-ttu-id="42d57-130">開啟 Visual Studio 2010 命令提示字元。</span><span class="sxs-lookup"><span data-stu-id="42d57-130">Open a Visual Studio 2010 command prompt.</span></span>  
  
3.  <span data-ttu-id="42d57-131">巡覽至範例目錄 (\WF\Basic\Execution\ControllingWorkflowApplications) 並執行 CreateInstanceStore.cmd。</span><span class="sxs-lookup"><span data-stu-id="42d57-131">Navigate to the sample directory (\WF\Basic\Execution\ControllingWorkflowApplications) and run CreateInstanceStore.cmd.</span></span>  
  
4.  <span data-ttu-id="42d57-132">CreateInstanceStore.cmd 指令碼會嘗試在 SQL Server 2008 Express 預設執行個體上建立資料庫。</span><span class="sxs-lookup"><span data-stu-id="42d57-132">The CreateInstanceStore.cmd script attempts to create the database on the default instance of SQL Server 2008 Express.</span></span> <span data-ttu-id="42d57-133">如果您想要在不同的執行個體上安裝資料庫，請修改指令碼。</span><span class="sxs-lookup"><span data-stu-id="42d57-133">If you want to install the database on a different instance, modify the script to do so.</span></span>  
  
5.  <span data-ttu-id="42d57-134">編譯 WorkflowApplicationReadLineHost 專案，並從命令列執行它。</span><span class="sxs-lookup"><span data-stu-id="42d57-134">Compile the WorkflowApplicationReadLineHost project and run it from the command line.</span></span>  
  
6.  <span data-ttu-id="42d57-135">一旦執行專案之後，您可以選擇開啟或關閉持續性。</span><span class="sxs-lookup"><span data-stu-id="42d57-135">Once running, you can optionally turn persistence off or on.</span></span> <span data-ttu-id="42d57-136">您可以進一步選擇開啟或關閉詳細活動追蹤。</span><span class="sxs-lookup"><span data-stu-id="42d57-136">Further, you can optionally turn detailed activity tracking on or off.</span></span>  
  
7.  <span data-ttu-id="42d57-137">按下省略符號按鈕旁的 **執行**按鈕瀏覽 XAML 檔案中定義的工作流程</span><span class="sxs-lookup"><span data-stu-id="42d57-137">Press the ellipsis button next to the **Run** button to browse for a workflow defined in a XAML file</span></span>  
  
     <span data-ttu-id="42d57-138">您可以在 SampleWorkflows 資料夾底下找到兩個範例。</span><span class="sxs-lookup"><span data-stu-id="42d57-138">Two samples can be found under the SampleWorkflows folder.</span></span> <span data-ttu-id="42d57-139">parallel1.xaml 範例會進入閒置狀態。</span><span class="sxs-lookup"><span data-stu-id="42d57-139">The parallel1.xaml example goes idle.</span></span>  
  
8.  <span data-ttu-id="42d57-140">一旦選取範例之後，按**執行** 按鈕。</span><span class="sxs-lookup"><span data-stu-id="42d57-140">Once an example is selected, press the **Run** button.</span></span>  
  
9. <span data-ttu-id="42d57-141">如果連接或在工作流程閒置時**書籤**下拉式方塊會填入可用的書籤。</span><span class="sxs-lookup"><span data-stu-id="42d57-141">If or when the workflow goes idle, the **Bookmarks** combo box is populated with available bookmarks.</span></span>  
  
10. <span data-ttu-id="42d57-142">此時的選項包括繼續書籤、取消、中止或終止工作流程。</span><span class="sxs-lookup"><span data-stu-id="42d57-142">The options at this point are to resume a bookmark, cancel, abort, or terminate the workflow.</span></span> <span data-ttu-id="42d57-143">您也可以關閉主機，然後重新啟動。</span><span class="sxs-lookup"><span data-stu-id="42d57-143">You can also shut down the host and restart it.</span></span> <span data-ttu-id="42d57-144">如果將持續性保留在開啟狀態，關閉主機時會卸載執行個體，並在啟動時重新載入。</span><span class="sxs-lookup"><span data-stu-id="42d57-144">If persistence is left on, the instances are unloaded on shutdown and reloaded on start up.</span></span>  
  
     <span data-ttu-id="42d57-145">若要繼續書籤，選取所需的書籤、 輸入的值，在文字方塊旁邊的下拉式方塊，然後按**繼續書籤**。</span><span class="sxs-lookup"><span data-stu-id="42d57-145">To resume a bookmark, select the desired bookmark, type in a value in the text box next to the combo box and press **Resume Bookmark**.</span></span>  
  
#### <a name="to-remove-the-instance-store-database"></a><span data-ttu-id="42d57-146">若要移除執行個體存放區資料庫</span><span class="sxs-lookup"><span data-stu-id="42d57-146">To remove the instance store database</span></span>  
  
1.  <span data-ttu-id="42d57-147">開啟 Visual Studio 2010 命令提示字元。</span><span class="sxs-lookup"><span data-stu-id="42d57-147">Open a Visual Studio 2010 command prompt.</span></span>  
  
2.  <span data-ttu-id="42d57-148">巡覽至範例目錄 (\WF\Basic\Execution\ControllingWorkflowApplications) 並執行 RemoveInstanceStore.cmd。</span><span class="sxs-lookup"><span data-stu-id="42d57-148">Navigate to the sample directory (\WF\Basic\Execution\ControllingWorkflowApplications) and run RemoveInstanceStore.cmd.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="42d57-149">這些範例可能已安裝在您的電腦上。</span><span class="sxs-lookup"><span data-stu-id="42d57-149">The samples may already be installed on your machine.</span></span> <span data-ttu-id="42d57-150">請先檢查下列 (預設) 目錄，然後再繼續。</span><span class="sxs-lookup"><span data-stu-id="42d57-150">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="42d57-151">如果此目錄不存在，請移至[Windows Communication Foundation (WCF) 和適用於.NET Framework 4 的 Windows Workflow Foundation (WF) 範例](http://go.microsoft.com/fwlink/?LinkId=150780)下載所有 Windows Communication Foundation (WCF) 和[!INCLUDE[wf1](../../../../includes/wf1-md.md)]範例。</span><span class="sxs-lookup"><span data-stu-id="42d57-151">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="42d57-152">此範例位於下列目錄。</span><span class="sxs-lookup"><span data-stu-id="42d57-152">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Basic\Execution\ControllingWorkflowApplications`