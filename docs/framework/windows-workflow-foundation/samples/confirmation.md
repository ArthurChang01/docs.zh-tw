---
title: 組態
ms.date: 03/30/2017
ms.assetid: 8637aeaf-ac9e-49b8-93f4-da15dee45277
ms.openlocfilehash: caa712aa52da01ce44335a361fd6c9f5215316bf
ms.sourcegitcommit: c7f3e2e9d6ead6cc3acd0d66b10a251d0c66e59d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/08/2018
ms.locfileid: "44198097"
---
# <a name="confirmation"></a><span data-ttu-id="990ce-102">組態</span><span class="sxs-lookup"><span data-stu-id="990ce-102">Confirmation</span></span>
<span data-ttu-id="990ce-103">這個範例示範四個有關 <xref:System.Activities.Statements.CompensableActivity> 和確認用法的一般案例。</span><span class="sxs-lookup"><span data-stu-id="990ce-103">This sample shows four common scenarios surrounding the use of <xref:System.Activities.Statements.CompensableActivity> and confirmation.</span></span> <span data-ttu-id="990ce-104">範例中會執行四個工作流程以示範確認。</span><span class="sxs-lookup"><span data-stu-id="990ce-104">The sample runs four workflows to show confirmation.</span></span> <span data-ttu-id="990ce-105">這個範例有宣告式和命令式版本。</span><span class="sxs-lookup"><span data-stu-id="990ce-105">This sample is available in declarative and imperative versions.</span></span>  
  
## <a name="confirm-a-compensable-activity"></a><span data-ttu-id="990ce-106">確認可補償的活動</span><span class="sxs-lookup"><span data-stu-id="990ce-106">Confirm a Compensable Activity</span></span>  
 <span data-ttu-id="990ce-107">第一個工作流程示範如何確認可補償的活動，它是由兩個 <xref:System.Activities.Statements.CompensableActivity> 執行個體的序列所組成。</span><span class="sxs-lookup"><span data-stu-id="990ce-107">The first workflow demonstrates how to confirm a compensable activity and consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity> instances.</span></span> <span data-ttu-id="990ce-108">在第二個 <xref:System.Activities.Statements.CompensableActivity> 完成之後，確認活動會確認第一個活動。</span><span class="sxs-lookup"><span data-stu-id="990ce-108">After the completion of the second <xref:System.Activities.Statements.CompensableActivity> a confirm activity confirms the first activity.</span></span> <span data-ttu-id="990ce-109">當工作流程順利完成時，所有尚未確認或未補償的 <xref:System.Activities.Statements.CompensableActivity> 執行個體都會依預設順序進行自動確認。</span><span class="sxs-lookup"><span data-stu-id="990ce-109">When the workflow successfully completes, all <xref:System.Activities.Statements.CompensableActivity> instances that have not been confirmed or compensated are automatically confirmed using the default order.</span></span> <span data-ttu-id="990ce-110">如果沒有確認，則會先確認第二個 <xref:System.Activities.Statements.CompensableActivity>。</span><span class="sxs-lookup"><span data-stu-id="990ce-110">Without the confirm, the second <xref:System.Activities.Statements.CompensableActivity> would have been confirmed first.</span></span>  
  
## <a name="explicit-compensation"></a><span data-ttu-id="990ce-111">明確補償</span><span class="sxs-lookup"><span data-stu-id="990ce-111">Explicit Compensation</span></span>  
 <span data-ttu-id="990ce-112">第二個案例示範在明確補償 <xref:System.Activities.Statements.CompensableActivity> 時，對預設確認所造成的影響。</span><span class="sxs-lookup"><span data-stu-id="990ce-112">The second scenario shows the affect on default confirmation when a <xref:System.Activities.Statements.CompensableActivity> is explicitly compensated.</span></span> <span data-ttu-id="990ce-113">工作流程是由兩個 <xref:System.Activities.Statements.CompensableActivity> 活動的序列所組成，在第二個完成之後會明確補償第一個。</span><span class="sxs-lookup"><span data-stu-id="990ce-113">The workflow consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity> activities, after the second completes the first is explicitly compensated.</span></span> <span data-ttu-id="990ce-114">因此當工作流程完成時，只確認第二個 <xref:System.Activities.Statements.CompensableActivity>。</span><span class="sxs-lookup"><span data-stu-id="990ce-114">As a result when the workflow, completes only the second <xref:System.Activities.Statements.CompensableActivity> is confirmed.</span></span>  
  
## <a name="controlling-the-order-of-confirmation-for-nested-compensableactivity-activities"></a><span data-ttu-id="990ce-115">控制巢狀 CompensableActivity 活動的確認順序</span><span class="sxs-lookup"><span data-stu-id="990ce-115">Controlling the Order of Confirmation for Nested CompensableActivity Activities</span></span>  
 <span data-ttu-id="990ce-116">第三個案例示範如何控制巢狀 <xref:System.Activities.Statements.CompensableActivity> 的確認順序。</span><span class="sxs-lookup"><span data-stu-id="990ce-116">The third scenario shows how to control the order of confirmation for nested <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="990ce-117">此案例包含 <xref:System.Activities.Statements.CompensableActivity> 做為工作流程的根活動。</span><span class="sxs-lookup"><span data-stu-id="990ce-117">The scenario consists of a <xref:System.Activities.Statements.CompensableActivity> as the root of the workflow.</span></span> <span data-ttu-id="990ce-118">根 <xref:System.Activities.Statements.CompensableActivity> 的主體是三個 <xref:System.Activities.Statements.CompensableActivity> 的序列。</span><span class="sxs-lookup"><span data-stu-id="990ce-118">The body of the root <xref:System.Activities.Statements.CompensableActivity> is a sequence of three <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="990ce-119">根 <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> 的 <xref:System.Activities.Statements.CompensableActivity> 是序列，指定先確認第一個再確認第二個巢狀 <xref:System.Activities.Statements.CompensableActivity>。</span><span class="sxs-lookup"><span data-stu-id="990ce-119">The <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> for the root <xref:System.Activities.Statements.CompensableActivity> is a sequence that specifies to confirm the first then the second nested <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="990ce-120">當工作流程完成時，會確認根 <xref:System.Activities.Statements.CompensableActivity>，接著由根活動依序確認第一個、第二個和第三個巢狀 <xref:System.Activities.Statements.CompensableActivity>。</span><span class="sxs-lookup"><span data-stu-id="990ce-120">When the workflow completes it confirms the root <xref:System.Activities.Statements.CompensableActivity>, which then confirms the first, second and third nested <xref:System.Activities.Statements.CompensableActivity>, in that order.</span></span> <span data-ttu-id="990ce-121">因此，預設確認順序基本上是反向。</span><span class="sxs-lookup"><span data-stu-id="990ce-121">As a result, the default confirmation order is essentially reversed.</span></span> <span data-ttu-id="990ce-122">由於根 <xref:System.Activities.Statements.CompensableActivity> 中 <xref:System.Activities.Statements.CompensableActivity> 未明確確認第三個 <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A>，因此依據預設順序確認它。</span><span class="sxs-lookup"><span data-stu-id="990ce-122">Because the third <xref:System.Activities.Statements.CompensableActivity> was not explicitly confirmed as part of the root <xref:System.Activities.Statements.CompensableActivity> by the <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A>, it is confirmed according to the default order.</span></span> <span data-ttu-id="990ce-123">但因為它是唯一未確認的 <xref:System.Activities.Statements.CompensableActivity>，這就表示它是已確認的。</span><span class="sxs-lookup"><span data-stu-id="990ce-123">However, because it is the only unconfirmed <xref:System.Activities.Statements.CompensableActivity> this just means it is confirmed.</span></span>  
  
## <a name="scoping-of-variables"></a><span data-ttu-id="990ce-124">變數範圍</span><span class="sxs-lookup"><span data-stu-id="990ce-124">Scoping of Variables</span></span>  
 <span data-ttu-id="990ce-125">第四個案例示範當 <xref:System.Activities.Statements.CompensableActivity>、<xref:System.Activities.Statements.CompensableActivity.CompensationHandler%2A> 或 <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> 處理常式執行時，即使活動或工作流程已完成，對 <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> 定義之變數或其中一個變數父系的存留期仍在範圍中。</span><span class="sxs-lookup"><span data-stu-id="990ce-125">The fourth scenario shows how the lifetime of variables defined for a <xref:System.Activities.Statements.CompensableActivity> or one of their parents are still in scope when the <xref:System.Activities.Statements.CompensableActivity.CompensationHandler%2A>, <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> or <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> handlers are executed even if the activity has completed or the workflow has completed.</span></span> <span data-ttu-id="990ce-126">工作流程包含兩個 <xref:System.Activities.Statements.CompensableActivity> 的序列。</span><span class="sxs-lookup"><span data-stu-id="990ce-126">The workflow consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="990ce-127">在第一個的主體中，`mySum` 變數設為 5 與 10 的總和，並列印結果。</span><span class="sxs-lookup"><span data-stu-id="990ce-127">In the body of the first, the variable `mySum` is set to the sum of 5 and 10 and the result printed.</span></span> <span data-ttu-id="990ce-128">在第二個 <xref:System.Activities.Statements.CompensableActivity> 的主體中，此變數設為現有總和與 7 的總和，並列印結果。</span><span class="sxs-lookup"><span data-stu-id="990ce-128">In the body of the second <xref:System.Activities.Statements.CompensableActivity>, the sum is set to the sum of the existing sum and 7 and the result printed.</span></span> <span data-ttu-id="990ce-129">對第一個 <xref:System.Activities.Statements.CompensableActivity> 定義自訂確認處理常式，該處理常式會列印總和、減去 7，並再次列印總和。</span><span class="sxs-lookup"><span data-stu-id="990ce-129">A custom confirmation handler is defined for the first <xref:System.Activities.Statements.CompensableActivity>, which prints the sum, subtracts 7 and prints the sum again.</span></span> <span data-ttu-id="990ce-130">透過檢查列印總和，很清楚的知道，變數不只是在兩個 <xref:System.Activities.Statements.CompensableActivity> 的主體範圍中，也是在 <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> 的範圍中。</span><span class="sxs-lookup"><span data-stu-id="990ce-130">It is clear by inspecting the printed sums that the variable is in scope not only for the bodies of both <xref:System.Activities.Statements.CompensableActivity> but the <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> as well.</span></span>  
  
#### <a name="to-run-the-sample"></a><span data-ttu-id="990ce-131">若要執行範例</span><span class="sxs-lookup"><span data-stu-id="990ce-131">To run the sample</span></span>  
  
1.  <span data-ttu-id="990ce-132">在 [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] 中載入方案。</span><span class="sxs-lookup"><span data-stu-id="990ce-132">Load the solution in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].</span></span>  
  
2.  <span data-ttu-id="990ce-133">執行 ConfirmationSample.exe 應用程式。</span><span class="sxs-lookup"><span data-stu-id="990ce-133">Run the ConfirmationSample.exe application.</span></span>  
  
3.  <span data-ttu-id="990ce-134">觀察下列輸出：</span><span class="sxs-lookup"><span data-stu-id="990ce-134">Observe the following output:</span></span>  
  
 <span data-ttu-id="990ce-135">**明確確認： 開頭 workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1： 確認 HandlerEnd 的 workflowCompensableActivity2： 確認 HandlerExplicit 補償： Start 的workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: workflowCompensableActivity2 的補償 HandlerEnd： 確認 HandlerCustom 確認處理常式： 開頭 workflowCompensableActivity1:BodyCompensableActivity2: BodyCompensableActivity3： 的 workflowCompensableActivity1 BodyEnd： 確認 HandlerCompensableActivity2： 確認 HandlerCompensableActivity3： 確認處理常式中的確認 HandlerVariable 存取：開頭 workflowCompensableActivity1: BodyCompensableActivity1： 總和為： 15CompensableActivity2: BodyCompensableActivity2： 新增 7 sumCompensableActivity2： 總和現在為： 的 workflowCompensableActivity2 22End： 確認HandlerCompensableActivity1： 確認 HandlerCompensableActivity2： 總和為： 22CompensableActivity2： 減去 12 後總和現在為： 10Press ENTER 以結束。**</span><span class="sxs-lookup"><span data-stu-id="990ce-135">**Explicit confirmation:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: Confirmation HandlerEnd of workflowCompensableActivity2: Confirmation HandlerExplicit compensation:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: Compensation HandlerEnd of workflowCompensableActivity2: Confirmation HandlerCustom confirmation handler:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity3: BodyEnd of workflowCompensableActivity1: Confirmation HandlerCompensableActivity2: Confirmation HandlerCompensableActivity3: Confirmation HandlerVariable access in a confirmation handler:Start of workflowCompensableActivity1: BodyCompensableActivity1: The sum is: 15CompensableActivity2: BodyCompensableActivity2: Adding 7 to the sumCompensableActivity2: The sum is now: 22End of workflowCompensableActivity2: Confirmation HandlerCompensableActivity1: Confirmation HandlerCompensableActivity2: The sum is: 22CompensableActivity2: After subtracting 12 the sum is now: 10Press ENTER to exit.**</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="990ce-136">這些範例可能已安裝在您的電腦上。</span><span class="sxs-lookup"><span data-stu-id="990ce-136">The samples may already be installed on your machine.</span></span> <span data-ttu-id="990ce-137">請先檢查下列 (預設) 目錄，然後再繼續。</span><span class="sxs-lookup"><span data-stu-id="990ce-137">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="990ce-138">如果此目錄不存在，請移至[Windows Communication Foundation (WCF) 和.NET Framework 4 的 Windows Workflow Foundation (WF) 範例](https://go.microsoft.com/fwlink/?LinkId=150780)以下載所有 Windows Communication Foundation (WCF) 和[!INCLUDE[wf1](../../../../includes/wf1-md.md)]範例。</span><span class="sxs-lookup"><span data-stu-id="990ce-138">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="990ce-139">此範例位於下列目錄。</span><span class="sxs-lookup"><span data-stu-id="990ce-139">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Basic\Compensation\Confirmation`