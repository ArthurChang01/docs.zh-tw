---
title: 基本 TransactionScope
ms.date: 03/30/2017
ms.assetid: 1e22b76a-76de-43b4-9be7-7a86ed3d5a44
ms.openlocfilehash: b3c673040d40ca91d8ab4a79e847d61e6f507ed1
ms.sourcegitcommit: efff8f331fd9467f093f8ab8d23a203d6ecb5b60
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/01/2018
ms.locfileid: "43415419"
---
# <a name="basic-transactionscope"></a><span data-ttu-id="17384-102">基本 TransactionScope</span><span class="sxs-lookup"><span data-stu-id="17384-102">Basic TransactionScope</span></span>
<span data-ttu-id="17384-103">這個範例包含四個案例，會示範如何巢狀處理 <xref:System.Activities.Statements.TransactionScope> 執行個體。</span><span class="sxs-lookup"><span data-stu-id="17384-103">This sample consists of four scenarios that run showing how to nest <xref:System.Activities.Statements.TransactionScope> instances.</span></span> <span data-ttu-id="17384-104">第一個案例會示範巢狀處理協力廠商活動，作者對於這個活動的結構並不清楚。</span><span class="sxs-lookup"><span data-stu-id="17384-104">The first scenario shows nesting a 3rd party activity of which the author has no knowledge of the construction.</span></span> <span data-ttu-id="17384-105">第二和第三個案例示範如何採用逾時，最後一個案例則示範 <xref:System.Activities.Statements.TransactionScope.AbortInstanceOnTransactionFailure%2A> 設定。</span><span class="sxs-lookup"><span data-stu-id="17384-105">The second and third scenarios show how time-outs are respected and the final scenario shows the <xref:System.Activities.Statements.TransactionScope.AbortInstanceOnTransactionFailure%2A> setting.</span></span>  
  
## <a name="nesting-of-transactionscopeactivity"></a><span data-ttu-id="17384-106">巢狀處理 TransactionScopeActivity</span><span class="sxs-lookup"><span data-stu-id="17384-106">Nesting of TransactionScopeActivity</span></span>  
 <span data-ttu-id="17384-107">第一個案例的工作流程是由兩個 <xref:System.Activities.Statements.WriteLine> 活動和一個 <xref:System.Activities.Statements.TransactionScope> 的序列所組成。</span><span class="sxs-lookup"><span data-stu-id="17384-107">The workflow for the first scenario consists of a sequence of two <xref:System.Activities.Statements.WriteLine> activities and a <xref:System.Activities.Statements.TransactionScope>.</span></span> <span data-ttu-id="17384-108"><xref:System.Activities.Statements.TransactionScope> 的主體為另外兩個 <xref:System.Activities.Statements.WriteLine> 活動、一個列印交易本機識別碼的自訂活動，以及協力廠商活動的序列。</span><span class="sxs-lookup"><span data-stu-id="17384-108">The body of the <xref:System.Activities.Statements.TransactionScope> is a sequence of two more <xref:System.Activities.Statements.WriteLine> activities, a custom activity that prints the local identifier of the transaction and a third party activity.</span></span> <span data-ttu-id="17384-109">協力廠商活動 `TransactionScopeTest` 包含 <xref:System.Activities.Statements.TransactionScope>，雖然工作流程作者對此不得而知。</span><span class="sxs-lookup"><span data-stu-id="17384-109">The third party activity `TransactionScopeTest` contains a <xref:System.Activities.Statements.TransactionScope> although the workflow author has no way of knowing.</span></span> <span data-ttu-id="17384-110">這個案例會示範 <xref:System.Activities.Statements.TransactionScope> 活動可以進行巢狀處理。</span><span class="sxs-lookup"><span data-stu-id="17384-110">This scenario shows that <xref:System.Activities.Statements.TransactionScope> activities can be nested.</span></span>  
  
## <a name="time-outs"></a><span data-ttu-id="17384-111">逾時</span><span class="sxs-lookup"><span data-stu-id="17384-111">Time-Outs</span></span>  
 <span data-ttu-id="17384-112">第二個案例的工作流程與第一個案例幾乎完全相同。</span><span class="sxs-lookup"><span data-stu-id="17384-112">The workflow for the second scenario is nearly identical to the first.</span></span> <span data-ttu-id="17384-113">`TransactionScopeTest` 已取代為 <xref:System.Activities.Statements.TransactionScope>。</span><span class="sxs-lookup"><span data-stu-id="17384-113">The `TransactionScopeTest` has been replaced with a <xref:System.Activities.Statements.TransactionScope>.</span></span> <span data-ttu-id="17384-114"><xref:System.Activities.Statements.TransactionScope> 的主體為五秒鐘延遲，而交易的逾時設為兩秒。</span><span class="sxs-lookup"><span data-stu-id="17384-114">The body of the <xref:System.Activities.Statements.TransactionScope> is a five-second delay and the time-out for the transaction is set to two seconds.</span></span> <span data-ttu-id="17384-115">外部 <xref:System.Activities.Statements.TransactionScope> 的逾時設為 10 秒。</span><span class="sxs-lookup"><span data-stu-id="17384-115">The time-out for the outer <xref:System.Activities.Statements.TransactionScope> is set to 10 seconds.</span></span> <span data-ttu-id="17384-116">請注意，系統會採用範圍內最小的逾時，且交易會逾時。</span><span class="sxs-lookup"><span data-stu-id="17384-116">Note that the smallest time-out in scope is respected and the transaction times out.</span></span>  
  
 <span data-ttu-id="17384-117">第三個案例的工作流程與第二個案例幾乎完全相同。</span><span class="sxs-lookup"><span data-stu-id="17384-117">The workflow for the third scenario is nearly identical to scenario two.</span></span> <span data-ttu-id="17384-118">延遲活動已從內部 <xref:System.Activities.Statements.TransactionScope> 的主體移至它在本身為外部 <xref:System.Activities.Statements.TransactionScope> 主體之序列中的正後方。</span><span class="sxs-lookup"><span data-stu-id="17384-118">The delay activity has been moved from the body of the inner <xref:System.Activities.Statements.TransactionScope> to immediately after it in the sequence that is the body of the outer <xref:System.Activities.Statements.TransactionScope>.</span></span> <span data-ttu-id="17384-119">交易仍然會逾時，不過這是因為內部 <xref:System.Activities.Statements.TransactionScope> 的兩秒逾時不再適用。</span><span class="sxs-lookup"><span data-stu-id="17384-119">The transaction still times out but because the two second time-out of the inner <xref:System.Activities.Statements.TransactionScope> no longer applies.</span></span> <span data-ttu-id="17384-120">交易會在超過外部 <xref:System.Activities.Statements.TransactionScope> 逾時的第 10 秒逾時。</span><span class="sxs-lookup"><span data-stu-id="17384-120">The transaction times out at 10 seconds when the outer <xref:System.Activities.Statements.TransactionScope> time-out is exceeded.</span></span>  
  
## <a name="aborting-on-transaction-failure"></a><span data-ttu-id="17384-121">交易失敗時中止</span><span class="sxs-lookup"><span data-stu-id="17384-121">Aborting on Transaction Failure</span></span>  
 <span data-ttu-id="17384-122">這個工作流程與案例三類似，不過逾時已被 <xref:System.Activities.Statements.TransactionScope.AbortInstanceOnTransactionFailure%2A> 屬性取代。</span><span class="sxs-lookup"><span data-stu-id="17384-122">This workflow is similar to scenario three except the time-outs have been replaced by the <xref:System.Activities.Statements.TransactionScope.AbortInstanceOnTransactionFailure%2A> property.</span></span> <span data-ttu-id="17384-123">請注意，所有內部子系的旗標 (如果已設定) 都必須符合外部 <xref:System.Activities.Statements.TransactionScope>。</span><span class="sxs-lookup"><span data-stu-id="17384-123">Note that the flags of all inner children, if set, must match the outer <xref:System.Activities.Statements.TransactionScope>.</span></span> <span data-ttu-id="17384-124">在這個案例中，這些旗標並不相符，因此會在工作流程開啟時擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="17384-124">In this scenario, they do not and an exception is thrown when the workflow opens.</span></span>  
  
#### <a name="to-run-the-sample"></a><span data-ttu-id="17384-125">若要執行範例</span><span class="sxs-lookup"><span data-stu-id="17384-125">To run the sample</span></span>  
  
1.  <span data-ttu-id="17384-126">在 [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] 中開啟 BasicTransactionScopeSample.sln 方案。</span><span class="sxs-lookup"><span data-stu-id="17384-126">Open the BasicTransactionScopeSample.sln solution in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].</span></span>  
  
2.  <span data-ttu-id="17384-127">若要建置方案，請按 CTRL + SHIFT + B 或選取**建置方案**從**建置**功能表。</span><span class="sxs-lookup"><span data-stu-id="17384-127">To build the solution, press CTRL+SHIFT+B or select **Build Solution** from the **Build** menu.</span></span>  
  
3.  <span data-ttu-id="17384-128">成功組建後，按 F5 或選取**開始偵錯**從**偵錯**功能表。</span><span class="sxs-lookup"><span data-stu-id="17384-128">Once the build has succeeded, press F5 or select **Start Debugging** from the **Debug** menu.</span></span> <span data-ttu-id="17384-129">或者您可以按 CTRL + F5 或選取**啟動但不偵錯**從**偵錯**執行，而不偵錯 功能表。</span><span class="sxs-lookup"><span data-stu-id="17384-129">Alternatively you can press CTRL+F5 or select **Start Without Debugging** from the **Debug** menu to run without debugging.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="17384-130">這些範例可能已安裝在您的電腦上。</span><span class="sxs-lookup"><span data-stu-id="17384-130">The samples may already be installed on your machine.</span></span> <span data-ttu-id="17384-131">請先檢查下列 (預設) 目錄，然後再繼續。</span><span class="sxs-lookup"><span data-stu-id="17384-131">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="17384-132">如果此目錄不存在，請移至[Windows Communication Foundation (WCF) 和.NET Framework 4 的 Windows Workflow Foundation (WF) 範例](https://go.microsoft.com/fwlink/?LinkId=150780)以下載所有 Windows Communication Foundation (WCF) 和[!INCLUDE[wf1](../../../../includes/wf1-md.md)]範例。</span><span class="sxs-lookup"><span data-stu-id="17384-132">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="17384-133">此範例位於下列目錄。</span><span class="sxs-lookup"><span data-stu-id="17384-133">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Basic\Transactions\BasicTransactionScope`