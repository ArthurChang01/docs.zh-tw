---
title: 執行個體啟動
ms.date: 03/30/2017
ms.assetid: 134c3f70-5d4e-46d0-9d49-469a6643edd8
ms.openlocfilehash: a1b78dc62fbdc6e5551addf400ceb14dc9e822f5
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/04/2018
ms.locfileid: "33516824"
---
# <a name="instance-activation"></a><span data-ttu-id="1d790-102">執行個體啟動</span><span class="sxs-lookup"><span data-stu-id="1d790-102">Instance Activation</span></span>
<span data-ttu-id="1d790-103">SQL 工作流程執行個體存放區會執行內部工作，定期喚醒及偵測持續性資料庫中可執行或可啟動的工作流程執行個體。</span><span class="sxs-lookup"><span data-stu-id="1d790-103">The SQL Workflow Instance Store runs an internal task that periodically wakes up and detects runnable or activatable workflow instances in the persistence database.</span></span> <span data-ttu-id="1d790-104">如果找到可執行的工作流程執行個體，就會通知工作流程主機，表示主機可以啟動該執行個體。</span><span class="sxs-lookup"><span data-stu-id="1d790-104">If it finds a runnable workflow instance, it notifies the workflow host that is capable of activating the instance.</span></span> <span data-ttu-id="1d790-105">如果執行個體存放區找到可啟動的工作流程執行個體，則會通知啟動工作流程主機的泛型主機，再由該主機執行工作流程執行個體。</span><span class="sxs-lookup"><span data-stu-id="1d790-105">If the instance store finds an activatable workflow instance, it notifies a generic host that activates a workflow host, which in turn runs the workflow instance.</span></span> <span data-ttu-id="1d790-106">本主題中的下列章節詳細說明執行個體啟動處理序。</span><span class="sxs-lookup"><span data-stu-id="1d790-106">The following sections in this topic explain the instance activation process in detail.</span></span>  
  
##  <a name="RunnableSection"></a> <span data-ttu-id="1d790-107">偵測與啟動可執行工作流程執行個體</span><span class="sxs-lookup"><span data-stu-id="1d790-107">Detecting and Activating Runnable Workflow Instances</span></span>  
 <span data-ttu-id="1d790-108">SQL 工作流程執行個體存放區會考慮的工作流程執行個體*runnable*如果執行個體不是暫停的狀態或已完成的狀態，並且滿足以下條件：</span><span class="sxs-lookup"><span data-stu-id="1d790-108">The SQL Workflow Instance Store considers a workflow instance *runnable* if the instance is not in the suspended state or the completed state and satisfies the following conditions:</span></span>  
  
-   <span data-ttu-id="1d790-109">執行個體已解除鎖定，並具有已過期的暫止計時器。</span><span class="sxs-lookup"><span data-stu-id="1d790-109">The instance is unlocked and has a pending timer that has expired.</span></span>  
  
-   <span data-ttu-id="1d790-110">執行個體上有過期的鎖定。</span><span class="sxs-lookup"><span data-stu-id="1d790-110">The instance has an expired lock on it.</span></span>  
  
-   <span data-ttu-id="1d790-111">執行個體已解除鎖定，其狀態為**執行**。</span><span class="sxs-lookup"><span data-stu-id="1d790-111">The instance is unlocked and its status is **Executing**.</span></span>  
  
 <span data-ttu-id="1d790-112">當 SQL 工作流程執行個體存放區找到可執行的執行個體時，會引發 <xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent>。</span><span class="sxs-lookup"><span data-stu-id="1d790-112">The SQL Workflow Instance Store raises the <xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent> when it finds a runnable instance.</span></span> <span data-ttu-id="1d790-113">之後，SqlWorkflowInstanceStore 就會停止監視，直到在存放區呼叫 <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand> 一次為止。</span><span class="sxs-lookup"><span data-stu-id="1d790-113">After this, the SqlWorkflowInstanceStore stops monitoring until the <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand> is called once on the store.</span></span>  
  
 <span data-ttu-id="1d790-114">訂閱 <xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent> 且可載入執行個體的工作流程主機會針對執行個體存放區執行 <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand>，將執行個體載入到記憶體中。</span><span class="sxs-lookup"><span data-stu-id="1d790-114">A workflow host that has subscribed for the <xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent> and capable of loading the instance executes the <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand> against the instance store to load the instance into memory.</span></span> <span data-ttu-id="1d790-115">工作流程主機會被視為可載入工作流程執行個體，如果主機和執行個體將中繼資料屬性**WorkflowServiceType**設為相同的值。</span><span class="sxs-lookup"><span data-stu-id="1d790-115">A workflow host is considered capable of loading a workflow instance if the host and the instance have metadata property **WorkflowServiceType** set to the same value.</span></span>  
  
## <a name="detecting-and-activating-activatable-workflow-instances"></a><span data-ttu-id="1d790-116">偵測與啟動可啟動的工作流程執行個體</span><span class="sxs-lookup"><span data-stu-id="1d790-116">Detecting and Activating Activatable Workflow Instances</span></span>  
 <span data-ttu-id="1d790-117">工作流程執行個體將會被視為*可啟動*如果執行個體已可執行，而且沒有任何工作流程主機能夠載入執行個體在電腦上執行。</span><span class="sxs-lookup"><span data-stu-id="1d790-117">A workflow instance is considered *activatable* if the instance is runnable and there is no workflow host that is capable of loading the instance is running on the computer.</span></span> <span data-ttu-id="1d790-118">如需可執行工作流程執行個體的定義，請參閱上面的＜偵測及啟動可執行工作流程執行個體＞。</span><span class="sxs-lookup"><span data-stu-id="1d790-118">See Detecting and Activating Runnable Workflow Instances above for the definition of a runnable workflow instance.</span></span>  
  
 <span data-ttu-id="1d790-119">當 SQL 工作流程執行個體存放區在資料庫中找到可啟動的工作流程執行個體時，會引發 <xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent>。</span><span class="sxs-lookup"><span data-stu-id="1d790-119">The SQL Workflow Instance Store raises the <xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent> when it finds an activatable workflow instance in the database.</span></span> <span data-ttu-id="1d790-120">之後，SqlWorkflowInstanceStore 就會停止監視，直到在存放區呼叫 <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand> 一次為止。</span><span class="sxs-lookup"><span data-stu-id="1d790-120">After this, the SqlWorkflowInstanceStore stops monitoring until the <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand> is called once on the store.</span></span>  
  
 <span data-ttu-id="1d790-121">當訂閱 <xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent> 的泛型主機收到這個事件時，會針對執行個體存放區執行 <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand>，以取得建立工作流程主機所需的啟動參數。</span><span class="sxs-lookup"><span data-stu-id="1d790-121">When a generic host that has subscribed for the <xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent> receives the event, it executes the <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand> against the instance store to obtain activation parameters required to create a workflow host.</span></span> <span data-ttu-id="1d790-122">泛型主機會使用這些啟動參數建立工作流程主機，而後者則會載入和執行可執行的服務執行個體。</span><span class="sxs-lookup"><span data-stu-id="1d790-122">The generic host uses these activation parameters to create a workflow host, which in turn loads and runs the runnable service instance.</span></span>  
  
## <a name="generic-hosts"></a><span data-ttu-id="1d790-123">泛型主機</span><span class="sxs-lookup"><span data-stu-id="1d790-123">Generic Hosts</span></span>  
 <span data-ttu-id="1d790-124">泛型主機是中繼資料屬性的值與**WorkflowServiceType**泛型主機設定為**WorkflowServiceType.Any**表示它可以處理任何工作流程類型。</span><span class="sxs-lookup"><span data-stu-id="1d790-124">A generic host is a host with the value of the metadata property **WorkflowServiceType** for generic hosts is set to **WorkflowServiceType.Any** to indicate that it can handle any workflow type.</span></span> <span data-ttu-id="1d790-125">泛型主機含有名為的 XName 參數**ActivationType**。</span><span class="sxs-lookup"><span data-stu-id="1d790-125">A generic host has an XName parameter named **ActivationType**.</span></span>  
  
 <span data-ttu-id="1d790-126">目前，SQL 工作流程執行個體存放區支援將 ActivationType 參數設定為值的泛型主機**WAS**。</span><span class="sxs-lookup"><span data-stu-id="1d790-126">Currently, the SQL Workflow Instance Store supports generic hosts with value of the ActivationType parameter set to **WAS**.</span></span> <span data-ttu-id="1d790-127">如果 ActivationType 未設定為 WAS，SQL 工作流程執行個體存放區會擲回 <xref:System.Runtime.DurableInstancing.InstancePersistenceException>。</span><span class="sxs-lookup"><span data-stu-id="1d790-127">If the ActivationType is not set to WAS, the SQL Workflow Instance Store throws an <xref:System.Runtime.DurableInstancing.InstancePersistenceException>.</span></span> <span data-ttu-id="1d790-128">Workflow Management Service 隨附[!INCLUDE[dublin](../../../includes/dublin-md.md)]是泛型主機，已啟動類型設定為**WAS**。</span><span class="sxs-lookup"><span data-stu-id="1d790-128">The Workflow Management Service that ships with the [!INCLUDE[dublin](../../../includes/dublin-md.md)] is a generic host that has the activation type set to **WAS**.</span></span>  
  
 <span data-ttu-id="1d790-129">針對 WAS 啟動，泛型主機需要一組啟動參數，才能衍生能夠用於啟動新主機的端點位址。</span><span class="sxs-lookup"><span data-stu-id="1d790-129">For WAS activation, a generic host requires a set of activation parameters to derive the endpoint address at which new hosts can be activated.</span></span> <span data-ttu-id="1d790-130">WAS 啟動的啟動參數是網站的名稱、應用程式的路徑 (相對於網站)，以及服務的路徑 (相對於應用程式)。</span><span class="sxs-lookup"><span data-stu-id="1d790-130">The activation parameters for WAS activation are name of the site, path to the application relative to the site, and path to the service relative to the application.</span></span> <span data-ttu-id="1d790-131">SQL 工作流程執行個體存放區會在執行 <xref:System.Activities.DurableInstancing.SaveWorkflowCommand> 的期間存放這些啟動參數。</span><span class="sxs-lookup"><span data-stu-id="1d790-131">The SQL Workflow Instance Store stores these activation parameters during the execution of the <xref:System.Activities.DurableInstancing.SaveWorkflowCommand>.</span></span>  
  
## <a name="runnable-instances-detection-period"></a><span data-ttu-id="1d790-132">可執行的執行個體偵測週期</span><span class="sxs-lookup"><span data-stu-id="1d790-132">Runnable Instances Detection Period</span></span>  
 <span data-ttu-id="1d790-133">**可執行個體偵測週期**SQL 工作流程執行個體存放區的屬性會指定時間週期之後，SQL 工作流程執行個體存放區會執行偵測工作，偵測到任何可執行或可啟動的工作流程在上一個偵測循環之後，持續性資料庫中的執行個體。</span><span class="sxs-lookup"><span data-stu-id="1d790-133">The **Runnable Instances Detection Period** property of the SQL Workflow Instance Store specifies the time period after which the SQL Workflow Instance Store runs a detection task to detect any runnable or activatable workflow instances in the persistence database after the previous detection cycle.</span></span> <span data-ttu-id="1d790-134">請參閱[可執行個體偵測週期](../../../docs/framework/windows-workflow-foundation/runnable-instances-detection-period.md)如需有關這個屬性。</span><span class="sxs-lookup"><span data-stu-id="1d790-134">See [Runnable Instances Detection Period](../../../docs/framework/windows-workflow-foundation/runnable-instances-detection-period.md) for more details on this property.</span></span>
