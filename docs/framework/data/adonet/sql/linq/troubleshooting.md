---
title: "疑難排解"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 8cd4401c-b12c-4116-a421-f3dcffa65670
caps.latest.revision: "3"
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload: dotnet
ms.openlocfilehash: 56d06fa7adf2690a2cb9194342071c7814a4ec4a
ms.sourcegitcommit: ed26cfef4e18f6d93ab822d8c29f902cff3519d1
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/17/2018
---
# <a name="troubleshooting"></a><span data-ttu-id="27a8a-102">疑難排解</span><span class="sxs-lookup"><span data-stu-id="27a8a-102">Troubleshooting</span></span>
<span data-ttu-id="27a8a-103">下列資訊將說明一些您在 [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] 應用程式中可能會遇到的問題，並提供建議來避免或降低這些問題的影響。</span><span class="sxs-lookup"><span data-stu-id="27a8a-103">The following information exposes some issues you might encounter in your [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] applications, and provides suggestions to avoid or otherwise reduce the effect of these issues.</span></span>  
  
 <span data-ttu-id="27a8a-104">其他問題已解決[常見問題集](../../../../../../docs/framework/data/adonet/sql/linq/frequently-asked-questions.md)。</span><span class="sxs-lookup"><span data-stu-id="27a8a-104">Additional issues are addressed in [Frequently Asked Questions](../../../../../../docs/framework/data/adonet/sql/linq/frequently-asked-questions.md).</span></span>  
  
## <a name="unsupported-standard-query-operators"></a><span data-ttu-id="27a8a-105">不支援的標準查詢運算子</span><span class="sxs-lookup"><span data-stu-id="27a8a-105">Unsupported Standard Query Operators</span></span>  
 [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]<span data-ttu-id="27a8a-106"> 並非支援所有標準查詢運算子方法 (例如 <xref:System.Linq.Enumerable.ElementAt%2A>)。</span><span class="sxs-lookup"><span data-stu-id="27a8a-106"> does not support all standard query operator methods (for example, <xref:System.Linq.Enumerable.ElementAt%2A>).</span></span> <span data-ttu-id="27a8a-107">因此，專案即使可以編譯，仍可能產生執行階段錯誤。</span><span class="sxs-lookup"><span data-stu-id="27a8a-107">As a result, projects that compile can still produce run-time errors.</span></span> <span data-ttu-id="27a8a-108">如需詳細資訊，請參閱[標準查詢運算子轉譯](../../../../../../docs/framework/data/adonet/sql/linq/standard-query-operator-translation.md)。</span><span class="sxs-lookup"><span data-stu-id="27a8a-108">For more information, see [Standard Query Operator Translation](../../../../../../docs/framework/data/adonet/sql/linq/standard-query-operator-translation.md).</span></span>  
  
## <a name="memory-issues"></a><span data-ttu-id="27a8a-109">記憶體問題</span><span class="sxs-lookup"><span data-stu-id="27a8a-109">Memory Issues</span></span>  
 <span data-ttu-id="27a8a-110">如果查詢牽涉到記憶體中集合和[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <xref:System.Data.Linq.Table%601>，在記憶體中，指定兩個集合的順序而定，可能會執行查詢。</span><span class="sxs-lookup"><span data-stu-id="27a8a-110">If a query involves an in-memory collection and [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <xref:System.Data.Linq.Table%601>, the query might be executed in memory, depending on the order in which the two collections are specified.</span></span> <span data-ttu-id="27a8a-111">如果查詢必須在記憶體中執行，則必須擷取資料庫資料表中的資料。</span><span class="sxs-lookup"><span data-stu-id="27a8a-111">If the query must be executed in memory, then the data from the database table will need to be retrieved.</span></span>  
  
 <span data-ttu-id="27a8a-112">這種方式沒有效率，而且可能會耗用大量的記憶體和處理器資源。</span><span class="sxs-lookup"><span data-stu-id="27a8a-112">This approach is inefficient and could result in significant memory and processor usage.</span></span> <span data-ttu-id="27a8a-113">請盡量避免這種多重定義域查詢。</span><span class="sxs-lookup"><span data-stu-id="27a8a-113">Try to avoid such multi-domain queries.</span></span>  
  
## <a name="file-names-and-sqlmetal"></a><span data-ttu-id="27a8a-114">檔案名稱和 SQLMetal</span><span class="sxs-lookup"><span data-stu-id="27a8a-114">File Names and SQLMetal</span></span>  
 <span data-ttu-id="27a8a-115">若要指定輸入檔案名稱，請將名稱以輸入檔案加入命令列。</span><span class="sxs-lookup"><span data-stu-id="27a8a-115">To specify an input file name, add the name to the command line as the input file.</span></span> <span data-ttu-id="27a8a-116">不支援將檔案名稱包含在連接字串中 (使用 **/conn** 選項)。</span><span class="sxs-lookup"><span data-stu-id="27a8a-116">Including the file name in the connection string (using the **/conn** option) is not supported.</span></span> <span data-ttu-id="27a8a-117">如需詳細資訊，請參閱 [SqlMetal.exe (程式碼產生工具)](../../../../../../docs/framework/tools/sqlmetal-exe-code-generation-tool.md)。</span><span class="sxs-lookup"><span data-stu-id="27a8a-117">For more information, see [SqlMetal.exe (Code Generation Tool)](../../../../../../docs/framework/tools/sqlmetal-exe-code-generation-tool.md).</span></span>  
  
## <a name="class-library-projects"></a><span data-ttu-id="27a8a-118">類別庫專案</span><span class="sxs-lookup"><span data-stu-id="27a8a-118">Class Library Projects</span></span>  
 <span data-ttu-id="27a8a-119">[!INCLUDE[vs_ordesigner_long](../../../../../../includes/vs-ordesigner-long-md.md)]會在專案的 `app.config` 檔案中建立連接字串。</span><span class="sxs-lookup"><span data-stu-id="27a8a-119">The [!INCLUDE[vs_ordesigner_long](../../../../../../includes/vs-ordesigner-long-md.md)] creates a connection string in the `app.config` file of the project.</span></span> <span data-ttu-id="27a8a-120">類別庫專案不使用 `app.config` 檔案。</span><span class="sxs-lookup"><span data-stu-id="27a8a-120">In class library projects, the `app.config` file is not used.</span></span> [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]<span data-ttu-id="27a8a-121"> 會使用設計階段檔案中提供的連接字串。</span><span class="sxs-lookup"><span data-stu-id="27a8a-121"> uses the Connection String provided in the design-time files.</span></span> <span data-ttu-id="27a8a-122">變更 `app.config` 中的值不會變更應用程式所連接的資料庫。</span><span class="sxs-lookup"><span data-stu-id="27a8a-122">Changing the value in `app.config` does not change the database to which your application connects.</span></span>  
  
## <a name="cascade-delete"></a><span data-ttu-id="27a8a-123">串聯刪除</span><span class="sxs-lookup"><span data-stu-id="27a8a-123">Cascade Delete</span></span>  
 [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]<span data-ttu-id="27a8a-124"> 不支援或辨識串聯 (Cascade) 刪除作業。</span><span class="sxs-lookup"><span data-stu-id="27a8a-124"> does not support or recognize cascade-delete operations.</span></span> <span data-ttu-id="27a8a-125">如果您要刪除有條件約束之資料表中的資料列，必須執行下列其中一項工作：</span><span class="sxs-lookup"><span data-stu-id="27a8a-125">If you want to delete a row in a table that has constraints against it, you must do either of the following:</span></span>  
  
-   <span data-ttu-id="27a8a-126">在資料庫的外部索引鍵條件約束中設定 `ON DELETE CASCADE` 規則。</span><span class="sxs-lookup"><span data-stu-id="27a8a-126">Set the `ON DELETE CASCADE` rule in the foreign-key constraint in the database.</span></span>  
  
-   <span data-ttu-id="27a8a-127">使用您自己的程式碼，先刪除使父物件無法刪除的子物件。</span><span class="sxs-lookup"><span data-stu-id="27a8a-127">Use your own code to first delete the child objects that prevent the parent object from being deleted.</span></span>  
  
 <span data-ttu-id="27a8a-128">否則會擲回 <xref:System.Data.SqlClient.SqlException> 例外狀況。</span><span class="sxs-lookup"><span data-stu-id="27a8a-128">Otherwise, a <xref:System.Data.SqlClient.SqlException> exception is thrown.</span></span>  
  
 <span data-ttu-id="27a8a-129">如需詳細資訊，請參閱[How to： 資料列從資料庫刪除](../../../../../../docs/framework/data/adonet/sql/linq/how-to-delete-rows-from-the-database.md)。</span><span class="sxs-lookup"><span data-stu-id="27a8a-129">For more information, see [How to: Delete Rows From the Database](../../../../../../docs/framework/data/adonet/sql/linq/how-to-delete-rows-from-the-database.md).</span></span>  
  
## <a name="expression-not-queryable"></a><span data-ttu-id="27a8a-130">無法查詢運算式</span><span class="sxs-lookup"><span data-stu-id="27a8a-130">Expression Not Queryable</span></span>  
 <span data-ttu-id="27a8a-131">如果您看到「運算式 [expression] 無法查詢；是否遺漏組件參考？」</span><span class="sxs-lookup"><span data-stu-id="27a8a-131">If you get the "Expression [expression] is not queryable; are you missing an assembly reference?"</span></span> <span data-ttu-id="27a8a-132">錯誤，請確定下列各項：</span><span class="sxs-lookup"><span data-stu-id="27a8a-132">error, make sure of the following:</span></span>  
  
-   <span data-ttu-id="27a8a-133">應用程式的目標為 [!INCLUDE[compact_v35_short](../../../../../../includes/compact-v35-short-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="27a8a-133">Your application is targeting [!INCLUDE[compact_v35_short](../../../../../../includes/compact-v35-short-md.md)].</span></span>  
  
-   <span data-ttu-id="27a8a-134">您有 `System.Core.dll` 和 `System.Data.Linq.dll` 的參考。</span><span class="sxs-lookup"><span data-stu-id="27a8a-134">You have a reference to `System.Core.dll` and `System.Data.Linq.dll`.</span></span>  
  
-   <span data-ttu-id="27a8a-135">`Imports` 和 [!INCLUDE[vbprvb](../../../../../../includes/vbprvb-md.md)] 有 `using` (<xref:System.Linq>) 或 <xref:System.Data.Linq> (C#) 指示詞。</span><span class="sxs-lookup"><span data-stu-id="27a8a-135">You have an `Imports` ([!INCLUDE[vbprvb](../../../../../../includes/vbprvb-md.md)]) or `using` (C#) directive for <xref:System.Linq> and <xref:System.Data.Linq>.</span></span>  
  
## <a name="duplicatekeyexception"></a><span data-ttu-id="27a8a-136">DuplicateKeyException</span><span class="sxs-lookup"><span data-stu-id="27a8a-136">DuplicateKeyException</span></span>  
 <span data-ttu-id="27a8a-137">在偵錯[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]專案中，您可能會周遊某個實體的關聯。</span><span class="sxs-lookup"><span data-stu-id="27a8a-137">In the course of debugging a [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] project, you might traverse an entity's relations.</span></span> <span data-ttu-id="27a8a-138">如此一來這些項目帶入快取，和[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]變成知道它們的存在。</span><span class="sxs-lookup"><span data-stu-id="27a8a-138">Doing so brings these items into the cache, and [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] becomes aware of their presence.</span></span> <span data-ttu-id="27a8a-139">如果您接著嘗試執行 <xref:System.Data.Linq.Table%601.Attach%2A> 或 <xref:System.Data.Linq.Table%601.InsertOnSubmit%2A>，或是類似方法來產生有相同索引鍵的多個資料列，就會擲回 <xref:System.Data.Linq.DuplicateKeyException>。</span><span class="sxs-lookup"><span data-stu-id="27a8a-139">If you then try to execute <xref:System.Data.Linq.Table%601.Attach%2A> or <xref:System.Data.Linq.Table%601.InsertOnSubmit%2A> or a similar method that produces multiple rows that have the same key, a <xref:System.Data.Linq.DuplicateKeyException> is thrown.</span></span>  
  
## <a name="string-concatenation-exceptions"></a><span data-ttu-id="27a8a-140">字串串連例外狀況</span><span class="sxs-lookup"><span data-stu-id="27a8a-140">String Concatenation Exceptions</span></span>  
 <span data-ttu-id="27a8a-141">串連對應到 `[n]text` 和其他 `[n][var]char` 的運算元是不支援的做法。</span><span class="sxs-lookup"><span data-stu-id="27a8a-141">Concatenation on operands mapped to `[n]text` and other `[n][var]char` is not supported.</span></span> <span data-ttu-id="27a8a-142">串連對應到兩組不同型別的字串時，會擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="27a8a-142">An exception is thrown for concatenation of strings mapped to the two different sets of types.</span></span> <span data-ttu-id="27a8a-143">如需詳細資訊，請參閱[System.String 方法](../../../../../../docs/framework/data/adonet/sql/linq/system-string-methods.md)。</span><span class="sxs-lookup"><span data-stu-id="27a8a-143">For more information, see [System.String Methods](../../../../../../docs/framework/data/adonet/sql/linq/system-string-methods.md).</span></span>  
  
## <a name="skip-and-take-exceptions-in-sql-server-2000"></a><span data-ttu-id="27a8a-144">SQL Server 2000 中的 Skip 和 Take 例外狀況</span><span class="sxs-lookup"><span data-stu-id="27a8a-144">Skip and Take Exceptions in SQL Server 2000</span></span>  
 <span data-ttu-id="27a8a-145">當您對 SQL Server 2000 資料庫使用 <xref:System.Data.Linq.Mapping.ColumnAttribute.IsPrimaryKey%2A> 或 <xref:System.Linq.Queryable.Take%2A> 時，必須使用識別成員 (<xref:System.Linq.Queryable.Skip%2A>)。</span><span class="sxs-lookup"><span data-stu-id="27a8a-145">You must use identity members (<xref:System.Data.Linq.Mapping.ColumnAttribute.IsPrimaryKey%2A>) when you use <xref:System.Linq.Queryable.Take%2A> or <xref:System.Linq.Queryable.Skip%2A> against a SQL Server 2000 database.</span></span> <span data-ttu-id="27a8a-146">此查詢必須針對單一資資料表 (即非聯結資料表) 執行，或為 <xref:System.Linq.Queryable.Distinct%2A>、<xref:System.Linq.Queryable.Except%2A>、<xref:System.Linq.Queryable.Intersect%2A> 或 <xref:System.Linq.Queryable.Union%2A> 作業，而且不能包含 <xref:System.Linq.Queryable.Concat%2A> 作業。</span><span class="sxs-lookup"><span data-stu-id="27a8a-146">The query must be against a single table (that is, not a join), or be a <xref:System.Linq.Queryable.Distinct%2A>, <xref:System.Linq.Queryable.Except%2A>, <xref:System.Linq.Queryable.Intersect%2A>, or <xref:System.Linq.Queryable.Union%2A> operation, and must not include a <xref:System.Linq.Queryable.Concat%2A> operation.</span></span> <span data-ttu-id="27a8a-147">如需詳細資訊，請參閱中的 < SQL Server 2000 支援 > 一節[標準查詢運算子轉譯](../../../../../../docs/framework/data/adonet/sql/linq/standard-query-operator-translation.md)。</span><span class="sxs-lookup"><span data-stu-id="27a8a-147">For more information, see the "SQL Server 2000 Support" section in [Standard Query Operator Translation](../../../../../../docs/framework/data/adonet/sql/linq/standard-query-operator-translation.md).</span></span>  
  
 <span data-ttu-id="27a8a-148">這項需求不適用於 [!INCLUDE[sqprsqlong](../../../../../../includes/sqprsqlong-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="27a8a-148">This requirement does not apply to [!INCLUDE[sqprsqlong](../../../../../../includes/sqprsqlong-md.md)].</span></span>  
  
## <a name="groupby-invalidoperationexception"></a><span data-ttu-id="27a8a-149">GroupBy InvalidOperationException</span><span class="sxs-lookup"><span data-stu-id="27a8a-149">GroupBy InvalidOperationException</span></span>  
 <span data-ttu-id="27a8a-150">當以 <xref:System.Linq.Enumerable.GroupBy%2A> 運算式做為群組依據 (例如 `boolean`) 的 `group x by (Phone==@phone)` 查詢有資料行的值為 null 時，會擲回此例外狀況。</span><span class="sxs-lookup"><span data-stu-id="27a8a-150">This exception is thrown when a column value is null in a <xref:System.Linq.Enumerable.GroupBy%2A> query that groups by a `boolean` expression, such as `group x by (Phone==@phone)`.</span></span> <span data-ttu-id="27a8a-151">因為運算式是`boolean`，金鑰就會推斷`boolean`，而非`nullable``boolean`。</span><span class="sxs-lookup"><span data-stu-id="27a8a-151">Because the expression is a `boolean`, the key is inferred to be `boolean`, not `nullable``boolean`.</span></span> <span data-ttu-id="27a8a-152">當轉譯後的比較產生 null 值時，嘗試指派`nullable``boolean`至`boolean`，並擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="27a8a-152">When the translated comparison produces a null, an attempt is made to assign a `nullable``boolean` to a `boolean`, and the exception is thrown.</span></span>  
  
 <span data-ttu-id="27a8a-153">為避免這個情況 (假設您要將 null 視為 false)，請使用類似下列的方式：</span><span class="sxs-lookup"><span data-stu-id="27a8a-153">To avoid this situation (assuming you want to treat nulls as false), use an approach such as the following:</span></span>  
  
 `GroupBy="(Phone != null) && (Phone=@Phone)"`  
  
## <a name="oncreated-partial-method"></a><span data-ttu-id="27a8a-154">OnCreated() 部分方法</span><span class="sxs-lookup"><span data-stu-id="27a8a-154">OnCreated() Partial Method</span></span>  
 <span data-ttu-id="27a8a-155">每次呼叫物件建構函式時，都會呼叫產生的方法 `OnCreated()`，包括 [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] 呼叫建構函式來複製原始值的情況。</span><span class="sxs-lookup"><span data-stu-id="27a8a-155">The generated method `OnCreated()` is called each time the object constructor is called, including the scenario in which [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] calls the constructor to make a copy for original values.</span></span> <span data-ttu-id="27a8a-156">如果您要在自己的部分類別中實作 `OnCreated()` 方法，請將此行為列入考量。</span><span class="sxs-lookup"><span data-stu-id="27a8a-156">Take this behavior into account if you implement the `OnCreated()` method in your own partial class.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="27a8a-157">請參閱</span><span class="sxs-lookup"><span data-stu-id="27a8a-157">See Also</span></span>  
 [<span data-ttu-id="27a8a-158">偵錯支援</span><span class="sxs-lookup"><span data-stu-id="27a8a-158">Debugging Support</span></span>](../../../../../../docs/framework/data/adonet/sql/linq/debugging-support.md)  
 [<span data-ttu-id="27a8a-159">常見問題集</span><span class="sxs-lookup"><span data-stu-id="27a8a-159">Frequently Asked Questions</span></span>](../../../../../../docs/framework/data/adonet/sql/linq/frequently-asked-questions.md)
