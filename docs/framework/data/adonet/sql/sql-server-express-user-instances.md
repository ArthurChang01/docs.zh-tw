---
title: "SQL Server Express 使用者執行個體"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: 00c12376-cb26-4317-86ad-e6e9c089be57
caps.latest.revision: "5"
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload: dotnet
ms.openlocfilehash: 55f3393c84ec08d3c3944552ac2bed7d15dd025f
ms.sourcegitcommit: ed26cfef4e18f6d93ab822d8c29f902cff3519d1
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/17/2018
---
# <a name="sql-server-express-user-instances"></a><span data-ttu-id="bdecf-102">SQL Server Express 使用者執行個體</span><span class="sxs-lookup"><span data-stu-id="bdecf-102">SQL Server Express User Instances</span></span>
<span data-ttu-id="bdecf-103">Microsoft SQL Server Express Edition (SQL Server Express) 支援使用者執行個體功能，只有在使用 .NET Framework Data Provider for SQL Server (`SqlClient`) 時才提供此功能。</span><span class="sxs-lookup"><span data-stu-id="bdecf-103">Microsoft SQL Server Express Edition (SQL Server Express) supports the user instance feature, which is only available when using the .NET Framework Data Provider for SQL Server (`SqlClient`).</span></span> <span data-ttu-id="bdecf-104">使用者執行個體是 SQL Server Express Database Engine 的獨立執行個體，由父執行個體所產生。</span><span class="sxs-lookup"><span data-stu-id="bdecf-104">A user instance is a separate instance of the SQL Server Express Database Engine that is generated by a parent instance.</span></span> <span data-ttu-id="bdecf-105">不是系統管理員的使用者可以透過使用者執行個體，從本機電腦附加及連接至 SQL Server Express 資料庫。</span><span class="sxs-lookup"><span data-stu-id="bdecf-105">User instances allow users who are not administrators on their local computers to attach and connect to SQL Server Express databases.</span></span> <span data-ttu-id="bdecf-106">每個執行個體都會依照「每個使用者一個執行個體」的基礎，在個別使用者的安全性內容下執行。</span><span class="sxs-lookup"><span data-stu-id="bdecf-106">Each instance runs under the security context of the individual user, on a one-instance-per-user basis.</span></span>  
  
## <a name="user-instance-capabilities"></a><span data-ttu-id="bdecf-107">使用者執行個體功能</span><span class="sxs-lookup"><span data-stu-id="bdecf-107">User Instance Capabilities</span></span>  
 <span data-ttu-id="bdecf-108">使用者執行個體對於在最小權限使用者帳戶 (LUA) 下執行的使用者而言很有用，因為每個使用者都對在其電腦上執行的執行個體擁有 SQL Server 系統管理員 (`sysadmin`) 權限，而不需同時以 Windows 系統管理員的身分執行。</span><span class="sxs-lookup"><span data-stu-id="bdecf-108">User instances are useful for users who are running Windows under a least-privilege user account (LUA) because each user has SQL Server system administrator (`sysadmin`) privileges over the instance running on her computer without needing to run as a Windows administrator as well.</span></span> <span data-ttu-id="bdecf-109">在使用者執行個體上執行但僅具有有限權限的軟體不能進行整個系統範圍的變更，因為 SQL Server Express 的執行個體是在使用者的非系統管理員 Windows 帳戶下執行，而非以服務方式執行。</span><span class="sxs-lookup"><span data-stu-id="bdecf-109">Software executing on a user instance with limited permissions cannot make system-wide changes because the instance of SQL Server Express is running under the non-administrator Windows account of the user, not as a service.</span></span> <span data-ttu-id="bdecf-110">每個使用者執行個體都與其父執行個體以及在相同電腦上執行的任何其他使用者執行個體隔離。</span><span class="sxs-lookup"><span data-stu-id="bdecf-110">Each user instance is isolated from its parent instance and from any other user instances running on the same computer.</span></span> <span data-ttu-id="bdecf-111">在使用者執行個體上執行的資料庫只會以單一使用者模式開啟，因此無法連接多個使用者。</span><span class="sxs-lookup"><span data-stu-id="bdecf-111">Databases running on a user instance are opened in single-user mode only, and it is not possible for multiple users to connect to databases running on a user instance.</span></span> <span data-ttu-id="bdecf-112">使用者執行個體的複寫及分散式查詢功能也會停用。</span><span class="sxs-lookup"><span data-stu-id="bdecf-112">Replication and distributed queries are also disabled for user instances.</span></span>  
  
 <span data-ttu-id="bdecf-113">如需詳細資訊，請參閱《SQL Server 線上叢書》的＜使用者執行個體＞。</span><span class="sxs-lookup"><span data-stu-id="bdecf-113">For more information, see "User Instances" in SQL Server Books Online.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="bdecf-114">對於已是自己電腦系統管理員的使用者，或在牽涉到多個資料庫使用者的案例中，就不需要使用者執行個體。</span><span class="sxs-lookup"><span data-stu-id="bdecf-114">User instances are not needed for users who are already administrators on their own computers, or for scenarios involving multiple database users.</span></span>  
  
## <a name="enabling-user-instances"></a><span data-ttu-id="bdecf-115">啟用使用者執行個體</span><span class="sxs-lookup"><span data-stu-id="bdecf-115">Enabling User Instances</span></span>  
 <span data-ttu-id="bdecf-116">若要產生使用者執行個體，必須有執行中的 SQL Server Express 父執行個體。</span><span class="sxs-lookup"><span data-stu-id="bdecf-116">To generate user instances, a parent instance of SQL Server Express must be running.</span></span> <span data-ttu-id="bdecf-117">依預設會啟用使用者執行個體，SQL Server Express 安裝時，而且它們可以明確地啟用或停用系統管理員執行**sp_configure**系統預存程序與父執行個體上。</span><span class="sxs-lookup"><span data-stu-id="bdecf-117">User instances are enabled by default when SQL Server Express is installed, and they can be explicitly enabled or disabled by a system administrator executing the **sp_configure** system stored procedure on the parent instance.</span></span>  
  
```  
-- Enable user instances.  
sp_configure 'user instances enabled','1'   
  
-- Disable user instances.  
sp_configure 'user instances enabled','0'  
```  
  
 <span data-ttu-id="bdecf-118">使用者執行個體的網路通訊協定必須為本機「具名管道」(Named Pipe)。</span><span class="sxs-lookup"><span data-stu-id="bdecf-118">The network protocol for user instances must be local Named Pipes.</span></span> <span data-ttu-id="bdecf-119">無法在 SQL Server 的遠端執行個體上啟動使用者執行個體，也不允許 SQL Server 登入。</span><span class="sxs-lookup"><span data-stu-id="bdecf-119">A user instance cannot be started on a remote instance of SQL Server, and SQL Server logins are not allowed.</span></span>  
  
## <a name="connecting-to-a-user-instance"></a><span data-ttu-id="bdecf-120">連接至使用者執行個體</span><span class="sxs-lookup"><span data-stu-id="bdecf-120">Connecting to a User Instance</span></span>  
 <span data-ttu-id="bdecf-121">`User Instance`和`AttachDBFilename`<xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>關鍵字可以讓<xref:System.Data.SqlClient.SqlConnection>連接到使用者執行個體。</span><span class="sxs-lookup"><span data-stu-id="bdecf-121">The `User Instance` and `AttachDBFilename`<xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A> keywords allow a <xref:System.Data.SqlClient.SqlConnection> to connect to a user instance.</span></span> <span data-ttu-id="bdecf-122">使用者執行個體也受到 <xref:System.Data.SqlClient.SqlConnectionStringBuilder>`UserInstance` 和 `AttachDBFilename` 屬性的支援。</span><span class="sxs-lookup"><span data-stu-id="bdecf-122">User instances are also supported by the <xref:System.Data.SqlClient.SqlConnectionStringBuilder>`UserInstance` and `AttachDBFilename` properties.</span></span>  
  
 <span data-ttu-id="bdecf-123">請注意下列所示的範例連接字串：</span><span class="sxs-lookup"><span data-stu-id="bdecf-123">Note the following about the sample connection string shown below:</span></span>  
  
-   <span data-ttu-id="bdecf-124">`Data Source` 關鍵字參考到產生使用者執行個體的 SQL Server Express 父執行個體。</span><span class="sxs-lookup"><span data-stu-id="bdecf-124">The `Data Source` keyword refers to the parent instance of SQL Server Express that is generating the user instance.</span></span> <span data-ttu-id="bdecf-125">預設執行個體是 \sqlexpress。</span><span class="sxs-lookup"><span data-stu-id="bdecf-125">The default instance is .\sqlexpress.</span></span>  
  
-   <span data-ttu-id="bdecf-126">`Integrated Security` 設定為 `true`。</span><span class="sxs-lookup"><span data-stu-id="bdecf-126">`Integrated Security` is set to `true`.</span></span> <span data-ttu-id="bdecf-127">若要連接至使用者執行個體，必須使用「Windows 驗證」；SQL Server 登入則不受支援。</span><span class="sxs-lookup"><span data-stu-id="bdecf-127">To connect to a user instance, Windows Authentication is required; SQL Server logins are not supported.</span></span>  
  
-   <span data-ttu-id="bdecf-128">`User Instance` 會設定為 `true`，如此會叫用 (Invoke) 使用者執行個體 </span><span class="sxs-lookup"><span data-stu-id="bdecf-128">The `User Instance` is set to `true`, which invokes a user instance.</span></span> <span data-ttu-id="bdecf-129">(預設值為 `false`)。</span><span class="sxs-lookup"><span data-stu-id="bdecf-129">(The default is `false`.)</span></span>  
  
-   <span data-ttu-id="bdecf-130">`AttachDbFileName` 連接字串關鍵字是用以附加主要資料庫檔案 (.mdf)，其中必須包括完整的路徑名稱。</span><span class="sxs-lookup"><span data-stu-id="bdecf-130">The `AttachDbFileName` connection string keyword is used to attach the primary database file (.mdf), which must include the full path name.</span></span> <span data-ttu-id="bdecf-131">`AttachDbFileName` 也會對應至 <xref:System.Data.SqlClient.SqlConnection> 連接字串中的 "extended properties" 與 "initial file name" 索引鍵。</span><span class="sxs-lookup"><span data-stu-id="bdecf-131">`AttachDbFileName` also corresponds to the "extended properties" and "initial file name" keys within a <xref:System.Data.SqlClient.SqlConnection> connection string.</span></span>  
  
-   <span data-ttu-id="bdecf-132">包含在垂直線符號中的 `|DataDirectory|` 替代字串參考到開啟連接之應用程式的資料目錄，且提供相關路徑，指出 .mdf 和 .ldf 資料庫以及記錄檔的位置。</span><span class="sxs-lookup"><span data-stu-id="bdecf-132">The `|DataDirectory|` substitution string enclosed in the pipe symbols refers to the data directory of the application opening the connection and provides a relative path indicating the location of the .mdf and .ldf database and log files.</span></span> <span data-ttu-id="bdecf-133">如果想要在其他位置尋找這些檔案，則必須提供檔案的完整路徑。</span><span class="sxs-lookup"><span data-stu-id="bdecf-133">If you want to locate these files elsewhere, you must provide the full path to the files.</span></span>  
  
```  
Data Source=.\\SQLExpress;Integrated Security=true;  
User Instance=true;AttachDBFilename=|DataDirectory|\InstanceDB.mdf;  
Initial Catalog=InstanceDB;  
```  
  
> [!NOTE]
>  <span data-ttu-id="bdecf-134">您也可以使用<xref:System.Data.SqlClient.SqlConnectionStringBuilder><xref:System.Data.SqlClient.SqlConnectionStringBuilder.UserInstance%2A>和<xref:System.Data.SqlClient.SqlConnectionStringBuilder.AttachDBFilename%2A>屬性，以建立連接字串，在執行階段。</span><span class="sxs-lookup"><span data-stu-id="bdecf-134">You can also use the <xref:System.Data.SqlClient.SqlConnectionStringBuilder><xref:System.Data.SqlClient.SqlConnectionStringBuilder.UserInstance%2A> and <xref:System.Data.SqlClient.SqlConnectionStringBuilder.AttachDBFilename%2A> properties to build a connection string at run time.</span></span>  
  
### <a name="using-the-124datadirectory124-substitution-string"></a><span data-ttu-id="bdecf-135">使用 &#124; DataDirectory &#124;替代字串</span><span class="sxs-lookup"><span data-stu-id="bdecf-135">Using the &#124;DataDirectory&#124; Substitution String</span></span>  
 <span data-ttu-id="bdecf-136">`AttachDbFileName` 在 ADO.NET 2.0 中已藉由引進 `|DataDirectory|` (放在垂直線符號內) 替代字串而擴充。</span><span class="sxs-lookup"><span data-stu-id="bdecf-136">`AttachDbFileName` was extended in ADO.NET 2.0 with the introduction of the `|DataDirectory|` (enclosed in pipe symbols) substitution string.</span></span> <span data-ttu-id="bdecf-137">`DataDirectory` 可與 `AttachDbFileName` 搭配使用以表示資料檔案的相對路徑，開發人員因此能根據資料來源的相對路徑建立連接字串，而不需指定完整路徑。</span><span class="sxs-lookup"><span data-stu-id="bdecf-137">`DataDirectory` is used in conjunction with `AttachDbFileName` to indicate a relative path to a data file, allowing developers to create connection strings that are based on a relative path to the data source instead of being required to specify a full path.</span></span>  
  
 <span data-ttu-id="bdecf-138">`DataDirectory` 所指向的實體位置，是根據應用程式的類型而定。</span><span class="sxs-lookup"><span data-stu-id="bdecf-138">The physical location that `DataDirectory` points to depends on the type of application.</span></span> <span data-ttu-id="bdecf-139">在這個範例中，要附加的 Northwind.mdf 檔案是位於應用程式的 \app_data 資料夾中。</span><span class="sxs-lookup"><span data-stu-id="bdecf-139">In this example, the Northwind.mdf file to be attached is located in the application's \app_data folder.</span></span>  
  
```  
Data Source=.\\SQLExpress;Integrated Security=true;  
User Instance=true;  
AttachDBFilename=|DataDirectory|\app_data\Northwind.mdf;  
Initial Catalog=Northwind;  
```  
  
 <span data-ttu-id="bdecf-140">在使用 `DataDirectory` 時，產生的檔案路徑在目錄結構中不能高過替代字串所指向的目錄。</span><span class="sxs-lookup"><span data-stu-id="bdecf-140">When `DataDirectory` is used, the resulting file path cannot be higher in the directory structure than the directory pointed to by the substitution string.</span></span> <span data-ttu-id="bdecf-141">例如，如果完全展開的 `DataDirectory` 為 C:\AppDirectory\app_data，則可以使用上述的範例連接字串，因為它是在 c:\AppDirectory 之下。</span><span class="sxs-lookup"><span data-stu-id="bdecf-141">For example, if the fully expanded `DataDirectory` is C:\AppDirectory\app_data, then the sample connection string shown above works because it is below c:\AppDirectory.</span></span> <span data-ttu-id="bdecf-142">不過，嘗試將 `DataDirectory` 指定為 `|DataDirectory|\..\data` 將會導致錯誤，因為 \data 不是 \AppDirectory 的子目錄。</span><span class="sxs-lookup"><span data-stu-id="bdecf-142">However, attempting to specify `DataDirectory` as `|DataDirectory|\..\data` will result in an error because \data is not a subdirectory of \AppDirectory.</span></span>  
  
 <span data-ttu-id="bdecf-143">如果連接字串具有格式設定錯誤的替代字串，則會顯示 <xref:System.ArgumentException>。</span><span class="sxs-lookup"><span data-stu-id="bdecf-143">If the connection string has an improperly formatted substitution string, an <xref:System.ArgumentException> will be thrown.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="bdecf-144"><xref:System.Data.SqlClient> 會根據本機電腦檔案系統，將替代字串解析為完整路徑。</span><span class="sxs-lookup"><span data-stu-id="bdecf-144"><xref:System.Data.SqlClient> resolves the substitution strings into full paths against the local computer file system.</span></span> <span data-ttu-id="bdecf-145">因此，遠端伺服器、HTTP 和 UNC 路徑名稱並不受支援。</span><span class="sxs-lookup"><span data-stu-id="bdecf-145">Therefore, remote server, HTTP, and UNC path names are not supported.</span></span> <span data-ttu-id="bdecf-146">如果伺服器不位於本機電腦，則在開啟連接時會擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="bdecf-146">An exception is thrown when the connection is opened if the server is not located on the local computer.</span></span>  
  
 <span data-ttu-id="bdecf-147">當 <xref:System.Data.SqlClient.SqlConnection> 開啟時，會從預設的 SQL Server Express 執行個體重新導向至在執行階段初始化，且在呼叫端帳戶下執行的執行個體。</span><span class="sxs-lookup"><span data-stu-id="bdecf-147">When the <xref:System.Data.SqlClient.SqlConnection> is opened, it is redirected from the default SQL Server Express instance to a run-time initiated instance running under the caller's account.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="bdecf-148">可能需要增加 <xref:System.Data.SqlClient.SqlConnection.ConnectionTimeout%2A> 值可能需要增加，因為載入使用者執行個體所花費的時間可能比一般的執行個體長。</span><span class="sxs-lookup"><span data-stu-id="bdecf-148">It may be necessary to increase the <xref:System.Data.SqlClient.SqlConnection.ConnectionTimeout%2A> value since user instances may take longer to load than regular instances.</span></span>  
  
 <span data-ttu-id="bdecf-149">下列的程式碼片段會開啟新的 `SqlConnection`、在主控台 (Console) 視窗中顯示連接字串，然後在結束 `using` 程式碼區塊時關閉連接。</span><span class="sxs-lookup"><span data-stu-id="bdecf-149">The following code fragment opens a new `SqlConnection`, displays the connection string in the console window, and then closes the connection when exiting the `using` code block.</span></span>  
  
```vb  
Private Sub OpenSqlConnection()  
    ' Retrieve the connection string.  
    Dim connectionString As String = GetConnectionString()  
  
    Using connection As New SqlConnection(connectionString)  
        connection.Open()  
        Console.WriteLine("ConnectionString: {0}", _  
           connection.ConnectionString)  
    End Using  
End Sub  
```  
  
```csharp  
private static void OpenSqlConnection()  
{  
    // Retrieve the connection string.  
    string connectionString = GetConnectionString();  
  
    using (SqlConnection connection =   
        new SqlConnection(connectionString))  
    {  
        connection.Open();  
        Console.WriteLine("ConnectionString: {0}",   
             connection.ConnectionString);  
    }  
}  
```  
  
> [!NOTE]
>  <span data-ttu-id="bdecf-150">在 SQL Server 內執行的 Common Language Runtime (CLR) 程式碼中不支援使用者執行個體。</span><span class="sxs-lookup"><span data-stu-id="bdecf-150">User instances are not supported in common language runtime (CLR) code that is running inside of SQL Server.</span></span> <span data-ttu-id="bdecf-151">如果在連接字串中有 <xref:System.InvalidOperationException> 的 `Open` 上呼叫 <xref:System.Data.SqlClient.SqlConnection>，則會擲回 `User Instance=true`。</span><span class="sxs-lookup"><span data-stu-id="bdecf-151">An <xref:System.InvalidOperationException> is thrown if `Open` is called on a <xref:System.Data.SqlClient.SqlConnection> that has `User Instance=true` in the connection string.</span></span>  
  
## <a name="lifetime-of-a-user-instance-connection"></a><span data-ttu-id="bdecf-152">使用者執行個體連接的存留期</span><span class="sxs-lookup"><span data-stu-id="bdecf-152">Lifetime of a User Instance Connection</span></span>  
 <span data-ttu-id="bdecf-153">與以服務方式執行的 SQL Server 版本不同，SQL Server Express 執行個體不需要以手動方式啟動及停止。</span><span class="sxs-lookup"><span data-stu-id="bdecf-153">Unlike versions of SQL Server that run as a service, SQL Server Express instances do not need to be manually started and stopped.</span></span> <span data-ttu-id="bdecf-154">使用者每次登入及連接至使用者執行個體時，使用者執行個體即會啟動 (如果尚未執行)。</span><span class="sxs-lookup"><span data-stu-id="bdecf-154">Each time a user logs in and connects to a user instance, the user instance is started if it is not already running.</span></span> <span data-ttu-id="bdecf-155">使用者執行個體資料庫會設定 `AutoClose` 選項，如此資料庫在一段時間未使用後，就會自動關閉。</span><span class="sxs-lookup"><span data-stu-id="bdecf-155">User instance databases have the `AutoClose` option set so that the database is automatically shut down after a period of inactivity.</span></span> <span data-ttu-id="bdecf-156">啟動的 sqlservr.exe 處理序會在最後的執行個體連接關閉後持續執行一段有限的逾時期限，這樣如果在逾時過期之前開啟另一個連接，就不需要重新啟動此處理序。</span><span class="sxs-lookup"><span data-stu-id="bdecf-156">The sqlservr.exe process that is started is kept running for a limited time-out period after the last connection to the instance is closed, so it does not need to be restarted if another connection is opened before the time-out has expired.</span></span> <span data-ttu-id="bdecf-157">如果在逾時期限過期之前沒有開啟任何新的連接，使用者執行個體就會自動關閉。</span><span class="sxs-lookup"><span data-stu-id="bdecf-157">The user instance automatically shuts down if no new connection opens before that time-out period has expired.</span></span> <span data-ttu-id="bdecf-158">父執行個體上的系統管理員可以使用設定的使用者執行個體的逾時期限的持續時間**sp_configure**變更**使用者執行個體逾時**選項。</span><span class="sxs-lookup"><span data-stu-id="bdecf-158">A system administrator on the parent instance can set the duration of the time-out period for a user instance by using **sp_configure** to change the **user instance timeout** option.</span></span> <span data-ttu-id="bdecf-159">預設值是 60 分鐘。</span><span class="sxs-lookup"><span data-stu-id="bdecf-159">The default is 60 minutes.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="bdecf-160">如果在連接字串中使用值大於零的 `Min Pool Size`，則連接集區一定會維持一些開啟的連接，而使用者執行個體也不會自動關閉。</span><span class="sxs-lookup"><span data-stu-id="bdecf-160">If `Min Pool Size` is used in the connection string with a value greater than zero, the connection pooler will always maintain a few opened connections, and the user instance will not automatically shut down.</span></span>  
  
## <a name="how-user-instances-work"></a><span data-ttu-id="bdecf-161">使用者執行個體的運作方式</span><span class="sxs-lookup"><span data-stu-id="bdecf-161">How User Instances Work</span></span>  
 <span data-ttu-id="bdecf-162">每個使用者產生使用者執行個體第一次**主要**和**msdb**系統資料庫會從 Template Data 資料夾複製到下使用者的本機應用程式資料儲存機制的路徑專供使用者執行個體的目錄。</span><span class="sxs-lookup"><span data-stu-id="bdecf-162">The first time a user instance is generated for each user, the **master** and **msdb** system databases are copied from the Template Data folder to a path under the user's local application data repository directory for exclusive use by the user instance.</span></span> <span data-ttu-id="bdecf-163">這個路徑通常是 `C:\Documents and Settings\<UserName>\Local Settings\Application Data\Microsoft\Microsoft SQL Server Data\SQLEXPRESS`。</span><span class="sxs-lookup"><span data-stu-id="bdecf-163">This path is typically `C:\Documents and Settings\<UserName>\Local Settings\Application Data\Microsoft\Microsoft SQL Server Data\SQLEXPRESS`.</span></span> <span data-ttu-id="bdecf-164">當使用者執行個體啟動時， **tempdb**、 記錄檔，以及追蹤檔案也會寫入到這個目錄。</span><span class="sxs-lookup"><span data-stu-id="bdecf-164">When a user instance starts up, the **tempdb**, log, and trace files are also written to this directory.</span></span> <span data-ttu-id="bdecf-165">接著執行個體的名稱就會產生，而每個使用者的名稱保證都是唯一的。</span><span class="sxs-lookup"><span data-stu-id="bdecf-165">A name is generated for the instance, which is guaranteed to be unique for each user.</span></span>  
  
 <span data-ttu-id="bdecf-166">根據預設，Windows Builtin\Users group 的所有成員都將獲得本機執行個體的連接權限，以及 SQL Server 二進位檔的讀取及執行權限。</span><span class="sxs-lookup"><span data-stu-id="bdecf-166">By default all members of the Windows Builtin\Users group are granted permissions to connect on the local instance as well as read and execute permissions on the SQL Server binaries.</span></span> <span data-ttu-id="bdecf-167">一旦確認裝載使用者執行個體的呼叫使用者認證，該使用者即可成為該執行個體的 `sysadmin`。</span><span class="sxs-lookup"><span data-stu-id="bdecf-167">Once the credentials of the calling user hosting the user instance have been verified, that user becomes the `sysadmin` on that instance.</span></span> <span data-ttu-id="bdecf-168">只能針對使用者執行個體啟用共用記憶體，這表示只能在本機電腦上進行作業。</span><span class="sxs-lookup"><span data-stu-id="bdecf-168">Only shared memory is enabled for user instances, which means that only operations on the local machine are possible.</span></span>  
  
 <span data-ttu-id="bdecf-169">連接字串中所指定之 .mdf 和 .ldf 檔案的讀取及寫入權限都必須授與使用者。</span><span class="sxs-lookup"><span data-stu-id="bdecf-169">Users must be granted both read and write permissions on the .mdf and .ldf files specified in the connection string.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="bdecf-170">.mdf 和 .ldf 檔案分別代表資料庫及記錄檔，</span><span class="sxs-lookup"><span data-stu-id="bdecf-170">The .mdf and .ldf files represent the database and log files, respectively.</span></span> <span data-ttu-id="bdecf-171">這兩個檔是相對應的組合，所以在備份及還原作業時必須特別小心。</span><span class="sxs-lookup"><span data-stu-id="bdecf-171">These two files are a matched set, so care must be taken during backup and restore operations.</span></span> <span data-ttu-id="bdecf-172">資料庫檔案包含有關記錄檔確實版本的詳細資訊，而且如果配對的記錄檔錯誤，就無法開啟資料庫。</span><span class="sxs-lookup"><span data-stu-id="bdecf-172">The database file contains information about the exact version of the log file, and the database will not open if it is coupled with the wrong log file.</span></span>  
  
 <span data-ttu-id="bdecf-173">為了避免資料毀損，使用者執行個體中的資料庫將使用獨佔存取權開啟。</span><span class="sxs-lookup"><span data-stu-id="bdecf-173">To avoid data corruption, a database in the user instance is opened with exclusive access.</span></span> <span data-ttu-id="bdecf-174">如果兩個不同的使用者執行個體共用同一台電腦的相同資料庫，則第一個執行個體上的使用者必須先關閉資料庫，才能在第二個執行個體中開啟該資料庫。</span><span class="sxs-lookup"><span data-stu-id="bdecf-174">If two different user instances share the same database on the same computer, the user on the first instance must close the database before it can be opened in a second instance.</span></span>  
  
## <a name="user-instance-scenarios"></a><span data-ttu-id="bdecf-175">使用者執行個體案例</span><span class="sxs-lookup"><span data-stu-id="bdecf-175">User Instance Scenarios</span></span>  
 <span data-ttu-id="bdecf-176">使用者執行個體為資料庫應用程式的開發人員提供 SQL Server 資料存放區，且開發人員不需擁有開發電腦的系統管理員帳戶。</span><span class="sxs-lookup"><span data-stu-id="bdecf-176">User instances provide developers of database applications with a SQL Server data store that does not depend on developers having administrative accounts on their development computers.</span></span> <span data-ttu-id="bdecf-177">使用者執行個體是以 Access/Jet 模型為基礎，在此模型中，資料庫應用程式只需連接至檔案，使用者即可自動擁有所有資料庫物件的完整權限，而不需系統管理員介入授與權限。</span><span class="sxs-lookup"><span data-stu-id="bdecf-177">User instances are based on the Access/Jet model, where the database application simply connects to a file, and the user automatically has full permissions on all of the database objects without needing the intervention of a system administrator to grant permissions.</span></span> <span data-ttu-id="bdecf-178">執行個體是針對使用者在最小權限使用者帳戶 (LUA) 下執行，且不具有伺服器或本機電腦的系統管理員權限，但又需要建立資料庫物件和應用程式的狀況而設計。</span><span class="sxs-lookup"><span data-stu-id="bdecf-178">It is intended to work in situations where the user is running under a least-privilege user account (LUA) and does not have administrative privileges on the server or local machine, yet needs to create database objects and applications.</span></span> <span data-ttu-id="bdecf-179">使用者執行個體可以讓使用者在執行階段建立執行個體，以在使用者本身的安全性內容下執行，而不是在權限更高的系統服務安全性內容中執行。</span><span class="sxs-lookup"><span data-stu-id="bdecf-179">User instances allow users to create instances at run time that run under the user's own security context, and not in the security context of a more privileged system service.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="bdecf-180">適用使用者執行個體的案例，只限當所有使用它的應用程式都完全受到信任時。</span><span class="sxs-lookup"><span data-stu-id="bdecf-180">User instances should only be used in scenarios where all the applications using it are fully trusted.</span></span>  
  
 <span data-ttu-id="bdecf-181">使用者執行個體案例包括：</span><span class="sxs-lookup"><span data-stu-id="bdecf-181">User instance scenarios include:</span></span>  
  
-   <span data-ttu-id="bdecf-182">任何不需共用資料的單一使用者應用程式。</span><span class="sxs-lookup"><span data-stu-id="bdecf-182">Any single-user application where sharing data is not required.</span></span>  
  
-   <span data-ttu-id="bdecf-183">ClickOnce 佈署。</span><span class="sxs-lookup"><span data-stu-id="bdecf-183">ClickOnce deployment.</span></span> <span data-ttu-id="bdecf-184">如果目標電腦上已安裝 .NET Framework 2.0 (或更新版本) 和 SQL Server Express，則非系統管理員的使用者也可以安裝及使用因採取 ClickOnce 動作而下載的安裝套件。</span><span class="sxs-lookup"><span data-stu-id="bdecf-184">If the .NET Framework 2.0 (or later) and SQL Server Express are already installed on the target computer, the installation package downloaded as a result of a ClickOnce action can be installed and used by non-administrator users.</span></span> <span data-ttu-id="bdecf-185">請注意，如果 SQL Server Express 是安裝的一部分，則系統管理員必須加以安裝。</span><span class="sxs-lookup"><span data-stu-id="bdecf-185">Note that an administrator must install SQL Server Express if that is part of the setup.</span></span> <span data-ttu-id="bdecf-186">如需詳細資訊，請參閱[ClickOnce 部署的 Windows Form 應用程式](http://msdn.microsoft.com/en-us/34d8c770-48f2-460c-8d67-4ea5684511df)。</span><span class="sxs-lookup"><span data-stu-id="bdecf-186">For more information, see [ClickOnce Deployment for Windows Forms Applications](http://msdn.microsoft.com/en-us/34d8c770-48f2-460c-8d67-4ea5684511df).</span></span>  
  
-   <span data-ttu-id="bdecf-187">使用「Windows 驗證」的專屬 ASP . NET 裝載。</span><span class="sxs-lookup"><span data-stu-id="bdecf-187">Dedicated ASP.NET hosting using Windows Authentication.</span></span> <span data-ttu-id="bdecf-188">單一的 SQL Server Express 執行個體可以裝載在內部網路上。</span><span class="sxs-lookup"><span data-stu-id="bdecf-188">A single SQL Server Express instance can be hosted on an intranet.</span></span> <span data-ttu-id="bdecf-189">應用程式會使用 ASPNET Windows 帳戶連接，而不是使用模擬。</span><span class="sxs-lookup"><span data-stu-id="bdecf-189">The application connects using the ASPNET Windows account, not by using impersonation.</span></span> <span data-ttu-id="bdecf-190">使用者執行個體不該用於協力廠商或共用裝載的案例，因為在這些情況下，所有的應用程式都會共用相同的使用者執行個體，而無法彼此保持隔離。</span><span class="sxs-lookup"><span data-stu-id="bdecf-190">User instances should not be used for third-party or shared hosting scenarios where all applications would share the same user instance and would no longer remain isolated from each other.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="bdecf-191">請參閱</span><span class="sxs-lookup"><span data-stu-id="bdecf-191">See Also</span></span>  
 [<span data-ttu-id="bdecf-192">SQL Server 和 ADO.NET</span><span class="sxs-lookup"><span data-stu-id="bdecf-192">SQL Server and ADO.NET</span></span>](../../../../../docs/framework/data/adonet/sql/index.md)  
 [<span data-ttu-id="bdecf-193">連接字串</span><span class="sxs-lookup"><span data-stu-id="bdecf-193">Connection Strings</span></span>](../../../../../docs/framework/data/adonet/connection-strings.md)  
 [<span data-ttu-id="bdecf-194">連接至資料來源</span><span class="sxs-lookup"><span data-stu-id="bdecf-194">Connecting to a Data Source</span></span>](../../../../../docs/framework/data/adonet/connecting-to-a-data-source.md)  
 [<span data-ttu-id="bdecf-195">ADO.NET Managed 提供者和 DataSet 開發人員中心</span><span class="sxs-lookup"><span data-stu-id="bdecf-195">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
