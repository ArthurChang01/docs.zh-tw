---
title: 資料流處理提供者 (WCF Data Services)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF Data Services, providers
- WCF Data Services, binary data
- streaming data provider [WCF Data Services]
- WCF Data Services, streams
ms.assetid: f0978fe4-5f9f-42aa-a5c2-df395d7c9495
ms.openlocfilehash: 19571f3102039176ed4d8fab46a7f8229cbfecbe
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/22/2019
ms.locfileid: "59980534"
---
# <a name="streaming-provider-wcf-data-services"></a><span data-ttu-id="f8c42-102">資料流處理提供者 (WCF Data Services)</span><span class="sxs-lookup"><span data-stu-id="f8c42-102">Streaming Provider (WCF Data Services)</span></span>

<span data-ttu-id="f8c42-103">資料服務可以公開大型物件二進位資料。</span><span class="sxs-lookup"><span data-stu-id="f8c42-103">A data service can expose large object binary data.</span></span> <span data-ttu-id="f8c42-104">這項二進位資料可能代表視訊和音訊資料流、影像、文件檔案，或其他類型的二進位媒體。</span><span class="sxs-lookup"><span data-stu-id="f8c42-104">This binary data might represent video and audio streams, images, document files, or other types of binary media.</span></span> <span data-ttu-id="f8c42-105">當資料模型中的實體包含一個或多個二進位屬性時，資料服務會在回應摘要的項目內，傳回這個 base-64 編碼形式的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="f8c42-105">When an entity in the data model includes one or more binary properties, the data service returns this binary data encoded as base-64 inside the entry in the response feed.</span></span> <span data-ttu-id="f8c42-106">載入及序列化大型二進位資料，以這種方式可能會影響效能，因為[!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)]定義一個機制來獨立擷取二進位資料與其所屬的實體無關。</span><span class="sxs-lookup"><span data-stu-id="f8c42-106">Because loading and serializing large binary data in this manner can affect performance, the [!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)] defines a mechanism for retrieving binary data independent of the entity to which it belongs.</span></span> <span data-ttu-id="f8c42-107">只要將實體中的二進位資料分成一個或多個資料流就可以完成這項處理。</span><span class="sxs-lookup"><span data-stu-id="f8c42-107">This is accomplished by separating the binary data from the entity into one or more data streams.</span></span>

- <span data-ttu-id="f8c42-108">媒體資源 - 屬於實體的二進位資料，例如視訊、音訊、影像或其他類型的媒體資源資料流。</span><span class="sxs-lookup"><span data-stu-id="f8c42-108">Media resource - binary data that belongs to an entity, such as a video, audio, image or other type of media resource stream.</span></span>

- <span data-ttu-id="f8c42-109">媒體連結項目 - 具有相關媒體資源資料流之參考的實體。</span><span class="sxs-lookup"><span data-stu-id="f8c42-109">Media link entry - an entity that has a reference to a related media resource stream.</span></span>

<span data-ttu-id="f8c42-110">透過 [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]，您可以實作資料流處理資料提供者來定義二進位資源資料流。</span><span class="sxs-lookup"><span data-stu-id="f8c42-110">With [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], you define a binary resource stream by implementing a streaming data provider.</span></span> <span data-ttu-id="f8c42-111">資料流處理提供者實作會隨附做為特定實體相關聯的媒體資源資料流中的資料服務<xref:System.IO.Stream>物件。</span><span class="sxs-lookup"><span data-stu-id="f8c42-111">The streaming provider implementation supplies the data service with the media resource stream associated with a specific entity as an <xref:System.IO.Stream> object.</span></span> <span data-ttu-id="f8c42-112">這個實作可讓資料服務透過 HTTP 接受並傳回媒體資源當做指定之 MIME 類型的二進位資料流。</span><span class="sxs-lookup"><span data-stu-id="f8c42-112">This implementation enables the data service to accept and return media resources over HTTP as binary data streams of a specified MIME type.</span></span>

<span data-ttu-id="f8c42-113">設定資料服務來支援二進位資料的資料流處理需要進行以下步驟：</span><span class="sxs-lookup"><span data-stu-id="f8c42-113">Configuring a data service to support the streaming of binary data requires the following steps:</span></span>

1. <span data-ttu-id="f8c42-114">將資料模型中的一個或多個實體歸類為媒體連結項目。</span><span class="sxs-lookup"><span data-stu-id="f8c42-114">Attribute one or more entities in the data model as a media link entry.</span></span> <span data-ttu-id="f8c42-115">這些實體不應該包含要進行資料流處理的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="f8c42-115">These entities should not include the binary data to be streamed.</span></span> <span data-ttu-id="f8c42-116">實體的任何二進位屬性一定會在此項目中以 base-64 二進位編碼形式傳回。</span><span class="sxs-lookup"><span data-stu-id="f8c42-116">Any binary properties of an entity are always returned in the entry as base-64 encoded binary.</span></span>

2. <span data-ttu-id="f8c42-117">實作 T:System.Data.Services.Providers.IDataServiceStreamProvider 介面。</span><span class="sxs-lookup"><span data-stu-id="f8c42-117">Implement the T:System.Data.Services.Providers.IDataServiceStreamProvider interface.</span></span>

3. <span data-ttu-id="f8c42-118">定義資料服務來實作 <xref:System.IServiceProvider> 介面。</span><span class="sxs-lookup"><span data-stu-id="f8c42-118">Define a data service that implements the <xref:System.IServiceProvider> interface.</span></span> <span data-ttu-id="f8c42-119">此資料服務會使用 <xref:System.IServiceProvider.GetService%2A> 實作來存取資料流處理資料提供者實作。</span><span class="sxs-lookup"><span data-stu-id="f8c42-119">The data service uses the <xref:System.IServiceProvider.GetService%2A> implementation to access the streaming data provider implementation.</span></span> <span data-ttu-id="f8c42-120">這個方法會傳回適當的資料流處理提供者實作。</span><span class="sxs-lookup"><span data-stu-id="f8c42-120">This method returns the appropriate streaming provider implementation.</span></span>

4. <span data-ttu-id="f8c42-121">在 Web 應用程式組態中啟用大型訊息資料流。</span><span class="sxs-lookup"><span data-stu-id="f8c42-121">Enable large message streams in the Web application configuration.</span></span>

5. <span data-ttu-id="f8c42-122">啟用伺服器上或資料來源中之二進位資源的存取權。</span><span class="sxs-lookup"><span data-stu-id="f8c42-122">Enable access to binary resources on the server or in a data source.</span></span>

<span data-ttu-id="f8c42-123">本主題的範例以資料流處理相片服務，後者的討論文章中深入了解範例[資料服務資料流處理提供者系列：實作資料流處理提供者 （第 1 部分）](https://go.microsoft.com/fwlink/?LinkID=198989)。</span><span class="sxs-lookup"><span data-stu-id="f8c42-123">The examples in this topic are based on a sample streaming photo service, which is discussed in depth in the post [Data Services Streaming Provider Series: Implementing a Streaming Provider (Part 1)](https://go.microsoft.com/fwlink/?LinkID=198989).</span></span> <span data-ttu-id="f8c42-124">此範例服務的原始程式碼位於[資料流處理相片資料服務範例頁面](https://go.microsoft.com/fwlink/?LinkID=198988)MSDN Code Gallery 上。</span><span class="sxs-lookup"><span data-stu-id="f8c42-124">The source code for this sample service is available on the [Streaming Photo Data Service Sample page](https://go.microsoft.com/fwlink/?LinkID=198988) on MSDN Code Gallery.</span></span>

## <a name="defining-a-media-link-entry-in-the-data-model"></a><span data-ttu-id="f8c42-125">在資料模型中定義媒體連結項目</span><span class="sxs-lookup"><span data-stu-id="f8c42-125">Defining a Media Link Entry in the Data Model</span></span>

<span data-ttu-id="f8c42-126">資料來源提供者會判斷實體定義為資料模型中媒體連結項目的方式。</span><span class="sxs-lookup"><span data-stu-id="f8c42-126">The data source provider determines the way that an entity is defined as a media link entry in the data model.</span></span>

<span data-ttu-id="f8c42-127">**Entity Framework 提供者**</span><span class="sxs-lookup"><span data-stu-id="f8c42-127">**Entity Framework Provider**</span></span>

<span data-ttu-id="f8c42-128">若要指出某個實體為媒體連結項目，請在概念模型中的實體類型定義內加上 `HasStream` 屬性，如下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="f8c42-128">To indicate that an entity is a media link entry, add the `HasStream` attribute to the entity type definition in the conceptual model, as in the following example:</span></span>

[!code-xml[Astoria Photo Streaming Service#HasStream](../../../../samples/snippets/xml/VS_Snippets_Misc/astoria_photo_streaming_service/xml/photodata.edmx#hasstream)]

<span data-ttu-id="f8c42-129">您也必須將命名空間 `xmlns:m=http://schemas.microsoft.com/ado/2007/08/dataservices/metadata` 加入至實體或定義資料模型之 .edmx 或 .csdl 檔案的根。</span><span class="sxs-lookup"><span data-stu-id="f8c42-129">You must also add the namespace `xmlns:m=http://schemas.microsoft.com/ado/2007/08/dataservices/metadata` either to the entity or to the root of the .edmx or .csdl file that defines the data model.</span></span>

<span data-ttu-id="f8c42-130">如需使用的資料服務的範例[!INCLUDE[adonet_ef](../../../../includes/adonet-ef-md.md)]提供者和公開媒體資源，請參閱文章[資料服務資料流處理提供者系列：實作資料流處理提供者 （第 1 部分）](https://go.microsoft.com/fwlink/?LinkID=198989)。</span><span class="sxs-lookup"><span data-stu-id="f8c42-130">For an example of a data service that uses the [!INCLUDE[adonet_ef](../../../../includes/adonet-ef-md.md)] provider and exposes a media resource, see the post [Data Services Streaming Provider Series: Implementing a Streaming Provider (Part 1)](https://go.microsoft.com/fwlink/?LinkID=198989).</span></span>

<span data-ttu-id="f8c42-131">**反映提供者**</span><span class="sxs-lookup"><span data-stu-id="f8c42-131">**Reflection Provider**</span></span>

<span data-ttu-id="f8c42-132">若要指出某個實體為媒體連結項目，請將 <xref:System.Data.Services.Common.HasStreamAttribute> 加入至在反映提供者內定義實體類型的類別。</span><span class="sxs-lookup"><span data-stu-id="f8c42-132">To indicate that an entity is a media link entry, add the <xref:System.Data.Services.Common.HasStreamAttribute> to the class that defines the entity type in the reflection provider.</span></span>

<span data-ttu-id="f8c42-133">**自訂資料服務提供者**</span><span class="sxs-lookup"><span data-stu-id="f8c42-133">**Custom Data Service Provider**</span></span>

<span data-ttu-id="f8c42-134">使用自訂服務提供者時，您必須實作 <xref:System.Data.Services.Providers.IDataServiceMetadataProvider> 介面來定義資料服務的中繼資料。</span><span class="sxs-lookup"><span data-stu-id="f8c42-134">When using custom service providers, you implement the <xref:System.Data.Services.Providers.IDataServiceMetadataProvider> interface to define the metadata for your data service.</span></span> <span data-ttu-id="f8c42-135">如需詳細資訊，請參閱 <<c0> [ 自訂資料服務提供者](../../../../docs/framework/data/wcf/custom-data-service-providers-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="f8c42-135">For more information, see [Custom Data Service Providers](../../../../docs/framework/data/wcf/custom-data-service-providers-wcf-data-services.md).</span></span> <span data-ttu-id="f8c42-136">您可以在代表實體類型 (媒體連結項目) 的 <xref:System.Data.Services.Providers.ResourceType> 上，將 <xref:System.Data.Services.Providers.ResourceType.IsMediaLinkEntry%2A> 屬性設定為 `true`，藉以指出二進位資源資料流屬於 <xref:System.Data.Services.Providers.ResourceType>。</span><span class="sxs-lookup"><span data-stu-id="f8c42-136">You indicate that a binary resource stream belongs to a <xref:System.Data.Services.Providers.ResourceType> by setting the <xref:System.Data.Services.Providers.ResourceType.IsMediaLinkEntry%2A> property to `true` on the <xref:System.Data.Services.Providers.ResourceType> that represents the entity type, which is a media link entry.</span></span>

## <a name="implementing-the-idataservicestreamprovider-interface"></a><span data-ttu-id="f8c42-137">實作 IDataServiceStreamProvider 介面</span><span class="sxs-lookup"><span data-stu-id="f8c42-137">Implementing the IDataServiceStreamProvider Interface</span></span>

<span data-ttu-id="f8c42-138">若要建立支援二進位資料流的資料服務，您必須實作 <xref:System.Data.Services.Providers.IDataServiceStreamProvider> 介面。</span><span class="sxs-lookup"><span data-stu-id="f8c42-138">To create a data service that supports binary data streams, you must implement the <xref:System.Data.Services.Providers.IDataServiceStreamProvider> interface.</span></span> <span data-ttu-id="f8c42-139">這個實作可讓資料服務將二進位資料當做資料流傳回給用戶端，並將二進位資料當做從用戶端傳送的資料流來取用。</span><span class="sxs-lookup"><span data-stu-id="f8c42-139">This implementation enables the data service to return binary data as a stream to the client and consume binary data as a stream sent from the client.</span></span> <span data-ttu-id="f8c42-140">每當資料服務需要存取二進位資料當做資料流時，它就會建立此介面的執行個體。</span><span class="sxs-lookup"><span data-stu-id="f8c42-140">The data service creates an instance of this interface whenever it needs to access binary data as a stream.</span></span> <span data-ttu-id="f8c42-141"><xref:System.Data.Services.Providers.IDataServiceStreamProvider> 介面會指定下列成員：</span><span class="sxs-lookup"><span data-stu-id="f8c42-141">The <xref:System.Data.Services.Providers.IDataServiceStreamProvider> interface specifies the following members:</span></span>

|<span data-ttu-id="f8c42-142">成員名稱</span><span class="sxs-lookup"><span data-stu-id="f8c42-142">Member name</span></span>|<span data-ttu-id="f8c42-143">描述</span><span class="sxs-lookup"><span data-stu-id="f8c42-143">Description</span></span>|
|-----------------|-----------------|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.DeleteStream%2A>|<span data-ttu-id="f8c42-144">這個方法是由資料服務所叫用，在對應媒體資源的媒體連結項目遭到刪除時，一併刪除該媒體資源。</span><span class="sxs-lookup"><span data-stu-id="f8c42-144">This method is invoked by the data service to delete the corresponding media resource when its media link entry is deleted.</span></span> <span data-ttu-id="f8c42-145">當您實作 <xref:System.Data.Services.Providers.IDataServiceStreamProvider> 時，這個方法所包含的程式碼會刪除與提供之媒體連結項目相關聯的媒體資源。</span><span class="sxs-lookup"><span data-stu-id="f8c42-145">When you implement <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, this method contains the code that deletes the media resource associated with the supplied media link entry.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStream%2A>|<span data-ttu-id="f8c42-146">這個方法是由資料服務所叫用，以便將媒體資源當做資料流傳回。</span><span class="sxs-lookup"><span data-stu-id="f8c42-146">This method is invoked by the data service to return a media resource as a stream.</span></span> <span data-ttu-id="f8c42-147">當您實作 <xref:System.Data.Services.Providers.IDataServiceStreamProvider> 時，這個方法所包含的程式碼會提供資料服務所使用的資料流，以便傳回與提供之媒體連結項目相關聯的媒體資源。</span><span class="sxs-lookup"><span data-stu-id="f8c42-147">When you implement <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, this method contains the code that provides a stream that is used by the data service to the return media resource that is associated with the provided media link entry.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStreamUri%2A>|<span data-ttu-id="f8c42-148">這個方法是由資料服務所叫用，以便傳回用來要求媒體連結項目之媒體資源的 URI。</span><span class="sxs-lookup"><span data-stu-id="f8c42-148">This method is invoked by the data service to return the URI that is used to request the media resource for the media link entry.</span></span> <span data-ttu-id="f8c42-149">這個值是用來在媒體連結項目的內容項目中建立 `src` 屬性，也可用來要求資料流。</span><span class="sxs-lookup"><span data-stu-id="f8c42-149">This value is used to create the `src` attribute in the content element of the media link entry and that is used to request the data stream.</span></span> <span data-ttu-id="f8c42-150">當此方法傳回 `null` 時，資料服務就會自動決定 URI。</span><span class="sxs-lookup"><span data-stu-id="f8c42-150">When this method returns `null`, the data service automatically determines the URI.</span></span> <span data-ttu-id="f8c42-151">當您必須為用戶端提供二進位資料的直接存取權，而不使用資料流提供者時，請使用此方法。</span><span class="sxs-lookup"><span data-stu-id="f8c42-151">Use this method when you need to provide clients with direct access to binary data without using the steam provider.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetStreamContentType%2A>|<span data-ttu-id="f8c42-152">這個方法是由資料服務所叫用，以便傳回與指定之媒體連結項目相關聯之媒體資源的 Content-Type 值。</span><span class="sxs-lookup"><span data-stu-id="f8c42-152">This method is invoked by the data service to return the Content-Type value of the media resource that is associated with the specified media link entry.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetStreamETag%2A>|<span data-ttu-id="f8c42-153">這個方法是由資料服務所叫用，以便傳回與指定之實體相關聯之資料流的 eTag。</span><span class="sxs-lookup"><span data-stu-id="f8c42-153">This method is invoked by the data service to return the eTag of the data stream that is associated with the specified entity.</span></span> <span data-ttu-id="f8c42-154">當您管理二進位資料的並行時，將會使用這個方法。</span><span class="sxs-lookup"><span data-stu-id="f8c42-154">This method is used when you manage concurrency for the binary data.</span></span> <span data-ttu-id="f8c42-155">當這個方法傳回 null 時，資料服務不會追蹤並行。</span><span class="sxs-lookup"><span data-stu-id="f8c42-155">When this method returns null, the data service does not track concurrency.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A>|<span data-ttu-id="f8c42-156">這個方法是由資料服務所叫用，可取得當接收從用戶端傳送的資料流時所使用的資料流。</span><span class="sxs-lookup"><span data-stu-id="f8c42-156">This method is invoked by the data service to obtain the stream that is used when receiving the stream sent from the client.</span></span> <span data-ttu-id="f8c42-157">當您實作 <xref:System.Data.Services.Providers.IDataServiceStreamProvider> 時，您必須傳回可寫入的資料流，資料服務會將接收的資料流資料寫入其中。</span><span class="sxs-lookup"><span data-stu-id="f8c42-157">When you implement <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, you must return a writable stream to which the data service writes received stream data.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.ResolveType%2A>|<span data-ttu-id="f8c42-158">傳回命名空間限定的型別名稱，代表資料服務執行階段必須為媒體連結項目建立的類型，該連結項目與正在插入之媒體資源的資料流相關聯。</span><span class="sxs-lookup"><span data-stu-id="f8c42-158">Returns a namespace-qualified type name that represents the type that the data service runtime must create for the media link entry that is associated with the data stream for the media resource that is being inserted.</span></span>|

## <a name="creating-the-streaming-data-service"></a><span data-ttu-id="f8c42-159">建立資料流處理資料服務</span><span class="sxs-lookup"><span data-stu-id="f8c42-159">Creating the Streaming Data Service</span></span>

<span data-ttu-id="f8c42-160">若要為 [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] 執行階段提供 <xref:System.Data.Services.Providers.IDataServiceStreamProvider> 實作的存取權，您所建立的資料服務也必須實作 <xref:System.IServiceProvider> 介面。</span><span class="sxs-lookup"><span data-stu-id="f8c42-160">To provide the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] runtime with access to the <xref:System.Data.Services.Providers.IDataServiceStreamProvider> implementation, the data service that you create must also implement the <xref:System.IServiceProvider> interface.</span></span> <span data-ttu-id="f8c42-161">下列範例將示範如何實作 <xref:System.IServiceProvider.GetService%2A> 方法來傳回實作 `PhotoServiceStreamProvider` 之 <xref:System.Data.Services.Providers.IDataServiceStreamProvider> 類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="f8c42-161">The following example shows how to implement the <xref:System.IServiceProvider.GetService%2A> method to return an instance of the `PhotoServiceStreamProvider` class that implements <xref:System.Data.Services.Providers.IDataServiceStreamProvider>.</span></span>

[!code-csharp[Astoria Photo Streaming Service#PhotoServiceStreamingProvider](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_photo_streaming_service/cs/photodata.svc.cs#photoservicestreamingprovider)]
[!code-vb[Astoria Photo Streaming Service#PhotoServiceStreamingProvider](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_photo_streaming_service/vb/photodata.svc.vb#photoservicestreamingprovider)]

<span data-ttu-id="f8c42-162">如需如何建立資料服務的一般資訊，請參閱[設定資料服務](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="f8c42-162">For general information about how to create a data service, see [Configuring the Data Service](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md).</span></span>

## <a name="enabling-large-binary-streams-in-the-hosting-environment"></a><span data-ttu-id="f8c42-163">在裝載環境中啟用大型二進位資料流</span><span class="sxs-lookup"><span data-stu-id="f8c42-163">Enabling Large Binary Streams in the Hosting Environment</span></span>

<span data-ttu-id="f8c42-164">當您在 [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Web 應用程式中建立資料服務時，便會使用 Windows Communication Foundation (WCF) 來提供 HTTP 通訊協定實作。</span><span class="sxs-lookup"><span data-stu-id="f8c42-164">When you create a data service in an [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Web application, Windows Communication Foundation (WCF) is used to provide the HTTP protocol implementation.</span></span> <span data-ttu-id="f8c42-165">根據預設，WCF 會將 HTTP 訊息大小限制為只有 65K 位元組。</span><span class="sxs-lookup"><span data-stu-id="f8c42-165">By default, WCF limits the size of HTTP messages to only 65K bytes.</span></span> <span data-ttu-id="f8c42-166">為了要能夠與資料服務之間來回進行大型二進位資料的資料流處理，您也必須設定 Web 應用程式啟用大型二進位檔案及使用資料流進行傳輸。</span><span class="sxs-lookup"><span data-stu-id="f8c42-166">To be able to stream large binary data to and from the data service, you must also configure the Web application to enable large binary files and to use streams for transfer.</span></span> <span data-ttu-id="f8c42-167">若要這樣做，請在應用程式 Web.config 檔案的 `<configuration />` 項目中加入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="f8c42-167">To do this, add the following in the `<configuration />` element of the application's Web.config file:</span></span>

> [!NOTE]
> <span data-ttu-id="f8c42-168">您必須使用<xref:System.ServiceModel.TransferMode.Streamed?displayProperty=nameWithType>以確保要求和回應訊息中的二進位資料會串流處理，並由 WCF 所未緩衝的傳輸模式。</span><span class="sxs-lookup"><span data-stu-id="f8c42-168">You must use a <xref:System.ServiceModel.TransferMode.Streamed?displayProperty=nameWithType> transfer mode to ensure that the binary data in both the request and response messages are streamed and not buffered by WCF.</span></span>

<span data-ttu-id="f8c42-169">如需詳細資訊，請參閱 < [Streaming Message Transfer](../../../../docs/framework/wcf/feature-details/streaming-message-transfer.md)並[傳輸配額](../../../../docs/framework/wcf/feature-details/transport-quotas.md)。</span><span class="sxs-lookup"><span data-stu-id="f8c42-169">For more information, see [Streaming Message Transfer](../../../../docs/framework/wcf/feature-details/streaming-message-transfer.md) and [Transport Quotas](../../../../docs/framework/wcf/feature-details/transport-quotas.md).</span></span>

<span data-ttu-id="f8c42-170">根據預設，Internet Information Services (IIS) 也會將要求的大小限制為 4MB。</span><span class="sxs-lookup"><span data-stu-id="f8c42-170">By default, Internet Information Services (IIS) also limits the size of requests to 4MB.</span></span> <span data-ttu-id="f8c42-171">若要啟用您的資料服務，以接收大於 4 MB 的資料流，在 IIS 上執行時，您也必須設定`maxRequestLength`的屬性[httpRuntime 項目 （ASP.NET 設定結構描述）](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/e1f13641(v=vs.100))在`<system.web />`組態 區段中，為下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="f8c42-171">To enable your data service to receive streams larger than 4MB when running on IIS, you must also set the `maxRequestLength` attribute of the [httpRuntime Element (ASP.NET Settings Schema)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/e1f13641(v=vs.100)) in the `<system.web />` configuration section, as shown in the following example:</span></span>

## <a name="using-data-streams-in-a-client-application"></a><span data-ttu-id="f8c42-172">在用戶端應用程式中使用資料流</span><span class="sxs-lookup"><span data-stu-id="f8c42-172">Using Data Streams in a Client Application</span></span>

<span data-ttu-id="f8c42-173">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] 用戶端程式庫可讓您將這些公開的資源當做用戶端的二進位資料流來擷取及更新。</span><span class="sxs-lookup"><span data-stu-id="f8c42-173">The [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client library enables you to both retrieve and update these exposed resources as binary streams on the client.</span></span> <span data-ttu-id="f8c42-174">如需詳細資訊，請參閱 <<c0> [ 使用二進位資料](../../../../docs/framework/data/wcf/working-with-binary-data-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="f8c42-174">For more information, see [Working with Binary Data](../../../../docs/framework/data/wcf/working-with-binary-data-wcf-data-services.md).</span></span>

## <a name="considerations-for-working-with-a-streaming-provider"></a><span data-ttu-id="f8c42-175">使用資料流處理提供者的考量</span><span class="sxs-lookup"><span data-stu-id="f8c42-175">Considerations for Working with a Streaming Provider</span></span>

<span data-ttu-id="f8c42-176">下列是當您實作資料流處理提供者以及從資料服務存取媒體資源時，所要考量的事項。</span><span class="sxs-lookup"><span data-stu-id="f8c42-176">The following are things to consider when you implement a streaming provider and when you access media resources from a data service.</span></span>

- <span data-ttu-id="f8c42-177">媒體資源不支援 MERGE 要求。</span><span class="sxs-lookup"><span data-stu-id="f8c42-177">MERGE requests are not supported for media resources.</span></span> <span data-ttu-id="f8c42-178">使用 PUT 要求可變更現有實體的媒體資源。</span><span class="sxs-lookup"><span data-stu-id="f8c42-178">Use a PUT request to change the media resource of an existing entity.</span></span>

- <span data-ttu-id="f8c42-179">POST 要求不能用來建立新的媒體連結項目。</span><span class="sxs-lookup"><span data-stu-id="f8c42-179">A POST request cannot be used to create a new media link entry.</span></span> <span data-ttu-id="f8c42-180">您必須改為發出 POST 要求來建立新的媒體資源，而資料服務會使用預設值建立新的媒體連結項目。</span><span class="sxs-lookup"><span data-stu-id="f8c42-180">Instead, you must issue a POST request to create a new media resource, and the data service creates a new media link entry with default values.</span></span> <span data-ttu-id="f8c42-181">後續的 MERGE 或 PUT 要求可以更新這個新的實體。</span><span class="sxs-lookup"><span data-stu-id="f8c42-181">This new entity can be updated by a subsequent MERGE or PUT request.</span></span> <span data-ttu-id="f8c42-182">您也可以考慮快取實體，並在處置工具中進行更新，例如將屬性值設定為 POST 要求中 Slug 標頭的值。</span><span class="sxs-lookup"><span data-stu-id="f8c42-182">You may also consider caching the entity and make updates in the disposer, such as setting the property value to the value of the Slug header in the POST request.</span></span>

- <span data-ttu-id="f8c42-183">當收到 POST 要求時，資料服務會呼叫 <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> 來建立媒體資源，然後再呼叫 <xref:System.Data.Services.IUpdatable.SaveChanges%2A> 建立媒體連結項目。</span><span class="sxs-lookup"><span data-stu-id="f8c42-183">When a POST request is received, the data service calls <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> to create the media resource before it calls <xref:System.Data.Services.IUpdatable.SaveChanges%2A> to create the media link entry.</span></span>

- <span data-ttu-id="f8c42-184"><xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> 的實作不應該傳回 <xref:System.IO.MemoryStream> 物件。</span><span class="sxs-lookup"><span data-stu-id="f8c42-184">An implementation of <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> should not return a <xref:System.IO.MemoryStream> object.</span></span> <span data-ttu-id="f8c42-185">當您使用這種資料流時，服務收到非常大型的資料流時將會發生記憶體資源問題。</span><span class="sxs-lookup"><span data-stu-id="f8c42-185">When you use this kind of stream, memory resource issues will occur when the service receives very large data streams.</span></span>

- <span data-ttu-id="f8c42-186">以下是將媒體資源儲存在資料庫時所要考量的事項：</span><span class="sxs-lookup"><span data-stu-id="f8c42-186">The following are things to consider when storing media resources in a database:</span></span>

  - <span data-ttu-id="f8c42-187">屬於媒體資源的二進位屬性不應該包含在資料模型中。</span><span class="sxs-lookup"><span data-stu-id="f8c42-187">A binary property that is a media resource should not be included in the data model.</span></span> <span data-ttu-id="f8c42-188">資料模型中公開的所有屬性都會在回應摘要的項目中傳回。</span><span class="sxs-lookup"><span data-stu-id="f8c42-188">All properties exposed in a data model are returned in the entry in a response feed.</span></span>

  - <span data-ttu-id="f8c42-189">為了改良大型二進位資料流的效能，我們建議您最好建立自訂資料流類別，將二進位資料儲存在資料庫中。</span><span class="sxs-lookup"><span data-stu-id="f8c42-189">To improve performance with a large binary stream, we recommend that you create a custom stream class to store binary data in the database.</span></span> <span data-ttu-id="f8c42-190">這個類別是由 <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> 實作所傳回，而且會以區塊傳送二進位資料給資料庫。</span><span class="sxs-lookup"><span data-stu-id="f8c42-190">This class is returned by your <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> implementation and sends the binary data to the database in chunks.</span></span> <span data-ttu-id="f8c42-191">SQL Server 資料庫，建議您到資料庫使用資料流資料的 FILESTREAM，大於 1 MB 的二進位資料時。</span><span class="sxs-lookup"><span data-stu-id="f8c42-191">For a SQL Server database, we recommend that you use a FILESTREAM to stream data into the database when the binary data is larger than 1MB.</span></span>

  - <span data-ttu-id="f8c42-192">請確定資料庫設計為可儲存二進位大型資料流，而且您的資料服務將會收到這些資料流。</span><span class="sxs-lookup"><span data-stu-id="f8c42-192">Ensure that your database is designed to store the binary large streams that are to be received by your data service.</span></span>

  - <span data-ttu-id="f8c42-193">當用戶端傳送 POST 要求，將包含媒體資源的媒體連結項目插入單一要求時，將會呼叫 <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> 來取得資料流，然後資料服務才會將新的實體插入資料庫中。</span><span class="sxs-lookup"><span data-stu-id="f8c42-193">When a client sends a POST request to insert a media link entry with a media resource in a single request, <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> is called to obtain the stream before the data service inserts the new entity into the database.</span></span> <span data-ttu-id="f8c42-194">資料流處理提供者實作必須能夠處理這個資料服務行為。</span><span class="sxs-lookup"><span data-stu-id="f8c42-194">A streaming provider implementation must be able to handle this data service behavior.</span></span> <span data-ttu-id="f8c42-195">請考慮使用個別的資料表來儲存二進位資料或是將資料流儲存在檔案中，直到實體已經插入資料庫為止。</span><span class="sxs-lookup"><span data-stu-id="f8c42-195">Consider using a separate data table to store the binary data or store the data stream in a file until after the entity has been inserted into the database.</span></span>

- <span data-ttu-id="f8c42-196">當您實作 <xref:System.Data.Services.Providers.IDataServiceStreamProvider.DeleteStream%2A>、<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStream%2A> 或 <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> 方法時，您必須使用當做方法參數提供的 eTag 和 Content-Type 值。</span><span class="sxs-lookup"><span data-stu-id="f8c42-196">When you implement the <xref:System.Data.Services.Providers.IDataServiceStreamProvider.DeleteStream%2A>, <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStream%2A>, or <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> methods, you must use the eTag and Content-Type values that are supplied as method parameters.</span></span> <span data-ttu-id="f8c42-197">請勿在 <xref:System.Data.Services.Providers.IDataServiceStreamProvider> 提供者實作中設定 eTag 或 Content-Type 標頭。</span><span class="sxs-lookup"><span data-stu-id="f8c42-197">Do not set eTag or Content-Type headers in your <xref:System.Data.Services.Providers.IDataServiceStreamProvider> provider implementation.</span></span>

- <span data-ttu-id="f8c42-198">根據預設，用戶端會使用區塊式 HTTP Transfer-Encoding 來傳送大型二進位資料流。</span><span class="sxs-lookup"><span data-stu-id="f8c42-198">By default, the client sends large binary streams by using a chunked HTTP Transfer-Encoding.</span></span> <span data-ttu-id="f8c42-199">因為[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]程式開發伺服器不支援這種編碼方式，您無法使用此網頁伺服器來裝載必須接受大型二進位資料流的資料流資料服務。</span><span class="sxs-lookup"><span data-stu-id="f8c42-199">Because the [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Development Server does not support this kind of encoding, you cannot use this Web server to host a streaming data service that must accept large binary streams.</span></span> <span data-ttu-id="f8c42-200">如需詳細資訊[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]程式開發伺服器，請參閱 < [ASP.NET Web 專案的 Visual Studio 中的 Web 伺服器](https://docs.microsoft.com/previous-versions/aspnet/58wxa9w5(v=vs.120))。</span><span class="sxs-lookup"><span data-stu-id="f8c42-200">For more information on [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Development Server, see [Web Servers in Visual Studio for ASP.NET Web Projects](https://docs.microsoft.com/previous-versions/aspnet/58wxa9w5(v=vs.120)).</span></span>

<a name="versioning"></a>

## <a name="versioning-requirements"></a><span data-ttu-id="f8c42-201">版本控制需求</span><span class="sxs-lookup"><span data-stu-id="f8c42-201">Versioning Requirements</span></span>

<span data-ttu-id="f8c42-202">資料流處理提供者具有下列 [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] 通訊協定版本控制需求：</span><span class="sxs-lookup"><span data-stu-id="f8c42-202">The streaming provider has the following [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] protocol versioning requirements:</span></span>

- <span data-ttu-id="f8c42-203">資料流處理提供者要求資料服務支援 2.0 版的 [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] 通訊協定和更新版本。</span><span class="sxs-lookup"><span data-stu-id="f8c42-203">The streaming provider requires that the data service support version 2.0 of the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] protocol and later versions.</span></span>

<span data-ttu-id="f8c42-204">如需詳細資訊，請參閱 <<c0> [ 資料服務版本控制](../../../../docs/framework/data/wcf/data-service-versioning-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="f8c42-204">For more information, see [Data Service Versioning](../../../../docs/framework/data/wcf/data-service-versioning-wcf-data-services.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="f8c42-205">另請參閱</span><span class="sxs-lookup"><span data-stu-id="f8c42-205">See also</span></span>

- [<span data-ttu-id="f8c42-206">資料服務提供者</span><span class="sxs-lookup"><span data-stu-id="f8c42-206">Data Services Providers</span></span>](../../../../docs/framework/data/wcf/data-services-providers-wcf-data-services.md)
- [<span data-ttu-id="f8c42-207">自訂資料服務提供者</span><span class="sxs-lookup"><span data-stu-id="f8c42-207">Custom Data Service Providers</span></span>](../../../../docs/framework/data/wcf/custom-data-service-providers-wcf-data-services.md)
- [<span data-ttu-id="f8c42-208">使用二進位資料</span><span class="sxs-lookup"><span data-stu-id="f8c42-208">Working with Binary Data</span></span>](../../../../docs/framework/data/wcf/working-with-binary-data-wcf-data-services.md)
