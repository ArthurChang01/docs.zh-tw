---
title: "通道處理站和快取 | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
ms.assetid: 954f030e-091c-4c0e-a7a2-10f9a6b1f529
caps.latest.revision: 3
author: "Erikre"
ms.author: "erikre"
manager: "erikre"
caps.handback.revision: 3
---
# 通道處理站和快取
WCF 用戶端應用程式會使用 <xref:System.ServiceModel.ChannelFactory%601> 類別來建立與 WCF 服務的通訊通道。建立 <xref:System.ServiceModel.ChannelFactory%601> 執行個體會產生額外負荷，因為這涉及到下列作業：  
  
-   建構 <xref:System.ServiceModel.Description.ContractDescription> 樹狀結構  
  
-   反映所有必要的 CLR 型別  
  
-   建構通道堆疊  
  
-   處置資源  
  
 為了儘量減少這種負荷，WCF 可以在您使用 WCF 用戶端 Proxy 時快取通道處理站。  
  
> [!TIP]
>  直接使用 <xref:System.ServiceModel.ChannelFactory%601> 類別時，您可以直接控制通道處理站的建立作業。  
  
 使用 [ServiceModel 中繼資料公用程式工具 \(Svcutil.exe\)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) 所產生的 WCF 用戶端 Proxy 是從  <xref:System.ServiceModel.ClientBase%601> 所衍生。<xref:System.ServiceModel.ClientBase%601> 會定義用於定義通道處理站快取行為的靜態 <xref:System.ServiceModel.ClientBase%601.CacheSetting%2A> 屬性。快取設定會針對特定型別來設定。例如，將 `ClientBase<ITest>.CacheSettings` 設定為下面定義的其中一個值只會影響型別為 `ITest` 的那些 Proxy\/ClientBase。第一個 Proxy\/ClientBase 執行個體一經建立，特定<xref:System.ServiceModel.ClientBase%601> 的快取設定就會是不可變的。  
  
## 指定快取行為  
 快取行為是藉由將 <xref:System.ServiceModel.ClientBase%601.CacheSetting> 屬性設定為下列其中一個值所指定。  
  
|快取設定值|說明|  
|-----------|--------|  
|<xref:System.ServiceModel.CacheSetting.AlwaysOn>|應用程式定義域內 <xref:System.ServiceModel.ClientBase%601> 的所有執行個體都可以參與快取。開發人員已經確定對快取沒有不利的安全性影響。即使存取 <xref:System.ServiceModel.ClientBase%601> 上的「安全性敏感」屬性，也不會關閉快取。<xref:System.ServiceModel.ClientBase%601> 的「安全性敏感」屬性為 <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A>、<xref:System.ServiceModel.ClientBase%601.Endpoint%2A> 和 <xref:System.ServiceModel.ClientBase%601.ChannelFactory%2A>。|  
|<xref:System.ServiceModel.CacheSetting.Default>|只有從定義於組態檔之端點建立的 <xref:System.ServiceModel.ClientBase%601> 執行個體才會在應用程式定義域中參與快取。任何以程式設計方式在應用程式定義域內建立的 <xref:System.ServiceModel.ClientBase%601> 執行個體都不會參與快取。此外，只要存取其中任何「安全性敏感」屬性，就會停用<xref:System.ServiceModel.ClientBase%601> 執行個體的快取。|  
|<xref:System.ServiceModel.CacheSetting.AlwaysOff>|在相關應用程式定義域內，特定型別之所有 <xref:System.ServiceModel.ClientBase%601> 執行個體的快取都會關閉。|  
  
 下列程式碼片段說明如何使用 <xref:System.ServiceModel.ClientBase%601.CacheSetting%2A> 屬性。  
  
```  
class Program   
{   
   static void Main(string[] args)   
   {   
      ClientBase<ITest>.CacheSettings = CacheSettings.AlwaysOn;   
      foreach (string msg in messages)   
      {   
         using (TestClient proxy = new TestClient (new BasicHttpBinding(), new EndpointAddress(address)))   
         {   
            // ...  
            proxy.Test(msg);   
            // ...  
         }   
      }   
   }   
}  
// Generated by SvcUtil.exe     
public partial class TestClient : System.ServiceModel.ClientBase, ITest { }  
  
```  
  
 在上述程式碼中，`TestClient` 的所有執行個體都將使用相同的通道處理站。  
  
```  
class Program   
{   
   static void Main(string[] args)   
   {   
      ClientBase.CacheSettings = CacheSettings.Default;   
      int i = 1;   
      foreach (string msg in messages)   
      {   
         using (TestClient proxy = new TestClient (“MyEndpoint”, new EndpointAddress(address)))   
         {   
            if (i == 4)   
            {   
               ServiceEndpoint endpoint = proxy.Endpoint;   
               ... // use endpoint in some way   
            }   
            proxy.Test(msg);   
         }   
         i++;   
   }   
}   
  
// Generated by SvcUtil.exe     
public partial class TestClient : System.ServiceModel.ClientBase, ITest {}  
```  
  
 在上述範例中，除了執行個體 \#4 以外，`TestClient` 的所有執行個體都會使用相同的通道處理站。執行個體 \# 4 會使用專門針對其用途建立的通道處理站。這個設定適用於特定端點需要的安全性設定與通道處理站型別 \(在本例中為 `ITest`\) 相同之其他端點所需安全性設定有所不同時的情節。  
  
```  
class Program   
{   
   static void Main(string[] args)   
   {   
      ClientBase.CacheSettings = CacheSettings.AlwaysOff;   
      foreach (string msg in messages)   
      {   
         using (TestClient proxy = new TestClient (“MyEndpoint”, new EndpointAddress(address)))   
         {   
            proxy.Test(msg);   
         }           
      }   
   }  
}  
  
// Generated by SvcUtil.exe   
public partial class TestClient : System.ServiceModel.ClientBase, ITest {}  
```  
  
 在上述範例中，`TestClient` 的所有執行個體都會使用不同的通道處理站。當每個端點各有不同的安全性需求，而進行快取沒有意義時，這種方式非常有用。  
  
## 請參閱  
 <xref:System.ServiceModel.ClientBase%601>   
 [建置用戶端](../../../../docs/framework/wcf/building-clients.md)   
 [用戶端](../../../../docs/framework/wcf/feature-details/clients.md)   
 [使用 WCF 用戶端存取服務](../../../../docs/framework/wcf/accessing-services-using-a-wcf-client.md)   
 [HOW TO：使用 ChannelFactory](../../../../docs/framework/wcf/feature-details/how-to-use-the-channelfactory.md)