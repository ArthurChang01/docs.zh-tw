---
title: 在 Windows 服務應用程式中裝載
ms.date: 03/30/2017
ms.assetid: f4199998-27f3-4dd9-aee4-0a4addfa9f24
ms.openlocfilehash: 2b3935babec0c7cdc3ffca5dd11d693fdfee7a89
ms.sourcegitcommit: 76a304c79a32aa13889ebcf4b9789a4542b48e3e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/14/2018
ms.locfileid: "45587437"
---
# <a name="hosting-in-a-windows-service-application"></a><span data-ttu-id="b1dc6-102">在 Windows 服務應用程式中裝載</span><span class="sxs-lookup"><span data-stu-id="b1dc6-102">Hosting in a Windows Service Application</span></span>
<span data-ttu-id="b1dc6-103">Windows 服務 (之前稱為 Windows NT 服務) 所提供的處理序模型特別適合那些必須駐留在長時間執行的可執行檔中，且不會顯示任何使用者介面形式的應用程式使用。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-103">Windows services (formerly known as Windows NT services) provide a process model particularly suited to applications that must live in a long-running executable and do not display any form of user interface.</span></span> <span data-ttu-id="b1dc6-104">Windows 服務應用程式的處理序存留期是由服務控制管理員 (SCM) 負責管理，可讓您啟動、停止與暫停 Windows 服務應用程式。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-104">The process lifetime of a Windows service application is managed by the service control manager (SCM), which allows you to start, stop, and pause Windows service applications.</span></span> <span data-ttu-id="b1dc6-105">您可以設定為啟動電腦，因此合適的裝載環境為 「 永遠開啟 」 應用程式時自動啟動 Windows 服務處理程序。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-105">You can configure a Windows service process to start automatically when the computer starts, making it a suitable hosting environment for "always on" applications.</span></span> <span data-ttu-id="b1dc6-106">如需有關 Windows 服務應用程式的詳細資訊，請參閱 < [Windows 服務應用程式](https://go.microsoft.com/fwlink/?LinkId=89450)。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-106">For more information about Windows service applications, see [Windows Service Applications](https://go.microsoft.com/fwlink/?LinkId=89450).</span></span>  
  
 <span data-ttu-id="b1dc6-107">裝載長時間執行的 Windows Communication Foundation (WCF) 服務的應用程式與 Windows 服務共用許多特性。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-107">Applications that host long-running Windows Communication Foundation (WCF) services share many characteristics with Windows services.</span></span> <span data-ttu-id="b1dc6-108">特別是，WCF 服務是長時間執行伺服器可執行檔不會直接與使用者互動，因此不會實作任何形式的使用者介面。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-108">In particular, WCF services are long-running server executables that do not interact directly with the user and therefore do not implement any form of user interface.</span></span> <span data-ttu-id="b1dc6-109">因此，裝載 Windows 服務應用程式的 WCF 服務是建置穩固、 長時間執行的 WCF 應用程式的其中一個選項。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-109">As such, hosting WCF services inside of a Windows service application is one option for building robust, long-running, WCF applications.</span></span>  
  
 <span data-ttu-id="b1dc6-110">通常，WCF 開發人員必須決定是否要裝載 WCF 應用程式到 Windows 服務應用程式，或在 Internet Information Services (IIS) 或 Windows Process Activation Service (WAS) 裝載環境內。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-110">Often, WCF developers must decide whether to host their WCF application inside of a Windows service application or inside of the Internet Information Services (IIS) or Windows Process Activation Service (WAS) hosting environment.</span></span> <span data-ttu-id="b1dc6-111">在下列情況中，您應該考慮使用 Windows 服務應用程式：</span><span class="sxs-lookup"><span data-stu-id="b1dc6-111">You should consider using Windows service applications under the following conditions:</span></span>  
  
-   <span data-ttu-id="b1dc6-112">您的應用程式需要明確的啟動。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-112">Your application requires explicit activation.</span></span> <span data-ttu-id="b1dc6-113">例如，您的應用程式必須在伺服器啟動時自動啟動，而非為了回應第一個傳入訊息才動態啟動時，您就應該使用 Windows 服務。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-113">For example, you should use Windows services when your application must start automatically when the server starts instead of being dynamically started in response to the first incoming message.</span></span>  
  
-   <span data-ttu-id="b1dc6-114">裝載應用程式的處理序一旦啟動，就必須維持在執行狀態。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-114">The process that hosts your application must remain running once started.</span></span> <span data-ttu-id="b1dc6-115">一旦啟動，Windows 服務處理序就會維持在執行狀態，除非伺服器管理員透過服務控制管理員明確地加以關閉。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-115">Once started, a Windows service process remains running unless explicitly shut down by a server administrator using the service control manager.</span></span> <span data-ttu-id="b1dc6-116">裝載在 IIS 或 WAS 的應用程式可以動態啟動與停止，以便充分運用系統資源。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-116">Applications hosted in IIS or WAS may be started and stopped dynamically to make optimal use of system resources.</span></span> <span data-ttu-id="b1dc6-117">需要對自身裝載處理序存留期擁有明確掌控權的應用程式，應該使用 Windows 服務，而不要使用 IIS 或 WAS。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-117">Applications that require explicit control over the lifetime of their hosting process should use Windows services instead of IIS or WAS.</span></span>  
  
-   <span data-ttu-id="b1dc6-118">您的 WCF 服務必須在 Windows Server 2003 上執行，並使用 HTTP 以外的傳輸。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-118">Your WCF service must run on Windows Server 2003 and use transports other than HTTP.</span></span> <span data-ttu-id="b1dc6-119">在 Windows Server 2003 上，會將 [!INCLUDE[iis601](../../../../includes/iis601-md.md)] 裝載環境限為僅適用 HTTP 通訊。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-119">On Windows Server 2003, the [!INCLUDE[iis601](../../../../includes/iis601-md.md)] hosting environment is restricted to HTTP communication only.</span></span> <span data-ttu-id="b1dc6-120">Windows 服務應用程式不會受限於這項限制，而且可以使用任何傳輸 WCF 支援，包括 net.tcp、 net.pipe 和 net.msmq。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-120">Windows service applications are not subject to this restriction and can use any transport WCF supports, including net.tcp, net.pipe, and net.msmq.</span></span>  
  
### <a name="to-host-wcf-inside-of-a-windows-service-application"></a><span data-ttu-id="b1dc6-121">若要在 Windows 服務應用程式中裝載 WCF</span><span class="sxs-lookup"><span data-stu-id="b1dc6-121">To host WCF inside of a Windows service application</span></span>  
  
1.  <span data-ttu-id="b1dc6-122">建立 Windows 服務應用程式。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-122">Create a Windows service application.</span></span> <span data-ttu-id="b1dc6-123">您可以使用 <xref:System.ServiceProcess> 命名空間中的類別，以 Managed 程式碼來撰寫 Windows 服務應用程式。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-123">You can write Windows service applications in managed code using the classes in the <xref:System.ServiceProcess> namespace.</span></span> <span data-ttu-id="b1dc6-124">此應用程式必須包含一個繼承自 <xref:System.ServiceProcess.ServiceBase> 的類別。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-124">This application must include one class that inherits from <xref:System.ServiceProcess.ServiceBase>.</span></span>  
  
2.  <span data-ttu-id="b1dc6-125">連結的 Windows 服務應用程式存留期的 WCF 服務的存留期間。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-125">Link the lifetime of the WCF services to the lifetime of the Windows service application.</span></span> <span data-ttu-id="b1dc6-126">一般而言，您會想要成為作用中裝載的服務啟動時，請停止接聽訊息時停止，並關閉裝載處理序，當發生錯誤時的 WCF 服務主控的服務 Windows 服務應用程式中裝載的 WCF 服務。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-126">Typically, you want WCF services hosted in a Windows service application to become active when the hosting service starts, stop listening for messages when the hosting service is stopped, and shut down the hosting process when the WCF service encounters an error.</span></span> <span data-ttu-id="b1dc6-127">執行下列工作即可達成這點：</span><span class="sxs-lookup"><span data-stu-id="b1dc6-127">This can be accomplished as follows:</span></span>  
  
    -   <span data-ttu-id="b1dc6-128">覆寫 <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> 以開啟一或多個 <xref:System.ServiceModel.ServiceHost> 執行個體。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-128">Override <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> to open one or more instances of <xref:System.ServiceModel.ServiceHost>.</span></span> <span data-ttu-id="b1dc6-129">單一的 Windows 服務應用程式可以裝載多個 WCF 服務的啟動和停止做為群組。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-129">A single Windows service application can host multiple WCF services that start and stop as a group.</span></span>  
  
    -   <span data-ttu-id="b1dc6-130">覆寫<xref:System.ServiceProcess.ServiceBase.OnStop%2A>來呼叫<xref:System.ServiceModel.Channels.CommunicationObject.Closed>上<xref:System.ServiceModel.ServiceHost>期間所啟動的任何執行 WCF 服務<xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-130">Override <xref:System.ServiceProcess.ServiceBase.OnStop%2A> to call <xref:System.ServiceModel.Channels.CommunicationObject.Closed> on the <xref:System.ServiceModel.ServiceHost> any running WCF services that were started during <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>.</span></span>  
  
    -   <span data-ttu-id="b1dc6-131">訂閱 <xref:System.ServiceModel.Channels.CommunicationObject.Faulted> 的 <xref:System.ServiceModel.ServiceHost> 事件，並在發生錯誤時，使用 <xref:System.ServiceProcess.ServiceController> 類別來關閉 Windows 服務應用程式。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-131">Subscribe to the <xref:System.ServiceModel.Channels.CommunicationObject.Faulted> event of <xref:System.ServiceModel.ServiceHost> and use the <xref:System.ServiceProcess.ServiceController> class to shut down the Windows service application in case of error.</span></span>  
  
     <span data-ttu-id="b1dc6-132">裝載 WCF 服務的 Windows 服務應用程式部署與管理方式相同，因為不會進行 Windows 服務應用程式使用 WCF。</span><span class="sxs-lookup"><span data-stu-id="b1dc6-132">Windows service applications that host WCF services are deployed and managed in the same way as Windows service applications that do not make use of WCF.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b1dc6-133">另請參閱</span><span class="sxs-lookup"><span data-stu-id="b1dc6-133">See Also</span></span>  
 <xref:System.ServiceProcess>  
 [<span data-ttu-id="b1dc6-134">逐步解說：在元件設計工具中建立 Windows 服務應用程式</span><span class="sxs-lookup"><span data-stu-id="b1dc6-134">Walkthrough: Creating a Windows Service Application in the Component Designer</span></span>](https://go.microsoft.com/fwlink/?LinkId=94875)  
 [<span data-ttu-id="b1dc6-135">如何：在 Managed Windows 服務中裝載 WCF 服務</span><span class="sxs-lookup"><span data-stu-id="b1dc6-135">How to: Host a WCF Service in a Managed Windows Service</span></span>](../../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-a-managed-windows-service.md)  
 [<span data-ttu-id="b1dc6-136">Windows 服務主機</span><span class="sxs-lookup"><span data-stu-id="b1dc6-136">Windows Service Host</span></span>](../../../../docs/framework/wcf/samples/windows-service-host.md)  
 [<span data-ttu-id="b1dc6-137">服務應用程式的程式設計架構</span><span class="sxs-lookup"><span data-stu-id="b1dc6-137">Service Application Programming Architecture</span></span>](https://go.microsoft.com/fwlink/?LinkId=94876)  
 [<span data-ttu-id="b1dc6-138">Windows Server App Fabric 主控功能</span><span class="sxs-lookup"><span data-stu-id="b1dc6-138">Windows Server App Fabric Hosting Features</span></span>](https://go.microsoft.com/fwlink/?LinkId=201276)
