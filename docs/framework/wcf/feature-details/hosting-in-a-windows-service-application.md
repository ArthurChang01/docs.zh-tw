---
title: "在 Windows 服務應用程式中裝載"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: f4199998-27f3-4dd9-aee4-0a4addfa9f24
caps.latest.revision: "12"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: d1a39162097c21f20c0dd04f3911442602871436
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/22/2017
---
# <a name="hosting-in-a-windows-service-application"></a><span data-ttu-id="8050c-102">在 Windows 服務應用程式中裝載</span><span class="sxs-lookup"><span data-stu-id="8050c-102">Hosting in a Windows Service Application</span></span>
<span data-ttu-id="8050c-103">Windows 服務 (之前稱為 Windows NT 服務) 所提供的處理序模型特別適合那些必須駐留在長時間執行的可執行檔中，且不會顯示任何使用者介面形式的應用程式使用。</span><span class="sxs-lookup"><span data-stu-id="8050c-103">Windows services (formerly known as Windows NT services) provide a process model particularly suited to applications that must live in a long-running executable and do not display any form of user interface.</span></span> <span data-ttu-id="8050c-104">Windows 服務應用程式的處理序存留期是由服務控制管理員 (SCM) 負責管理，可讓您啟動、停止與暫停 Windows 服務應用程式。</span><span class="sxs-lookup"><span data-stu-id="8050c-104">The process lifetime of a Windows service application is managed by the service control manager (SCM), which allows you to start, stop, and pause Windows service applications.</span></span> <span data-ttu-id="8050c-105">您可以設定 Windows 服務處理序啟動時自動啟動電腦，因此適合裝載 「 永遠開啟 」 應用程式的環境。</span><span class="sxs-lookup"><span data-stu-id="8050c-105">You can configure a Windows service process to start automatically when the computer starts, making it a suitable hosting environment for "always on" applications.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="8050c-106">Windows 服務應用程式，請參閱[Windows 服務應用程式](http://go.microsoft.com/fwlink/?LinkId=89450)。</span><span class="sxs-lookup"><span data-stu-id="8050c-106"> Windows service applications, see [Windows Service Applications](http://go.microsoft.com/fwlink/?LinkId=89450).</span></span>  
  
 <span data-ttu-id="8050c-107">裝載長時間執行 [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] 服務的應用程式會有許多 Windows 服務的特徵。</span><span class="sxs-lookup"><span data-stu-id="8050c-107">Applications that host long-running [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] services share many characteristics with Windows services.</span></span> <span data-ttu-id="8050c-108">值得一提的是，[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 服務這項長時間執行的伺服器可執行檔不會直接與使用者互動，因此不會實作任何形式的使用者介面。</span><span class="sxs-lookup"><span data-stu-id="8050c-108">In particular, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services are long-running server executables that do not interact directly with the user and therefore do not implement any form of user interface.</span></span> <span data-ttu-id="8050c-109">因此，建置穩固、長時間執行的 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 應用程式時，可以選擇將 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 服務裝載到 Windows 服務應用程式中。</span><span class="sxs-lookup"><span data-stu-id="8050c-109">As such, hosting [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services inside of a Windows service application is one option for building robust, long-running, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] applications.</span></span>  
  
 <span data-ttu-id="8050c-110">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 開發人員經常必須決定是否將其 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 應用程式裝載到 Windows 服務應用程式內或是網際網路資訊服務 (IIS) 或 Windows Process Activation Service (WAS) 裝載環境中。</span><span class="sxs-lookup"><span data-stu-id="8050c-110">Often, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] developers must decide whether to host their [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] application inside of a Windows service application or inside of the Internet Information Services (IIS) or Windows Process Activation Service (WAS) hosting environment.</span></span> <span data-ttu-id="8050c-111">在下列情況中，您應該考慮使用 Windows 服務應用程式：</span><span class="sxs-lookup"><span data-stu-id="8050c-111">You should consider using Windows service applications under the following conditions:</span></span>  
  
-   <span data-ttu-id="8050c-112">您的應用程式需要明確的啟動。</span><span class="sxs-lookup"><span data-stu-id="8050c-112">Your application requires explicit activation.</span></span> <span data-ttu-id="8050c-113">例如，您的應用程式必須在伺服器啟動時自動啟動，而非為了回應第一個傳入訊息才動態啟動時，您就應該使用 Windows 服務。</span><span class="sxs-lookup"><span data-stu-id="8050c-113">For example, you should use Windows services when your application must start automatically when the server starts instead of being dynamically started in response to the first incoming message.</span></span>  
  
-   <span data-ttu-id="8050c-114">裝載應用程式的處理序一旦啟動，就必須維持在執行狀態。</span><span class="sxs-lookup"><span data-stu-id="8050c-114">The process that hosts your application must remain running once started.</span></span> <span data-ttu-id="8050c-115">一旦啟動，Windows 服務處理序就會維持在執行狀態，除非伺服器管理員透過服務控制管理員明確地加以關閉。</span><span class="sxs-lookup"><span data-stu-id="8050c-115">Once started, a Windows service process remains running unless explicitly shut down by a server administrator using the service control manager.</span></span> <span data-ttu-id="8050c-116">裝載在 IIS 或 WAS 的應用程式可以動態啟動與停止，以便充分運用系統資源。</span><span class="sxs-lookup"><span data-stu-id="8050c-116">Applications hosted in IIS or WAS may be started and stopped dynamically to make optimal use of system resources.</span></span> <span data-ttu-id="8050c-117">需要對自身裝載處理序存留期擁有明確掌控權的應用程式，應該使用 Windows 服務，而不要使用 IIS 或 WAS。</span><span class="sxs-lookup"><span data-stu-id="8050c-117">Applications that require explicit control over the lifetime of their hosting process should use Windows services instead of IIS or WAS.</span></span>  
  
-   <span data-ttu-id="8050c-118">您的 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 服務必須在 Windows Server 2003 上執行，並使用 HTTP 以外的傳輸。</span><span class="sxs-lookup"><span data-stu-id="8050c-118">Your [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service must run on Windows Server 2003 and use transports other than HTTP.</span></span> <span data-ttu-id="8050c-119">在 Windows Server 2003 上，會將 [!INCLUDE[iis601](../../../../includes/iis601-md.md)] 裝載環境限為僅適用 HTTP 通訊。</span><span class="sxs-lookup"><span data-stu-id="8050c-119">On Windows Server 2003, the [!INCLUDE[iis601](../../../../includes/iis601-md.md)] hosting environment is restricted to HTTP communication only.</span></span> <span data-ttu-id="8050c-120">Windows 服務應用程式不受到這項限制的約束，可以使用 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 所支援的任何傳輸，包括 net.tcp、net.pipe 和 net.msmq。</span><span class="sxs-lookup"><span data-stu-id="8050c-120">Windows service applications are not subject to this restriction and can use any transport [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] supports, including net.tcp, net.pipe, and net.msmq.</span></span>  
  
### <a name="to-host-wcf-inside-of-a-windows-service-application"></a><span data-ttu-id="8050c-121">若要在 Windows 服務應用程式中裝載 WCF</span><span class="sxs-lookup"><span data-stu-id="8050c-121">To host WCF inside of a Windows service application</span></span>  
  
1.  <span data-ttu-id="8050c-122">建立 Windows 服務應用程式。</span><span class="sxs-lookup"><span data-stu-id="8050c-122">Create a Windows service application.</span></span> <span data-ttu-id="8050c-123">您可以使用 <xref:System.ServiceProcess> 命名空間中的類別，以 Managed 程式碼來撰寫 Windows 服務應用程式。</span><span class="sxs-lookup"><span data-stu-id="8050c-123">You can write Windows service applications in managed code using the classes in the <xref:System.ServiceProcess> namespace.</span></span> <span data-ttu-id="8050c-124">此應用程式必須包含一個繼承自 <xref:System.ServiceProcess.ServiceBase> 的類別。</span><span class="sxs-lookup"><span data-stu-id="8050c-124">This application must include one class that inherits from <xref:System.ServiceProcess.ServiceBase>.</span></span>  
  
2.  <span data-ttu-id="8050c-125">將 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 服務的存留期連接至 Windows 服務應用程式的存留期。</span><span class="sxs-lookup"><span data-stu-id="8050c-125">Link the lifetime of the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services to the lifetime of the Windows service application.</span></span> <span data-ttu-id="8050c-126">一般來說，您會希望裝載於 Windows 服務應用程式內的 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 服務能夠在裝載服務啟動時變成作用中、當裝載服務停止時隨之停止接聽訊息，並且在 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 服務遭遇錯誤時關閉裝載處理序。</span><span class="sxs-lookup"><span data-stu-id="8050c-126">Typically, you want [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services hosted in a Windows service application to become active when the hosting service starts, stop listening for messages when the hosting service is stopped, and shut down the hosting process when the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service encounters an error.</span></span> <span data-ttu-id="8050c-127">執行下列工作即可達成這點：</span><span class="sxs-lookup"><span data-stu-id="8050c-127">This can be accomplished as follows:</span></span>  
  
    -   <span data-ttu-id="8050c-128">覆寫 <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> 以開啟一或多個 <xref:System.ServiceModel.ServiceHost> 執行個體。</span><span class="sxs-lookup"><span data-stu-id="8050c-128">Override <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> to open one or more instances of <xref:System.ServiceModel.ServiceHost>.</span></span> <span data-ttu-id="8050c-129">單一 Windows 服務應用程式可以裝載多個以群組為單位啟動並停止的 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 服務。</span><span class="sxs-lookup"><span data-stu-id="8050c-129">A single Windows service application can host multiple [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services that start and stop as a group.</span></span>  
  
    -   <span data-ttu-id="8050c-130">覆寫 <xref:System.ServiceProcess.ServiceBase.OnStop%2A> 以呼叫 <xref:System.ServiceModel.Channels.CommunicationObject.Closed> (位於任何執行中 <xref:System.ServiceModel.ServiceHost> 服務的 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]，而這些服務都是在執行 <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> 期間所啟動)。</span><span class="sxs-lookup"><span data-stu-id="8050c-130">Override <xref:System.ServiceProcess.ServiceBase.OnStop%2A> to call <xref:System.ServiceModel.Channels.CommunicationObject.Closed> on the <xref:System.ServiceModel.ServiceHost> any running [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services that were started during <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>.</span></span>  
  
    -   <span data-ttu-id="8050c-131">訂閱 <xref:System.ServiceModel.Channels.CommunicationObject.Faulted> 的 <xref:System.ServiceModel.ServiceHost> 事件，並在發生錯誤時，使用 <xref:System.ServiceProcess.ServiceController> 類別來關閉 Windows 服務應用程式。</span><span class="sxs-lookup"><span data-stu-id="8050c-131">Subscribe to the <xref:System.ServiceModel.Channels.CommunicationObject.Faulted> event of <xref:System.ServiceModel.ServiceHost> and use the <xref:System.ServiceProcess.ServiceController> class to shut down the Windows service application in case of error.</span></span>  
  
     <span data-ttu-id="8050c-132">負責裝載 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 服務的 Windows 服務應用程式，其部署與管理方式將與不使用 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 的 Windows 服務應用程式相同。</span><span class="sxs-lookup"><span data-stu-id="8050c-132">Windows service applications that host [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services are deployed and managed in the same way as Windows service applications that do not make use of [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8050c-133">請參閱</span><span class="sxs-lookup"><span data-stu-id="8050c-133">See Also</span></span>  
 <xref:System.ServiceProcess>  
 [<span data-ttu-id="8050c-134">逐步解說：在元件設計工具中建立 Windows 服務應用程式</span><span class="sxs-lookup"><span data-stu-id="8050c-134">Walkthrough: Creating a Windows Service Application in the Component Designer</span></span>](http://go.microsoft.com/fwlink/?LinkId=94875)  
 [<span data-ttu-id="8050c-135">如何：在 Managed Windows 服務中裝載 WCF 服務</span><span class="sxs-lookup"><span data-stu-id="8050c-135">How to: Host a WCF Service in a Managed Windows Service</span></span>](../../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-a-managed-windows-service.md)  
 [<span data-ttu-id="8050c-136">Windows 服務主機</span><span class="sxs-lookup"><span data-stu-id="8050c-136">Windows Service Host</span></span>](../../../../docs/framework/wcf/samples/windows-service-host.md)  
 [<span data-ttu-id="8050c-137">服務應用程式的程式設計架構</span><span class="sxs-lookup"><span data-stu-id="8050c-137">Service Application Programming Architecture</span></span>](http://go.microsoft.com/fwlink/?LinkId=94876)  
 [<span data-ttu-id="8050c-138">Windows Server App Fabric 裝載功能</span><span class="sxs-lookup"><span data-stu-id="8050c-138">Windows Server App Fabric Hosting Features</span></span>](http://go.microsoft.com/fwlink/?LinkId=201276)
