---
title: "限制訊息散發"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 8b5ec4b8-1ce9-45ef-bb90-2c840456bcc1
caps.latest.revision: "10"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: ab46b1c908e8eb61ea49315e120973f1ea381bc6
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/18/2017
---
# <a name="limiting-message-distribution"></a><span data-ttu-id="42134-102">限制訊息散發</span><span class="sxs-lookup"><span data-stu-id="42134-102">Limiting Message Distribution</span></span>
<span data-ttu-id="42134-103">對等通道在設計上即是廣播 mesh。</span><span class="sxs-lookup"><span data-stu-id="42134-103">Peer Channel is by design a broadcast mesh.</span></span> <span data-ttu-id="42134-104">其基本流動模型牽涉到將 mesh 的任何成員所傳送的每個訊息，散發給該 mesh 的所有其他成員。</span><span class="sxs-lookup"><span data-stu-id="42134-104">Its basic flooding model involves distributing each message sent by any member of a mesh to all other members of that mesh.</span></span> <span data-ttu-id="42134-105">當成員產生的每個訊息對所有其他成員而言，是相關的且有用的訊息的情況下 (例如聊天室的案例)，這就是理想的方式。</span><span class="sxs-lookup"><span data-stu-id="42134-105">This is ideal in situations where every message generated by a member is relevant and useful to all other members (for example, a chat room).</span></span> <span data-ttu-id="42134-106">然而，許多應用程式偶爾會需要限制訊息的散發。</span><span class="sxs-lookup"><span data-stu-id="42134-106">However, many applications have an occasional need for limiting message distribution.</span></span> <span data-ttu-id="42134-107">例如，在新成員加入 mesh 並想要擷取透過 mesh 傳送的上一個訊息時，這個要求並不需要流向 mesh 的每個成員。</span><span class="sxs-lookup"><span data-stu-id="42134-107">For example, if a new member joins a mesh and wants to retrieve the last message sent through the mesh, this request does not need to be flooded to every member of the mesh.</span></span> <span data-ttu-id="42134-108">您可以限制要求流向至近鄰，或者可以篩選掉本機產生的訊息。而訊息也可以傳送到 mesh 上的個別節點。</span><span class="sxs-lookup"><span data-stu-id="42134-108">The request could be limited to near neighbors, or locally generated messages can be filtered out. Messages can also be sent to an individual node on the mesh.</span></span> <span data-ttu-id="42134-109">本主題討論使用躍點計數、訊息傳播篩選條件、本機篩選條件或直接連接，控制訊息在整個 mesh 間的轉送方式，並提供用於選擇適當方法的一般方針。</span><span class="sxs-lookup"><span data-stu-id="42134-109">This topic discusses using Hop Count, a Message Propagation Filter, a local filter, or a direct connection to control how messages are forwarded throughout the mesh, and provides general guidelines for choosing an approach.</span></span>  
  
## <a name="hop-counts"></a><span data-ttu-id="42134-110">躍點計數</span><span class="sxs-lookup"><span data-stu-id="42134-110">Hop Counts</span></span>  
 <span data-ttu-id="42134-111">`PeerHopCount` 的概念類似於 IP 通訊協定中使用的 TTL (存留時間)。</span><span class="sxs-lookup"><span data-stu-id="42134-111">The concept of `PeerHopCount` is similar to TTL (Time-To-Live) used in IP protocol.</span></span> <span data-ttu-id="42134-112">`PeerHopCount` 的值會繫結到訊息執行個體，並會指定在捨棄訊息前應該轉送幾次訊息。</span><span class="sxs-lookup"><span data-stu-id="42134-112">The value of `PeerHopCount` is tied to a message instance, and it specifies how many times a message should be forwarded before being dropped.</span></span> <span data-ttu-id="42134-113">每當對等通道用戶端收到訊息時，用戶端會檢查訊息是否有指定 `PeerHopCount`。</span><span class="sxs-lookup"><span data-stu-id="42134-113">Each time a message is received by a Peer Channel client, the client examines the message to see if `PeerHopCount` is specified.</span></span> <span data-ttu-id="42134-114">如果有指定的話，則用戶端會將躍點計數值減一後，才轉送訊息給鄰近節點。</span><span class="sxs-lookup"><span data-stu-id="42134-114">If it is specified, then the client decrements the hop count value by one before forwarding the message to neighboring nodes.</span></span> <span data-ttu-id="42134-115">當用戶端所收到訊息的躍點計數值為零時，用戶端會處理該訊息，但不會將訊息轉送給鄰近節點。</span><span class="sxs-lookup"><span data-stu-id="42134-115">When a client receives a message with a hop count value of zero, the client processes the message, but does not forward the message to neighbors.</span></span>  
  
 <span data-ttu-id="42134-116">只要將 `PeerHopCount` 當做屬性 (Attribute) 加入至訊息類別實作中適當的屬性 (Property) 或欄位中，即可將躍點計數加入至訊息。</span><span class="sxs-lookup"><span data-stu-id="42134-116">Hop count may be added to a message by adding `PeerHopCount` as an attribute to the applicable property or field in the implementation of the message class.</span></span> <span data-ttu-id="42134-117">您可以在傳送訊息至網狀結構之前，先將此屬性設定為特定值。</span><span class="sxs-lookup"><span data-stu-id="42134-117">You can set this to a specific value before sending the message to the mesh.</span></span> <span data-ttu-id="42134-118">因此，必要時您可以使用躍點計數來限制訊息在 mesh 間的散發，或許可以避免不必要的重複訊息。</span><span class="sxs-lookup"><span data-stu-id="42134-118">In this manner, you can use hop count to limit distribution of messages throughout the mesh when necessary, potentially avoiding unnecessary message duplication.</span></span> <span data-ttu-id="42134-119">當 mesh 包含大量的多餘資料，或者要傳送訊息給最近的鄰居或少許躍點內的鄰居時，這個方法會特別有用。</span><span class="sxs-lookup"><span data-stu-id="42134-119">This is useful in cases where the mesh contains a high amount of redundant data, or for sending a message to immediate neighbors, or neighbors within a few hops.</span></span>  
  
-   <span data-ttu-id="42134-120">如需程式碼片段和相關的資訊，請參閱[對等通道部落格](http://go.microsoft.com/fwlink/?LinkID=114531)(http://go.microsoft.com/fwlink/?LinkID=114531)。</span><span class="sxs-lookup"><span data-stu-id="42134-120">For code snippets and related information, see the [Peer Channel blog](http://go.microsoft.com/fwlink/?LinkID=114531) (http://go.microsoft.com/fwlink/?LinkID=114531).</span></span>  
  
## <a name="message-propagation-filter"></a><span data-ttu-id="42134-121">訊息傳播篩選條件</span><span class="sxs-lookup"><span data-stu-id="42134-121">Message Propagation Filter</span></span>  
 <span data-ttu-id="42134-122">`MessagePropagationFilter` 可以用於訊息流動的自訂控制，特別是在訊息內容或其他特定案例會決定傳播的進行時。</span><span class="sxs-lookup"><span data-stu-id="42134-122">`MessagePropagationFilter` can be used for customized control of message flooding, especially when the content of the message or other specific scenarios determine propagation.</span></span> <span data-ttu-id="42134-123">篩選條件可以為通過節點的每個訊息進行傳播決策。</span><span class="sxs-lookup"><span data-stu-id="42134-123">The filter makes propagation decisions for every message that passes through the node.</span></span> <span data-ttu-id="42134-124">這對於節點所收到的訊息是在 mesh 中任何其他地方產生的，以及應用程式所建立的訊息來說，特別是如此。</span><span class="sxs-lookup"><span data-stu-id="42134-124">This is true for messages that originated elsewhere in the mesh that your node has received as well as messages created by your application.</span></span> <span data-ttu-id="42134-125">篩選條件能夠同時存取訊息及其來源，因此可以根據完整可用的資訊來判斷是否要轉送或捨棄訊息。</span><span class="sxs-lookup"><span data-stu-id="42134-125">The filter has access to both the message and its origination, so decisions about forwarding or dropping the message can be based on the full information available.</span></span>  
  
 <span data-ttu-id="42134-126"><xref:System.ServiceModel.PeerMessagePropagationFilter> 是基底抽象類別，具有單一函式 <xref:System.ServiceModel.PeerMessagePropagationFilter.ShouldMessagePropagate%2A>。</span><span class="sxs-lookup"><span data-stu-id="42134-126"><xref:System.ServiceModel.PeerMessagePropagationFilter> is a base abstract class with a single function, <xref:System.ServiceModel.PeerMessagePropagationFilter.ShouldMessagePropagate%2A>.</span></span> <span data-ttu-id="42134-127">方法呼叫的第一個引數會傳入訊息的完整複本。</span><span class="sxs-lookup"><span data-stu-id="42134-127">The first argument of the method call passes in a full copy of the message.</span></span> <span data-ttu-id="42134-128">對該訊息所進行的任何變更，並不會影響到實際的訊息。</span><span class="sxs-lookup"><span data-stu-id="42134-128">Any changes made to the message do not affect the actual message.</span></span> <span data-ttu-id="42134-129">方法呼叫的最後一個引數會識別訊息的來源 (`PeerMessageOrigination.Local` 或 `PeerMessageOrigination.Remote`)。</span><span class="sxs-lookup"><span data-stu-id="42134-129">The last argument of the method call identifies the origin of the message (`PeerMessageOrigination.Local` or `PeerMessageOrigination.Remote`).</span></span> <span data-ttu-id="42134-130">這個方法的具體實作必須從 <xref:System.ServiceModel.PeerMessagePropagation> 列舉型別傳回常數，此常數表示要將訊息轉送至本機應用程式 (`Local`)、轉送至遠端用戶端 (`Remote`)，或者兩個都要 (`LocalAndRemote`) 或都不要 (`None`)。</span><span class="sxs-lookup"><span data-stu-id="42134-130">Concrete implementations of this method must return a constant from the <xref:System.ServiceModel.PeerMessagePropagation> enumeration indicating that the message is to be forwarded to the local application (`Local`), forwarded to remote clients (`Remote`), both (`LocalAndRemote`), or neither (`None`).</span></span> <span data-ttu-id="42134-131">您可以存取對應的 `PeerNode` 物件，並在 `PeerNode.MessagePropagationFilter` 屬性中指定衍生傳播篩選條件類別的執行個體，藉此套用這個篩選條件。</span><span class="sxs-lookup"><span data-stu-id="42134-131">This filter can be applied by accessing the corresponding `PeerNode` object and specifying an instance of the derived propagation filter class in the `PeerNode.MessagePropagationFilter` property.</span></span> <span data-ttu-id="42134-132">請確定您已在開啟對等通道前附加傳播篩選條件。</span><span class="sxs-lookup"><span data-stu-id="42134-132">Ensure that the propagation filter is attached before opening the Peer Channel.</span></span>  
  
-   <span data-ttu-id="42134-133">如需程式碼片段和相關的資訊，請參閱[對等通道部落格](http://go.microsoft.com/fwlink/?LinkID=114532)(http://go.microsoft.com/fwlink/?LinkID=114532)。</span><span class="sxs-lookup"><span data-stu-id="42134-133">For code snippets and related information, see the [Peer Channel blog](http://go.microsoft.com/fwlink/?LinkID=114532) (http://go.microsoft.com/fwlink/?LinkID=114532).</span></span>  
  
## <a name="contacting-an-individual-node-in-the-mesh"></a><span data-ttu-id="42134-134">聯繫 Mesh 中的個別節點</span><span class="sxs-lookup"><span data-stu-id="42134-134">Contacting an Individual Node in the Mesh</span></span>  
 <span data-ttu-id="42134-135">藉由設定本機篩選條件或設定直接連接，即可以聯繫 mesh 中的個別節點。</span><span class="sxs-lookup"><span data-stu-id="42134-135">An individual node in a mesh can be contacted by setting up a local filter, or by setting up a direct connection.</span></span>  
  
 <span data-ttu-id="42134-136">如果 mesh 中的每個節點都有個別的 ID，就可以在訊息實作中指定目的端 ID。</span><span class="sxs-lookup"><span data-stu-id="42134-136">If the nodes in a mesh each have an individual ID, a destination ID can be specified in the implementation of your message.</span></span> <span data-ttu-id="42134-137">本機篩選條件的設定方式，是藉由在訊息合約中撰寫函式，只有在目前節點的 ID 符合您指定的目的端 ID 時，才顯示訊息給該節點。</span><span class="sxs-lookup"><span data-stu-id="42134-137">A local filter can be set up by writing a function in your message contract that will only display the message to the current node if its ID matches the destination ID you specified.</span></span> <span data-ttu-id="42134-138">由於 mesh 會傳輸該訊息，所以不一定會帶來設定新連接的額外負荷作業。</span><span class="sxs-lookup"><span data-stu-id="42134-138">The mesh transports the message, so the overhead of setting up a new connection does not have to be incurred.</span></span> <span data-ttu-id="42134-139">然而，這樣卻缺乏效率，因為要在 mesh 中傳送許多次訊息。</span><span class="sxs-lookup"><span data-stu-id="42134-139">However, there is a loss of efficiency since the message is sent many times throughout the mesh.</span></span> <span data-ttu-id="42134-140">當傳送給 mesh 的個別成員的訊息不太大而且也不頻繁發生時，這個方法可以運作得很好。</span><span class="sxs-lookup"><span data-stu-id="42134-140">This works well for sending messages to individual members of a mesh as long as the messages are neither too big nor too frequent.</span></span>  
  
 <span data-ttu-id="42134-141">對於持續性、高頻寬的連接，比較適合使用直接連接。</span><span class="sxs-lookup"><span data-stu-id="42134-141">For long-lasting, high-bandwidth connections, direct connections are preferable.</span></span> <span data-ttu-id="42134-142">您可以透過 mesh 傳送連接資訊，然後再設定您選擇的直接連接以傳送/接收訊息。</span><span class="sxs-lookup"><span data-stu-id="42134-142">You can send connection information over the mesh, and then set up a direct connection of your choosing to send/receive messages.</span></span>  
  
## <a name="choosing-an-approach-for-limiting-message-distribution"></a><span data-ttu-id="42134-143">選擇限制訊息散發的方法</span><span class="sxs-lookup"><span data-stu-id="42134-143">Choosing an Approach for Limiting Message Distribution</span></span>  
 <span data-ttu-id="42134-144">在探索您需要限制訊息散發的案例時，請詢問您自己下列問題：</span><span class="sxs-lookup"><span data-stu-id="42134-144">When you discover a scenario in which you need to limit message distribution, ask yourself the following questions:</span></span>  
  
-   <span data-ttu-id="42134-145">**誰**需要接收訊息？</span><span class="sxs-lookup"><span data-stu-id="42134-145">**Who** needs to receive the message?</span></span> <span data-ttu-id="42134-146">只是一個鄰近節點？</span><span class="sxs-lookup"><span data-stu-id="42134-146">Just one neighbor node?</span></span> <span data-ttu-id="42134-147">mesh 中其他位置的節點？</span><span class="sxs-lookup"><span data-stu-id="42134-147">A node somewhere else in the mesh?</span></span> <span data-ttu-id="42134-148">或是 mesh 中一半的節點？</span><span class="sxs-lookup"><span data-stu-id="42134-148">Half the mesh?</span></span>  
  
-   <span data-ttu-id="42134-149">**頻率**會傳送此訊息？</span><span class="sxs-lookup"><span data-stu-id="42134-149">**How often** will this message be sent?</span></span>  
  
-   <span data-ttu-id="42134-150">何種類型的**頻寬**將使用此訊息？</span><span class="sxs-lookup"><span data-stu-id="42134-150">What kind of **bandwidth** will this message use?</span></span>  
  
 <span data-ttu-id="42134-151">這些問題的答案能夠協助您決定該使用躍點計數、訊息傳播篩選條件、本機篩選條件或直接連接。</span><span class="sxs-lookup"><span data-stu-id="42134-151">The answers to these questions can help you determine whether to use Hop Count, a Message Propagation Filter, a local filter, or a direct connection.</span></span> <span data-ttu-id="42134-152">請考慮下列一般方針：</span><span class="sxs-lookup"><span data-stu-id="42134-152">Consider the following general guidelines:</span></span>  
  
-   <span data-ttu-id="42134-153">**人員**</span><span class="sxs-lookup"><span data-stu-id="42134-153">**Who**</span></span>  
  
    -   <span data-ttu-id="42134-154">*個別節點*： 本機篩選條件或直接連接。</span><span class="sxs-lookup"><span data-stu-id="42134-154">*Individual node*:  Local filter or direct connection.</span></span>  
  
    -   <span data-ttu-id="42134-155">*某些區域內的鄰居*: PeerHopCount。</span><span class="sxs-lookup"><span data-stu-id="42134-155">*Neighbors within a certain vicinity*:  PeerHopCount.</span></span>  
  
    -   <span data-ttu-id="42134-156">*Mesh 的複雜子集*: MessagePropagationFilter。</span><span class="sxs-lookup"><span data-stu-id="42134-156">*Complex subset of the mesh*:  MessagePropagationFilter.</span></span>  
  
-   <span data-ttu-id="42134-157">**頻率**</span><span class="sxs-lookup"><span data-stu-id="42134-157">**How often**</span></span>  
  
    -   <span data-ttu-id="42134-158">*非常頻繁*： 直接連接、 PeerHopCount、 MessagePropagationFilter。</span><span class="sxs-lookup"><span data-stu-id="42134-158">*Very frequent*:  Direct connection, PeerHopCount, MessagePropagationFilter.</span></span>  
  
    -   <span data-ttu-id="42134-159">*偶爾*： 本機篩選條件。</span><span class="sxs-lookup"><span data-stu-id="42134-159">*Occasional*:  Local filter.</span></span>  
  
-   <span data-ttu-id="42134-160">**頻寬使用**</span><span class="sxs-lookup"><span data-stu-id="42134-160">**Bandwidth use**</span></span>  
  
    -   <span data-ttu-id="42134-161">*高*： 直接連接，較不建議使用 MessagePropagationFilter 或本機篩選條件。</span><span class="sxs-lookup"><span data-stu-id="42134-161">*High*:  Direct connection, less advisable to use MessagePropagationFilter or local filter.</span></span>  
  
    -   <span data-ttu-id="42134-162">*低*： 可能不需要任何，直接連線。</span><span class="sxs-lookup"><span data-stu-id="42134-162">*Low*:  Any, direct connection probably not needed.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="42134-163">另請參閱</span><span class="sxs-lookup"><span data-stu-id="42134-163">See Also</span></span>  
 [<span data-ttu-id="42134-164">建置對等通道應用程式</span><span class="sxs-lookup"><span data-stu-id="42134-164">Building a Peer Channel Application</span></span>](../../../../docs/framework/wcf/feature-details/building-a-peer-channel-application.md)
