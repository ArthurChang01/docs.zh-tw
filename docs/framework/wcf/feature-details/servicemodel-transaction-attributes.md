---
title: ServiceModel 交易屬性
ms.date: 03/30/2017
helpviewer_keywords:
- transactions [WCF], ServiceModel attributes
ms.assetid: 1e0d2436-6ae5-439b-9765-a448d6f60000
ms.openlocfilehash: 79d97eee328d816281348b5b15cf779e1ee65893
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/23/2019
ms.locfileid: "61747663"
---
# <a name="servicemodel-transaction-attributes"></a><span data-ttu-id="5ede7-102">ServiceModel 交易屬性</span><span class="sxs-lookup"><span data-stu-id="5ede7-102">ServiceModel Transaction Attributes</span></span>
<span data-ttu-id="5ede7-103">Windows Communication Foundation (WCF) 提供的三個標準屬性<xref:System.ServiceModel>屬性，可讓您設定 WCF 服務的交易的行為：</span><span class="sxs-lookup"><span data-stu-id="5ede7-103">Windows Communication Foundation (WCF) provides properties on three standard <xref:System.ServiceModel> attributes that enable you to configure the behavior of transactions for a WCF service:</span></span>  
  
- <xref:System.ServiceModel.TransactionFlowAttribute>  
  
- <xref:System.ServiceModel.ServiceBehaviorAttribute>  
  
- <xref:System.ServiceModel.OperationBehaviorAttribute>  
  
## <a name="transactionflowattribute"></a><span data-ttu-id="5ede7-104">TransactionFlowAttribute</span><span class="sxs-lookup"><span data-stu-id="5ede7-104">TransactionFlowAttribute</span></span>  
 <span data-ttu-id="5ede7-105"><xref:System.ServiceModel.TransactionFlowAttribute> 屬性指定服務合約中的作業是否願意接受來自用戶端的傳入異動。</span><span class="sxs-lookup"><span data-stu-id="5ede7-105">The <xref:System.ServiceModel.TransactionFlowAttribute> attribute specifies the willingness of an operation in a service contract to accept incoming transactions from a client.</span></span> <span data-ttu-id="5ede7-106">屬性會提供這個控制項，使用下列屬性：使用交易<xref:System.ServiceModel.TransactionFlowOption>列舉來指定傳入異動是否<xref:System.ServiceModel.TransactionFlowOption.Mandatory>， <xref:System.ServiceModel.TransactionFlowOption.Allowed>，或<xref:System.ServiceModel.TransactionFlowOption.NotAllowed>。</span><span class="sxs-lookup"><span data-stu-id="5ede7-106">The attribute provides this control with the following property: Transactions use the <xref:System.ServiceModel.TransactionFlowOption> enumeration to specify whether an incoming transaction is <xref:System.ServiceModel.TransactionFlowOption.Mandatory>, <xref:System.ServiceModel.TransactionFlowOption.Allowed>, or <xref:System.ServiceModel.TransactionFlowOption.NotAllowed>.</span></span>  
  
 <span data-ttu-id="5ede7-107">這是唯一將服務作業與外部用戶端互動產生關聯的屬性。</span><span class="sxs-lookup"><span data-stu-id="5ede7-107">This is the only attribute that relates service operations to external interactions with a client.</span></span> <span data-ttu-id="5ede7-108">下列章節中描述的屬性與使用執行作業內的異動有關。</span><span class="sxs-lookup"><span data-stu-id="5ede7-108">The attributes described in the following sections relate to the use of transactions within the execution of the operation.</span></span>  
  
## <a name="servicebehaviorattribute"></a><span data-ttu-id="5ede7-109">ServiceBehaviorAttribute</span><span class="sxs-lookup"><span data-stu-id="5ede7-109">ServiceBehaviorAttribute</span></span>  
 <span data-ttu-id="5ede7-110"><xref:System.ServiceModel.ServiceBehaviorAttribute> 屬性指定服務合約實作的內部執行行為。</span><span class="sxs-lookup"><span data-stu-id="5ede7-110">The <xref:System.ServiceModel.ServiceBehaviorAttribute> attribute specifies the internal execution behavior of a service contract implementation.</span></span> <span data-ttu-id="5ede7-111">這個屬性 (Attribute) 的異動特定屬性 (Property) 包括：</span><span class="sxs-lookup"><span data-stu-id="5ede7-111">Transaction-specific properties of this attribute include:</span></span>  
  
- <span data-ttu-id="5ede7-112"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A> 指定當工作階段關閉時是否會完成未完成的異動。</span><span class="sxs-lookup"><span data-stu-id="5ede7-112"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A> specifies whether to complete an uncompleted transaction when the session closes.</span></span> <span data-ttu-id="5ede7-113">這個屬性的預設值為 `false`。</span><span class="sxs-lookup"><span data-stu-id="5ede7-113">The default value for this property is `false`.</span></span> <span data-ttu-id="5ede7-114">如果這個屬性是 `true`，並且傳入工作階段依正常程序關閉，而不是因為網路或用戶端錯誤導致關閉，則任何未完成的異動都會成功完成。</span><span class="sxs-lookup"><span data-stu-id="5ede7-114">If this property is `true`, and the incoming session was gracefully shut down instead of closing due to network or client faults, any uncompleted transaction is successfully completed.</span></span> <span data-ttu-id="5ede7-115">否則，如果這個屬性是 `false`，或是如果工作階段不是依正常程序關閉，則當工作階段關閉時就會復原未完成的交易。</span><span class="sxs-lookup"><span data-stu-id="5ede7-115">Otherwise, if this property is `false` or if the session was not gracefully closed, any uncompleted transaction is rolled back when the session closes.</span></span> <span data-ttu-id="5ede7-116">如果這個屬性是 `true`，則傳入通道必須是以工作階段為依據。</span><span class="sxs-lookup"><span data-stu-id="5ede7-116">If this property is `true`, the incoming channel must be session-based.</span></span>  
  
- <span data-ttu-id="5ede7-117"><xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A> 指定當異動完成時是否要釋放基礎服務執行個體。</span><span class="sxs-lookup"><span data-stu-id="5ede7-117"><xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A> specifies whether the underlying service instance is released when a transaction completes.</span></span> <span data-ttu-id="5ede7-118">這個屬性的預設值為 `true`。</span><span class="sxs-lookup"><span data-stu-id="5ede7-118">The default value for this property is `true`.</span></span> <span data-ttu-id="5ede7-119">下一個傳入訊息會導致建立新的基礎執行個體，並捨棄之前執行個體可能持有的任何每個異動狀態。</span><span class="sxs-lookup"><span data-stu-id="5ede7-119">The next inbound message causes a new underlying instance to be created, discarding any per-transaction state that the previous instance might have held.</span></span> <span data-ttu-id="5ede7-120">釋放服務執行個體是服務執行的內部動作，並且不會影響用戶端可能已建立的任何現有連線或工作階段。</span><span class="sxs-lookup"><span data-stu-id="5ede7-120">Releasing a service instance is an internal action the service takes and has no impact on any existing connections or sessions that clients might have established.</span></span> <span data-ttu-id="5ede7-121">這個功能等同於 COM+ 提供的 Just-in-Time 啟動功能。</span><span class="sxs-lookup"><span data-stu-id="5ede7-121">This functionality is equivalent to the just-in-time activation feature COM+ provides.</span></span> <span data-ttu-id="5ede7-122">如果屬性是 `true`，則 <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> 必須等於 <xref:System.ServiceModel.ConcurrencyMode.Single>。</span><span class="sxs-lookup"><span data-stu-id="5ede7-122">If the property is `true`, <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> must be equal to <xref:System.ServiceModel.ConcurrencyMode.Single>.</span></span> <span data-ttu-id="5ede7-123">否則，在啟動期間服務會發生無效組態驗證例外狀況。</span><span class="sxs-lookup"><span data-stu-id="5ede7-123">Otherwise, the service throws an invalid configuration validation exception during startup.</span></span>  
  
- <span data-ttu-id="5ede7-124"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionIsolationLevel%2A> 指定服務內異動所使用的隔離等級，這個屬性會使用其中一個 <xref:System.Transactions.IsolationLevel> 值。</span><span class="sxs-lookup"><span data-stu-id="5ede7-124"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionIsolationLevel%2A> specifies the isolation level to use for transactions within the service; this property takes one of the <xref:System.Transactions.IsolationLevel> values.</span></span> <span data-ttu-id="5ede7-125">如果本機隔離等級屬性不是 <xref:System.Transactions.IsolationLevel.Unspecified>，則傳入交易的隔離等級必須符合此本機屬性的設定。</span><span class="sxs-lookup"><span data-stu-id="5ede7-125">If the local isolation level property is anything other than <xref:System.Transactions.IsolationLevel.Unspecified>, the isolation level of an incoming transaction must match the setting of this local property.</span></span> <span data-ttu-id="5ede7-126">否則，就會拒絕傳入異動並且將錯誤傳回用戶端。</span><span class="sxs-lookup"><span data-stu-id="5ede7-126">Otherwise, the incoming transaction is rejected, and a fault is sent back to the client.</span></span> <span data-ttu-id="5ede7-127">如果 <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> 是 `true`，並且沒有流動的交易，這個屬性會判定在本機建立之交易要使用的 <xref:System.Transactions.IsolationLevel> 值。</span><span class="sxs-lookup"><span data-stu-id="5ede7-127">If <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> is `true`, and no transaction is flowed, this property determines the <xref:System.Transactions.IsolationLevel> value to use for the locally created transaction.</span></span> <span data-ttu-id="5ede7-128">如果 <xref:System.Transactions.IsolationLevel> 設定為 <xref:System.Transactions.IsolationLevel.Unspecified>，就會使用 <xref:System.Transactions.IsolationLevel><xref:System.Transactions.IsolationLevel.Serializable>。</span><span class="sxs-lookup"><span data-stu-id="5ede7-128">If <xref:System.Transactions.IsolationLevel> is set to <xref:System.Transactions.IsolationLevel.Unspecified>, <xref:System.Transactions.IsolationLevel><xref:System.Transactions.IsolationLevel.Serializable> is used.</span></span>  
  
- <span data-ttu-id="5ede7-129"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> 指定在服務所建立之新交易必須完成的時間間隔。</span><span class="sxs-lookup"><span data-stu-id="5ede7-129"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> specifies the time period within which a new transaction created at the service must complete.</span></span> <span data-ttu-id="5ede7-130">如果達到這個時間而異動尚未完成的話，異動就會中止。</span><span class="sxs-lookup"><span data-stu-id="5ede7-130">If this time is reached and the transaction has not been completed, it will abort.</span></span> <span data-ttu-id="5ede7-131"><xref:System.TimeSpan> 會用來當做將 <xref:System.Transactions.TransactionScope> 設定為 <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> 之任何作業，以及建立新異動的 `true` 逾時。</span><span class="sxs-lookup"><span data-stu-id="5ede7-131">The <xref:System.TimeSpan> is used as the <xref:System.Transactions.TransactionScope> time-out for any operations that have <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> set to `true` and for which a new transaction was created.</span></span> <span data-ttu-id="5ede7-132">從建立異動到完成兩階段異動認可通訊協定中的階段 1，所允許的逾時期間上限。</span><span class="sxs-lookup"><span data-stu-id="5ede7-132">The time-out is the maximum allowed duration from the creation of the transaction to the completion of phase 1 in the two-phase commit protocol.</span></span> <span data-ttu-id="5ede7-133">所使用的逾時值永遠都是 <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> 屬性和 `transactionTimeout` 組態設定之間較低的值。</span><span class="sxs-lookup"><span data-stu-id="5ede7-133">The time-out value used is always the lower value between the <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> property and the `transactionTimeout` configuration setting.</span></span>  
  
## <a name="operationbehaviorattribute"></a><span data-ttu-id="5ede7-134">OperationBehaviorAttribute</span><span class="sxs-lookup"><span data-stu-id="5ede7-134">OperationBehaviorAttribute</span></span>  
 <span data-ttu-id="5ede7-135"><xref:System.ServiceModel.OperationBehaviorAttribute> 屬性指定服務實作中方法的行為。</span><span class="sxs-lookup"><span data-stu-id="5ede7-135">The <xref:System.ServiceModel.OperationBehaviorAttribute> attribute specifies the behaviors of the methods in the service implementation.</span></span> <span data-ttu-id="5ede7-136">您可以用來表示作業的特定執行行為。</span><span class="sxs-lookup"><span data-stu-id="5ede7-136">You can use it to indicate the operation's specific execution behavior.</span></span> <span data-ttu-id="5ede7-137">這個屬性的屬性不會影響的服務合約的 Web 服務描述語言 (WSDL) 描述，而且是純粹的元素 WCF 程式設計模型可讓開發人員則必須自行實作的常見功能。</span><span class="sxs-lookup"><span data-stu-id="5ede7-137">Properties of this attribute do not affect the Web Service Description Language (WSDL) description of the service contract, and are purely elements of the WCF programming model that enable common features that developers otherwise have to implement themselves.</span></span>  
  
 <span data-ttu-id="5ede7-138">這個屬性 (Attribute) 有下列異動特定屬性 (Property)：</span><span class="sxs-lookup"><span data-stu-id="5ede7-138">This attribute has the following transaction-specific properties:</span></span>  
  
- <span data-ttu-id="5ede7-139"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> 指定方法是否必須在現用異動的範圍內執行。</span><span class="sxs-lookup"><span data-stu-id="5ede7-139"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> specifies whether a method must execute within an active transaction scope.</span></span> <span data-ttu-id="5ede7-140">預設為 `false`。</span><span class="sxs-lookup"><span data-stu-id="5ede7-140">The default is `false`.</span></span> <span data-ttu-id="5ede7-141">如果沒有為方法設定 <xref:System.ServiceModel.OperationBehaviorAttribute> 屬性，這也表示該方法不會在異動中執行。</span><span class="sxs-lookup"><span data-stu-id="5ede7-141">If the <xref:System.ServiceModel.OperationBehaviorAttribute> attribute is not set for a method, it also implies that the method will not execute in a transaction.</span></span> <span data-ttu-id="5ede7-142">如果作業不需要交易範圍，則存在於訊息標頭中的任何交易都不會啟動，而且保持為 <xref:System.ServiceModel.OperationContext.IncomingMessageProperties%2A> 的 <xref:System.ServiceModel.OperationContext> 項目。</span><span class="sxs-lookup"><span data-stu-id="5ede7-142">If a transaction scope is not required for an operation, any transaction that is present within the message header is not activated and remains as an element of the <xref:System.ServiceModel.OperationContext.IncomingMessageProperties%2A> of the <xref:System.ServiceModel.OperationContext>.</span></span> <span data-ttu-id="5ede7-143">如果作業需要異動範圍，則異動來源會衍生自下列其中一個：</span><span class="sxs-lookup"><span data-stu-id="5ede7-143">If a transaction scope is required for an operation, the source for the transaction is derived from one of the following:</span></span>  
  
    - <span data-ttu-id="5ede7-144">如果交易從用戶端流入，則會在使用分散式交易建立的交易範圍內執行方法。</span><span class="sxs-lookup"><span data-stu-id="5ede7-144">If a transaction is flowed from the client, the method is executed under a transaction scope created using that distributed transaction.</span></span>  
  
    - <span data-ttu-id="5ede7-145">使用已佇列的傳輸時，會使用用來清除佇列訊息的異動。</span><span class="sxs-lookup"><span data-stu-id="5ede7-145">With a queued transport, the transaction used to dequeue the message is used.</span></span> <span data-ttu-id="5ede7-146">請注意，使用的交易並不是流動交易，因為不是由訊息的原始傳送者提供。</span><span class="sxs-lookup"><span data-stu-id="5ede7-146">Note that the transaction used is not a flowed transaction, in that it was not provided by the original sender of the message.</span></span>  
  
    - <span data-ttu-id="5ede7-147">自訂傳輸可以透過使用 `TransportTransactionProperty` 提供交易。</span><span class="sxs-lookup"><span data-stu-id="5ede7-147">A custom transport can provide a transaction through the use of the `TransportTransactionProperty`.</span></span>  
  
    - <span data-ttu-id="5ede7-148">如果上述都無法提供交易的外部來源，就會在呼叫方法之前立即建立新的 <xref:System.Transactions.Transaction> 執行個體。</span><span class="sxs-lookup"><span data-stu-id="5ede7-148">If none of the above provides an external source for a transaction, a new <xref:System.Transactions.Transaction> instance is created immediately prior to calling the method.</span></span>  
  
- <span data-ttu-id="5ede7-149"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> 指定如果沒有發生未處理的例外狀況，方法執行的異動是否會自動完成。</span><span class="sxs-lookup"><span data-stu-id="5ede7-149"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> specifies whether the transaction in which the method executes is automatically completed if no unhandled exceptions are thrown.</span></span> <span data-ttu-id="5ede7-150">如果這個屬性是 `true`，當使用者方法在傳回時沒有發生例外狀況時，呼叫基礎結構會自動將異動標記為「已完成」。</span><span class="sxs-lookup"><span data-stu-id="5ede7-150">If this property is `true`, the calling infrastructure automatically marks the transaction as "completed" if the user method returns without throwing an exception.</span></span> <span data-ttu-id="5ede7-151">如果這個屬性是 `false`，則異動會附加至執行個體，並且只有在用戶端呼叫使用這個屬性標記為 `true` 的後續方法，或是如果後續方法明確地呼叫 <xref:System.ServiceModel.OperationContext.SetTransactionComplete%2A> 時，才會標記為「已完成」。</span><span class="sxs-lookup"><span data-stu-id="5ede7-151">If this property is `false`, the transaction is attached to the instance, and is only marked as "completed" if the client calls a subsequent method that is marked with this property equal to `true`, or if a subsequent method explicitly calls <xref:System.ServiceModel.OperationContext.SetTransactionComplete%2A>.</span></span> <span data-ttu-id="5ede7-152">除非 <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A> 屬性設定為 `true`，否則無法在從未標記為「已完成」的交易中執行這些結果，並且也不會認可其中包含的工作。</span><span class="sxs-lookup"><span data-stu-id="5ede7-152">Failure to perform either of these results in the transaction never being "completed," and the contained work is not committed, unless the <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A> property is set to `true`.</span></span> <span data-ttu-id="5ede7-153">如果這個屬性設定為 `true`，您必須搭配工作階段使用通道，並且 <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> 必須設定為 <xref:System.ServiceModel.InstanceContextMode.PerSession>。</span><span class="sxs-lookup"><span data-stu-id="5ede7-153">If this property is set to `true`, you must use a channel with a session, and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> must be set to <xref:System.ServiceModel.InstanceContextMode.PerSession>.</span></span>
