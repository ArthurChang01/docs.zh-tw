---
title: "聯合與信任"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords: federation [WCF], and trust
ms.assetid: 4bdec4f2-f8a2-4512-bdcf-14ef54b5877a
caps.latest.revision: "12"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: a5228ffaab43e24849d461080cdf3ef09b2fa6c0
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/02/2017
---
# <a name="federation-and-trust"></a><span data-ttu-id="3c97f-102">聯合與信任</span><span class="sxs-lookup"><span data-stu-id="3c97f-102">Federation and Trust</span></span>
<span data-ttu-id="3c97f-103">本主題涵蓋與聯合應用程式、信任界限和組態，以及在 [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] 內使用發行權杖相關的各個層面。</span><span class="sxs-lookup"><span data-stu-id="3c97f-103">This topic covers various aspects related to federated applications, trust boundaries and configuration, and use of issued tokens in [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span></span>  
  
## <a name="services-security-token-services-and-trust"></a><span data-ttu-id="3c97f-104">服務、安全性權杖服務和信任</span><span class="sxs-lookup"><span data-stu-id="3c97f-104">Services, Security Token Services, and Trust</span></span>  
 <span data-ttu-id="3c97f-105">公開聯合端點的服務，通常會預期用戶端使用特定簽發者所提供的權杖進行驗證。</span><span class="sxs-lookup"><span data-stu-id="3c97f-105">Services that expose federated endpoints typically expect clients to authenticate using a token provided by a specific issuer.</span></span> <span data-ttu-id="3c97f-106">以正確的簽發者認證設定服務是很重要的，否則該服務將無法確認發行權杖上的簽章，而用戶端將無法與服務通訊。</span><span class="sxs-lookup"><span data-stu-id="3c97f-106">It is important that the service is configured with the correct credentials for the issuer; otherwise, it will not be able to verify signatures over the issued tokens, and the client will be unable to communicate with the service.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="3c97f-107">在服務上設定簽發者認證，請參閱[How to： 設定聯合服務的認證](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md)。</span><span class="sxs-lookup"><span data-stu-id="3c97f-107"> configuring issuer credentials on the service, see [How to: Configure Credentials on a Federation Service](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md).</span></span>  
  
 <span data-ttu-id="3c97f-108">同樣地，在使用對稱金鑰時，由於該金鑰會為目標服務而加密，因此您必須為目標服務以正確的憑證設定安全性權杖服務，否則將無法為目標服務加密金鑰，而因此用戶端將無法與服務通訊。</span><span class="sxs-lookup"><span data-stu-id="3c97f-108">Similarly, when using symmetric keys, the keys are encrypted for the target service, so you must configure the security token service with the correct credentials for the target service; otherwise, it will be unable to encrypt the key for the target service, and again, the client will be unable to communicate with the service.</span></span>  
  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="3c97f-109">服務使用的值<xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxClockSkew%2A>屬性[SecurityBindingElement](../../../../docs/framework/wcf/diagnostics/wmi/securitybindingelement.md)允許的時鐘誤差用戶端與服務之間。</span><span class="sxs-lookup"><span data-stu-id="3c97f-109"> services use the value of the <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxClockSkew%2A> property on the [SecurityBindingElement](../../../../docs/framework/wcf/diagnostics/wmi/securitybindingelement.md) to allow for clock skew between the client and service.</span></span> <span data-ttu-id="3c97f-110">在聯合中，`MaxClockSkew` 設定會從用戶端取得的發行權杖，套用至用戶端和安全性權杖服務間的時鐘誤差。</span><span class="sxs-lookup"><span data-stu-id="3c97f-110">In federation, the `MaxClockSkew` setting applies to clock skews between both the client and the security token service from where the client obtained the issued token.</span></span> <span data-ttu-id="3c97f-111">因此，在設定發行權杖的有效性和到期時間時，安全性權杖服務不需要設定時鐘誤差的上限。</span><span class="sxs-lookup"><span data-stu-id="3c97f-111">Therefore, security token services need not make clock-skew allowances when setting the issued token's effective and expiration times.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="3c97f-112">時鐘誤差的重要性隨著發行權杖的存留時間縮短而增加。</span><span class="sxs-lookup"><span data-stu-id="3c97f-112">The importance of clock skew increases as the lifetime of the issued token shortens.</span></span> <span data-ttu-id="3c97f-113">在大多數的情況下，如果權杖的存留時間為 30 分鐘 (含) 以上，則時鐘誤差就不是個嚴重的問題。</span><span class="sxs-lookup"><span data-stu-id="3c97f-113">In most cases, clock skew is not a significant issue if the token lifetime is 30 minutes or more.</span></span> <span data-ttu-id="3c97f-114">存留時間較短或需要精確驗證權杖時間的案例中，則請務必在設計時考量到時鐘誤差的問題。</span><span class="sxs-lookup"><span data-stu-id="3c97f-114">Scenarios with shorter lifetimes or where the exact validity time of the token is important should be designed to take clock skew into account.</span></span>  
  
## <a name="federated-endpoints-and-time-outs"></a><span data-ttu-id="3c97f-115">聯合端點和逾時</span><span class="sxs-lookup"><span data-stu-id="3c97f-115">Federated Endpoints and Time-Outs</span></span>  
 <span data-ttu-id="3c97f-116">當用戶端與聯合端點通訊時，必須先從安全性權杖服務取得適當的權杖。</span><span class="sxs-lookup"><span data-stu-id="3c97f-116">When a client communicates with a federated endpoint, it must first acquire an appropriate token from a security token service.</span></span> <span data-ttu-id="3c97f-117">如果安全性權杖服務公開了一個聯合端點，則用戶端必須先從該端點的簽發者取得權杖。</span><span class="sxs-lookup"><span data-stu-id="3c97f-117">If the security token service exposes a federated endpoint, the client must first obtain a token from the issuer for that endpoint.</span></span> <span data-ttu-id="3c97f-118">每個權杖的擷取都需要時間，而這些時間會隨著傳送實際訊息至最終端點的整個逾時而變動。</span><span class="sxs-lookup"><span data-stu-id="3c97f-118">Each token acquisition takes time, and that time is subject to the overall time-out for sending the actual message to the final endpoint.</span></span>  
  
 <span data-ttu-id="3c97f-119">例如，用戶端通道上的逾時設定為 30 秒。</span><span class="sxs-lookup"><span data-stu-id="3c97f-119">For example, the time-out on the client-side channel is set to 30 seconds.</span></span> <span data-ttu-id="3c97f-120">此時需要呼叫兩個權杖簽發者，以便在傳送訊息至最終端點之前擷取權杖，而每次發行權杖的時間需要 15 秒。</span><span class="sxs-lookup"><span data-stu-id="3c97f-120">Two token issuers need to be called to retrieve tokens before sending the message to the final endpoint, and each takes 15 seconds to issue a token.</span></span> <span data-ttu-id="3c97f-121">在此例中，此嘗試將會失敗，並會擲回 <xref:System.TimeoutException>。</span><span class="sxs-lookup"><span data-stu-id="3c97f-121">In this case, the attempt will fail and a <xref:System.TimeoutException> is thrown.</span></span> <span data-ttu-id="3c97f-122">因此，您必須將用戶端通道上的 <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A> 值，設定為足以擷取所有發行權杖所需的時間。</span><span class="sxs-lookup"><span data-stu-id="3c97f-122">Thus, you need to set the <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A> value on the client channel to a value large enough to include the time taken to retrieve all issued tokens.</span></span> <span data-ttu-id="3c97f-123">在沒有為 <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A> 屬性指定值的情形下，需要將 <xref:System.ServiceModel.Channels.Binding.OpenTimeout%2A> 屬性或 <xref:System.ServiceModel.Channels.Binding.SendTimeout%2A> 屬性 (或兩者同時) 的值設定為足以擷取所有發行權杖所需的時間。</span><span class="sxs-lookup"><span data-stu-id="3c97f-123">In the case where a value is not specified for the <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A> property, the <xref:System.ServiceModel.Channels.Binding.OpenTimeout%2A> property or the <xref:System.ServiceModel.Channels.Binding.SendTimeout%2A> property (or both) need to be set to a value large enough to include the time taken to retrieve all issued tokens.</span></span>  
  
## <a name="token-lifetime-and-renewal"></a><span data-ttu-id="3c97f-124">權杖存留時間和更新</span><span class="sxs-lookup"><span data-stu-id="3c97f-124">Token Lifetime and Renewal</span></span>  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="3c97f-125"> 用戶端不需要在對服務建立初始要求時檢查發行權杖。</span><span class="sxs-lookup"><span data-stu-id="3c97f-125"> clients do not check the issued token when making an initial request to a service.</span></span>  <span data-ttu-id="3c97f-126">更確切地說，[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 信任安全性權杖服務會發行具有適當有效性和到期時間的權杖。</span><span class="sxs-lookup"><span data-stu-id="3c97f-126">Rather, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] trusts the security token service to issue a token with appropriate effective and expiration times.</span></span> <span data-ttu-id="3c97f-127">如果用戶端快取了權杖並重複使用，則會在隨後要求時檢查權杖存留時間，而用戶端則會視需要自動更新權杖。</span><span class="sxs-lookup"><span data-stu-id="3c97f-127">If the token is cached by the client and reused, the token lifetime is checked on subsequent requests and the client automatically renews the token if necessary.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="3c97f-128">權杖快取，請參閱[How to： 建立聯合用戶端](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md)。</span><span class="sxs-lookup"><span data-stu-id="3c97f-128"> token caching, see [How to: Create a Federated Client](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md).</span></span>  
  
 <span data-ttu-id="3c97f-129">為發行權杖或安全性內容權杖指定較短的存留期間 (以 30 秒或小於 30 秒為例) 可能會導致交涉逾時，或者會在要求發行權杖或者在交涉或更新安全性內容權杖時，由 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 用戶端擲回其他例狀況。</span><span class="sxs-lookup"><span data-stu-id="3c97f-129">Specifying short lifetimes, on the order of 30 seconds or less for issued tokens or security context tokens, may result in negotiation time-outs or other exceptions being thrown by [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] clients when requesting issued tokens or when negotiating or renewing security context tokens.</span></span>  
  
## <a name="issued-tokens-and-inclusionmode"></a><span data-ttu-id="3c97f-130">發行的權杖和 InclusionMode</span><span class="sxs-lookup"><span data-stu-id="3c97f-130">Issued Tokens and InclusionMode</span></span>  
 <span data-ttu-id="3c97f-131">從用戶端傳送至聯合端點的訊息中，其發行的權杖是否已序列化是由設定 <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.InclusionMode%2A> 類別的 <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters> 屬性所控制。</span><span class="sxs-lookup"><span data-stu-id="3c97f-131">Whether an issued token is serialized in a message sent from a client to a federated endpoint or not is controlled by setting the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.InclusionMode%2A> property of the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters> class.</span></span> <span data-ttu-id="3c97f-132">這個屬性可以設定為 <xref:System.ServiceModel.Security.Tokens.SecurityTokenInclusionMode> 列舉值的其中一個值，但是這在大部分的聯合案例中沒有作用。</span><span class="sxs-lookup"><span data-stu-id="3c97f-132">This property can be set to one of the <xref:System.ServiceModel.Security.Tokens.SecurityTokenInclusionMode> enumeration values, but it is not useful in most federated scenarios.</span></span> <span data-ttu-id="3c97f-133">`SecurityTokenInclusionMode.Never` 和 `SecurityTokenInclusionMode.AlwaysToInitiator` 值會使用戶端將權杖參考，傳送給安全性權杖服務所發行給信賴憑證者的權杖。</span><span class="sxs-lookup"><span data-stu-id="3c97f-133">The `SecurityTokenInclusionMode.Never` and `SecurityTokenInclusionMode.AlwaysToInitiator` values cause the client to send a reference to the token issued by the security token service to the relying party.</span></span> <span data-ttu-id="3c97f-134">除非信賴憑證者持有發行權杖的複本，否則驗證將會因為無法解析權杖參考而失敗。</span><span class="sxs-lookup"><span data-stu-id="3c97f-134">Unless the relying party possesses a copy of the issued token, authentication will fail because the token reference is not resolvable.</span></span> [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="3c97f-135"> 會將 `SecurityTokenInclusionMode.Once` 視同為 `SecurityTokenInclusionMode.AlwaysToRecipient`。</span><span class="sxs-lookup"><span data-stu-id="3c97f-135"> treats `SecurityTokenInclusionMode.Once` as equivalent to `SecurityTokenInclusionMode.AlwaysToRecipient`.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3c97f-136">另請參閱</span><span class="sxs-lookup"><span data-stu-id="3c97f-136">See Also</span></span>  
 <xref:System.ServiceModel.Security.Tokens.SecurityTokenInclusionMode>  
 [<span data-ttu-id="3c97f-137">如何： 建立聯合用戶端</span><span class="sxs-lookup"><span data-stu-id="3c97f-137">How to: Create a Federated Client</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md)  
 [<span data-ttu-id="3c97f-138">如何： 設定聯合服務認證</span><span class="sxs-lookup"><span data-stu-id="3c97f-138">How to: Configure Credentials on a Federation Service</span></span>](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md)  
 [<span data-ttu-id="3c97f-139">如何： 建立 WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="3c97f-139">How to: Create a WSFederationHttpBinding</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)
