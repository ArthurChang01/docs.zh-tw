---
title: WCF 中的佇列
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e98d76ba-1acf-42cd-b137-0f8214661112
caps.latest.revision: 21
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: 01dc36c73d9e668dd98cb5ba8b275d3d5177ba61
ms.sourcegitcommit: 03ee570f6f528a7d23a4221dcb26a9498edbdf8c
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/28/2018
---
# <a name="queuing-in-wcf"></a><span data-ttu-id="f0fbc-102">WCF 中的佇列</span><span class="sxs-lookup"><span data-stu-id="f0fbc-102">Queuing in WCF</span></span>
<span data-ttu-id="f0fbc-103">本節說明如何在 [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] 中使用佇列通訊。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-103">This section describes how to use queued communication in [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span></span>  
  
## <a name="queues-as-a-wcf-transport-binding"></a><span data-ttu-id="f0fbc-104">當做 WCF 傳輸繫結排入佇列</span><span class="sxs-lookup"><span data-stu-id="f0fbc-104">Queues as a WCF transport binding</span></span>  
 <span data-ttu-id="f0fbc-105">在 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中，合約會指定要交換的項目。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-105">In [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], the contracts specify what is being exchanged.</span></span> <span data-ttu-id="f0fbc-106">合約是一種與企業相關或應用程式特定的訊息交換。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-106">Contracts are business-dependent or application-specific message exchanges.</span></span> <span data-ttu-id="f0fbc-107">繫結中會指定用來交換訊息 (或「如何交換」) 的機制。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-107">The mechanism used to exchange messages (or the "how") is specified in the bindings.</span></span> <span data-ttu-id="f0fbc-108">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中的繫結會封裝訊息交換的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-108">Bindings in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] encapsulate details of the message exchange.</span></span> <span data-ttu-id="f0fbc-109">這些繫結會公開組態旋鈕，讓使用者控制繫結所表示之傳輸或通訊協定的各個層面。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-109">They expose configuration knobs for the user to control various aspects of the transport or the protocol that the bindings represent.</span></span> <span data-ttu-id="f0fbc-110">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中的佇列會視為其他傳輸繫結處理，這對於許多佇列應用程式來說十分有利。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-110">Queuing in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] is treated like any other transport binding, which is a big advantage for many queuing applications.</span></span> <span data-ttu-id="f0fbc-111">目前許多佇列應用程式都是透過其他遠端程序呼叫 (RPC) 型的分散式應用程式來撰寫，導致在遵循上和維護上都有難度。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-111">Today, many queuing applications are written differently from other remote procedure call (RPC)-style distributed applications, making it harder to follow and maintain.</span></span> <span data-ttu-id="f0fbc-112">有了 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]，撰寫分散式應用程式的樣式就會一致許多，遵循和維護時也更為容易。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-112">With [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], the style of writing a distributed application is much the same, making it easier to follow and maintain.</span></span> <span data-ttu-id="f0fbc-113">另外，藉由根據商務邏輯獨立析出交換機制，您可以更輕鬆地設定傳輸或進行變更，而不會影響應用程式特定的程式碼。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-113">Moreover, by factoring out the mechanism of exchange separately from the business logic, it is easier to configure the transport or make changes to it without affecting application specific code.</span></span> <span data-ttu-id="f0fbc-114">下圖會說明使用 MSMQ 做為傳輸之 WCF 服務和用戶端的結構。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-114">The following figure illustrates the structure of a WCF service and client using MSMQ as a transport.</span></span>  
  
 <span data-ttu-id="f0fbc-115">![排入佇列的應用程式圖表](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "分散式佇列圖")</span><span class="sxs-lookup"><span data-stu-id="f0fbc-115">![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="f0fbc-116">如上圖所示，用戶端和服務只能定義應用程式語意 (Semantics)，也就是合約和實作。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-116">As you can see from the preceding figure, the client and service must define only the application semantics, that is, the contract and implementation.</span></span> <span data-ttu-id="f0fbc-117">服務會使用偏好的設定來設定佇列繫結，</span><span class="sxs-lookup"><span data-stu-id="f0fbc-117">The service configures a queued binding with preferred settings.</span></span> <span data-ttu-id="f0fbc-118">用戶端使用[ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)產生[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]用戶端到服務，然後產生描述要用於傳送訊息至服務的繫結的組態檔。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-118">The client uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to generate a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client to the service and to generate a configuration file that describes the bindings to use to send messages to the service.</span></span> <span data-ttu-id="f0fbc-119">因此，為了傳送佇列訊息，用戶端會具現化 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 用戶端並對其叫用作業，</span><span class="sxs-lookup"><span data-stu-id="f0fbc-119">Thus, to send a queued message, the client instantiates a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client and invokes an operation on it.</span></span> <span data-ttu-id="f0fbc-120">使訊息傳送至傳輸佇列並傳輸至目標佇列。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-120">This causes the message to be sent to the transmission queue and transferred to the target queue.</span></span> <span data-ttu-id="f0fbc-121">如此一來，傳送和接收訊息的應用程式就可以避開佇列通訊的所有複雜操作。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-121">All the complexities of queued communication are hidden from the application that is sending and receiving messages.</span></span>  
  
 <span data-ttu-id="f0fbc-122">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中佇列繫結的注意事項如下：</span><span class="sxs-lookup"><span data-stu-id="f0fbc-122">Caveats about queued binding in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] include:</span></span>  
  
-   <span data-ttu-id="f0fbc-123">所有服務作業必須為單向，因為 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中的預設佇列繫結不支援使用佇列的雙工通訊。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-123">All service operations must be one-way because the default queued binding in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] does not support duplex communication using queues.</span></span> <span data-ttu-id="f0fbc-124">雙向通訊範例 ([雙向通訊](../../../../docs/framework/wcf/samples/two-way-communication.md)) 說明如何實作使用佇列的雙工通訊中使用兩個單向合約。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-124">A two-way communication sample ([Two-Way Communication](../../../../docs/framework/wcf/samples/two-way-communication.md)) illustrates how to use two one-way contracts to implement duplex communication using queues.</span></span>  
  
-   <span data-ttu-id="f0fbc-125">為了產生 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 用戶端，使用中繼資料交換就必須要在服務上有額外的 HTTP 端點，讓中繼資料可以直接經過查詢，以便產生 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 用戶端，並且取得繫結資訊以適當地設定佇列通訊。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-125">To generate a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client using metadata exchange requires an additional HTTP endpoint on the service so that it can be queried directly to generate the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client and obtain binding information to appropriately configure queued communication.</span></span>  
  
-   <span data-ttu-id="f0fbc-126">按照這個佇列繫結，一定要有 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 外部的額外組態。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-126">Based on the queued binding, extra configuration outside of [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] is required.</span></span> <span data-ttu-id="f0fbc-127">例如，使用 <xref:System.ServiceModel.NetMsmqBinding> 隨附的 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 類別時，您需要設定繫結，而且至少要設定訊息佇列 (MSMQ)。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-127">For example, the <xref:System.ServiceModel.NetMsmqBinding> class that is shipped with [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] requires you to configure the bindings as well as minimally configure Message Queuing (MSMQ).</span></span>  
  
 <span data-ttu-id="f0fbc-128">下列章節會根據 MSMQ 說明 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 隨附的特定佇列繫結。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-128">The following sections describe the specific queued bindings shipped with [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], which are based on MSMQ.</span></span>  
  
### <a name="msmq"></a><span data-ttu-id="f0fbc-129">MSMQ</span><span class="sxs-lookup"><span data-stu-id="f0fbc-129">MSMQ</span></span>  
 <span data-ttu-id="f0fbc-130">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中的佇列傳輸會對其佇列通訊使用 MSMQ。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-130">The queued transport in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] uses MSMQ for its queued communication.</span></span>  
  
 <span data-ttu-id="f0fbc-131">MSMQ 是 Windows 隨附的選用元件，而且會以 NT 服務的身分執行。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-131">MSMQ ships as an optional component with Windows and runs as an NT service.</span></span> <span data-ttu-id="f0fbc-132">MSMQ 會擷取傳輸佇列中要進行傳輸的訊息，以及要傳遞至目標佇列的訊息。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-132">It captures messages for transmission in a transmission queue and for delivery in a target queue.</span></span> <span data-ttu-id="f0fbc-133">MSMQ 佇列管理員會實作可靠訊息傳輸通訊協定，使訊息不會在傳輸期間遺失。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-133">The MSMQ queue managers implement a reliable message-transfer protocol so that messages are not lost in transmission.</span></span> <span data-ttu-id="f0fbc-134">此通訊協定可以是原生通訊協定，或是 SOAP Reliable Message Protocol (SRMP) 這類 SOAP 架構的通訊協定。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-134">The protocol can be either native or SOAP-based, such as the SOAP Reliable Message Protocol (SRMP).</span></span>  
  
 <span data-ttu-id="f0fbc-135">在 MSMQ 中，佇列可以為交易式或非交易式。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-135">In MSMQ, queues can be transactional or non-transactional.</span></span> <span data-ttu-id="f0fbc-136">交易式佇列可讓您在交易中擷取及傳送訊息，然後永久將訊息儲存在佇列中。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-136">A transactional queue allows messages to be captured and delivered in a transaction and then stored durably in the queue.</span></span> <span data-ttu-id="f0fbc-137">傳送至交易式佇列的訊息只會依序傳輸一次。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-137">Messages sent to a transactional queue are transferred exactly once in order.</span></span> <span data-ttu-id="f0fbc-138">您可以使用非交易式佇列來同時傳送變動性 (volatile) 和永久性 (durable) 訊息。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-138">You can use a non-transactional queue to send both volatile and durable messages.</span></span> <span data-ttu-id="f0fbc-139">傳送至非交易式佇列的訊息並不保證傳輸可靠，因此便有可能遺失訊息。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-139">A message sent to a non-transactional queue does not carry any reliable transfer assurances; thus, messages can be lost.</span></span>  
  
 <span data-ttu-id="f0fbc-140">MSMQ 佇列的安全也可以使用向 Active Directory 目錄服務註冊的 Windows 身分識別來保護。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-140">MSMQ queues can also be secured using a Windows identity registered with the Active Directory directory service.</span></span> <span data-ttu-id="f0fbc-141">在安裝 MSMQ 時，您可以安裝 Active Directory 整合，而此時電腦必須是 Windows 網域網路的成員。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-141">When installing MSMQ, you can install Active Directory integration, which requires the computer to be part of a Windows domain network.</span></span>  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="f0fbc-142"> MSMQ 中，請參閱[安裝訊息佇列 (MSMQ)](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md)。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-142"> MSMQ, see [Installing Message Queuing (MSMQ)](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md).</span></span>  
  
### <a name="netmsmqbinding"></a><span data-ttu-id="f0fbc-143">NetMsmqBinding</span><span class="sxs-lookup"><span data-stu-id="f0fbc-143">NetMsmqBinding</span></span>  
 <span data-ttu-id="f0fbc-144">[ \<NetMsmqBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md)的佇列繫結[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]提供兩個[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]通訊使用 MSMQ 的端點。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-144">The [\<netMsmqBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md) is the queued binding [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] provides for two [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] endpoints to communicate using MSMQ.</span></span> <span data-ttu-id="f0fbc-145">因此，繫結會公開特定用於 MSMQ 的屬性。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-145">The binding, therefore, exposes properties that are specific to MSMQ.</span></span> <span data-ttu-id="f0fbc-146">不過，在 `NetMsmqBinding` 中不會公開所有 MSMQ 功能和屬性。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-146">However, not all MSMQ features and properties are exposed in the `NetMsmqBinding`.</span></span> <span data-ttu-id="f0fbc-147">精簡型 `NetMsmqBinding` 是使用大多數客戶都認為足夠的最佳功能組來設計。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-147">The compact `NetMsmqBinding` is designed with an optimal set of features that most customers should find sufficient.</span></span>  
  
 <span data-ttu-id="f0fbc-148">`NetMsmqBinding` 闡述了到目前為止以繫結屬性為形式討論的核心佇列概念。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-148">The `NetMsmqBinding` manifests the core queuing concepts discussed thus far in the form of properties on the bindings.</span></span> <span data-ttu-id="f0fbc-149">這些屬性接著會向 MSMQ 傳達傳輸及傳送訊息的方式。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-149">These properties, in turn, communicate to MSMQ how to transfer and deliver the messages.</span></span> <span data-ttu-id="f0fbc-150">下列章節討論屬性分類。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-150">A discussion of the property categories is in the following sections.</span></span> <span data-ttu-id="f0fbc-151">如需詳細資訊，請參閱概念性主題的更完整地描述特定的屬性。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-151">For more information, see the conceptual topics that describe specific properties more completely.</span></span>  
  
#### <a name="exactlyonce-and-durable-properties"></a><span data-ttu-id="f0fbc-152">ExactlyOnce 和 Durable 屬性</span><span class="sxs-lookup"><span data-stu-id="f0fbc-152">ExactlyOnce and Durable Properties</span></span>  
 <span data-ttu-id="f0fbc-153">`ExactlyOnce` 和 `Durable` 屬性會影響在佇列之間傳輸訊息的方式：</span><span class="sxs-lookup"><span data-stu-id="f0fbc-153">The `ExactlyOnce` and `Durable` properties affect how messages are transferred between queues:</span></span>  
  
-   <span data-ttu-id="f0fbc-154">`ExactlyOnce`：設定為 `true` (預設值) 時，佇列通道會確定傳送的訊息沒有重複，</span><span class="sxs-lookup"><span data-stu-id="f0fbc-154">`ExactlyOnce`: When set to `true` (the default), the queued channel ensures that the message, if delivered, is not duplicated.</span></span> <span data-ttu-id="f0fbc-155">也會確定沒有遺失訊息。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-155">It also ensures that the message is not lost.</span></span> <span data-ttu-id="f0fbc-156">如果無法傳送訊息，或者在可以傳送訊息之前訊息存留時間到期，就會在寄不出的信件佇列中記錄失敗的訊息和傳送失敗的原因。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-156">If the message cannot be delivered, or the message Time-To Live expires before the message can be delivered, the failed message along with the delivery failure reason is recorded in a dead-letter queue.</span></span> <span data-ttu-id="f0fbc-157">設定為 `false` 時，佇列通道會傳輸訊息。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-157">When set to `false`, the queued channel makes an effort to transfer the message.</span></span> <span data-ttu-id="f0fbc-158">在這個情況下，您可以選擇寄不出的信件佇列。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-158">In this case, you can optionally choose a dead-letter queue.</span></span>  
  
-   <span data-ttu-id="f0fbc-159">`Durable:` 設定為 `true` (預設值) 時，佇列通道會確定 MSMQ 將訊息永久儲存在磁碟上。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-159">`Durable:` When set to `true` (the default), the queued channel ensures that MSMQ stores the message durably on disk.</span></span> <span data-ttu-id="f0fbc-160">因此，如果停止後重新啟動 MSMQ 服務，磁碟上的訊息就會傳輸至目標佇列或傳遞至服務。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-160">Thus, if the MSMQ service were to stop and restart, the messages on disk is transferred to the target queue or delivered to the service.</span></span> <span data-ttu-id="f0fbc-161">設定為 `false` 時，訊息會儲存在變動性存放區中，而且在停止後重新啟動 MSMQ 服務時會遺失。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-161">When set to `false`, the messages are stored in volatile store and are lost on stopping and restarting the MSMQ service.</span></span>  
  
 <span data-ttu-id="f0fbc-162">如果是 `ExactlyOnce` 可靠傳輸，MSMQ 則會需要使用交易式佇列，</span><span class="sxs-lookup"><span data-stu-id="f0fbc-162">For `ExactlyOnce` reliable transfer, MSMQ requires the queue to be transactional.</span></span> <span data-ttu-id="f0fbc-163">也需要從交易式佇列讀取交易。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-163">Also, MSMQ requires a transaction to read from a transactional queue.</span></span> <span data-ttu-id="f0fbc-164">因此，當您使用 `NetMsmqBinding` 時，交易一定會在 `ExactlyOnce` 設定為 `true` 的狀況下傳送或接收訊息。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-164">As such, when you use the `NetMsmqBinding`, remember that a transaction is required to send or receive messages when `ExactlyOnce` is set to `true`.</span></span> <span data-ttu-id="f0fbc-165">同樣地，MSMQ 必須使用非交易式佇列才能得到最佳保證，例如當 `ExactlyOnce` 為 `false` 以及用於變動性傳訊時。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-165">Similarly, MSMQ requires the queue to be non-transactional for best-effort assurances, such as when `ExactlyOnce` is `false` and for volatile messaging.</span></span> <span data-ttu-id="f0fbc-166">因此，將 `ExactlyOnce` 設定為 `false` 或將 durable 設定為 `false` 時，您無法使用交易來進行傳送或接收。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-166">Thus, when setting `ExactlyOnce` to `false` or durable to `false`, you cannot send or receive using a transaction.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f0fbc-167">您一定要根據繫結中的設定建立正確的佇列 (交易式或非交易式)。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-167">Ensure that the correct queue (transactional or non-transactional) is created based on settings in the bindings.</span></span> <span data-ttu-id="f0fbc-168">如果 `ExactlyOnce` 為 `true`，請使用交易式佇列，否則請使用非交易式佇列。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-168">If `ExactlyOnce` is `true`, use a transactional queue; otherwise, use a non-transactional queue.</span></span>  
  
#### <a name="dead-letter-queue-properties"></a><span data-ttu-id="f0fbc-169">寄不出的信件佇列屬性</span><span class="sxs-lookup"><span data-stu-id="f0fbc-169">Dead-Letter Queue Properties</span></span>  
 <span data-ttu-id="f0fbc-170">寄不出的信件佇列是用來儲存無法傳遞的訊息。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-170">The dead-letter queue is used to store messages that fail delivery.</span></span> <span data-ttu-id="f0fbc-171">使用者可以撰寫補償邏輯，用來從寄不出的信件佇列中讀取訊息。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-171">The user can write compensating logic that reads messages out of the dead-letter queue.</span></span>  
  
 <span data-ttu-id="f0fbc-172">許多佇列系統都會提供全系統範圍之寄不出的信件佇列。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-172">Many queuing systems provide for a system-wide dead-letter queue.</span></span> <span data-ttu-id="f0fbc-173">MSMQ 會對無法傳遞至非交易式佇列的訊息提供全系統範圍的非交易式寄不出的信件佇列，並對無法傳遞至交易式佇列的訊息提供全系統範圍的交易式寄不出的信件佇列。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-173">MSMQ provides a system-wide non-transactional dead-letter queue for messages that fail delivery to non-transactional queues and a system-wide transactional dead-letter queue for messages that fail delivery to transactional queues.</span></span>  
  
 <span data-ttu-id="f0fbc-174">如果將訊息傳送至不同目標佇列的用戶端共用 MSMQ 服務，則用戶端傳送的所有訊息都會移至同一個寄不出的信件佇列。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-174">If multiple clients sending messages to different target queues share the MSMQ service, all messages sent by the clients go to the same dead-letter queue.</span></span> <span data-ttu-id="f0fbc-175">您不一定都要這麼做，</span><span class="sxs-lookup"><span data-stu-id="f0fbc-175">This is not always preferable.</span></span> <span data-ttu-id="f0fbc-176">為了加強隔離效果，[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 和 [!INCLUDE[wv](../../../../includes/wv-md.md)] 中的 MSMQ 提供了自訂寄不出的信件佇列 (或是應用程式特定之寄不出的信件佇列)，讓使用者可以指定這個佇列儲存無法傳遞的訊息。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-176">For better isolation, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] and MSMQ in [!INCLUDE[wv](../../../../includes/wv-md.md)] provide a custom dead-letter queue (or application-specific dead-letter queue) that the user can specify to store messages that fail delivery.</span></span> <span data-ttu-id="f0fbc-177">因此，不同的用戶端就不會共用同一個寄不出的信件佇列。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-177">Therefore, different clients do not share the same dead-letter queue.</span></span>  
  
 <span data-ttu-id="f0fbc-178">繫結中有兩個重要的屬性：</span><span class="sxs-lookup"><span data-stu-id="f0fbc-178">The binding has two properties of interest:</span></span>  
  
-   <span data-ttu-id="f0fbc-179">`DeadLetterQueue`：這個屬性是一種列舉，指出是否要求寄不出的信件佇列。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-179">`DeadLetterQueue`: This property is an enumeration that indicates whether a dead-letter queue is requested.</span></span> <span data-ttu-id="f0fbc-180">列舉中也包含寄不出的信件佇列種類 (如果有要求的話)。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-180">The enumeration also contains the kind of dead-letter queue, if one is requested.</span></span> <span data-ttu-id="f0fbc-181">這些值則為 `None`、`System` 和 `Custom`。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-181">The values are `None`, `System`, and `Custom`.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="f0fbc-182"> 解譯這些屬性，請參閱[使用寄不出信件佇列來處理訊息傳輸失敗](../../../../docs/framework/wcf/feature-details/using-dead-letter-queues-to-handle-message-transfer-failures.md)</span><span class="sxs-lookup"><span data-stu-id="f0fbc-182"> the interpretation of these properties, see [Using Dead-Letter Queues to Handle Message Transfer Failures](../../../../docs/framework/wcf/feature-details/using-dead-letter-queues-to-handle-message-transfer-failures.md)</span></span>  
  
-   <span data-ttu-id="f0fbc-183">`CustomDeadLetterQueue`：這個屬性是應用程式特定之寄不出的信件佇列的統一資源識別碼 (URI) 位址。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-183">`CustomDeadLetterQueue`: This property is the Uniform Resource Identifier (URI) address of the application-specific dead-letter queue.</span></span> <span data-ttu-id="f0fbc-184">這是必要的如果`DeadLetterQueue`。`Custom`</span><span class="sxs-lookup"><span data-stu-id="f0fbc-184">This is required if `DeadLetterQueue`.`Custom`</span></span> <span data-ttu-id="f0fbc-185">會選擇。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-185">is chosen.</span></span>  
  
#### <a name="poison-message-handling-properties"></a><span data-ttu-id="f0fbc-186">有害訊息處理屬性</span><span class="sxs-lookup"><span data-stu-id="f0fbc-186">Poison Message Handling properties</span></span>  
 <span data-ttu-id="f0fbc-187">當服務在交易中從目標佇列中讀取訊息時，可能會因為各種原因而無法處理訊息。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-187">When the service reads messages from the target queue under a transaction, the service may fail to process the message for various reasons.</span></span> <span data-ttu-id="f0fbc-188">然後服務會將訊息放回佇列，以便再次讀取。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-188">The message is then put back into the queue to be read again.</span></span> <span data-ttu-id="f0fbc-189">若要處理重複失敗的訊息，可以在繫結中設定一組有害訊息處理屬性。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-189">To deal with messages that fail repeatedly, a set of poison-message handling properties can be configured in the binding.</span></span> <span data-ttu-id="f0fbc-190">有害訊息處理屬性有四個：`ReceiveRetryCount`、`MaxRetryCycles`、`RetryCycleDelay` 和 `ReceiveErrorHandling`。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-190">There are four properties: `ReceiveRetryCount`, `MaxRetryCycles`, `RetryCycleDelay`, and `ReceiveErrorHandling`.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="f0fbc-191"> 這些屬性，請參閱[有害訊息處理](../../../../docs/framework/wcf/feature-details/poison-message-handling.md)。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-191"> these properties, see [Poison Message Handling](../../../../docs/framework/wcf/feature-details/poison-message-handling.md).</span></span>  
  
#### <a name="security-properties"></a><span data-ttu-id="f0fbc-192">安全性屬性</span><span class="sxs-lookup"><span data-stu-id="f0fbc-192">Security Properties</span></span>  
 <span data-ttu-id="f0fbc-193">MSMQ 會公開本身的安全性模型，例如佇列上或傳送驗證訊息上的存取控制清單 (ACL)。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-193">MSMQ exposes its own security model, such as access control lists (ACLs) on a queue or sending authenticated messages.</span></span> <span data-ttu-id="f0fbc-194">`NetMsmqBinding` 會將這些安全性屬性當做部分傳輸安全性設定公開。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-194">The `NetMsmqBinding` exposes these security properties as part of its transport security settings.</span></span> <span data-ttu-id="f0fbc-195">在傳輸安全性的繫結中有兩個屬性：`MsmqAuthenticationMode` 和 `MsmqProtectionLevel`。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-195">There are two properties in the binding for transport security: `MsmqAuthenticationMode` and `MsmqProtectionLevel`.</span></span> <span data-ttu-id="f0fbc-196">這些屬性中的設定取決於設定 MSMQ 的方式。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-196">Settings in these properties depend on how MSMQ is configured.</span></span> <span data-ttu-id="f0fbc-197">如需詳細資訊，請參閱[保護訊息使用傳輸安全性](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-197">For more information, see [Securing Messages Using Transport Security](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md).</span></span>  
  
 <span data-ttu-id="f0fbc-198">除了傳輸安全性以外，也可以使用訊息安全性來保護實際的 SOAP 訊息本身。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-198">In addition to transport security, the actual SOAP message itself can be secured using message security.</span></span> <span data-ttu-id="f0fbc-199">如需詳細資訊，請參閱[保護訊息使用訊息安全性](../../../../docs/framework/wcf/feature-details/securing-messages-using-message-security.md)。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-199">For more information, see [Securing Messages Using Message Security](../../../../docs/framework/wcf/feature-details/securing-messages-using-message-security.md).</span></span>  
  
 <span data-ttu-id="f0fbc-200">`MsmqTransportSecurity` 也會公開 `MsmqEncryptionAlgorithm` 和 `MsmqHashAlgorithm` 這兩個屬性。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-200">`MsmqTransportSecurity` also exposes two properties, `MsmqEncryptionAlgorithm` and `MsmqHashAlgorithm`.</span></span> <span data-ttu-id="f0fbc-201">進行訊息的佇列對佇列傳輸加密，以及進行簽章雜湊處理時，可選用這些不同演算法的列舉。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-201">These are enumerations of different algorithms to choose for queue-to-queue transfer encryption of messages and hashing of the signatures.</span></span>  
  
#### <a name="other-properties"></a><span data-ttu-id="f0fbc-202">其他屬性</span><span class="sxs-lookup"><span data-stu-id="f0fbc-202">Other Properties</span></span>  
 <span data-ttu-id="f0fbc-203">除了上述屬性，下面也有繫結中公開的其他 MSMQ 特定屬性：</span><span class="sxs-lookup"><span data-stu-id="f0fbc-203">In addition to the preceding properties, other MSMQ-specific properties exposed in the binding include:</span></span>  
  
-   <span data-ttu-id="f0fbc-204">`UseSourceJournal`：指出已開啟來源日誌記錄的屬性。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-204">`UseSourceJournal`: A property to indicate that source journaling is turned on.</span></span> <span data-ttu-id="f0fbc-205">來源日誌記錄是一個 MSMQ 功能，可追蹤已順利從傳輸佇列傳輸的訊息。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-205">Source journaling is an MSMQ feature that keeps track of messages that have been successfully transmitted from the transmission queue.</span></span>  
  
-   <span data-ttu-id="f0fbc-206">`UseMsmqTracing`：指出已開啟 MSMQ 追蹤的屬性。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-206">`UseMsmqTracing`: A property to indicate that MSMQ tracing is turned on.</span></span> <span data-ttu-id="f0fbc-207">每次裝載 MSMQ 佇列管理員的電腦上有訊息傳入或傳出時，MSMQ 追蹤就會將報告訊息傳送至報告佇列。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-207">MSMQ tracing sends report messages to a report queue each time a message leaves or arrives at a machine hosting an MSMQ queue manager.</span></span>  
  
-   <span data-ttu-id="f0fbc-208">`QueueTransferProtocol`：用於佇列對佇列訊息傳輸的通訊協定列舉。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-208">`QueueTransferProtocol`: An enumeration of the protocol to use for queue-to-queue message transfers.</span></span> <span data-ttu-id="f0fbc-209">MSMQ 會實作原生佇列對佇列傳輸通訊協定，以及稱為 SOAP Reliable Messaging Protocol (SRMP) 的 SOAP 架構通訊協定。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-209">MSMQ implements a native queue-to-queue transfer protocol and a SOAP-based protocol called SOAP Reliable Messaging Protocol (SRMP).</span></span> <span data-ttu-id="f0fbc-210">在佇列對佇列傳輸中使用 HTTP 傳輸時，就會使用 SRMP。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-210">SRMP is used when using HTTP transport for queue-to-queue transfers.</span></span> <span data-ttu-id="f0fbc-211">在佇列對佇列傳輸中使用 HTTPS 時，則會使用 SRMP。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-211">SRMP secure is used when using HTTPS for queue-to-queue transfers.</span></span>  
  
-   <span data-ttu-id="f0fbc-212">`UseActiveDirectory`：布林值，指出是否必須使用 Active Directory 解析佇列位址。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-212">`UseActiveDirectory`: A Boolean value to indicate whether the Active Directory must be used for queue address resolution.</span></span> <span data-ttu-id="f0fbc-213">根據預設，這個屬性為關閉狀態。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-213">By default, this is off.</span></span> <span data-ttu-id="f0fbc-214">如需詳細資訊，請參閱[服務端點與佇列定址](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-214">For more information, see [Service Endpoints and Queue Addressing](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md).</span></span>  
  
### <a name="msmqintegrationbinding"></a><span data-ttu-id="f0fbc-215">MsmqIntegrationBinding</span><span class="sxs-lookup"><span data-stu-id="f0fbc-215">MsmqIntegrationBinding</span></span>  
 <span data-ttu-id="f0fbc-216">若要讓 `MsmqIntegrationBinding` 端點與使用 C、C++、COM 或 System.Messaging API 所撰寫的現有 MSMQ 應用程式進行通訊，則會用到 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-216">The `MsmqIntegrationBinding` is used when you want a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] endpoint to communicate with an existing MSMQ application written in C, C++, COM, or System.Messaging APIs.</span></span>  
  
 <span data-ttu-id="f0fbc-217">其繫結屬性與 `NetMsmqBinding` 一樣，</span><span class="sxs-lookup"><span data-stu-id="f0fbc-217">The binding properties are the same as for `NetMsmqBinding`.</span></span> <span data-ttu-id="f0fbc-218">但是會有下列差異：</span><span class="sxs-lookup"><span data-stu-id="f0fbc-218">However, the following differences apply:</span></span>  
  
-   <span data-ttu-id="f0fbc-219">`MsmqIntegrationBinding` 的作業合約受限為採用類型為 <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> 的單一參數，其中類型參數為本文類型。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-219">The operation contract for `MsmqIntegrationBinding` is restricted to taking a single parameter of type <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> where the type parameter is the body type.</span></span>  
  
-   <span data-ttu-id="f0fbc-220">許多 MSMQ 原生訊息屬性會在 <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> 中公開以供使用。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-220">Much of MSMQ native message properties are exposed in the <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> for use.</span></span>  
  
-   <span data-ttu-id="f0fbc-221">為了協助序列化和還原序列化訊息本文，XML 和 ActiveX 等序列化程式都會提供讓您使用。</span><span class="sxs-lookup"><span data-stu-id="f0fbc-221">To help with serialization and deserialization of the message body, serializers such as XML and ActiveX are provided.</span></span>  
  
### <a name="sample-code"></a><span data-ttu-id="f0fbc-222">程式碼範例</span><span class="sxs-lookup"><span data-stu-id="f0fbc-222">Sample Code</span></span>  
 <span data-ttu-id="f0fbc-223">如需如何撰寫使用 MSMQ 之 WCF 服務的逐步指示，請參閱下列主題：</span><span class="sxs-lookup"><span data-stu-id="f0fbc-223">For step by step instructions on how to write WCF services that use MSMQ see the following topics:</span></span>  
  
-   [<span data-ttu-id="f0fbc-224">如何：與 WCF 端點和訊息佇列應用程式交換訊息</span><span class="sxs-lookup"><span data-stu-id="f0fbc-224">How to: Exchange Messages with WCF Endpoints and Message Queuing Applications</span></span>](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-with-wcf-endpoints-and-message-queuing-applications.md)  
  
-   [<span data-ttu-id="f0fbc-225">如何：與 WCF 端點交換佇列訊息</span><span class="sxs-lookup"><span data-stu-id="f0fbc-225">How to: Exchange Queued Messages with WCF Endpoints</span></span>](../../../../docs/framework/wcf/feature-details/how-to-exchange-queued-messages-with-wcf-endpoints.md)  
  
 <span data-ttu-id="f0fbc-226">如需示範在 WCF 中使用 MSMQ 的完整程式碼範例，請參閱下列主題：</span><span class="sxs-lookup"><span data-stu-id="f0fbc-226">For a completed code sample illustrating the use of MSMQ in WCF see the following topics:</span></span>  
  
-   [<span data-ttu-id="f0fbc-227">異動 MSMQ 繫結</span><span class="sxs-lookup"><span data-stu-id="f0fbc-227">Transacted MSMQ Binding</span></span>](../../../../docs/framework/wcf/samples/transacted-msmq-binding.md)  
  
-   [<span data-ttu-id="f0fbc-228">變動性佇列通訊</span><span class="sxs-lookup"><span data-stu-id="f0fbc-228">Volatile Queued Communication</span></span>](../../../../docs/framework/wcf/samples/volatile-queued-communication.md)  
  
-   [<span data-ttu-id="f0fbc-229">無效信件佇列</span><span class="sxs-lookup"><span data-stu-id="f0fbc-229">Dead Letter Queues</span></span>](../../../../docs/framework/wcf/samples/dead-letter-queues.md)  
  
-   [<span data-ttu-id="f0fbc-230">工作階段和佇列</span><span class="sxs-lookup"><span data-stu-id="f0fbc-230">Sessions and Queues</span></span>](../../../../docs/framework/wcf/samples/sessions-and-queues.md)  
  
-   [<span data-ttu-id="f0fbc-231">雙向通訊</span><span class="sxs-lookup"><span data-stu-id="f0fbc-231">Two-Way Communication</span></span>](../../../../docs/framework/wcf/samples/two-way-communication.md)  
  
-   [<span data-ttu-id="f0fbc-232">異動批次處理</span><span class="sxs-lookup"><span data-stu-id="f0fbc-232">Transacted Batching</span></span>](../../../../docs/framework/wcf/samples/transacted-batching.md)  
  
-   [<span data-ttu-id="f0fbc-233">SRMP</span><span class="sxs-lookup"><span data-stu-id="f0fbc-233">SRMP</span></span>](../../../../docs/framework/wcf/samples/srmp.md)  
  
-   [<span data-ttu-id="f0fbc-234">訊息佇列上的訊息安全性</span><span class="sxs-lookup"><span data-stu-id="f0fbc-234">Message Security over Message Queuing</span></span>](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)  
  
## <a name="see-also"></a><span data-ttu-id="f0fbc-235">另請參閱</span><span class="sxs-lookup"><span data-stu-id="f0fbc-235">See Also</span></span>  
 [<span data-ttu-id="f0fbc-236">服務端點與佇列定址</span><span class="sxs-lookup"><span data-stu-id="f0fbc-236">Service Endpoints and Queue Addressing</span></span>](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)  
 [<span data-ttu-id="f0fbc-237">以 Web 裝載佇列應用程式</span><span class="sxs-lookup"><span data-stu-id="f0fbc-237">Web Hosting a Queued Application</span></span>](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md)
