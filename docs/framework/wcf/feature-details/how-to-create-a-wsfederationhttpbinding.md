---
title: HOW TO：建立 WSFederationHttpBinding
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, federation
- federation
ms.assetid: e54897d7-aa6c-46ec-a278-b2430c8c2e10
ms.openlocfilehash: c3ce90c74ae61dfcbfc0b05fc17b25fe0118e071
ms.sourcegitcommit: fbb8a593a511ce667992502a3ce6d8f65c594edf
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/16/2019
ms.locfileid: "74141687"
---
# <a name="how-to-create-a-wsfederationhttpbinding"></a><span data-ttu-id="dfcb2-102">HOW TO：建立 WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="dfcb2-102">How to: Create a WSFederationHttpBinding</span></span>

<span data-ttu-id="dfcb2-103">在 Windows Communication Foundation （WCF）中，<xref:System.ServiceModel.WSFederationHttpBinding> 類別（[\<wsFederationHttpBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)在設定中）會提供公開同盟服務的機制。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-103">In Windows Communication Foundation (WCF), the <xref:System.ServiceModel.WSFederationHttpBinding> class ([\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) in configuration) provides a mechanism for exposing a federated service.</span></span> <span data-ttu-id="dfcb2-104">也就是，要求用戶端使用由安全性權杖服務發出的安全性權杖進行驗證的一種服務。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-104">That is, a service that requires clients to authenticate using a security token issued by a security token service.</span></span> <span data-ttu-id="dfcb2-105">這個主題會表示如何在程式碼和組態中設定 <xref:System.ServiceModel.WSFederationHttpBinding>。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-105">This topic shows how to set up a <xref:System.ServiceModel.WSFederationHttpBinding> in both code and configuration.</span></span> <span data-ttu-id="dfcb2-106">一旦建立了繫結，就可以設定端點以使用該繫結。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-106">Once the binding is created, you can set up an endpoint to use that binding.</span></span>

 <span data-ttu-id="dfcb2-107">以下將粗略說明基本步驟：</span><span class="sxs-lookup"><span data-stu-id="dfcb2-107">The basic steps are outlined as follows:</span></span>

1. <span data-ttu-id="dfcb2-108">選取安全性模式。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-108">Select a security mode.</span></span> <span data-ttu-id="dfcb2-109"><xref:System.ServiceModel.WSFederationHttpBinding> 支援 `Message`，而這會在訊息層級中提供端對端安全性 (甚至於在多重躍點中)；也支援 `TransportWithMessageCredential`，而這會在用戶端和服務可直接透過 HTTPS 連線的狀況下提供較好的效能。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-109">The <xref:System.ServiceModel.WSFederationHttpBinding> supports `Message`, which provides end-to-end security at the message level, even across multiple hops, and `TransportWithMessageCredential`, which provides better performance in cases where the client and the service can make a direct connection over HTTPS.</span></span>

    > [!NOTE]
    > <span data-ttu-id="dfcb2-110"><xref:System.ServiceModel.WSFederationHttpBinding> 也支援 `None` 做為安全性模式。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-110">The <xref:System.ServiceModel.WSFederationHttpBinding> also supports `None` as a security mode.</span></span> <span data-ttu-id="dfcb2-111">這個模式並不安全，主要目的僅用於偵錯。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-111">This mode is not secure and is provided for debugging purposes only.</span></span> <span data-ttu-id="dfcb2-112">如果服務端點是以 <xref:System.ServiceModel.WSFederationHttpBinding>，且其安全性模式設定為 `None`，則產生的用戶端系結（由[System.servicemodel 中繼資料公用程式工具（Svcutil）](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)所產生）就是安全性模式為 `None`的 <xref:System.ServiceModel.WSHttpBinding>。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-112">If a service endpoint is deployed with a <xref:System.ServiceModel.WSFederationHttpBinding> with its security mode set to `None`, the resulting client binding (generated by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)) is a <xref:System.ServiceModel.WSHttpBinding> with a security mode of `None`.</span></span>

     <span data-ttu-id="dfcb2-113">和其他系統提供的繫結程序不一樣，在您使用 `WSFederationHttpBinding` 時不需要選取用戶端認證類型。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-113">Unlike other system-provided bindings, it is not necessary to select a client credential type when using the `WSFederationHttpBinding`.</span></span> <span data-ttu-id="dfcb2-114">這是因為用戶端認證類型一律為已發行的權杖。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-114">This is because the client credential type is always an issued token.</span></span> <span data-ttu-id="dfcb2-115">WCF 會從指定的簽發者取得權杖，並向服務呈現該權杖以驗證用戶端。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-115">WCF acquires a token from a specified issuer and presents that token to the service to authenticate the client.</span></span>

2. <span data-ttu-id="dfcb2-116">在聯合用戶端上，請將 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerAddress%2A> 屬性設定為安全性權杖服務的 URL。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-116">On federated clients, set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerAddress%2A> property to the URL of the security token service.</span></span> <span data-ttu-id="dfcb2-117">將 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerBinding%2A> 設定為繫結，以用來與安全性權杖服務進行通訊。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-117">Set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerBinding%2A> to the binding to use to communicate with the security token service.</span></span>

3. <span data-ttu-id="dfcb2-118">選擇項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-118">Optional.</span></span> <span data-ttu-id="dfcb2-119">將 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedTokenType%2A> 屬性設定成權杖型別統一資源識別元 (URI)。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-119">Set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedTokenType%2A> property to the Uniform Resource Identifier (URI) of a token type.</span></span> <span data-ttu-id="dfcb2-120">在聯合服務上，指定服務預期的權杖型別。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-120">On federated services, specify the token type that the service expects.</span></span> <span data-ttu-id="dfcb2-121">在聯合用戶端上，指定用戶端從安全性權杖服務中所要求的權杖型別。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-121">On federated clients, specify the token type the client requests from the security token service.</span></span>

     <span data-ttu-id="dfcb2-122">如果沒有指定權杖型別，用戶端會產生不具權杖型別 URI 的 WS-Trust 要求安全性權杖 (Request Security Token，RST)，而根據預設，服務會預期使用安全性判斷提示標記語言 (Security Assertions Markup Language，SAML) 1.1 權杖來進行用戶端驗證。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-122">If no token type is specified, clients generate WS-Trust Request Security Tokens (RSTs) without a token type URI, and services expect client authentication using a Security Assertions Markup Language (SAML) 1.1 token by default.</span></span>

     <span data-ttu-id="dfcb2-123">SAML 1.1 權杖的 URI 是 `http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1`。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-123">The URI for a SAML 1.1 token is `http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1`.</span></span>

4. <span data-ttu-id="dfcb2-124">選擇項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-124">Optional.</span></span> <span data-ttu-id="dfcb2-125">在聯合服務上，請將 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerMetadataAddress%2A> 屬性設定為安全性權杖服務的中繼資料 URL。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-125">On federated services, set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerMetadataAddress%2A> property to the metadata URL of a security token service.</span></span> <span data-ttu-id="dfcb2-126">中繼資料端點可讓服務的用戶端選取適當的繫結/端點組 (如果已將服務設定為發行中繼資料)。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-126">The metadata endpoint enables clients of the service to select an appropriate binding/endpoint pair, if the service is configured to publish metadata.</span></span> <span data-ttu-id="dfcb2-127">如需發行中繼資料的詳細資訊，請參閱[發行中繼資料](publishing-metadata.md)。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-127">For more information about publishing metadata, see [Publishing Metadata](publishing-metadata.md).</span></span>

 <span data-ttu-id="dfcb2-128">您也可以設定其他屬性，包括在發行的權杖中當做證明金鑰使用的金鑰類型、在用戶端和服務之間使用的演算法套件、是否交涉或明確指定服務認證、服務預期發行的權杖要包含的任何特定宣告，以及必須新增至要求 (這些是用戶端傳送至安全性權杖服務的要求) 的其他 XML 項目。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-128">You can also set other properties, including the type of key used as a proof key in the issued token, the algorithm suite to use between the client and the service, whether to negotiate or explicitly specify the service credential, any specific claims the service expects the issued token to contain, and any additional XML elements that must be added to the request the client sends to the security token service.</span></span>

> [!NOTE]
> <span data-ttu-id="dfcb2-129">只有當 `NegotiateServiceCredential` 設定為 `SecurityMode`，`Message` 屬性才有關聯。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-129">The `NegotiateServiceCredential` property is only relevant when the `SecurityMode` is set to `Message`.</span></span> <span data-ttu-id="dfcb2-130">如果 `SecurityMode` 設定為 `TransportWithMessageCredential`，則會忽略 `NegotiateServiceCredential` 屬性。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-130">If `SecurityMode` is set to `TransportWithMessageCredential`, then the `NegotiateServiceCredential` property is ignored.</span></span>

## <a name="to-configure-a-wsfederationhttpbinding-in-code"></a><span data-ttu-id="dfcb2-131">在程式碼中設定 WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="dfcb2-131">To configure a WSFederationHttpBinding in code</span></span>

1. <span data-ttu-id="dfcb2-132">建立 <xref:System.ServiceModel.WSFederationHttpBinding>的執行個體。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-132">Create an instance of the <xref:System.ServiceModel.WSFederationHttpBinding>.</span></span>

2. <span data-ttu-id="dfcb2-133">依需求將 <xref:System.ServiceModel.WSFederationHttpSecurity.Mode%2A> 屬性設定為 <xref:System.ServiceModel.WSFederationHttpSecurityMode> 或 <xref:System.ServiceModel.WSFederationHttpSecurityMode.Message>。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-133">Set the <xref:System.ServiceModel.WSFederationHttpSecurity.Mode%2A> property to <xref:System.ServiceModel.WSFederationHttpSecurityMode> or <xref:System.ServiceModel.WSFederationHttpSecurityMode.Message> as required.</span></span> <span data-ttu-id="dfcb2-134">如果需要 <xref:System.ServiceModel.Security.SecurityAlgorithmSuite.Basic256%2A> 以外的演算法套件，請將 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.AlgorithmSuite%2A> 屬性設定為從 <xref:System.ServiceModel.Security.SecurityAlgorithmSuite>取得的值。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-134">If an algorithm suite other than <xref:System.ServiceModel.Security.SecurityAlgorithmSuite.Basic256%2A> is required, set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.AlgorithmSuite%2A> property to a value taken from <xref:System.ServiceModel.Security.SecurityAlgorithmSuite>.</span></span>

3. <span data-ttu-id="dfcb2-135">適當地設定 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.NegotiateServiceCredential%2A> 屬性。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-135">Set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.NegotiateServiceCredential%2A> property as appropriate.</span></span>

4. <span data-ttu-id="dfcb2-136">將 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedKeyType%2A> 屬性設定為 <xref:System.IdentityModel.Tokens.SecurityKeyType>`SymmetricKey` 或。`AsymmetricKey`</span><span class="sxs-lookup"><span data-stu-id="dfcb2-136">Set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedKeyType%2A> property to <xref:System.IdentityModel.Tokens.SecurityKeyType>`SymmetricKey` or .`AsymmetricKey`</span></span> <span data-ttu-id="dfcb2-137">視需要。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-137">as required.</span></span>

5. <span data-ttu-id="dfcb2-138">將 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedTokenType%2A> 屬性設定為適當值。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-138">Set the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedTokenType%2A> property to the appropriate value.</span></span> <span data-ttu-id="dfcb2-139">如果未設定任何值，WCF 會預設為 `http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1`，表示 SAML 1.1 權杖。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-139">If no value is set, WCF defaults to `http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1`, which indicates SAML 1.1 tokens.</span></span>

6. <span data-ttu-id="dfcb2-140">如果未指定本機簽發者，則在用戶端上為必要項；在服務上則為選擇項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-140">Required on the client if no local issuer is specified; optional on the service.</span></span> <span data-ttu-id="dfcb2-141">建立其中包含安全性權杖服務之位址和身分識別資訊的 <xref:System.ServiceModel.EndpointAddress>，並將 <xref:System.ServiceModel.EndpointAddress> 執行個體指派給 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerAddress%2A> 屬性。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-141">Create an <xref:System.ServiceModel.EndpointAddress> that contains the address and identity information of the security token service and assign the <xref:System.ServiceModel.EndpointAddress> instance to the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerAddress%2A> property.</span></span>

7. <span data-ttu-id="dfcb2-142">如果未指定本機簽發者，則在用戶端上為必要項；在服務上則不要使用。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-142">Required on the client if no local issuer is specified; not used on the service.</span></span> <span data-ttu-id="dfcb2-143">建立 `SecurityTokenService` 的 <xref:System.ServiceModel.Channels.Binding>，並將 <xref:System.ServiceModel.Channels.Binding> 實例指派給 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerBinding%2A> 屬性。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-143">Create a <xref:System.ServiceModel.Channels.Binding> for the `SecurityTokenService` and assign the <xref:System.ServiceModel.Channels.Binding> instance to the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuerBinding%2A> property.</span></span>

8. <span data-ttu-id="dfcb2-144">在用戶端上不要使用，在服務上則為選擇項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-144">Not used on the client; optional on the service.</span></span> <span data-ttu-id="dfcb2-145">對安全性權杖服務的中繼資料建立 <xref:System.ServiceModel.EndpointAddress> 執行個體，並將它指派給 `IssuerMetadataAddress` 屬性。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-145">Create an <xref:System.ServiceModel.EndpointAddress> instance for the metadata of the security token service and assign it to the `IssuerMetadataAddress` property.</span></span>

9. <span data-ttu-id="dfcb2-146">在用戶端和服務上都是選擇項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-146">Optional on both the client and the service.</span></span> <span data-ttu-id="dfcb2-147">建立一或多個 <xref:System.ServiceModel.Security.Tokens.ClaimTypeRequirement> 執行個體，並將這些執行個體新增至 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.ClaimTypeRequirements%2A> 屬性所傳回的集合。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-147">Create and add one or more <xref:System.ServiceModel.Security.Tokens.ClaimTypeRequirement> instances to the collection returned by the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.ClaimTypeRequirements%2A> property.</span></span>

10. <span data-ttu-id="dfcb2-148">在用戶端和服務上都是選擇項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-148">Optional on both the client and the service.</span></span> <span data-ttu-id="dfcb2-149">建立一或多個 <xref:System.Xml.XmlElement> 執行個體，並將這些執行個體新增至 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.TokenRequestParameters%2A> 屬性所傳回的集合。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-149">Create and add one or more <xref:System.Xml.XmlElement> instances to the collection returned by the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.TokenRequestParameters%2A> property.</span></span>

## <a name="to-create-a-federated-endpoint-in-configuration"></a><span data-ttu-id="dfcb2-150">在組態中建立聯合端點</span><span class="sxs-lookup"><span data-stu-id="dfcb2-150">To create a federated endpoint in configuration</span></span>

1. <span data-ttu-id="dfcb2-151">建立[\<wsFederationHttpBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)作為應用程式佈建檔中[\<](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md)系結 > 元素的子系。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-151">Create a [\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) as a child of the [\<bindings>](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md) element in the application configuration file.</span></span>

2. <span data-ttu-id="dfcb2-152">建立\<系結[>](../../configure-apps/file-schema/wcf/bindings.md)元素做為[\<wsFederationHttpBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)的子系，並將 `name` 屬性設定為適當的值。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-152">Create a [\<binding>](../../configure-apps/file-schema/wcf/bindings.md) element as a child of [\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) and set the `name` attribute to an appropriate value.</span></span>

3. <span data-ttu-id="dfcb2-153">建立 `<security>` 元素做為\<系結[>](../../configure-apps/file-schema/wcf/bindings.md)元素的子系。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-153">Create a `<security>` element as a child of the [\<binding>](../../configure-apps/file-schema/wcf/bindings.md) element.</span></span>

4. <span data-ttu-id="dfcb2-154">依照需求，將 `mode` 項目上的 `<security>` 屬性設定為 `Message` 或 `TransportWithMessageCredential` 的值。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-154">Set the `mode` attribute on the `<security>` element to a value of `Message` or `TransportWithMessageCredential`, as required.</span></span>

5. <span data-ttu-id="dfcb2-155">建立 `<message>` 項目做為 `<security>` 項目的子項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-155">Create a `<message>` element as a child of the `<security>` element.</span></span>

6. <span data-ttu-id="dfcb2-156">選擇項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-156">Optional.</span></span> <span data-ttu-id="dfcb2-157">以適當的值設定 `algorithmSuite` 項目上的 `<message>` 屬性。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-157">Set the `algorithmSuite` attribute on the `<message>` element with an appropriate value.</span></span> <span data-ttu-id="dfcb2-158">預設為 `Basic256`。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-158">The default is `Basic256`.</span></span>

7. <span data-ttu-id="dfcb2-159">選擇項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-159">Optional.</span></span> <span data-ttu-id="dfcb2-160">如果需要非對稱證明金鑰，請將 `issuedKeyType` 項目的 `<message>` 屬性設定為 `AsymmetricKey`。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-160">If an asymmetric proof key is required, set the `issuedKeyType` attribute of the `<message>` element to `AsymmetricKey`.</span></span> <span data-ttu-id="dfcb2-161">預設為 `SymmetricKey`。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-161">The default is `SymmetricKey`.</span></span>

8. <span data-ttu-id="dfcb2-162">選擇項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-162">Optional.</span></span> <span data-ttu-id="dfcb2-163">設定 `issuedTokenType` 項目上的 `<message>` 屬性。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-163">Set the `issuedTokenType` attribute on the `<message>` element.</span></span>

9. <span data-ttu-id="dfcb2-164">如果未指定本機簽發者，則在用戶端上為必要項；在服務上則為選擇項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-164">Required on the client if no local issuer is specified; optional on the service.</span></span> <span data-ttu-id="dfcb2-165">建立 `<issuer>` 項目以做為 `<message>` 項目的子項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-165">Create an `<issuer>` element as a child of the `<message>` element.</span></span>

10. <span data-ttu-id="dfcb2-166">將 `address` 屬性設定為 `<issuer>` 項目，並指定安全性權杖服務會接受權杖要求的位址。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-166">Set the `address` attribute to the `<issuer>` element and specify the address at which the security token service accepts token requests.</span></span>

11. <span data-ttu-id="dfcb2-167">選擇項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-167">Optional.</span></span> <span data-ttu-id="dfcb2-168">加入 `<identity>` 子項目，並指定安全性權杖服務的識別。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-168">Add an `<identity>` child element and specify the identity of the security token service</span></span>

12. <span data-ttu-id="dfcb2-169">如需詳細資訊，請參閱[服務身分識別和驗證](service-identity-and-authentication.md)。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-169">For more information, see [Service Identity and Authentication](service-identity-and-authentication.md).</span></span>

13. <span data-ttu-id="dfcb2-170">如果未指定本機簽發者，則在用戶端上為必要項；在服務上則不要使用。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-170">Required on the client if no local issuer is specified; not used on the service.</span></span> <span data-ttu-id="dfcb2-171">在 [系結] 區段中建立\<系結[>](../../configure-apps/file-schema/wcf/bindings.md)元素，可用來與 Security Token Service 進行通訊。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-171">Create a [\<binding>](../../configure-apps/file-schema/wcf/bindings.md) element in the bindings section that can be used to communicate with the security token service.</span></span> <span data-ttu-id="dfcb2-172">如需建立系結的詳細資訊，請參閱 how [to：在 Configuration 中指定服務](../../../../docs/framework/wcf/how-to-specify-a-service-binding-in-configuration.md)系結。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-172">For more information about creating a binding, see [How to: Specify a Service Binding in Configuration](../../../../docs/framework/wcf/how-to-specify-a-service-binding-in-configuration.md).</span></span>

14. <span data-ttu-id="dfcb2-173">藉由設定 `binding` 項目的 `bindingConfiguration` 和 `<issuer>` 屬性，指定在前面的步驟中所建立的繫結。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-173">Specify the binding created in the previous step by setting the `binding` and `bindingConfiguration` attributes of the `<issuer>` element.</span></span>

15. <span data-ttu-id="dfcb2-174">在用戶端上不要使用，在服務上則為選擇項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-174">Not used on the client; optional on the service.</span></span> <span data-ttu-id="dfcb2-175">建立 `<issuerMetadata>` 元素做為 <`message`> 元素的子系。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-175">Create an `<issuerMetadata>` element as a child of the <`message`> element.</span></span> <span data-ttu-id="dfcb2-176">接著，在 `address` 項目的 `<issuerMetadata>` 屬性上，指定安全性權杖服務要發行其中繼資料的位址。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-176">Then, in an `address` attribute on the `<issuerMetadata>` element, specify the address at which the security token service is to publish its metadata.</span></span> <span data-ttu-id="dfcb2-177">您也可以選擇性地新增 `<identity>` 子項目，並指定安全性權杖服務的身分識別。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-177">Optionally, add an `<identity>` child element and specify the identity of the security token service.</span></span>

16. <span data-ttu-id="dfcb2-178">在用戶端和服務上都是選擇項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-178">Optional on both the client and the service.</span></span> <span data-ttu-id="dfcb2-179">新增 `<claimTypeRequirements>` 項目以做為 `<message>` 項目的子項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-179">Add a `<claimTypeRequirements>` element as a child of the `<message>` element.</span></span> <span data-ttu-id="dfcb2-180">藉由新增[\<將 > 元素新增](../../../../docs/framework/configure-apps/file-schema/wcf/add-of-claimtyperequirements.md)至 `<claimTypeRequirements>` 專案，並使用 `claimType` 屬性指定宣告類型，指定服務所依賴的必要和選擇性宣告。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-180">Specify required and optional claims that the service relies on by adding [\<add>](../../../../docs/framework/configure-apps/file-schema/wcf/add-of-claimtyperequirements.md) elements to the `<claimTypeRequirements>` element and specifying the claim type with the `claimType` attribute.</span></span> <span data-ttu-id="dfcb2-181">透過設定 `isOptional` 屬性，指定提供的宣告為必要項或選擇項。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-181">Specify whether a given claim is required or optional by setting the `isOptional` attribute.</span></span>

## <a name="example"></a><span data-ttu-id="dfcb2-182">範例</span><span class="sxs-lookup"><span data-stu-id="dfcb2-182">Example</span></span>

<span data-ttu-id="dfcb2-183">下列程式碼範例會顯示以命令方式設定 `WSFederationHttpBinding` 的程式碼。</span><span class="sxs-lookup"><span data-stu-id="dfcb2-183">The following code sample shows code for setting up a `WSFederationHttpBinding` imperatively.</span></span>

[!code-csharp[c_FederationBinding#2](~/samples/snippets/csharp/VS_Snippets_CFX/c_federationbinding/cs/source.cs#2)]
[!code-vb[c_FederationBinding#2](~/samples/snippets/visualbasic/VS_Snippets_CFX/c_federationbinding/vb/source.vb#2)]

## <a name="see-also"></a><span data-ttu-id="dfcb2-184">請參閱</span><span class="sxs-lookup"><span data-stu-id="dfcb2-184">See also</span></span>

- [<span data-ttu-id="dfcb2-185">同盟</span><span class="sxs-lookup"><span data-stu-id="dfcb2-185">Federation</span></span>](federation.md)
- [<span data-ttu-id="dfcb2-186">同盟範例</span><span class="sxs-lookup"><span data-stu-id="dfcb2-186">Federation Sample</span></span>](../../../../docs/framework/wcf/samples/federation-sample.md)
- [<span data-ttu-id="dfcb2-187">如何：在 WSFederationHttpBinding 上停用安全工作階段</span><span class="sxs-lookup"><span data-stu-id="dfcb2-187">How to: Disable Secure Sessions on a WSFederationHttpBinding</span></span>](how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md)
