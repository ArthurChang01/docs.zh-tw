---
title: 訊息安全性中的活動追蹤
ms.date: 03/30/2017
ms.assetid: 68862534-3b2e-4270-b097-8121b12a2c97
author: BrucePerlerMS
ms.openlocfilehash: 830339682f86d3882ff2cfc2d07d14145b987dde
ms.sourcegitcommit: 213292dfbb0c37d83f62709959ff55c50af5560d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/25/2018
ms.locfileid: "47157515"
---
# <a name="activity-tracing-in-message-security"></a><span data-ttu-id="ef3e6-102">訊息安全性中的活動追蹤</span><span class="sxs-lookup"><span data-stu-id="ef3e6-102">Activity Tracing in Message Security</span></span>
<span data-ttu-id="ef3e6-103">此主題將說明安全性處理中的活動追蹤 (將於下列三個階段中發生)。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-103">This topic describes activity tracing for security processing, which happens in the following three phases.</span></span>  
  
-   <span data-ttu-id="ef3e6-104">交涉/SCT 交換。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-104">Negotiation/SCT exchange.</span></span> <span data-ttu-id="ef3e6-105">這個情況會發生在傳輸層 (透過二進位資料交換) 或訊息層 (透過 SOAP 訊息交換)。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-105">This can happen at the transport later (through binary data exchange) or message layer (through SOAP message exchanges).</span></span>  
  
-   <span data-ttu-id="ef3e6-106">訊息加密/解密，包含簽章驗證 (verification) 與驗證 (authentication)。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-106">Message encryption/decryption, with signature verification and authentication.</span></span> <span data-ttu-id="ef3e6-107">追蹤項目會在環境活動中發生 (通常是「處理動作」)。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-107">Traces appear in the ambient activity, typically "Process Action."</span></span>  
  
-   <span data-ttu-id="ef3e6-108">授權與驗證</span><span class="sxs-lookup"><span data-stu-id="ef3e6-108">Authorization and verification.</span></span> <span data-ttu-id="ef3e6-109">這個情況會在本機或於端點之間進行通訊時發生。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-109">This can happen locally or when communicating between endpoints.</span></span>  
  
## <a name="negotiationsct-exchange"></a><span data-ttu-id="ef3e6-110">交涉/SCT 交換</span><span class="sxs-lookup"><span data-stu-id="ef3e6-110">Negotiation/SCT exchange</span></span>  
 <span data-ttu-id="ef3e6-111">在交涉/SCT 交換階段，會在用戶端上建立兩種活動類型：「設定安全工作階段」與「關閉安全工作階段」。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-111">In the negotiation/SCT exchange phase, two activity types are created on the client: "Set up Secure Session" and "Close Secure Session."</span></span> <span data-ttu-id="ef3e6-112">「設定安全工作階段」涵蓋了 RST/RSTR/SCT 訊息交換的追蹤，而「關閉安全工作階段」則包含了取消訊息的追蹤。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-112">"Set up Secure Session" encompasses traces for the RST/RSTR/SCT message exchanges, while "Close Secure Session" includes traces for the Cancel message.</span></span>  
  
 <span data-ttu-id="ef3e6-113">在伺服器上，RST/RSTR/SCT 的每個要求/回覆都會出現在自己的活動中。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-113">On the server, each request/reply for the RST/RSTR/SCT appears in its own activity.</span></span> <span data-ttu-id="ef3e6-114">如果`propagateActivity` = `true`同時在伺服器與用戶端，在伺服器上的活動有相同的識別碼，並一起出現在 「 設定安全工作階段 」 時透過服務追蹤檢視器檢視中。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-114">If `propagateActivity`=`true` on both the server and client, activities on the server have the same ID, and appear together in the "Setup Secure Session" when viewed through Service Trace Viewer.</span></span>  
  
 <span data-ttu-id="ef3e6-115">此活動追蹤模型可應用在使用者名稱/密碼驗證、憑證驗證，以及 NTLM 驗證上。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-115">This activity tracing model is valid for user name/password authentication, certificate authentication, and NTLM authentication.</span></span>  
  
 <span data-ttu-id="ef3e6-116">下表列出交涉與 SCT 交換的活動及追蹤。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-116">The following table lists the activities and traces for negotiation and SCT exchange.</span></span>  
  
||<span data-ttu-id="ef3e6-117">交涉/SCT 交換發生的時間</span><span class="sxs-lookup"><span data-stu-id="ef3e6-117">Time when Negotiation/SCT exchange happens</span></span>|<span data-ttu-id="ef3e6-118">活動</span><span class="sxs-lookup"><span data-stu-id="ef3e6-118">Activities</span></span>|<span data-ttu-id="ef3e6-119">追蹤</span><span class="sxs-lookup"><span data-stu-id="ef3e6-119">Traces</span></span>|  
|-|-------------------------------------------------|----------------|------------|  
|<span data-ttu-id="ef3e6-120">安全傳輸</span><span class="sxs-lookup"><span data-stu-id="ef3e6-120">Secure Transport</span></span><br /><br /> <span data-ttu-id="ef3e6-121">(HTTPS、SSL)</span><span class="sxs-lookup"><span data-stu-id="ef3e6-121">(HTTPS, SSL)</span></span>|<span data-ttu-id="ef3e6-122">在收到第一則訊息時。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-122">On first message received.</span></span>|<span data-ttu-id="ef3e6-123">環境活動中會發出追蹤。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-123">Traces are emitted in the ambient activity.</span></span>|<span data-ttu-id="ef3e6-124">交換追蹤</span><span class="sxs-lookup"><span data-stu-id="ef3e6-124">-   Exchange traces</span></span><br /><span data-ttu-id="ef3e6-125">-已建立安全通道</span><span class="sxs-lookup"><span data-stu-id="ef3e6-125">-   Secure channel established</span></span><br /><span data-ttu-id="ef3e6-126">-取得共用秘密。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-126">-   Share secrets obtained.</span></span>|  
|<span data-ttu-id="ef3e6-127">安全訊息層</span><span class="sxs-lookup"><span data-stu-id="ef3e6-127">Secure Message Layer</span></span><br /><br /> <span data-ttu-id="ef3e6-128">(WSHTTP)</span><span class="sxs-lookup"><span data-stu-id="ef3e6-128">(WSHTTP)</span></span>|<span data-ttu-id="ef3e6-129">在收到第一則訊息時。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-129">On first message received.</span></span>|<span data-ttu-id="ef3e6-130">在用戶端上：</span><span class="sxs-lookup"><span data-stu-id="ef3e6-130">On the client:</span></span><br /><br /> <span data-ttu-id="ef3e6-131">-RST/RSTR/SCT 的 「 設定安全工作階段 」 從 「 處理動作 」 的第一個訊息，每個要求/回覆。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-131">-   "Setup Secure Session" out of "Process Action" of that first message, for each request/reply for RST/RSTR/SCT.</span></span><br /><span data-ttu-id="ef3e6-132">-「 關閉安全工作階段 」 之 CANCEL 交換，從 「 關閉 Proxy 活動 」。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-132">-   "Close Secure Session" for the CANCEL exchange, out of the "Close Proxy activity."</span></span> <span data-ttu-id="ef3e6-133">此活動可能出自其他一些環境活動，視安全工作階段關閉時間而定。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-133">This activity may happen out of some other ambient activity, depending on when the secure session is closed.</span></span><br /><br /> <span data-ttu-id="ef3e6-134">在伺服器上：</span><span class="sxs-lookup"><span data-stu-id="ef3e6-134">On the server:</span></span><br /><br /> <span data-ttu-id="ef3e6-135">-每個要求/回覆的 RST/SCT/Cancel 伺服器上的一個 「 處理動作 」 活動。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-135">-   One "Process Action" activity for each request/reply for RST/SCT/Cancel on the server.</span></span> <span data-ttu-id="ef3e6-136">如果`propagateActivity` = `true`、 RST/RSTR/SCT 活動會合併使用 「 設定安全工作階段 」，和 [取消] 會與從用戶端的 「 關閉 」 活動合併。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-136">If `propagateActivity`=`true`, RST/RSTR/SCT activities are merged with "Set up Security Session", and Cancel is merged with the "Close" activity from the client.</span></span><br /><br /> <span data-ttu-id="ef3e6-137">「設定安全工作階段」共有兩個階段：</span><span class="sxs-lookup"><span data-stu-id="ef3e6-137">There are two stages for "Set up Secure Session":</span></span><br /><br /> <span data-ttu-id="ef3e6-138">1.驗證交涉。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-138">1.  Authentication negotiation.</span></span> <span data-ttu-id="ef3e6-139">如果用戶端已經具有適當的認證，則此選項將為選用。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-139">This is optional if the client already has the proper credentials.</span></span> <span data-ttu-id="ef3e6-140">您可以透過安全傳輸或是訊息交換來完成此階段。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-140">This phase can be done through secure transport, or through message exchanges.</span></span> <span data-ttu-id="ef3e6-141">在稍後階段，可能發生 1 或 2 次 RST/RSTR 交換。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-141">In the latter case, 1 or 2 RST/RSTR exchanges can happen.</span></span> <span data-ttu-id="ef3e6-142">在這些交換當中，新的要求/回覆活動會按照原先設計發出追蹤。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-142">For these exchanges, traces are emitted in new request/reply activities as previously designed.</span></span><br /><span data-ttu-id="ef3e6-143">2.安全工作階段建立 (SCT)，其中會發生一次 RST/RSTR 交換。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-143">2.  Secure session establishment (SCT), in which one RST/RSTR exchange happens here.</span></span> <span data-ttu-id="ef3e6-144">此交換與先前所述一樣，具備相同的環境活動。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-144">This has the same ambient activities as described previously.</span></span>|<span data-ttu-id="ef3e6-145">交換追蹤</span><span class="sxs-lookup"><span data-stu-id="ef3e6-145">-   Exchange traces</span></span><br /><span data-ttu-id="ef3e6-146">-已建立安全通道</span><span class="sxs-lookup"><span data-stu-id="ef3e6-146">-   Secure channel established</span></span><br /><span data-ttu-id="ef3e6-147">-取得共用秘密。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-147">-   Share secrets obtained.</span></span>|  
  
> [!NOTE]
>  <span data-ttu-id="ef3e6-148">在混合式安全性模式中，交涉驗證會於二進位交換中發生，但是 SCT 則是在訊息交換中發生。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-148">In mixed security mode, negotiation authentication happens in binary exchanges, but SCT happens in message exchange.</span></span> <span data-ttu-id="ef3e6-149">在單純的傳輸模式中，交涉只會在不包含額外活動的傳輸中發生。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-149">In pure transport mode, negotiation happens only in transport with no additional activities.</span></span>  
  
## <a name="message-encryption-and-decryption"></a><span data-ttu-id="ef3e6-150">訊息加密與解密</span><span class="sxs-lookup"><span data-stu-id="ef3e6-150">Message Encryption and Decryption</span></span>  
 <span data-ttu-id="ef3e6-151">下表列出訊息加密/解密，以及簽章驗證的活動及追蹤。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-151">The following table lists the activities and traces for message encryption/decryption, as well as signature authentication.</span></span>  
  
||<span data-ttu-id="ef3e6-152">安全傳輸</span><span class="sxs-lookup"><span data-stu-id="ef3e6-152">Secure Transport</span></span><br /><br /> <span data-ttu-id="ef3e6-153">(HTTPS、SSL) 與安全訊息層</span><span class="sxs-lookup"><span data-stu-id="ef3e6-153">(HTTPS, SSL) and Secure Message Layer</span></span><br /><br /> <span data-ttu-id="ef3e6-154">(WSHTTP)</span><span class="sxs-lookup"><span data-stu-id="ef3e6-154">(WSHTTP)</span></span>|  
|-|---------------------------------------------------------------------------------|  
|<span data-ttu-id="ef3e6-155">訊息加密/解密，以及簽章驗證發生的時間</span><span class="sxs-lookup"><span data-stu-id="ef3e6-155">Time when message encryption/decryption, as well as signature authentication happens</span></span>|<span data-ttu-id="ef3e6-156">在收到訊息時</span><span class="sxs-lookup"><span data-stu-id="ef3e6-156">On message received</span></span>|  
|<span data-ttu-id="ef3e6-157">活動</span><span class="sxs-lookup"><span data-stu-id="ef3e6-157">Activities</span></span>|<span data-ttu-id="ef3e6-158">用戶端與伺服器上的 ProcessAction 活動會發出追蹤。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-158">Traces are emitted in the ProcessAction activity on the client and server.</span></span>|  
|<span data-ttu-id="ef3e6-159">追蹤</span><span class="sxs-lookup"><span data-stu-id="ef3e6-159">Traces</span></span>|<span data-ttu-id="ef3e6-160">-sendSecurityHeader （傳送者）：</span><span class="sxs-lookup"><span data-stu-id="ef3e6-160">-   sendSecurityHeader (sender):</span></span><br /><span data-ttu-id="ef3e6-161">-簽署訊息</span><span class="sxs-lookup"><span data-stu-id="ef3e6-161">-   Sign message</span></span><br /><span data-ttu-id="ef3e6-162">-加密要求資料</span><span class="sxs-lookup"><span data-stu-id="ef3e6-162">-   Encrypt request data</span></span><br /><span data-ttu-id="ef3e6-163">-receiveSecurityHeader （接收者）：</span><span class="sxs-lookup"><span data-stu-id="ef3e6-163">-   receiveSecurityHeader (receiver):</span></span><br /><span data-ttu-id="ef3e6-164">-驗證簽章</span><span class="sxs-lookup"><span data-stu-id="ef3e6-164">-   Verify signature</span></span><br /><span data-ttu-id="ef3e6-165">解密回應資料</span><span class="sxs-lookup"><span data-stu-id="ef3e6-165">-   Decrypt response data</span></span><br /><span data-ttu-id="ef3e6-166">-驗證</span><span class="sxs-lookup"><span data-stu-id="ef3e6-166">-   Authentication</span></span>|  
  
> [!NOTE]
>  <span data-ttu-id="ef3e6-167">在單純的傳輸模式中，訊息加密/解密只會在不包含額外活動的傳輸中發生。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-167">In pure transport mode, message encryption/decryption happens only in transport with no additional activities.</span></span>  
  
## <a name="authorization-and-verification"></a><span data-ttu-id="ef3e6-168">授權與驗證</span><span class="sxs-lookup"><span data-stu-id="ef3e6-168">Authorization and Verification</span></span>  
 <span data-ttu-id="ef3e6-169">下表列出授權的活動與追蹤。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-169">The following table lists the activities and traces for authorization.</span></span>  
  
||<span data-ttu-id="ef3e6-170">發生授權的時間</span><span class="sxs-lookup"><span data-stu-id="ef3e6-170">Time when authorization happens</span></span>|<span data-ttu-id="ef3e6-171">活動</span><span class="sxs-lookup"><span data-stu-id="ef3e6-171">Activities</span></span>|<span data-ttu-id="ef3e6-172">追蹤</span><span class="sxs-lookup"><span data-stu-id="ef3e6-172">Traces</span></span>|  
|-|-------------------------------------|----------------|------------|  
|<span data-ttu-id="ef3e6-173">本機 (預設)</span><span class="sxs-lookup"><span data-stu-id="ef3e6-173">Local (default)</span></span>|<span data-ttu-id="ef3e6-174">當伺服器上的訊息解密之後</span><span class="sxs-lookup"><span data-stu-id="ef3e6-174">After the message is decrypted on the server</span></span>|<span data-ttu-id="ef3e6-175">伺服器上的 ProcessAction 活動會發出追蹤。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-175">Traces are emitted in the ProcessAction activity at the server.</span></span>|<span data-ttu-id="ef3e6-176">使用者已授權。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-176">User authorized.</span></span>|  
|<span data-ttu-id="ef3e6-177">Remote</span><span class="sxs-lookup"><span data-stu-id="ef3e6-177">Remote</span></span>|<span data-ttu-id="ef3e6-178">當伺服器上的訊息解密之後</span><span class="sxs-lookup"><span data-stu-id="ef3e6-178">After the message is decrypted on the server</span></span>|<span data-ttu-id="ef3e6-179">由 ProcessAction 活動叫用的新活動會發出追蹤。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-179">Traces are emitted in a new activity invoked by the ProcessAction activity.</span></span>|<span data-ttu-id="ef3e6-180">使用者已授權。</span><span class="sxs-lookup"><span data-stu-id="ef3e6-180">User authorized.</span></span>|
