---
title: 訊息記錄的安全性考量
ms.date: 03/30/2017
ms.assetid: 21f513f2-815b-47f3-85a6-03c008510038
author: BrucePerlerMS
ms.openlocfilehash: c03b4fff41b66d2da6e912be613fb4341484518b
ms.sourcegitcommit: ea00c05e0995dae928d48ead99ddab6296097b4c
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/02/2018
ms.locfileid: "48032188"
---
# <a name="security-concerns-for-message-logging"></a><span data-ttu-id="3bec5-102">訊息記錄的安全性考量</span><span class="sxs-lookup"><span data-stu-id="3bec5-102">Security Concerns for Message Logging</span></span>
<span data-ttu-id="3bec5-103">此主題描述如何保護訊息記錄以及記錄訊息時所產生之事件中的敏感性資料，使其不會被公開。</span><span class="sxs-lookup"><span data-stu-id="3bec5-103">This topic describes how you can protect sensitive data from being exposed in message logs, as well as events generated by message logging.</span></span>  
  
## <a name="security-concerns"></a><span data-ttu-id="3bec5-104">安全性考量</span><span class="sxs-lookup"><span data-stu-id="3bec5-104">Security Concerns</span></span>  
  
### <a name="logging-sensitive-information"></a><span data-ttu-id="3bec5-105">記錄敏感資訊</span><span class="sxs-lookup"><span data-stu-id="3bec5-105">Logging Sensitive Information</span></span>  
 <span data-ttu-id="3bec5-106">Windows Communication Foundation (WCF) 不會修改應用程式特定標頭和本文中的任何資料。</span><span class="sxs-lookup"><span data-stu-id="3bec5-106">Windows Communication Foundation (WCF) does not modify any data in application-specific headers and body.</span></span> <span data-ttu-id="3bec5-107">WCF 也不會追蹤應用程式特定標頭或本文資料中的個人資訊。</span><span class="sxs-lookup"><span data-stu-id="3bec5-107">WCF also does not track personal information in application-specific headers or body data.</span></span>  
  
 <span data-ttu-id="3bec5-108">啟用訊息記錄時，應用程式特定標頭中的個人資訊 (例如查詢字串) 和本文資訊 (例如信用卡號碼) 會在記錄檔中變得可見。</span><span class="sxs-lookup"><span data-stu-id="3bec5-108">When message logging is enabled, personal information in application-specific headers, such as, a query string; and body information, such as, a credit card number, can become visible in the logs.</span></span> <span data-ttu-id="3bec5-109">應用程式部署者負責強制針對組態和記錄檔採取存取控制。</span><span class="sxs-lookup"><span data-stu-id="3bec5-109">The application deployer is responsible for enforcing access control on the configuration and log files.</span></span> <span data-ttu-id="3bec5-110">如果不要讓這類資訊變得可見，您應該停用記錄，如果要共用記錄檔，則應該篩選掉部分資料。</span><span class="sxs-lookup"><span data-stu-id="3bec5-110">If you do not want this kind of information to be visible, you should disable logging, or filter out part of the data if you want to share the logs.</span></span>  
  
 <span data-ttu-id="3bec5-111">下列秘訣有助於防止無意間公開記錄檔內容：</span><span class="sxs-lookup"><span data-stu-id="3bec5-111">The following tips can help you to prevent the content of a log file from being exposed unintentionally:</span></span>  
  
-   <span data-ttu-id="3bec5-112">確定在 Web 主控和自我主控的情況下，記錄檔都受到存取控制清單 (ACL) 的保護。</span><span class="sxs-lookup"><span data-stu-id="3bec5-112">Ensure that the log files are protected by Access Control Lists (ACL) both in Web-host and self-host scenarios.</span></span>  
  
-   <span data-ttu-id="3bec5-113">您選擇的副檔名不可讓人透過 Web 要求就輕而易舉地取得檔案。</span><span class="sxs-lookup"><span data-stu-id="3bec5-113">Choose a file extension that cannot be easily served using a Web request.</span></span> <span data-ttu-id="3bec5-114">例如，.xml 副檔名就不是安全的選擇。</span><span class="sxs-lookup"><span data-stu-id="3bec5-114">For example, the .xml file extension is not a safe choice.</span></span> <span data-ttu-id="3bec5-115">請參閱網際網路資訊服務 (IIS) 管理手冊，查看可服務的副檔名清單。</span><span class="sxs-lookup"><span data-stu-id="3bec5-115">You can check the Internet Information Services (IIS) administration guide to see a list of extensions that can be served.</span></span>  
  
-   <span data-ttu-id="3bec5-116">指定絕對路徑做為記錄檔位置，此位置應該位於 Web 主機 vroot 公用目錄之外，以防止外部人員使用網頁瀏覽器存取記錄檔。</span><span class="sxs-lookup"><span data-stu-id="3bec5-116">Specify an absolute path for the log file location, which should be outside of the Web host vroot public directory to prevent it from being accessed by an external party using a Web browser.</span></span>  
  
 <span data-ttu-id="3bec5-117">根據預設，金鑰和個人可識別資訊 (PII)，例如使用者名稱和密碼，不會記錄在追蹤和記錄訊息中。</span><span class="sxs-lookup"><span data-stu-id="3bec5-117">By default, keys and personally identifiable information (PII) such as username and password are not logged in traces and logged messages.</span></span> <span data-ttu-id="3bec5-118">不過，電腦的系統管理員還是可以使用 Machine.config 檔案中 `enableLoggingKnownPII` 項目的 `machineSettings` 屬性，來允許電腦上執行的應用程式記錄已知的個人可識別資訊 (PII)。</span><span class="sxs-lookup"><span data-stu-id="3bec5-118">A machine administrator, however, can use the `enableLoggingKnownPII` attribute in the `machineSettings` element of the Machine.config file to permit applications running on the machine to log known personally identifiable information (PII).</span></span> <span data-ttu-id="3bec5-119">下列組態示範如何執行這項操作：</span><span class="sxs-lookup"><span data-stu-id="3bec5-119">The following configuration demonstrates how to do this:</span></span>  
  
```xml  
<configuration>  
   <system.serviceModel>  
      <machineSettings enableLoggingKnownPii="true"/>  
   </system.serviceModel>  
</configuration>   
```  
  
 <span data-ttu-id="3bec5-120">然後，應用程式部署者可以使用 App.config 或 Web.config 檔案中的 `logKnownPii` 屬性，啟用 PII 記錄，如下所示：</span><span class="sxs-lookup"><span data-stu-id="3bec5-120">An application deployer can then use the `logKnownPii` attribute in either the App.config or Web.config file to enable PII logging as follows:</span></span>  
  
```xml  
<system.diagnostics>  
  <sources>  
      <source name="System.ServiceModel.MessageLogging"  
        logKnownPii="true">  
        <listeners>  
                 <add name="messages"  
                 type="System.Diagnostics.XmlWriterTraceListener"  
                 initializeData="c:\logs\messages.svclog" />  
          </listeners>  
      </source>  
    </sources>  
</system.diagnostics>  
```  
  
 <span data-ttu-id="3bec5-121">只有在這兩個設定都是 `true` 時，才會啟用 PII 記錄。</span><span class="sxs-lookup"><span data-stu-id="3bec5-121">Only when both settings are `true` is PII logging enabled.</span></span> <span data-ttu-id="3bec5-122">結合兩個參數，提供了記錄每個應用程式已知 PII 的彈性。</span><span class="sxs-lookup"><span data-stu-id="3bec5-122">The combination of two switches allows the flexibility to log known PII for each application.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="3bec5-123">在 [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] 的 Web.config 檔案或 App.config 檔案中，`logEntireMessage` 和 `logKnownPii` 旗標也必須設定為 `true` 以啟用 PII 記錄，如下列範例 `<system.serviceModel><messageLogging logEntireMessage="true" logKnownPii="true" …` 所示。</span><span class="sxs-lookup"><span data-stu-id="3bec5-123">In [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] the `logEntireMessage` and `logKnownPii` flags must also be set to `true` in the Web.config file or the App.config file to enable PII logging, as show in the following example `<system.serviceModel><messageLogging logEntireMessage="true" logKnownPii="true" …`.</span></span>  
  
 <span data-ttu-id="3bec5-124">您應該知道，在組態檔中指定兩個以上的自訂來源時，只會讀取第一個來源的屬性。</span><span class="sxs-lookup"><span data-stu-id="3bec5-124">You should be aware that if you specify two or more custom sources in a configuration file, only the attributes of the first source are read.</span></span> <span data-ttu-id="3bec5-125">其他的來源則會被忽略。</span><span class="sxs-lookup"><span data-stu-id="3bec5-125">The others are ignored.</span></span> <span data-ttu-id="3bec5-126">這表示，在下列的 App.config 檔案中，即使第二個來源已明確啟用 PII 記錄，但不會記錄這兩個來源的 PII。</span><span class="sxs-lookup"><span data-stu-id="3bec5-126">This means that, for the following App.config, file, PII is not logged for both sources even though PII logging is explicitly enabled for the second source.</span></span>  
  
```xml  
<system.diagnostics>  
   <sources>  
      <source name="System.ServiceModel.MessageLogging"  
              logKnownPii="false">  
              <listeners>  
                 <add name="messages"  
                      type="System.Diagnostics.XmlWriterTraceListener"  
                      initializeData="c:\logs\messages.svclog" />  
              </listeners>  
            </source>  
      <source name="System.ServiceModel"   
              logKnownPii="true">  
              <listeners>  
                 <add name="traces"  
                      type="System.Diagnostics.XmlWriterTraceListener"  
                      initializeData="c:\logs\traces.svclog" />  
              </listeners>  
      </source>  
   </sources>  
</system.diagnostics>  
```  
  
 <span data-ttu-id="3bec5-127">如果`<machineSettings enableLoggingKnownPii="Boolean"/>`t:system.configuration.configurationerrorsexception 項目不在 Machine.config 檔案，系統會擲回<xref:System.Configuration.ConfigurationErrorsException>。</span><span class="sxs-lookup"><span data-stu-id="3bec5-127">If the `<machineSettings enableLoggingKnownPii="Boolean"/>` element exists outside the Machine.config file, the system throws a <xref:System.Configuration.ConfigurationErrorsException>.</span></span>  
  
 <span data-ttu-id="3bec5-128">只有在應用程式啟動或重新啟動時，才能讓變更生效。</span><span class="sxs-lookup"><span data-stu-id="3bec5-128">The changes are effective only when the application starts or restarts.</span></span> <span data-ttu-id="3bec5-129">當這兩個屬性都設定為 `true` 時，啟動時會記錄事件。</span><span class="sxs-lookup"><span data-stu-id="3bec5-129">An event is logged at startup when both attributes are set to `true`.</span></span> <span data-ttu-id="3bec5-130">如果 `logKnownPii` 設定為 `true`，但 `enableLoggingKnownPii` 設定為 `false`，也會記錄事件。</span><span class="sxs-lookup"><span data-stu-id="3bec5-130">An event is also logged if `logKnownPii` is set to `true` but `enableLoggingKnownPii` is `false`.</span></span>  
  
 <span data-ttu-id="3bec5-131">電腦的系統管理員和應用程式部署人員在使用這兩個參數時，應該特別小心謹慎。</span><span class="sxs-lookup"><span data-stu-id="3bec5-131">The machine administrator and application deployer should exercise extreme caution when using these two switches.</span></span> <span data-ttu-id="3bec5-132">如果啟用 PII 記錄，則會記錄安全性金鑰和 PII。</span><span class="sxs-lookup"><span data-stu-id="3bec5-132">If PII logging is enabled, security keys and PII are logged.</span></span> <span data-ttu-id="3bec5-133">如果停用，敏感資料和應用程式特定資料仍然會記錄在訊息標頭和本文中。</span><span class="sxs-lookup"><span data-stu-id="3bec5-133">If it is disabled, sensitive and application-specific data is still logged in message headers and bodies.</span></span> <span data-ttu-id="3bec5-134">如需隱私權和保護 PII 免於遭到公開的更完整討論，請參閱 <<c0> [ 使用者隱私權](https://go.microsoft.com/fwlink/?LinkID=94647)。</span><span class="sxs-lookup"><span data-stu-id="3bec5-134">For a more thorough discussion about privacy and protecting PII from being exposed, see [User Privacy](https://go.microsoft.com/fwlink/?LinkID=94647).</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="3bec5-135">格式錯誤的訊息中不會隱藏 PII。</span><span class="sxs-lookup"><span data-stu-id="3bec5-135">PII is not hidden in malformed messages.</span></span> <span data-ttu-id="3bec5-136">這類訊息會依現狀記錄，不做任何修改。</span><span class="sxs-lookup"><span data-stu-id="3bec5-136">Such messaged are logged as-is without any modification.</span></span> <span data-ttu-id="3bec5-137">上述的屬性在此不會有任何作用。</span><span class="sxs-lookup"><span data-stu-id="3bec5-137">Attributes mentioned previously have no effect on this.</span></span>  
  
### <a name="custom-trace-listener"></a><span data-ttu-id="3bec5-138">自訂追蹤接聽項</span><span class="sxs-lookup"><span data-stu-id="3bec5-138">Custom Trace Listener</span></span>  
 <span data-ttu-id="3bec5-139">在訊息記錄追蹤來源上加入自訂追蹤接聽項，是僅限於系統管理員的權限。</span><span class="sxs-lookup"><span data-stu-id="3bec5-139">Adding a custom trace listener on the Message Logging trace source is a privilege that should be restricted to the administrator.</span></span> <span data-ttu-id="3bec5-140">這是因為惡意的自訂接聽項可以設定為從遠端傳送訊息，進而導致敏感資訊洩漏。</span><span class="sxs-lookup"><span data-stu-id="3bec5-140">This is because malicious custom listeners can be configured to send messages remotely, which leads to sensitive information disclosure.</span></span> <span data-ttu-id="3bec5-141">此外，如果您將自訂接聽項設定為在網路上傳送訊息，例如傳送至遠端資料庫，在遠端電腦的訊息記錄檔上應該強制採取適當的存取控制。</span><span class="sxs-lookup"><span data-stu-id="3bec5-141">In addition, if you configure a custom listener to send messages on the wire, such as, to a remote database, you should enforce proper access control on the message logs in the remote machine.</span></span>  
  
## <a name="events-triggered-by-message-logging"></a><span data-ttu-id="3bec5-142">由訊息記錄所觸發的事件</span><span class="sxs-lookup"><span data-stu-id="3bec5-142">Events Triggered by Message Logging</span></span>  
 <span data-ttu-id="3bec5-143">以下列出由訊息記錄所發出的所有事件。</span><span class="sxs-lookup"><span data-stu-id="3bec5-143">The following lists all the events emitted by message logging.</span></span>  
  
-   <span data-ttu-id="3bec5-144">Message logging on：在組態中或透過 WMI 啟用訊息記錄時，會發出這個事件。</span><span class="sxs-lookup"><span data-stu-id="3bec5-144">Message logging on: This event is emitted when message logging is enabled in configuration, or through WMI.</span></span> <span data-ttu-id="3bec5-145">事件內容為「已開啟訊息記錄。</span><span class="sxs-lookup"><span data-stu-id="3bec5-145">The content of the event is "Message logging has been turned on.</span></span> <span data-ttu-id="3bec5-146">可能會以純文字記錄敏感資料，即使在網路傳輸時經過加密，例如，訊息本文」。</span><span class="sxs-lookup"><span data-stu-id="3bec5-146">Sensitive information may be logged in clear text, even if they were encrypted on the wire, for example, message bodies."</span></span>  
  
-   <span data-ttu-id="3bec5-147">Message logging off：在組態中或透過 WMI 停用訊息記錄時，會發出這個事件。</span><span class="sxs-lookup"><span data-stu-id="3bec5-147">Message logging off: This event is emitted when message logging is disabled through WMI.</span></span> <span data-ttu-id="3bec5-148">事件內容為「已關閉訊息記錄」。</span><span class="sxs-lookup"><span data-stu-id="3bec5-148">The content of the event is "Message logging has been turned off."</span></span>  
  
-   <span data-ttu-id="3bec5-149">Log Known PII On：啟用已知 PII 記錄時，會發出這個事件。</span><span class="sxs-lookup"><span data-stu-id="3bec5-149">Log Known PII On: This event is emitted when logging of known PII is enabled.</span></span> <span data-ttu-id="3bec5-150">發生這種情況時`enableLoggingKnownPii`屬性中`machineSettings`Machine.config 檔案的元素設定為`true`，而`logKnownPii`屬性`source`App.config 或 Web.config 檔案中的項目設為`true`.</span><span class="sxs-lookup"><span data-stu-id="3bec5-150">This happens when the `enableLoggingKnownPii` attribute in the `machineSettings` element of the Machine.config file is set to `true`, and the `logKnownPii` attribute of the `source` element in either the App.config or Web.config file is set to `true`.</span></span>  
  
-   <span data-ttu-id="3bec5-151">Log Known PII Not Allowed：不允許記錄已知 PII 時，會發出這個事件。</span><span class="sxs-lookup"><span data-stu-id="3bec5-151">Log Known PII Not Allowed: This event is emitted when logging of known PII is not allowed.</span></span> <span data-ttu-id="3bec5-152">發生這種情況時`logKnownPii`的屬性`source`App.config 或 Web.config 檔案中的項目設為`true`，但`enableLoggingKnownPii`屬性中`machineSettings`Machine.config 檔案的項目設為`false`.</span><span class="sxs-lookup"><span data-stu-id="3bec5-152">This happens when the `logKnownPii` attribute of the `source` element in either the App.config or Web.config file is set to `true`, but the `enableLoggingKnownPii` attribute in the `machineSettings` element of the Machine.config file is set to `false`.</span></span> <span data-ttu-id="3bec5-153">不會有例外狀況擲回。</span><span class="sxs-lookup"><span data-stu-id="3bec5-153">No exception is thrown.</span></span>  
  
 <span data-ttu-id="3bec5-154">您可以在 Windows 的 [事件檢視器] 工具中檢視這些事件。</span><span class="sxs-lookup"><span data-stu-id="3bec5-154">These events can be viewed in the Event Viewer tool that comes with Windows.</span></span> <span data-ttu-id="3bec5-155">如需詳細資訊，請參閱[事件記錄](../../../../docs/framework/wcf/diagnostics/event-logging/index.md)。</span><span class="sxs-lookup"><span data-stu-id="3bec5-155">For more information on this, see [Event Logging](../../../../docs/framework/wcf/diagnostics/event-logging/index.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3bec5-156">另請參閱</span><span class="sxs-lookup"><span data-stu-id="3bec5-156">See Also</span></span>  
 [<span data-ttu-id="3bec5-157">訊息記錄</span><span class="sxs-lookup"><span data-stu-id="3bec5-157">Message Logging</span></span>](../../../../docs/framework/wcf/diagnostics/message-logging.md)  
 [<span data-ttu-id="3bec5-158">追蹤的安全性考量及實用秘訣</span><span class="sxs-lookup"><span data-stu-id="3bec5-158">Security Concerns and Useful Tips for Tracing</span></span>](../../../../docs/framework/wcf/diagnostics/tracing/security-concerns-and-useful-tips-for-tracing.md)
