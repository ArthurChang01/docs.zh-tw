---
title: "條件式 Get 和 Put"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 3d22067f-57b8-4e0f-a571-a694512187ae
caps.latest.revision: "8"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: e4ab4d0a97cbbaa2e5aaee25e0154e1cc94a82f8
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/18/2017
---
# <a name="conditional-get-and-put"></a><span data-ttu-id="e9e21-102">條件式 Get 和 Put</span><span class="sxs-lookup"><span data-stu-id="e9e21-102">Conditional Get and Put</span></span>
<span data-ttu-id="e9e21-103">此範例示範如何針對 WCF REST 程式設計模型使用新的條件式擷取和更新 API。</span><span class="sxs-lookup"><span data-stu-id="e9e21-103">This sample demonstrates how to use the new conditional retrieve and update APIs for the WCF REST programming model.</span></span> <span data-ttu-id="e9e21-104">因為最適合的條件式擷取和更新資源導向和 REST 服務，這個範例會延續[基本資源服務](../../../../docs/framework/wcf/samples/basic-resource-service.md)範例。</span><span class="sxs-lookup"><span data-stu-id="e9e21-104">Because conditional retrieve and update are most appropriate for resource-oriented and REST services, this sample extends the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span> <span data-ttu-id="e9e21-105">此範例著重於新增的條件式擷取和更新支援[基本資源服務](../../../../docs/framework/wcf/samples/basic-resource-service.md)範例使用新的 Api 中導入[!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="e9e21-105">This sample focuses on adding support for conditional retrieve and update to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample using the new APIs introduced in [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="e9e21-106">示範</span><span class="sxs-lookup"><span data-stu-id="e9e21-106">Demonstrates</span></span>  
 <span data-ttu-id="e9e21-107">條件式擷取和更新</span><span class="sxs-lookup"><span data-stu-id="e9e21-107">Conditional Retrieve and Update</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="e9e21-108">討論</span><span class="sxs-lookup"><span data-stu-id="e9e21-108">Discussion</span></span>  
 <span data-ttu-id="e9e21-109">此範例中的 WCF 服務會以資源導向和 REST 的方式公開客戶的集合。</span><span class="sxs-lookup"><span data-stu-id="e9e21-109">The WCF service in this sample exposes a collection of customers in a resource-oriented and REST manner.</span></span> <span data-ttu-id="e9e21-110">服務實作的詳細說明，請參閱[基本資源服務](../../../../docs/framework/wcf/samples/basic-resource-service.md)範例。</span><span class="sxs-lookup"><span data-stu-id="e9e21-110">For a detailed description of the service implementation, please see the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span>  
  
 <span data-ttu-id="e9e21-111">這個範例會加入條件式擷取和更新功能，以[基本資源服務](../../../../docs/framework/wcf/samples/basic-resource-service.md)範例。</span><span class="sxs-lookup"><span data-stu-id="e9e21-111">This sample adds conditional retrieve and update capabilities to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span> <span data-ttu-id="e9e21-112">條件式擷取和更新使用 HTTP 實體標記與 HTTP If-None-Match 和 If-Match 標頭驗證用戶端是否擁有給定資源的最新實體。</span><span class="sxs-lookup"><span data-stu-id="e9e21-112">Conditional retrieve and update use HTTP entity tags and the HTTP If-None-Match and If-Match headers to validate that clients either have or do not have the most current entity for a given resource.</span></span> <span data-ttu-id="e9e21-113">不過，實作程式碼以正確剖析 HTTP If-None-Match 和 If-Match 標頭可能很費時而且容易產生錯誤。</span><span class="sxs-lookup"><span data-stu-id="e9e21-113">However, implementing the code to correctly parse the HTTP If-None-Match and If-Match headers can be tedious and error-prone.</span></span> <span data-ttu-id="e9e21-114">因此，<xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> 和 <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> 方法已經加入至可以使用目前 <xref:System.ServiceModel.Web.IncomingWebRequestContext> 執行個體存取的 <xref:System.ServiceModel.Web.WebOperationContext>。</span><span class="sxs-lookup"><span data-stu-id="e9e21-114">Therefore, the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> and <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> methods have been added to the <xref:System.ServiceModel.Web.IncomingWebRequestContext>, which can be accessed using the current instance of the <xref:System.ServiceModel.Web.WebOperationContext>.</span></span> <span data-ttu-id="e9e21-115">此外，`SetETag` 方法已經加入至 <xref:System.ServiceModel.Web.OutgoingWebRequestContext>，讓其更容易傳回有效的實體標記。</span><span class="sxs-lookup"><span data-stu-id="e9e21-115">In addition, the `SetETag` method has been added to the <xref:System.ServiceModel.Web.OutgoingWebRequestContext>, making it easier to return valid entity tags.</span></span>  
  
 <span data-ttu-id="e9e21-116"><xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> 方法可搭配 [WebGet] 作業使用。</span><span class="sxs-lookup"><span data-stu-id="e9e21-116">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method is intended to be used with [WebGet] operations.</span></span> <span data-ttu-id="e9e21-117">它會採用給定資源的目前實體標記做為 `entityTag` 參數，這個參數可以是 `string`、`int`、`long` 或 `Guid`。</span><span class="sxs-lookup"><span data-stu-id="e9e21-117">It takes the current entity tag for the given resource as the `entityTag` parameter, which can be a `string`, `int`, `long` or `Guid`.</span></span> <span data-ttu-id="e9e21-118"><xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> 方法會針對要求的 HTTP If-None-Match 標頭，檢查實體標記。</span><span class="sxs-lookup"><span data-stu-id="e9e21-118">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method checks the entity tag against the HTTP If-None-Match header of the request.</span></span> <span data-ttu-id="e9e21-119">如果實體標記存在於 HTTP If-None-Match 標頭中，則會擲回狀態碼為「未修改 (304)」的 <xref:System.ServiceModel.Web.WebFaultException>，否則會傳回方法。</span><span class="sxs-lookup"><span data-stu-id="e9e21-119">If the entity tag is present in the HTTP If-None-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Not Modified (304) is thrown; otherwise the method returns.</span></span> <span data-ttu-id="e9e21-120">條件式擷取機制可讓用戶端告知伺服器它擁有這個實體，如果用戶端還未擁有這個實體，則僅傳送目前的實體。</span><span class="sxs-lookup"><span data-stu-id="e9e21-120">The conditional retrieve mechanism allows the client to tell the server that it has this entity and to only send the current entity if the client does not already have it.</span></span> <span data-ttu-id="e9e21-121">在服務的 <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> 和 `GetCustomer` 作業中，可以看到 `GetCustomers` 方法的使用範例。</span><span class="sxs-lookup"><span data-stu-id="e9e21-121">Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method can be seen in the `GetCustomer` and `GetCustomers` operations of the service.</span></span> <span data-ttu-id="e9e21-122">請務必注意，<xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> 的呼叫可能不會傳回。</span><span class="sxs-lookup"><span data-stu-id="e9e21-122">It is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> may not return.</span></span> <span data-ttu-id="e9e21-123">開發人員應該實作此作業，如此可在執行 <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> 的呼叫之前，就已經知道要求成功，因此，如果 <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> 的呼叫不存在，服務就會傳送一個具有成功狀態碼的回應。</span><span class="sxs-lookup"><span data-stu-id="e9e21-123">Developers should implement the operation so that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> was not present, the service would send a response with a successful status code.</span></span>  
  
 <span data-ttu-id="e9e21-124"><xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> 方法類似於 <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="e9e21-124">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method is similar to the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method.</span></span> <span data-ttu-id="e9e21-125">它也會採用給定資源的目前實體標記。</span><span class="sxs-lookup"><span data-stu-id="e9e21-125">It also takes the current entity tag for the given resource.</span></span> <span data-ttu-id="e9e21-126">不過，它被用來搭配 [WebInvoke] 作業所在的方式設定為"PUT"或"DELETE"。</span><span class="sxs-lookup"><span data-stu-id="e9e21-126">However, it is intended to be used with [WebInvoke] operations in which the method is set to "PUT" or "DELETE".</span></span> <span data-ttu-id="e9e21-127"><xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> 方法會針對要求的 HTTP If-Match 標頭，檢查實體標記。</span><span class="sxs-lookup"><span data-stu-id="e9e21-127">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method checks the entity tag against the HTTP If-Match header of the request.</span></span> <span data-ttu-id="e9e21-128">如果實體標記不存在於 HTTP If-Match 標頭中，則會擲回狀態碼為「前置條件失敗 (412)」的 <xref:System.ServiceModel.Web.WebFaultException>。</span><span class="sxs-lookup"><span data-stu-id="e9e21-128">If the entity tag is not present in the HTTP If-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Precondition Failed (412) is thrown.</span></span> <span data-ttu-id="e9e21-129">條件式更新機制可讓用戶端告知伺服器它擁有資源的這個實體，如果它所擁有的實體是最新的，則僅允許用戶端變更資源。</span><span class="sxs-lookup"><span data-stu-id="e9e21-129">The conditional update mechanism allows the client to tell the server that it has this entity for the resource and to only allow the client to alter the resource; if the entity it has is current.</span></span> <span data-ttu-id="e9e21-130">在服務的 <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> 和 `UpdateCustomer` 作業中，可以看到 `DeleteCustomer` 方法的使用範例。</span><span class="sxs-lookup"><span data-stu-id="e9e21-130">Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method can be seen in the `UpdateCustomer` and `DeleteCustomer` operations of the service.</span></span> <span data-ttu-id="e9e21-131">請務必注意，如同 <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> 般，<xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> 的呼叫可能不會傳回。</span><span class="sxs-lookup"><span data-stu-id="e9e21-131">Just as with <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>, it is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> may not return.</span></span> <span data-ttu-id="e9e21-132">開發人員應該實作此作業，如此可在執行 <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> 的呼叫之前，就已經知道要求成功，因此，如果 <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> 的呼叫不存在，服務就會以成功狀態碼回應。</span><span class="sxs-lookup"><span data-stu-id="e9e21-132">Developers should implement the operation such that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> was not present, the service would respond with a successful status code.</span></span>  
  
 <span data-ttu-id="e9e21-133">此範例包含在主控台應用程式中執行的自我裝載服務和用戶端。</span><span class="sxs-lookup"><span data-stu-id="e9e21-133">The sample consists of a self-hosted service and a client that runs within a console application.</span></span> <span data-ttu-id="e9e21-134">當主控台應用程式執行時，用戶端會對服務發出要求，然後將相關的資訊從回應寫入至主控台視窗。</span><span class="sxs-lookup"><span data-stu-id="e9e21-134">As the console application runs, the client makes requests to the service and writes the pertinent information from the responses to the console window.</span></span>  
  
#### <a name="to-run-the-sample"></a><span data-ttu-id="e9e21-135">若要執行範例</span><span class="sxs-lookup"><span data-stu-id="e9e21-135">To run the sample</span></span>  
  
1.  <span data-ttu-id="e9e21-136">開啟「條件式 Get 和 Put」範例的方案。</span><span class="sxs-lookup"><span data-stu-id="e9e21-136">Open the solution for the Conditional Get and Put sample.</span></span> <span data-ttu-id="e9e21-137">啟動 [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] 時，您必須以系統管理員身分執行，才能成功執行範例。</span><span class="sxs-lookup"><span data-stu-id="e9e21-137">When launching [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], you must run as an administrator to execute the sample successfully.</span></span> <span data-ttu-id="e9e21-138">執行這項操作，以滑鼠右鍵按一下[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]圖示，然後選擇**系統管理員身分執行**從內容功能表。</span><span class="sxs-lookup"><span data-stu-id="e9e21-138">Do this by right-clicking the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icon and choosing **Run as Administrator** from the context menu.</span></span>  
  
2.  <span data-ttu-id="e9e21-139">按下 CTRL+SHIFT+B 建置方案，然後按下 CTRL+F5 執行主控台應用程式專案。</span><span class="sxs-lookup"><span data-stu-id="e9e21-139">Press CTRL+SHIFT+B to build the solution and then press CTRL+F5 to run the console application project.</span></span> <span data-ttu-id="e9e21-140">如果在執行此專案時啟用偵錯 (按下 F5 而非 CTRL+F5)，則偵錯工具會在條件式 GET 和 PUT 檢查擲回例外狀況時停止。</span><span class="sxs-lookup"><span data-stu-id="e9e21-140">If running this project with debugging enabled (by pressing F5 instead of CTRL+F5), the debugger stops when an exception is thrown by the conditional GET and PUT checking.</span></span> <span data-ttu-id="e9e21-141">發生這個狀況時，按下 F5 可繼續執行範例。</span><span class="sxs-lookup"><span data-stu-id="e9e21-141">When this happens, press F5 to continue executing the sample.</span></span>  
  
3.  <span data-ttu-id="e9e21-142">主控台視窗隨即出現，並提供執行中服務的 URI，以及執行中服務之 HTML 說明頁的 URI。</span><span class="sxs-lookup"><span data-stu-id="e9e21-142">The console window appear sand provides the URI of the running service and the URI of the HTML help page for the running service.</span></span>  
  
4.  <span data-ttu-id="e9e21-143">當範例執行時，用戶端會對服務傳送要求，然後將回應寫入至主控台視窗。</span><span class="sxs-lookup"><span data-stu-id="e9e21-143">As the sample runs, the client sends requests to the service and writes the responses to the console window.</span></span>  
  
5.  <span data-ttu-id="e9e21-144">按下任何按鍵可終止此範例。</span><span class="sxs-lookup"><span data-stu-id="e9e21-144">Press any key to terminate the sample.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="e9e21-145">這些範例可能已安裝在您的電腦上。</span><span class="sxs-lookup"><span data-stu-id="e9e21-145">The samples may already be installed on your machine.</span></span> <span data-ttu-id="e9e21-146">請先檢查下列 (預設) 目錄，然後再繼續。</span><span class="sxs-lookup"><span data-stu-id="e9e21-146">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="e9e21-147">如果此目錄不存在，請移至 [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4  (適用於 .NET Framework 4 的 Windows Communication Foundation (WCF) 與 Windows Workflow Foundation (WF) 範例)](http://go.microsoft.com/fwlink/?LinkId=150780) ，以下載所有 [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] 和 [!INCLUDE[wf1](../../../../includes/wf1-md.md)] 範例。</span><span class="sxs-lookup"><span data-stu-id="e9e21-147">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="e9e21-148">此範例位於下列目錄。</span><span class="sxs-lookup"><span data-stu-id="e9e21-148">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Web\ConditionalGetAndPut`
