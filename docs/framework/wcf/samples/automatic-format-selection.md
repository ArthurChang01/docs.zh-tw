---
title: 自動格式選取
ms.date: 03/30/2017
ms.assetid: dab51e56-8517-4a6a-bb54-b55b15ab37bb
ms.openlocfilehash: 4fd695195f5c7c13bc088248a6b3c12388328d37
ms.sourcegitcommit: 2eceb05f1a5bb261291a1f6a91c5153727ac1c19
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/04/2018
ms.locfileid: "43659757"
---
# <a name="automatic-format-selection"></a><span data-ttu-id="79a08-102">自動格式選取</span><span class="sxs-lookup"><span data-stu-id="79a08-102">Automatic Format Selection</span></span>
<span data-ttu-id="79a08-103">此範例會示範如何啟用自動格式選取 （XML 或 JSON） 使用的 Windows Communication Foundation (WCF) REST 程式設計模型，以及如何明確設定作業碼中的格式。</span><span class="sxs-lookup"><span data-stu-id="79a08-103">This sample demonstrates how to enable automatic format selection (XML or JSON) with the Windows Communication Foundation (WCF) REST programming model, as well as how to explicitly set the format in the operation code.</span></span>  
  
## <a name="sample-details"></a><span data-ttu-id="79a08-104">範例詳細資料</span><span class="sxs-lookup"><span data-stu-id="79a08-104">Sample Details</span></span>  
 <span data-ttu-id="79a08-105">這個範例包含服務，以及可對服務發出要求的用戶端程式碼。</span><span class="sxs-lookup"><span data-stu-id="79a08-105">The sample consists of a service along with client code that makes requests to the service.</span></span> <span data-ttu-id="79a08-106">服務支援單一 HTTP `GET` 作業 (`EchoWithGet`) 以及單一 HTTP `POST` 作業 (`EchoWithPost`)。</span><span class="sxs-lookup"><span data-stu-id="79a08-106">The service supports a single HTTP `GET` operation (`EchoWithGet`) and a single HTTP `POST` operation (`EchoWithPost`).</span></span> <span data-ttu-id="79a08-107">這兩種作業都需要字串，然後會在回應中傳回字串。</span><span class="sxs-lookup"><span data-stu-id="79a08-107">Both operations expect a string and then return the string in the response.</span></span> <span data-ttu-id="79a08-108">在 `GET` 作業中，字串會在 URI 查詢字串參數中提供。</span><span class="sxs-lookup"><span data-stu-id="79a08-108">With the `GET` operation, the string is provided in a URI query-string parameter.</span></span> <span data-ttu-id="79a08-109">而在 `POST` 作業中，字串會在以 XML 序列化的要求主體中提供。</span><span class="sxs-lookup"><span data-stu-id="79a08-109">With the `POST` operation, the string is provided in the body of the request, serialized in XML.</span></span> <span data-ttu-id="79a08-110">服務能夠以 XML 或 JSON 傳回回應，並且利用 [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)] 中新的自動格式選取和命令式格式選取功能。</span><span class="sxs-lookup"><span data-stu-id="79a08-110">The service is able to return responses in either XML or JSON, utilizing the new automatic format selection and imperative format selection features in [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].</span></span>  
  
 <span data-ttu-id="79a08-111">在這個範例中，自動格式選取是使用 App.config 檔啟用。</span><span class="sxs-lookup"><span data-stu-id="79a08-111">In the sample, automatic format selection is enabled using the App.config file.</span></span> <span data-ttu-id="79a08-112">在預設的 Web HTTP 端點上，`automaticFormatSelectionEnabled` 屬性已有 `true` 值。</span><span class="sxs-lookup"><span data-stu-id="79a08-112">On the default Web HTTP endpoint, the `automaticFormatSelectionEnabled` attribute has been given a value of `true`.</span></span> <span data-ttu-id="79a08-113">啟用自動格式選取，WCF 基礎結構會選取最適合的回應格式 （XML 或 JSON） 指定的要求 HTTP Accept 或 Content-type 標頭。</span><span class="sxs-lookup"><span data-stu-id="79a08-113">With automatic format selection enabled, the WCF infrastructure selects the most appropriate response format (XML or JSON) given the HTTP Accept or Content-Type headers of the request.</span></span> <span data-ttu-id="79a08-114">開發人員除了將 `automaticFormatSelectionEnabled` 屬性設定為 `true` 以使用這個新功能之外，不需要提供任何額外的程式碼或組態。</span><span class="sxs-lookup"><span data-stu-id="79a08-114">The developer is not required to provide any additional code or configuration other than setting the `automaticFormatSelectionEnabled` attribute to `true` to use this new feature.</span></span> <span data-ttu-id="79a08-115">在 Program.cs 中用戶端程式碼中，要求會傳送兩個`GET`和`POST`HTTP Accept 標頭指定為"application/xml"或"application/json"的服務和服務作業傳回的回應個別的格式。</span><span class="sxs-lookup"><span data-stu-id="79a08-115">In the client code in Program.cs, requests are sent to both the `GET` and `POST` operations of the service with the HTTP Accept header specified as either "application/xml" or "application/json" and the service returns a response in that respective format.</span></span>  
  
 <span data-ttu-id="79a08-116">在 `GET` 作業中同樣會使用命令式格式選取。</span><span class="sxs-lookup"><span data-stu-id="79a08-116">Also in the `GET` operation, imperative format selection is used.</span></span> <span data-ttu-id="79a08-117">`GET` 作業會檢查選擇性的 `format` 查詢字串參數，如果該參數存在，則會設定 <xref:System.ServiceModel.Web.WebOperationContext.OutgoingResponse%2A> 屬性上的回應格式。</span><span class="sxs-lookup"><span data-stu-id="79a08-117">The `GET` operation checks for an optional `format` query-string parameter and if present, sets the response format on the <xref:System.ServiceModel.Web.WebOperationContext.OutgoingResponse%2A> property.</span></span> <span data-ttu-id="79a08-118">以命令方式設定回應格式，如此一來，就會覆寫由 WCF 基礎結構自動格式化選取範圍。</span><span class="sxs-lookup"><span data-stu-id="79a08-118">Imperatively setting the response format in this way overrides the automatic format selection done by the WCF infrastructure.</span></span>  
  
 <span data-ttu-id="79a08-119">此範例包含在主控台應用程式中執行的自我裝載服務和用戶端。</span><span class="sxs-lookup"><span data-stu-id="79a08-119">The sample consists of a self-hosted service and a client that runs within a console application.</span></span> <span data-ttu-id="79a08-120">當主控台應用程式執行時，用戶端會對服務發出要求，然後將相關的資訊從回應寫入至主控台視窗。</span><span class="sxs-lookup"><span data-stu-id="79a08-120">As the console application runs, the client makes requests to the service and writes the pertinent information from the responses to the console window.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="79a08-121">若要使用這個範例</span><span class="sxs-lookup"><span data-stu-id="79a08-121">To use this sample</span></span>  
  
1.  <span data-ttu-id="79a08-122">開啟「自動格式選取範例」的方案。</span><span class="sxs-lookup"><span data-stu-id="79a08-122">Open the solution for the Automatic Format Selection Sample.</span></span> <span data-ttu-id="79a08-123">啟動 [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] 時，您必須以系統管理員身分執行，才能讓範例成功執行。</span><span class="sxs-lookup"><span data-stu-id="79a08-123">When launching [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], you must run as an administrator for the sample to execute successfully.</span></span> <span data-ttu-id="79a08-124">執行這項操作，以滑鼠右鍵按一下[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]圖示，然後選取**系統管理員身分執行**從內容功能表。</span><span class="sxs-lookup"><span data-stu-id="79a08-124">Do this by right-clicking the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icon and select **Run as Administrator** from the context menu.</span></span>  
  
2.  <span data-ttu-id="79a08-125">按下 CTRL+SHIFT+B 建置方案，然後按下 Ctrl+F5 執行主控台應用程式 AutomaticFormatSelection 專案。</span><span class="sxs-lookup"><span data-stu-id="79a08-125">Press CTRL+SHIFT+B to build the solution and then press Ctrl+F5 to run the console application AutomaticFormatSelection project.</span></span> <span data-ttu-id="79a08-126">主控台視窗隨即出現，並提供執行中服務的 URI，以及執行中服務之 HTML 說明頁的 URI。</span><span class="sxs-lookup"><span data-stu-id="79a08-126">The console window appears and provides the URI of the running service and the URI of the HTML help page for the running service.</span></span>  
  
3.  <span data-ttu-id="79a08-127">當範例執行時，用戶端會對服務傳送要求，然後將回應寫入至主控台視窗。</span><span class="sxs-lookup"><span data-stu-id="79a08-127">As the sample runs, the client sends requests to the service and writes the responses to the console window.</span></span> <span data-ttu-id="79a08-128">請注意 XML 和 JSON 兩種不同格式的回應。</span><span class="sxs-lookup"><span data-stu-id="79a08-128">Notice the different formats of the responses in XML and JSON.</span></span>  
  
4.  <span data-ttu-id="79a08-129">按下任何按鍵可終止此範例。</span><span class="sxs-lookup"><span data-stu-id="79a08-129">Press any key to terminate the sample.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="79a08-130">這些範例可能已安裝在您的電腦上。</span><span class="sxs-lookup"><span data-stu-id="79a08-130">The samples may already be installed on your machine.</span></span> <span data-ttu-id="79a08-131">請先檢查下列 (預設) 目錄，然後再繼續。</span><span class="sxs-lookup"><span data-stu-id="79a08-131">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="79a08-132">如果此目錄不存在，請移至[Windows Communication Foundation (WCF) 和.NET Framework 4 的 Windows Workflow Foundation (WF) 範例](https://go.microsoft.com/fwlink/?LinkId=150780)以下載所有 Windows Communication Foundation (WCF) 和[!INCLUDE[wf1](../../../../includes/wf1-md.md)]範例。</span><span class="sxs-lookup"><span data-stu-id="79a08-132">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="79a08-133">此範例位於下列目錄。</span><span class="sxs-lookup"><span data-stu-id="79a08-133">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Web\AutomaticFormatSelection`  
  
## <a name="see-also"></a><span data-ttu-id="79a08-134">另請參閱</span><span class="sxs-lookup"><span data-stu-id="79a08-134">See Also</span></span>
