---
title: 使用平台叫用封送處理資料
ms.date: 07/31/2018
dev_langs:
- cpp
helpviewer_keywords:
- platform invoke, marshaling data
- data marshaling, platform invoke
- marshaling, platform invoke
ms.assetid: dc5c76cf-7b12-406f-b79c-d1a023ec245d
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 0501bb2b67c6bbe23c46dc350aedea7d7be09ba1
ms.sourcegitcommit: 412bbc2e43c3b6ca25b358cdf394be97336f0c24
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/24/2018
ms.locfileid: "42911727"
---
# <a name="marshaling-data-with-platform-invoke"></a><span data-ttu-id="d3d28-102">使用平台叫用封送處理資料</span><span class="sxs-lookup"><span data-stu-id="d3d28-102">Marshaling Data with Platform Invoke</span></span>
<span data-ttu-id="d3d28-103">若要呼叫從 Unmanaged 程式庫匯出的函式，.NET Framework 應用程式需要代表此 Unmanaged 函式之 Managed 程式碼中的函式原型。</span><span class="sxs-lookup"><span data-stu-id="d3d28-103">To call functions exported from an unmanaged library, a .NET Framework application requires a function prototype in managed code that represents the unmanaged function.</span></span> <span data-ttu-id="d3d28-104">若要建立使平台叫用正確地封送處理資料的原型，您必須執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="d3d28-104">To create a prototype that enables platform invoke to marshal data correctly, you must do the following:</span></span>  
  
-   <span data-ttu-id="d3d28-105">將 <xref:System.Runtime.InteropServices.DllImportAttribute> 屬性套用至使用 Managed 程式碼的靜態函式或方法。</span><span class="sxs-lookup"><span data-stu-id="d3d28-105">Apply the <xref:System.Runtime.InteropServices.DllImportAttribute> attribute to the static function or method in managed code.</span></span>  
  
-   <span data-ttu-id="d3d28-106">將 Unmanaged 資料類型替代為 Managed 資料類型。</span><span class="sxs-lookup"><span data-stu-id="d3d28-106">Substitute managed data types for unmanaged data types.</span></span>  
  
 <span data-ttu-id="d3d28-107">您可以使用 Unmanaged 函式所提供的文件，以選擇性欄位套用屬性，並且將 Unmanaged 資料類型替代為 Managed 資料類型，來建構對等的 Managed 原型。</span><span class="sxs-lookup"><span data-stu-id="d3d28-107">You can use the documentation supplied with an unmanaged function to construct an equivalent managed prototype by applying the attribute with its optional fields and substituting managed data types for unmanaged types.</span></span> <span data-ttu-id="d3d28-108">如需如何套用 **DllImportAttribute** 的指示，請參閱[使用 Unmanaged DLL 函式](../../../docs/framework/interop/consuming-unmanaged-dll-functions.md)。</span><span class="sxs-lookup"><span data-stu-id="d3d28-108">For instructions about how to apply the **DllImportAttribute**, see [Consuming Unmanaged DLL Functions](../../../docs/framework/interop/consuming-unmanaged-dll-functions.md).</span></span>  
  
 <span data-ttu-id="d3d28-109">本節提供範例，示範如何建立 Managed 函式原型，供傳遞引數至函式和接收 Unmanaged 程式庫所匯出函式的傳回值。</span><span class="sxs-lookup"><span data-stu-id="d3d28-109">This section provides samples that demonstrate how to create managed function prototypes for passing arguments to and receiving return values from functions exported by unmanaged libraries.</span></span> <span data-ttu-id="d3d28-110">此範例也會示範使用 <xref:System.Runtime.InteropServices.MarshalAsAttribute> 屬性和 <xref:System.Runtime.InteropServices.Marshal> 類別來明確封送處理資料的時機。</span><span class="sxs-lookup"><span data-stu-id="d3d28-110">The samples also demonstrate when to use the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute and the <xref:System.Runtime.InteropServices.Marshal> class to explicitly marshal data.</span></span>  
  
## <a name="platform-invoke-data-types"></a><span data-ttu-id="d3d28-111">平台叫用資料類型</span><span class="sxs-lookup"><span data-stu-id="d3d28-111">Platform invoke data types</span></span>  
 <span data-ttu-id="d3d28-112">下表列出 Win32 API (Wtypes.h 中所列) 和 C 樣式函式中所使用的資料類型。</span><span class="sxs-lookup"><span data-stu-id="d3d28-112">The following table lists data types used in the Win32 API (listed in Wtypes.h) and C-style functions.</span></span> <span data-ttu-id="d3d28-113">許多 Unmanaged 程式庫包含傳遞資料類型做為參數和傳回值的函式。</span><span class="sxs-lookup"><span data-stu-id="d3d28-113">Many unmanaged libraries contain functions that pass these data types as parameters and return values.</span></span> <span data-ttu-id="d3d28-114">第三個行列出對應的 .NET Framework 內建實值類型或您在 Managed 程式碼中使用的類別。</span><span class="sxs-lookup"><span data-stu-id="d3d28-114">The third column lists the corresponding .NET Framework built-in value type or class that you use in managed code.</span></span> <span data-ttu-id="d3d28-115">在某些情況下，您可將本表格中所列的類型取代為相同大小的類型。</span><span class="sxs-lookup"><span data-stu-id="d3d28-115">In some cases, you can substitute a type of the same size for the type listed in the table.</span></span>  
  
|<span data-ttu-id="d3d28-116">在 Wtypes.h 中的 Unmanaged 類型</span><span class="sxs-lookup"><span data-stu-id="d3d28-116">Unmanaged type in Wtypes.h</span></span>|<span data-ttu-id="d3d28-117">Unmanaged C 語言類型</span><span class="sxs-lookup"><span data-stu-id="d3d28-117">Unmanaged C language type</span></span>|<span data-ttu-id="d3d28-118">Managed 類別名稱</span><span class="sxs-lookup"><span data-stu-id="d3d28-118">Managed class name</span></span>|<span data-ttu-id="d3d28-119">描述</span><span class="sxs-lookup"><span data-stu-id="d3d28-119">Description</span></span>|  
|--------------------------------|-------------------------------|------------------------|-----------------|  
|<span data-ttu-id="d3d28-120">**VOID**</span><span class="sxs-lookup"><span data-stu-id="d3d28-120">**VOID**</span></span>|<span data-ttu-id="d3d28-121">**void**</span><span class="sxs-lookup"><span data-stu-id="d3d28-121">**void**</span></span>|<xref:System.Void?displayProperty=nameWithType>|<span data-ttu-id="d3d28-122">套用至未傳回值的函式。</span><span class="sxs-lookup"><span data-stu-id="d3d28-122">Applied to a function that does not return a value.</span></span>|
|<span data-ttu-id="d3d28-123">**HANDLE**</span><span class="sxs-lookup"><span data-stu-id="d3d28-123">**HANDLE**</span></span>|<span data-ttu-id="d3d28-124">**void \***</span><span class="sxs-lookup"><span data-stu-id="d3d28-124">**void \***</span></span>|<xref:System.IntPtr?displayProperty=nameWithType>|<span data-ttu-id="d3d28-125">在 32 位元 Windows 作業系統上為 32 位元，在 64 位元 Windows 作業系統上為 64 位元。</span><span class="sxs-lookup"><span data-stu-id="d3d28-125">32 bits on 32-bit Windows operating systems, 64 bits on 64-bit Windows operating systems.</span></span>|  
|<span data-ttu-id="d3d28-126">**BYTE**</span><span class="sxs-lookup"><span data-stu-id="d3d28-126">**BYTE**</span></span>|<span data-ttu-id="d3d28-127">**unsigned char**</span><span class="sxs-lookup"><span data-stu-id="d3d28-127">**unsigned char**</span></span>|<xref:System.Byte?displayProperty=nameWithType>|<span data-ttu-id="d3d28-128">8 位元</span><span class="sxs-lookup"><span data-stu-id="d3d28-128">8 bits</span></span>|  
|<span data-ttu-id="d3d28-129">**SHORT**</span><span class="sxs-lookup"><span data-stu-id="d3d28-129">**SHORT**</span></span>|<span data-ttu-id="d3d28-130">**short**</span><span class="sxs-lookup"><span data-stu-id="d3d28-130">**short**</span></span>|<xref:System.Int16?displayProperty=nameWithType>|<span data-ttu-id="d3d28-131">16 位元</span><span class="sxs-lookup"><span data-stu-id="d3d28-131">16 bits</span></span>|  
|<span data-ttu-id="d3d28-132">**WORD**</span><span class="sxs-lookup"><span data-stu-id="d3d28-132">**WORD**</span></span>|<span data-ttu-id="d3d28-133">**unsigned short**</span><span class="sxs-lookup"><span data-stu-id="d3d28-133">**unsigned short**</span></span>|<xref:System.UInt16?displayProperty=nameWithType>|<span data-ttu-id="d3d28-134">16 位元</span><span class="sxs-lookup"><span data-stu-id="d3d28-134">16 bits</span></span>|  
|<span data-ttu-id="d3d28-135">**INT**</span><span class="sxs-lookup"><span data-stu-id="d3d28-135">**INT**</span></span>|<span data-ttu-id="d3d28-136">**int**</span><span class="sxs-lookup"><span data-stu-id="d3d28-136">**int**</span></span>|<xref:System.Int32?displayProperty=nameWithType>|<span data-ttu-id="d3d28-137">32 位元</span><span class="sxs-lookup"><span data-stu-id="d3d28-137">32 bits</span></span>|  
|<span data-ttu-id="d3d28-138">**UINT**</span><span class="sxs-lookup"><span data-stu-id="d3d28-138">**UINT**</span></span>|<span data-ttu-id="d3d28-139">**unsigned int**</span><span class="sxs-lookup"><span data-stu-id="d3d28-139">**unsigned int**</span></span>|<xref:System.UInt32?displayProperty=nameWithType>|<span data-ttu-id="d3d28-140">32 位元</span><span class="sxs-lookup"><span data-stu-id="d3d28-140">32 bits</span></span>|  
|<span data-ttu-id="d3d28-141">**LONG**</span><span class="sxs-lookup"><span data-stu-id="d3d28-141">**LONG**</span></span>|<span data-ttu-id="d3d28-142">**long**</span><span class="sxs-lookup"><span data-stu-id="d3d28-142">**long**</span></span>|<xref:System.Int32?displayProperty=nameWithType>|<span data-ttu-id="d3d28-143">32 位元</span><span class="sxs-lookup"><span data-stu-id="d3d28-143">32 bits</span></span>|  
|<span data-ttu-id="d3d28-144">**BOOL**</span><span class="sxs-lookup"><span data-stu-id="d3d28-144">**BOOL**</span></span>|<span data-ttu-id="d3d28-145">**long**</span><span class="sxs-lookup"><span data-stu-id="d3d28-145">**long**</span></span>|<xref:System.Byte>|<span data-ttu-id="d3d28-146">32 位元</span><span class="sxs-lookup"><span data-stu-id="d3d28-146">32 bits</span></span>|  
|<span data-ttu-id="d3d28-147">**DWORD**</span><span class="sxs-lookup"><span data-stu-id="d3d28-147">**DWORD**</span></span>|<span data-ttu-id="d3d28-148">**unsigned long**</span><span class="sxs-lookup"><span data-stu-id="d3d28-148">**unsigned long**</span></span>|<xref:System.UInt32?displayProperty=nameWithType>|<span data-ttu-id="d3d28-149">32 位元</span><span class="sxs-lookup"><span data-stu-id="d3d28-149">32 bits</span></span>|  
|<span data-ttu-id="d3d28-150">**ULONG**</span><span class="sxs-lookup"><span data-stu-id="d3d28-150">**ULONG**</span></span>|<span data-ttu-id="d3d28-151">**unsigned long**</span><span class="sxs-lookup"><span data-stu-id="d3d28-151">**unsigned long**</span></span>|<xref:System.UInt32?displayProperty=nameWithType>|<span data-ttu-id="d3d28-152">32 位元</span><span class="sxs-lookup"><span data-stu-id="d3d28-152">32 bits</span></span>|  
|<span data-ttu-id="d3d28-153">**CHAR**</span><span class="sxs-lookup"><span data-stu-id="d3d28-153">**CHAR**</span></span>|<span data-ttu-id="d3d28-154">**char**</span><span class="sxs-lookup"><span data-stu-id="d3d28-154">**char**</span></span>|<xref:System.Char?displayProperty=nameWithType>|<span data-ttu-id="d3d28-155">使用 ANSI 裝飾。</span><span class="sxs-lookup"><span data-stu-id="d3d28-155">Decorate with ANSI.</span></span>|  
|<span data-ttu-id="d3d28-156">**WCHAR**</span><span class="sxs-lookup"><span data-stu-id="d3d28-156">**WCHAR**</span></span>|<span data-ttu-id="d3d28-157">**wchar_t**</span><span class="sxs-lookup"><span data-stu-id="d3d28-157">**wchar_t**</span></span>|<xref:System.Char?displayProperty=nameWithType>|<span data-ttu-id="d3d28-158">使用 Unicode 裝飾。</span><span class="sxs-lookup"><span data-stu-id="d3d28-158">Decorate with Unicode.</span></span>|  
|<span data-ttu-id="d3d28-159">**LPSTR**</span><span class="sxs-lookup"><span data-stu-id="d3d28-159">**LPSTR**</span></span>|<span data-ttu-id="d3d28-160">**char \***</span><span class="sxs-lookup"><span data-stu-id="d3d28-160">**char \***</span></span>|<span data-ttu-id="d3d28-161"><xref:System.String?displayProperty=nameWithType> 或 <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="d3d28-161"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="d3d28-162">使用 ANSI 裝飾。</span><span class="sxs-lookup"><span data-stu-id="d3d28-162">Decorate with ANSI.</span></span>|  
|<span data-ttu-id="d3d28-163">**LPCSTR**</span><span class="sxs-lookup"><span data-stu-id="d3d28-163">**LPCSTR**</span></span>|<span data-ttu-id="d3d28-164">**Const char\***</span><span class="sxs-lookup"><span data-stu-id="d3d28-164">**Const char\***</span></span>|<span data-ttu-id="d3d28-165"><xref:System.String?displayProperty=nameWithType> 或 <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="d3d28-165"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="d3d28-166">使用 ANSI 裝飾。</span><span class="sxs-lookup"><span data-stu-id="d3d28-166">Decorate with ANSI.</span></span>|  
|<span data-ttu-id="d3d28-167">**LPWSTR**</span><span class="sxs-lookup"><span data-stu-id="d3d28-167">**LPWSTR**</span></span>|<span data-ttu-id="d3d28-168">**wchar_t \***</span><span class="sxs-lookup"><span data-stu-id="d3d28-168">**wchar_t \***</span></span>|<span data-ttu-id="d3d28-169"><xref:System.String?displayProperty=nameWithType> 或 <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="d3d28-169"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="d3d28-170">使用 Unicode 裝飾。</span><span class="sxs-lookup"><span data-stu-id="d3d28-170">Decorate with Unicode.</span></span>|  
|<span data-ttu-id="d3d28-171">**LPCWSTR**</span><span class="sxs-lookup"><span data-stu-id="d3d28-171">**LPCWSTR**</span></span>|<span data-ttu-id="d3d28-172">**Const wchar_t \***</span><span class="sxs-lookup"><span data-stu-id="d3d28-172">**Const wchar_t \***</span></span>|<span data-ttu-id="d3d28-173"><xref:System.String?displayProperty=nameWithType> 或 <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="d3d28-173"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="d3d28-174">使用 Unicode 裝飾。</span><span class="sxs-lookup"><span data-stu-id="d3d28-174">Decorate with Unicode.</span></span>|  
|<span data-ttu-id="d3d28-175">**FLOAT**</span><span class="sxs-lookup"><span data-stu-id="d3d28-175">**FLOAT**</span></span>|<span data-ttu-id="d3d28-176">**Float**</span><span class="sxs-lookup"><span data-stu-id="d3d28-176">**Float**</span></span>|<xref:System.Single?displayProperty=nameWithType>|<span data-ttu-id="d3d28-177">32 位元</span><span class="sxs-lookup"><span data-stu-id="d3d28-177">32 bits</span></span>|  
|<span data-ttu-id="d3d28-178">**DOUBLE**</span><span class="sxs-lookup"><span data-stu-id="d3d28-178">**DOUBLE**</span></span>|<span data-ttu-id="d3d28-179">**Double**</span><span class="sxs-lookup"><span data-stu-id="d3d28-179">**Double**</span></span>|<xref:System.Double?displayProperty=nameWithType>|<span data-ttu-id="d3d28-180">64 位元</span><span class="sxs-lookup"><span data-stu-id="d3d28-180">64 bits</span></span>|  
  
 <span data-ttu-id="d3d28-181">如需 [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)]、C# 和 C++ 中的對應類型，請參閱 [簡介](../../../docs/standard/class-library-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="d3d28-181">For corresponding types in [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)], C#, and C++, see the [Introduction to the .NET Framework Class Library](../../../docs/standard/class-library-overview.md).</span></span>  
  
## <a name="pinvokelibdll"></a><span data-ttu-id="d3d28-182">PinvokeLib.dll</span><span class="sxs-lookup"><span data-stu-id="d3d28-182">PinvokeLib.dll</span></span>  
 <span data-ttu-id="d3d28-183">下列程式碼定義 Pinvoke.dll 所提供的程式庫函式。</span><span class="sxs-lookup"><span data-stu-id="d3d28-183">The following code defines the library functions provided by Pinvoke.dll.</span></span> <span data-ttu-id="d3d28-184">本節所描述的許多範例會呼叫此程式庫。</span><span class="sxs-lookup"><span data-stu-id="d3d28-184">Many samples described in this section call this library.</span></span>  
  
### <a name="example"></a><span data-ttu-id="d3d28-185">範例</span><span class="sxs-lookup"><span data-stu-id="d3d28-185">Example</span></span>  
 [!code-cpp[PInvokeLib#1](../../../samples/snippets/cpp/VS_Snippets_CLR/pinvokelib/cpp/pinvokelib.cpp#1)]  
  
 [!code-cpp[PInvokeLib#2](../../../samples/snippets/cpp/VS_Snippets_CLR/pinvokelib/cpp/pinvokelib.h#2)]
