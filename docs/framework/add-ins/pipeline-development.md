---
title: 管線開發
ms.date: 03/30/2017
helpviewer_keywords:
- add-in pipeline [.NET Framework], segments
- activation path for add-ins [.NET Framework]
- add-in pipeline [.NET Framework], activation path
- communication pipeline for add-ins [.NET Framework]
- add-in pipeline [.NET Framework], about
- add-ins [.NET Framework], pipeline development
ms.assetid: 932788f2-b87d-44cf-82f9-04492a8b2722
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: f981d667f3cbf35ab010ac5bd26a9ecd5c2aae11
ms.sourcegitcommit: 9bd8f213b50f0e1a73e03bd1e840c917fbd6d20a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/26/2018
ms.locfileid: "50135429"
---
# <a name="pipeline-development"></a><span data-ttu-id="6eb1b-102">管線開發</span><span class="sxs-lookup"><span data-stu-id="6eb1b-102">Pipeline Development</span></span>
<span data-ttu-id="6eb1b-103">增益集管線是主應用程式和其增益集必須使用與彼此進行通訊的管線區段的路徑。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-103">The add-in pipeline is the path of pipeline segments that the host application and its add-in must use to communicate with each other.</span></span>  
  
 <span data-ttu-id="6eb1b-104">下圖顯示的通訊管線和其區段。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-104">The following illustration shows the communication pipeline and its segments.</span></span>  
  
 <span data-ttu-id="6eb1b-105">![新增&#45;管線模型中。](../../../docs/framework/add-ins/media/addin1.png "AddIn1")</span><span class="sxs-lookup"><span data-stu-id="6eb1b-105">![Add&#45;in pipeline model.](../../../docs/framework/add-ins/media/addin1.png "AddIn1")</span></span>  
<span data-ttu-id="6eb1b-106">增益集管線</span><span class="sxs-lookup"><span data-stu-id="6eb1b-106">Add-in pipeline</span></span>  
  
 <span data-ttu-id="6eb1b-107">主應用程式是其中一端的管線和增益集是在另一端。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-107">The host application is at one end of the pipeline and the add-in is at the other end.</span></span> <span data-ttu-id="6eb1b-108">從 每一端，且邁向中間，主應用程式和增益集已定義兩者共用的物件模型的檢視的抽象基底類別。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-108">Starting from each end and moving toward the middle, both the host application and the add-in have an abstract base class that defines a view of the object model that they both share.</span></span> <span data-ttu-id="6eb1b-109">這些型別 （類別） 是由增益集檢視管線區段和增益集管線區段的 [主機] 檢視所組成。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-109">These types (classes) make up the add-in view pipeline segment and the host view of the add-in pipeline segment.</span></span> <span data-ttu-id="6eb1b-110">增益集檢視管線區段通常會包含一個以上的抽象類別，但增益集繼承自的類別就所謂的增益集基底。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-110">The add-in view pipeline segment often contains more than one abstract class but the class that the add-in inherits from is known as the add-in base.</span></span>  
  
 <span data-ttu-id="6eb1b-111">增益集端配接器管線區段，主應用程式端配接器管線區段轉換的型別，其檢視管線區段與合約管線區段之間的流程。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-111">The add-in-side adapter pipeline segment and the host-side adapter pipeline segment convert the flow of types between their view pipeline segments and the contract pipeline segment.</span></span> <span data-ttu-id="6eb1b-112">管線的中央區段是衍生自合約<xref:System.AddIn.Contract.IContract>介面。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-112">The central segment of the pipeline is a contract that is derived from the <xref:System.AddIn.Contract.IContract> interface.</span></span> <span data-ttu-id="6eb1b-113">此合約會定義主應用程式和其增益集都會使用的方法。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-113">This contract defines the methods that the host application and its add-in will both use.</span></span>  
  
 <span data-ttu-id="6eb1b-114">如果您將主機和增益集載入不同的應用程式定義域，您會有隔離界限分隔範圍從增益集主應用程式的範圍。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-114">If you load the host and the add-in into separate application domains, you have an isolation boundary that separates the scope of the host application from the scope of the add-in.</span></span> <span data-ttu-id="6eb1b-115">合約是只在主機和增益集應用程式定義域中載入的組件。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-115">The contract is the only assembly that is loaded in both the host and add-in application domains.</span></span> <span data-ttu-id="6eb1b-116">主機和增益集在每個只能參考其檢視的合約方法。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-116">The host and the add-in each refer only to their view of the contract methods.</span></span> <span data-ttu-id="6eb1b-117">因此，會以從合約的抽象層分隔。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-117">Therefore, they are separated by a layer of abstraction from the contract.</span></span>  
  
 <span data-ttu-id="6eb1b-118">若要開發管線區段，您必須建立將包含的目錄結構。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-118">To develop pipeline segments, you must create a directory structure that will contain them.</span></span> <span data-ttu-id="6eb1b-119">如需有關開發需求和範圍的指導方針的詳細資訊，請參閱[管線開發需求](https://msdn.microsoft.com/library/ef9fa986-e80b-43e1-868b-247f4c1d9da5)。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-119">For more information about development requirements and scope guidelines, see [Pipeline Development Requirements](https://msdn.microsoft.com/library/ef9fa986-e80b-43e1-868b-247f4c1d9da5).</span></span>  
  
 <span data-ttu-id="6eb1b-120">下圖顯示管線區段所組成的類型。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-120">The following illustration shows the types that make up the pipeline segments.</span></span> <span data-ttu-id="6eb1b-121">在圖例中顯示的型別名稱是任意的但主機和主機以外的所有類型都檢視的增益集需要的屬性，所以建構資訊儲存庫的方法可以找到它們。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-121">The names of the types shown in the illustration are arbitrary, but all types except for the host and the host view of the add-in require attributes so they can be discovered by methods that construct an information store.</span></span>  
  
 <span data-ttu-id="6eb1b-122">![新增&#45;中具有所需屬性類型的模型。](../../../docs/framework/add-ins/media/addin-model.png "AddIn_Model")</span><span class="sxs-lookup"><span data-stu-id="6eb1b-122">![Add&#45;in model with required attributes on types.](../../../docs/framework/add-ins/media/addin-model.png "AddIn_Model")</span></span>  
<span data-ttu-id="6eb1b-123">具有類型的增益集管線</span><span class="sxs-lookup"><span data-stu-id="6eb1b-123">Add-in pipeline with types</span></span>  
  
 <span data-ttu-id="6eb1b-124">下表描述用來啟用增益集管線區段。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-124">The following table describes the pipeline segments for activating an add-in.</span></span> <span data-ttu-id="6eb1b-125">如需有關這些區段的詳細資訊，請參閱 <<c0> [ 合約、 檢視和配接器](https://msdn.microsoft.com/library/a6460173-9507-4b87-8c07-d4ee245d715c)。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-125">For more information about these segments, see [Contracts, Views, and Adapters](https://msdn.microsoft.com/library/a6460173-9507-4b87-8c07-d4ee245d715c).</span></span>  
  
|<span data-ttu-id="6eb1b-126">管線區段</span><span class="sxs-lookup"><span data-stu-id="6eb1b-126">Pipeline segment</span></span>|<span data-ttu-id="6eb1b-127">描述</span><span class="sxs-lookup"><span data-stu-id="6eb1b-127">Description</span></span>|  
|----------------------|-----------------|  
|<span data-ttu-id="6eb1b-128">主機</span><span class="sxs-lookup"><span data-stu-id="6eb1b-128">Host</span></span>|<span data-ttu-id="6eb1b-129">建立增益集的執行個體的應用程式組件。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-129">The application assembly that creates an instance of an add-in.</span></span>|  
|<span data-ttu-id="6eb1b-130">增益集主應用程式檢視</span><span class="sxs-lookup"><span data-stu-id="6eb1b-130">Host view of the add-in</span></span>|<span data-ttu-id="6eb1b-131">表示物件型別和方法用來與增益集通訊的主應用程式的檢視。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-131">Represents the host application's view of the object types and methods used to communicate with the add-in.</span></span> <span data-ttu-id="6eb1b-132">[主機] 檢視是一個抽象基底類別或介面。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-132">The host view is an abstract base class or interface.</span></span>|  
|<span data-ttu-id="6eb1b-133">主應用程式端配接器</span><span class="sxs-lookup"><span data-stu-id="6eb1b-133">Host-side adapter</span></span>|<span data-ttu-id="6eb1b-134">調整與合約的方法具有一個或多個類別的組件。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-134">An assembly with one or more classes that adapts methods to and from the contract.</span></span><br /><br /> <span data-ttu-id="6eb1b-135">此管線區段由使用<xref:System.AddIn.Pipeline.HostAdapterAttribute>屬性。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-135">This pipeline segment is identified by using the <xref:System.AddIn.Pipeline.HostAdapterAttribute> attribute.</span></span><br /><br /> <span data-ttu-id="6eb1b-136">不支援多模組組件。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-136">Multi-module assemblies are not supported.</span></span>|  
|<span data-ttu-id="6eb1b-137">合約</span><span class="sxs-lookup"><span data-stu-id="6eb1b-137">Contract</span></span>|<span data-ttu-id="6eb1b-138">衍生自介面<xref:System.AddIn.Contract.IContract>介面以及定義的通訊協定進行通訊的主機和其增益集之間的類型。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-138">An interface that is derived from the <xref:System.AddIn.Contract.IContract> interface and that defines the protocol for communicating types between the host and its add-in.</span></span><br /><br /> <span data-ttu-id="6eb1b-139">此管線區段由設定<xref:System.AddIn.Pipeline.AddInContractAttribute>屬性。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-139">This pipeline segment is identified by setting the <xref:System.AddIn.Pipeline.AddInContractAttribute> attribute.</span></span>|  
|<span data-ttu-id="6eb1b-140">增益集端配接器</span><span class="sxs-lookup"><span data-stu-id="6eb1b-140">Add-in-side adapter</span></span>|<span data-ttu-id="6eb1b-141">調整與合約的方法具有一個或多個類別的組件。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-141">An assembly with one or more classes that adapts methods to and from the contract.</span></span><br /><br /> <span data-ttu-id="6eb1b-142">此管線區段由使用<xref:System.AddIn.Pipeline.AddInAdapterAttribute>屬性。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-142">This pipeline segment is identified by using the <xref:System.AddIn.Pipeline.AddInAdapterAttribute> attribute.</span></span><br /><br /> <span data-ttu-id="6eb1b-143">包含具有類型的增益集端配接器目錄中的每個組件<xref:System.AddIn.Pipeline.AddInAdapterAttribute>屬性載入增益集的應用程式定義域。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-143">Each assembly in the add-in-side adapter directory that contains a type that has an <xref:System.AddIn.Pipeline.AddInAdapterAttribute> attribute is loaded into the add-in's application domain.</span></span><br /><br /> <span data-ttu-id="6eb1b-144">在自己的應用程式定義域中，會載入增益集端目錄中的每個組件。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-144">Each assembly in the add-in-side directory is loaded in its own application domain.</span></span><br /><br /> <span data-ttu-id="6eb1b-145">不支援多模組組件</span><span class="sxs-lookup"><span data-stu-id="6eb1b-145">Multi-module assemblies are not supported</span></span>|  
|<span data-ttu-id="6eb1b-146">增益集檢視</span><span class="sxs-lookup"><span data-stu-id="6eb1b-146">Add-in view</span></span>|<span data-ttu-id="6eb1b-147">組件，表示增益集檢視的物件類型和方法，用來與主機通訊。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-147">An assembly that represents the add-in's view of the object types and methods that are used to communicate with the host.</span></span> <span data-ttu-id="6eb1b-148">增益集檢視是一個抽象基底類別或介面。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-148">The add-in view is an abstract base class or interface.</span></span><br /><br /> <span data-ttu-id="6eb1b-149">此管線區段由使用<xref:System.AddIn.Pipeline.AddInBaseAttribute>屬性。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-149">This pipeline segment is identified by using the <xref:System.AddIn.Pipeline.AddInBaseAttribute> attribute.</span></span><br /><br /> <span data-ttu-id="6eb1b-150">在包含的類型具有 AddInViews 目錄中的每個組件<xref:System.AddIn.Pipeline.AddInBaseAttribute>屬性載入增益集的應用程式定義域。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-150">Each assembly in the AddInViews directory that contains a type that has an <xref:System.AddIn.Pipeline.AddInBaseAttribute> attribute is loaded into the add-in's application domain.</span></span>|  
|<span data-ttu-id="6eb1b-151">增益集</span><span class="sxs-lookup"><span data-stu-id="6eb1b-151">Add-in</span></span>|<span data-ttu-id="6eb1b-152">會執行的服務，主應用程式具現化的類型。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-152">An instantiated type that performs a service for the host.</span></span>|  
  
## <a name="pipeline-activation-path"></a><span data-ttu-id="6eb1b-153">管線啟動路徑</span><span class="sxs-lookup"><span data-stu-id="6eb1b-153">Pipeline Activation Path</span></span>  
 <span data-ttu-id="6eb1b-154">啟動增益集時下, 圖顯示的啟動類型。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-154">The following illustration shows the activation of types when an add-in is activated.</span></span> <span data-ttu-id="6eb1b-155">它也會顯示物件的傳遞至主機，例如計算或物件的集合的結果。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-155">It also shows the passing of objects to the host, such as the results of a calculation or a collection of objects.</span></span> <span data-ttu-id="6eb1b-156">這是最常見的案例。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-156">This is the most typical scenario.</span></span>  
  
 <span data-ttu-id="6eb1b-157">![新增&#45;具有啟動路徑的模型中。](../../../docs/framework/add-ins/media/addin6.png "AddIn6")</span><span class="sxs-lookup"><span data-stu-id="6eb1b-157">![Add&#45;in model with activation path.](../../../docs/framework/add-ins/media/addin6.png "AddIn6")</span></span>  
<span data-ttu-id="6eb1b-158">從增益集主應用程式的啟動路徑</span><span class="sxs-lookup"><span data-stu-id="6eb1b-158">Activation path from the add-in to the host</span></span>  
  
 <span data-ttu-id="6eb1b-159">管線的啟動路徑會如下所示：</span><span class="sxs-lookup"><span data-stu-id="6eb1b-159">The activation path of the pipeline occurs as follows:</span></span>  
  
1.  <span data-ttu-id="6eb1b-160">主應用程式會啟動增益集與<xref:System.AddIn.Hosting.AddInToken.Activate%2A>方法。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-160">The host application activates the add-in with the <xref:System.AddIn.Hosting.AddInToken.Activate%2A> method.</span></span>  
  
2.  <span data-ttu-id="6eb1b-161">增益集、 增益集檢視、 增益集端配接器，以及合約組件會載入增益集的應用程式定義域。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-161">The add-in, add-in view, add-in-side adapter, and the contract assemblies are loaded into the add-in's application domain.</span></span>  
  
3.  <span data-ttu-id="6eb1b-162">使用增益集檢視來建立增益集端配接器執行個體 (所識別的類別與<xref:System.AddIn.Pipeline.AddInBaseAttribute>屬性) 作為其建構函式。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-162">An instance of the add-in-side adapter is created using the add-in view (with the class identified by the <xref:System.AddIn.Pipeline.AddInBaseAttribute> attribute) as its constructor.</span></span> <span data-ttu-id="6eb1b-163">增益集端配接器會從合約繼承。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-163">The add-in-side adapter inherits from the contract.</span></span>  
  
4.  <span data-ttu-id="6eb1b-164">增益集端配接器，其為合約型別之間 （選擇性） 的隔離界限傳遞至主應用程式端配接器的建構函式。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-164">The add-in-side adapter, which is typed as the contract, is passed across the (optional) isolation boundary to the host-side adapter's constructor.</span></span>  
  
5.  <span data-ttu-id="6eb1b-165">主應用程式檢視的增益集，主應用程式端配接器，並將合約組件載入主機的應用程式定義域。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-165">The host view of the add-in, host-side adapter, and the contract assemblies are loaded into the host's application domain.</span></span>  
  
6.  <span data-ttu-id="6eb1b-166">建立主應用程式端配接器執行個體作為其建構函式中使用合約。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-166">An instance of the host-side adapter is created using the contract as its constructor.</span></span> <span data-ttu-id="6eb1b-167">主應用程式端配接器是由增益集的 [主機] 檢視所繼承。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-167">The host-side adapter inherits from the host view of the add-in.</span></span>  
  
7.  <span data-ttu-id="6eb1b-168">主機有增益集，它主機檢視的增益集，以及可以繼續呼叫其方法型別。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-168">The host has the add-in, which is typed as the host view of the add-in, and can continue calling its methods.</span></span>  
  
## <a name="walkthroughs"></a><span data-ttu-id="6eb1b-169">逐步解說</span><span class="sxs-lookup"><span data-stu-id="6eb1b-169">Walkthroughs</span></span>  
 <span data-ttu-id="6eb1b-170">有三個逐步解說主題描述如何使用 Visual Studio 來建立管線：</span><span class="sxs-lookup"><span data-stu-id="6eb1b-170">There are three walkthrough topics that describe how to create pipelines using Visual Studio:</span></span>  
  
-   [<span data-ttu-id="6eb1b-171">逐步解說：建立可延伸應用程式</span><span class="sxs-lookup"><span data-stu-id="6eb1b-171">Walkthrough: Creating an Extensible Application</span></span>](../../../docs/framework/add-ins/walkthrough-create-extensible-app.md)  
  
     <span data-ttu-id="6eb1b-172">描述主機執行加法、 減法、 乘法和除法計算的計算機增益集。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-172">Describes a calculator add-in that performs addition, subtraction, multiplication, and division calculations for the host.</span></span>  
  
-   [<span data-ttu-id="6eb1b-173">逐步解說： 啟用主應用程式變更的回溯相容性</span><span class="sxs-lookup"><span data-stu-id="6eb1b-173">Walkthrough: Enabling Backward Compatibility as Your Host Changes</span></span>](https://msdn.microsoft.com/library/6fa15bb5-8f04-407d-bd7d-675dc043c848)  
  
     <span data-ttu-id="6eb1b-174">描述計算機增益集與增強的計算功能，以及如何維護與第一個計算機增益集的相容性。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-174">Describes a calculator add-in with enhanced calculation capabilities, and how to maintain compatibility with the first calculator add-in.</span></span>  
  
-   [<span data-ttu-id="6eb1b-175">主機和增益集之間的逐步解說： 將集合</span><span class="sxs-lookup"><span data-stu-id="6eb1b-175">Walkthrough: Passing Collections Between Hosts and Add-Ins</span></span>](https://msdn.microsoft.com/library/b532c604-548e-4fab-b11c-377257dd0ee5)  
  
     <span data-ttu-id="6eb1b-176">描述如何透過使用案例的管線傳遞資料集合。</span><span class="sxs-lookup"><span data-stu-id="6eb1b-176">Describes how to pass data collections over the pipeline using a book store scenario.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6eb1b-177">另請參閱</span><span class="sxs-lookup"><span data-stu-id="6eb1b-177">See Also</span></span>  
- [<span data-ttu-id="6eb1b-178">增益集管線案例</span><span class="sxs-lookup"><span data-stu-id="6eb1b-178">Add-in Pipeline Scenarios</span></span>](https://msdn.microsoft.com/library/feb70e0b-8734-494c-aeaf-b567f014043e)  
- [<span data-ttu-id="6eb1b-179">增益集和擴充性</span><span class="sxs-lookup"><span data-stu-id="6eb1b-179">Add-ins and Extensibility</span></span>](../../../docs/framework/add-ins/index.md)
