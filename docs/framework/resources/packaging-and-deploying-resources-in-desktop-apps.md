---
title: "在桌面應用程式中封裝和部署資源"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology:
- dotnet-bcl
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- deploying applications [.NET Framework], resources
- resource files, deploying
- hub-and-spoke resource deployment model
- resource files, packaging
- application resources, packaging
- single resource assembly
- satellite assemblies
- default culture for applications
- names [.NET Framework], resources
- fallback process for resources
- grouping cultures
- application resources, deploying
- application resources, naming conventions
- culture, packaging and deploying resources
- resource files, naming conventions
- packaging application resources
- application resources, fallback processes
- resource files, fallback processes
- localizing resources
- neutral cultures
ms.assetid: b224d7c0-35f8-4e82-a705-dd76795e8d16
caps.latest.revision: 
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: 3ab23b263d572a5573de5fc21f15b56e784a9a94
ms.sourcegitcommit: 96cc82cac4650adfb65ba351506d8a8fbcd17b5c
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/19/2018
---
# <a name="packaging-and-deploying-resources-in-desktop-apps"></a><span data-ttu-id="4ebb5-102">在桌面應用程式中封裝和部署資源</span><span class="sxs-lookup"><span data-stu-id="4ebb5-102">Packaging and Deploying Resources in Desktop Apps</span></span>
<span data-ttu-id="4ebb5-103">應用程式會依賴 <xref:System.Resources.ResourceManager> 類別所代表的 .NET Framework Resource Manager，來擷取當地語系化的資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-103">Applications rely on the .NET Framework Resource Manager, represented by the <xref:System.Resources.ResourceManager> class, to retrieve localized resources.</span></span> <span data-ttu-id="4ebb5-104">Resource Manager 假設使用中樞和支點模型來封裝和部署資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-104">The Resource Manager assumes that a hub and spoke model is used to package and deploy resources.</span></span> <span data-ttu-id="4ebb5-105">中樞是主要組件，其中包含未當地語系化的可執行程式碼以及稱為中性或預設文化特性之單一文化特性的資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-105">The hub is the main assembly that contains the nonlocalizable executable code and the resources for a single culture, called the neutral or default culture.</span></span> <span data-ttu-id="4ebb5-106">預設文化特性是應用程式的後援文化特性；如果找不到當地語系化的資源，則它是使用其資源的文化特性。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-106">The default culture is the fallback culture for the application; it is the culture whose resources are used if localized resources cannot be found.</span></span> <span data-ttu-id="4ebb5-107">每個支點都會連線至附屬組件，其中包含單一文化特性但未包含任何程式碼的資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-107">Each spoke connects to a satellite assembly that contains the resources for a single culture, but does not contain any code.</span></span>  
  
 <span data-ttu-id="4ebb5-108">這個模型有數個優點：</span><span class="sxs-lookup"><span data-stu-id="4ebb5-108">There are several advantages to this model:</span></span>  
  
-   <span data-ttu-id="4ebb5-109">在您部署應用程式之後，可以透過累加方式新增新文化特性的資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-109">You can incrementally add resources for new cultures after you have deployed an application.</span></span> <span data-ttu-id="4ebb5-110">因為文化特性特定資源的後續開發可能需要很長一段時間，所以這可讓您先發行主要應用程式，並於日後提供文化特性特定資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-110">Because subsequent development of culture-specific resources can require a significant amount of time, this allows you to release your main application first, and deliver culture-specific resources at a later date.</span></span>  
  
-   <span data-ttu-id="4ebb5-111">您可以更新並變更應用程式的附屬組件，而不需要重新編譯應用程式。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-111">You can update and change an application's satellite assemblies without recompiling the application.</span></span>  
  
-   <span data-ttu-id="4ebb5-112">應用程式只需要載入包含特定文化特性所需之資源的附屬組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-112">An application needs to load only those satellite assemblies that contain the resources needed for a particular culture.</span></span> <span data-ttu-id="4ebb5-113">這可以大幅降低系統資源的使用。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-113">This can significantly reduce the use of system resources.</span></span>  
  
 <span data-ttu-id="4ebb5-114">不過，這個模型也有缺點：</span><span class="sxs-lookup"><span data-stu-id="4ebb5-114">However, there are also disadvantages to this model:</span></span>  
  
-   <span data-ttu-id="4ebb5-115">您必須管理多組資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-115">You must manage multiple sets of resources.</span></span>  
  
-   <span data-ttu-id="4ebb5-116">因為您必須測試數個組態，所以測試應用程式的初始成本會增加。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-116">The initial cost of testing an application increases, because you must test several configurations.</span></span> <span data-ttu-id="4ebb5-117">請注意，長期而言，測試一個具有數個附屬的核心應用程式，與測試並維護數個平行國際版本相較之下，較為簡單且費用較少。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-117">Note that in the long term it will be easier and less expensive to test one core application with several satellites, than to test and maintain several parallel international versions.</span></span>  
  
## <a name="resource-naming-conventions"></a><span data-ttu-id="4ebb5-118">資源命名慣例</span><span class="sxs-lookup"><span data-stu-id="4ebb5-118">Resource Naming Conventions</span></span>  
 <span data-ttu-id="4ebb5-119">當您封裝應用程式的資源時，必須使用 Common Language Runtime 所預期的資源命名慣例來命名它們。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-119">When you package your application's resources, you must name them using the resource naming conventions that the common language runtime expects.</span></span> <span data-ttu-id="4ebb5-120">執行階段會依文化特性名稱識別資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-120">The runtime identifies a resource by its culture name.</span></span> <span data-ttu-id="4ebb5-121">每個文化特性都會獲指定唯一名稱，此名稱通常是下列項目的組合：與語言建立關聯的兩個字母小寫文化特性名稱以及與國家或地區建立關聯的兩個字母大寫子文化特性名稱 (必要時)。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-121">Each culture is given a unique name, which is usually a combination of a two-letter, lowercase culture name associated with a language and, if required, a two-letter, uppercase subculture name associated with a country or region.</span></span> <span data-ttu-id="4ebb5-122">子文化特性名稱遵循文化特性名稱，以破折號 (-) 分隔。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-122">The subculture name follows the culture name, separated by a dash (-).</span></span> <span data-ttu-id="4ebb5-123">範例包括 ja-JP (代表在日本日文)、en-US (美式英文)、de-DE (德國德文)，或 de-AT (奧地利德文)。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-123">Examples include ja-JP for Japanese as spoken in Japan, en-US for English as spoken in the United States, de-DE for German as spoken in Germany, or de-AT for German as spoken in Austria.</span></span> <span data-ttu-id="4ebb5-124">如需文化特性名稱的完整清單，請參閱全球化開發人員中心上的[國家語言支援 (NLS) API 參考](http://go.microsoft.com/fwlink/?LinkId=200048)。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-124">See the [National Language Support (NLS) API Reference](http://go.microsoft.com/fwlink/?LinkId=200048) at the Go Global Developer Center for a complete list of culture names.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4ebb5-125">如需建立資源檔的資訊，請參閱[建立資源檔](../../../docs/framework/resources/creating-resource-files-for-desktop-apps.md)和[建立附屬組件](../../../docs/framework/resources/creating-satellite-assemblies-for-desktop-apps.md)。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-125">For information about creating resource files, see [Creating Resource Files](../../../docs/framework/resources/creating-resource-files-for-desktop-apps.md) and [Creating Satellite Assemblies](../../../docs/framework/resources/creating-satellite-assemblies-for-desktop-apps.md).</span></span>  
  
<a name="cpconpackagingdeployingresourcesanchor1"></a>   
## <a name="the-resource-fallback-process"></a><span data-ttu-id="4ebb5-126">資源後援處理序</span><span class="sxs-lookup"><span data-stu-id="4ebb5-126">The Resource Fallback Process</span></span>  
 <span data-ttu-id="4ebb5-127">封裝和部署資源的中樞和支點模型會使用後援程序來找出適當的資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-127">The hub and spoke model for packaging and deploying resources uses a fallback process to locate appropriate resources.</span></span> <span data-ttu-id="4ebb5-128">如果應用程式要求的當地語系化資源無法使用，通用語言執行平台 (CLR) 就會在文化特性的階層架構中搜尋最接近使用者應用程式所要求的適當後援資源，而擲回例外狀況只會做為最後手段。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-128">If an application requests a localized resource  that is unavailable, the common language runtime searches the hierarchy of cultures for an appropriate fallback resource that most closely matches the user's application's request, and throws an exception only as a last resort.</span></span> <span data-ttu-id="4ebb5-129">在階層的每個層級，如果找到適當的資源，則執行階段會使用它。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-129">At each level of the hierarchy, if an appropriate resource is found, the runtime uses it.</span></span> <span data-ttu-id="4ebb5-130">如果找不到資源，則會繼續搜尋下一個層級。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-130">If the resource is not found, the search continues at the next level.</span></span>  
  
 <span data-ttu-id="4ebb5-131">若要改善查閱效能，請將 <xref:System.Resources.NeutralResourcesLanguageAttribute> 屬性套用至主要組件，並將使用主要組件之中性語言的名稱傳遞給它。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-131">To improve lookup performance, apply the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute to your main assembly, and pass it the name of the neutral language that will work with your main assembly.</span></span>  
  
> [!TIP]
>  <span data-ttu-id="4ebb5-132">您可以使用 [\<relativeBindForResources>](../../../docs/framework/configure-apps/file-schema/runtime/relativebindforresources-element.md) 組態項目最佳化資源後援處理序，以及執行階段探查資源組件的處理序。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-132">You may be able to use the [\<relativeBindForResources>](../../../docs/framework/configure-apps/file-schema/runtime/relativebindforresources-element.md) configuration element to optimize the resource fallback process and the process by which the runtime probes for resource assemblies.</span></span> <span data-ttu-id="4ebb5-133">如需詳細資訊，請參閱[最佳化資源後援處理序](../../../docs/framework/resources/packaging-and-deploying-resources-in-desktop-apps.md#Optimizing)一節。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-133">For more information, see the [Optimizing the Resource Fallback Process](../../../docs/framework/resources/packaging-and-deploying-resources-in-desktop-apps.md#Optimizing) section.</span></span>  
  
 <span data-ttu-id="4ebb5-134">資源後援程序包含下列步驟：</span><span class="sxs-lookup"><span data-stu-id="4ebb5-134">The resource fallback process is involves the following steps:</span></span>  
  
1.  <span data-ttu-id="4ebb5-135">執行階段會先檢查[全域組件快取](../../../docs/framework/app-domains/gac.md)是否有符合應用程式之所要求文化特性的組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-135">The runtime first checks the [global assembly cache](../../../docs/framework/app-domains/gac.md) for an assembly that matches the requested culture for your application.</span></span>  
  
     <span data-ttu-id="4ebb5-136">全域組件快取可以儲存多個應用程式所共用的資源組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-136">The global assembly cache can store resource assemblies that are shared by many applications.</span></span> <span data-ttu-id="4ebb5-137">這可讓您不需要在所建立之每個應用程式的目錄結構中包括特定資源集。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-137">This frees you from having to include specific sets of resources in the directory structure of every application you create.</span></span> <span data-ttu-id="4ebb5-138">如果執行階段找到組件的參考，則會搜尋所要求資源的組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-138">If the runtime finds a reference to the assembly, it searches the assembly for the requested resource.</span></span> <span data-ttu-id="4ebb5-139">如果在組件中找到項目，則會使用所要求的資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-139">If it finds the entry in the assembly, it uses the requested resource.</span></span> <span data-ttu-id="4ebb5-140">如果找不到項目，會繼續搜尋。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-140">If it doesn't find the entry, it continues the search.</span></span>  
  
2.  <span data-ttu-id="4ebb5-141">執行階段接著會檢查目前執行中組件的目錄中是否有符合所要求文化特性的目錄。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-141">The runtime next checks the directory of the currently executing assembly for a directory that matches the requested culture.</span></span> <span data-ttu-id="4ebb5-142">如果它找到目錄，則會搜尋該目錄是否有所要求文化特性的有效附屬組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-142">If it finds the directory, it searches that directory for a valid satellite assembly for the requested culture.</span></span> <span data-ttu-id="4ebb5-143">執行階段接著會搜尋所要求資源的附屬組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-143">The runtime then searches the satellite assembly for the requested resource.</span></span> <span data-ttu-id="4ebb5-144">如果在組件中找到資源，則會使用它。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-144">If it finds the resource in the assembly, it uses it.</span></span> <span data-ttu-id="4ebb5-145">如果找不到資源，會繼續搜尋。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-145">If it doesn't find the resource, it continues the search.</span></span>  
  
3.  <span data-ttu-id="4ebb5-146">執行階段接下來會查詢 Windows Installer，以判斷是否依需求安裝附屬組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-146">The runtime next queries the Windows Installer to determine whether the satellite assembly is to be installed on demand.</span></span> <span data-ttu-id="4ebb5-147">如果是這樣，它會處理安裝、載入組件，並搜尋它或所要求的資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-147">If so, it handles the installation, loads the assembly, and searches it or the requested resource.</span></span> <span data-ttu-id="4ebb5-148">如果在組件中找到資源，則會使用它。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-148">If it finds the resource in the assembly, it uses it.</span></span> <span data-ttu-id="4ebb5-149">如果找不到資源，會繼續搜尋。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-149">If it doesn't find the resource, it continues the search.</span></span>  
  
4.  <span data-ttu-id="4ebb5-150">執行階段會引發 <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> 事件，指出找不到附屬組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-150">The runtime raises the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event to indicate that it is unable to find the satellite assembly.</span></span> <span data-ttu-id="4ebb5-151">如果您選擇處理事件，則事件處理常式會傳回其資源用於查閱之附屬組件的參考。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-151">If you choose to handle the event, your event handler can return a reference to the satellite assembly whose resources will be used for the lookup.</span></span> <span data-ttu-id="4ebb5-152">否則，事件處理常式會傳回 `null` 並繼續搜尋。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-152">Otherwise, the event handler returns `null` and the search continues.</span></span>  
  
5.  <span data-ttu-id="4ebb5-153">執行階段接下來會重新搜尋全域組件快取，這一次則會搜尋所要求文化特性的父組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-153">The runtime next searches the global assembly cache again, this time for the parent assembly of the requested culture.</span></span> <span data-ttu-id="4ebb5-154">如果父組件位於全域組件快取中，則執行階段會搜尋所要求資源的組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-154">If the parent assembly exists in the global assembly cache, the runtime searches the assembly for the requested resource.</span></span>  
  
     <span data-ttu-id="4ebb5-155">父文化特性會定義為適當的後援文化特性。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-155">The parent culture is defined as the appropriate fallback culture.</span></span> <span data-ttu-id="4ebb5-156">請將父項視為後援候選項目，因為最好提供任何資源以擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-156">Consider parents as fallback candidates, because providing any resource is preferable to throwing an exception.</span></span> <span data-ttu-id="4ebb5-157">此程序也可讓您重複使用資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-157">This process also allows you to reuse resources.</span></span> <span data-ttu-id="4ebb5-158">只有在子文化特性不需要當地語系化所要求的資源時，才應該包括父層級的特定資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-158">You should include a particular resource at the parent level only if the child culture doesn't need to localize the requested resource.</span></span> <span data-ttu-id="4ebb5-159">例如，如果您提供 en (中性英文)、en-GB (英式英文) 和 en-US (美式英文) 的附屬組件，則 en 附屬組件會包含一般術語，而且 en-GB 和 en-US 附屬組件可以僅提供這些不同詞彙的覆寫。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-159">For example, if you supply satellite assemblies for en (neutral English), en-GB (English as spoken in the United Kingdom), and en-US (English as spoken in the United States), the en satellite would contain the common terminology, and the en-GB and en-US satellites could provide overrides for only those terms that differ.</span></span>  
  
6.  <span data-ttu-id="4ebb5-160">執行階段接著會檢查目前執行中組件的目錄，以查看它是否包含上層目錄。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-160">The runtime next checks the directory of the currently executing assembly to see if it contains a parent directory.</span></span> <span data-ttu-id="4ebb5-161">如果已有上層目錄，則執行階段會搜尋目錄中是否有父文化特性的有效附屬組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-161">If a parent directory exists, the runtime searches the directory for a valid satellite assembly for the parent culture.</span></span> <span data-ttu-id="4ebb5-162">如果找到組件，則執行階段會搜尋所要求資源的組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-162">If it finds the assembly, the runtime searches the assembly for the requested resource.</span></span> <span data-ttu-id="4ebb5-163">如果找到資源，則會使用它。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-163">If it finds the resource, it uses it.</span></span> <span data-ttu-id="4ebb5-164">如果找不到資源，會繼續搜尋。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-164">If it doesn't find the resource, it continues the search.</span></span>  
  
7.  <span data-ttu-id="4ebb5-165">執行階段接下來會查詢 Windows Installer，以判斷是否依需求安裝父附屬組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-165">The runtime next queries the Windows Installer to determine whether the parent satellite assembly is to be installed on demand.</span></span> <span data-ttu-id="4ebb5-166">如果是這樣，它會處理安裝、載入組件，並搜尋它或所要求的資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-166">If so, it handles the installation, loads the assembly, and searches it or the requested resource.</span></span> <span data-ttu-id="4ebb5-167">如果在組件中找到資源，則會使用它。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-167">If it finds the resource in the assembly, it uses it.</span></span> <span data-ttu-id="4ebb5-168">如果找不到資源，會繼續搜尋。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-168">If it doesn't find the resource, it continues the search.</span></span>  
  
8.  <span data-ttu-id="4ebb5-169">執行階段會引發 <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> 事件，指出找不到適當的後援資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-169">The runtime raises the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event to indicate that it is unable to find an appropriate fallback resource.</span></span> <span data-ttu-id="4ebb5-170">如果您選擇處理事件，則事件處理常式會傳回其資源用於查閱之附屬組件的參考。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-170">If you choose to handle the event, your event handler can return a reference to the satellite assembly whose resources will be used for the lookup.</span></span> <span data-ttu-id="4ebb5-171">否則，事件處理常式會傳回 `null` 並繼續搜尋。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-171">Otherwise, the event handler returns `null` and the search continues.</span></span>  
  
9. <span data-ttu-id="4ebb5-172">執行階段接下來會如先前三個步驟所述搜尋父組件的多個可能層級。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-172">The runtime next searches parent assemblies, as in the previous three steps, through many potential levels.</span></span> <span data-ttu-id="4ebb5-173">每個文化特性都只有 <xref:System.Globalization.CultureInfo.Parent%2A?displayProperty=nameWithType> 屬性所定義的一個父代，但是父代可能有其本身的父代。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-173">Each culture has only one parent, which is defined by the <xref:System.Globalization.CultureInfo.Parent%2A?displayProperty=nameWithType> property, but a parent might have its own parent.</span></span> <span data-ttu-id="4ebb5-174">文化特性的 <xref:System.Globalization.CultureInfo.Parent%2A> 屬性傳回 <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType> 時，會停止搜尋父文化特性；針對資源後援，不會將不區分文化特性視為父文化特性或可有資源的文化特性。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-174">The search for parent cultures stops when a culture's <xref:System.Globalization.CultureInfo.Parent%2A> property returns <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType>; for resource fallback, the invariant culture is not considered a parent culture or a culture that can have resources.</span></span>  
  
10. <span data-ttu-id="4ebb5-175">如果已搜尋原先指定的文化特性和所有父項，但仍然找不到資源，則會使用預設 (後援) 文化特性的資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-175">If the culture that was originally specified and all parents have been searched and the resource is still not found, the resource for the default (fallback) culture is used.</span></span> <span data-ttu-id="4ebb5-176">通常，主要應用程式組件中會包含預設文化特性的資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-176">Typically, the resources for the default culture are included in the main application assembly.</span></span> <span data-ttu-id="4ebb5-177">不過，您可以指定 <xref:System.Resources.NeutralResourcesLanguageAttribute> 屬性 (attribute) 之 <xref:System.Resources.NeutralResourcesLanguageAttribute.Location%2A> 屬性 (property) 的 <xref:System.Resources.UltimateResourceFallbackLocation.Satellite> 值，指出資源的最終後援位置是附屬組件，而不是主要組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-177">However, you can specify a value of <xref:System.Resources.UltimateResourceFallbackLocation.Satellite> for the <xref:System.Resources.NeutralResourcesLanguageAttribute.Location%2A> property of the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute to indicate that the ultimate fallback location for resources is a satellite assembly, rather than the main assembly.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="4ebb5-178">預設資源是可使用主要組件進行編譯的唯一資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-178">The default resource is the only resource that can be compiled with the main assembly.</span></span> <span data-ttu-id="4ebb5-179">除非您使用 <xref:System.Resources.NeutralResourcesLanguageAttribute> 屬性指定附屬組件，否則它是最終後援 (最終父項)。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-179">Unless you specify a satellite assembly by using the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute, it is the ultimate fallback (final parent).</span></span> <span data-ttu-id="4ebb5-180">因此，建議您一律在主要組件中包括預設一組資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-180">Therefore, we recommend that you always include a default set of resources in your main assembly.</span></span> <span data-ttu-id="4ebb5-181">這樣有助於防止擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-181">This helps prevent exceptions from being thrown.</span></span> <span data-ttu-id="4ebb5-182">透過包括預設資源檔，您可以提供所有資源的後援，並確保使用者至少一律有一個資源，即使不是文化特性特有的也是一樣。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-182">By including a default resource file you provide a fallback for all resources, and ensure that at least one resource is always present for the user, even if it is not culturally specific.</span></span>  
  
11. <span data-ttu-id="4ebb5-183">最後，如果執行階段找不到預設 (後援) 文化特性的資源，則會擲回 <xref:System.Resources.MissingManifestResourceException> 或 <xref:System.Resources.MissingSatelliteAssemblyException> 例外狀況，指出找不到資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-183">Finally, if the runtime doesn't find a resource for a default (fallback) culture, a <xref:System.Resources.MissingManifestResourceException> or <xref:System.Resources.MissingSatelliteAssemblyException> exception is thrown to indicate that the resource could not be found.</span></span>  
  
 <span data-ttu-id="4ebb5-184">例如，假設應用程式要求墨西哥西班牙文 (es-MX 文化特性) 的當地語系化資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-184">For example, suppose the application requests a resource localized for Spanish (Mexico) (the es-MX culture).</span></span> <span data-ttu-id="4ebb5-185">執行階段會先搜尋符合 es-MX 之組件的全域組件快取，但找不到它。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-185">The runtime first searches the global assembly cache for the assembly that matches es-MX, but doesn't find it.</span></span> <span data-ttu-id="4ebb5-186">執行階段接著會搜尋目前執行中組件的目錄是否有 es-MX 目錄。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-186">The runtime then searches the directory of the currently executing assembly for an es-MX directory.</span></span> <span data-ttu-id="4ebb5-187">如果失敗，則執行階段會重新搜尋全域組件快取中是否有父組件可反映適當的後援文化特性；在此情況下為 es (西班牙文)。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-187">Failing that, the runtime searches the global assembly cache again for a parent assembly that reflects the appropriate fallback culture — in this case, es (Spanish).</span></span> <span data-ttu-id="4ebb5-188">如果找不到父組件，執行階段會搜尋 es-MX 文化特性之父組件的所有可能層級，直到找到對應的資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-188">If the parent assembly is not found, the runtime searches all potential levels of parent assemblies for the es-MX culture until it finds a corresponding resource.</span></span> <span data-ttu-id="4ebb5-189">如果找不到資源，執行階段會使用預設文化特性的資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-189">If a resource isn't found, the runtime uses the resource for the default culture.</span></span>  
  
<a name="Optimizing"></a>   
### <a name="optimizing-the-resource-fallback-process"></a><span data-ttu-id="4ebb5-190">最佳化資源後援處理序</span><span class="sxs-lookup"><span data-stu-id="4ebb5-190">Optimizing the Resource Fallback Process</span></span>  
 <span data-ttu-id="4ebb5-191">在下列情況中，您可以最佳化執行階段用來搜尋附屬組件中資源的程序。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-191">Under the following conditions, you can optimize the process by which the runtime searches for resources in satellite assemblies</span></span>  
  
-   <span data-ttu-id="4ebb5-192">附屬組件會部署在與程式碼組件相同的位置中。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-192">Satellite assemblies are deployed in the same location as the code assembly.</span></span> <span data-ttu-id="4ebb5-193">如果程式碼組件安裝在[全域組件快取](../../../docs/framework/app-domains/gac.md)中，則也會將附屬組件安裝在全域組件快取中。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-193">If the code assembly is installed in the [Global Assembly Cache](../../../docs/framework/app-domains/gac.md), satellite assemblies are also installed in the global assembly cache.</span></span> <span data-ttu-id="4ebb5-194">如果程式碼組件安裝在目錄中，則附屬組件會安裝在該目錄的文化特性特定資料夾中。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-194">If the code assembly is installed in a directory, satellite assemblies are installed in culture-specific folders of that directory.</span></span>  
  
-   <span data-ttu-id="4ebb5-195">不會隨選安裝附屬組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-195">Satellite assemblies are not installed on demand.</span></span>  
  
-   <span data-ttu-id="4ebb5-196">應用程式碼不會處理 <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> 事件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-196">Application code does not handle the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event.</span></span>  
  
 <span data-ttu-id="4ebb5-197">如下列範例所示，您將藉由在應用程式組態檔中加入 [\<relativeBindForResources>](../../../docs/framework/configure-apps/file-schema/runtime/relativebindforresources-element.md) 項目並且將其 `enabled` 屬性設定為 `true` 的方式，最佳化附屬組件的探查工作。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-197">You optimize the probe for satellite assemblies by including the [\<relativeBindForResources>](../../../docs/framework/configure-apps/file-schema/runtime/relativebindforresources-element.md) element and setting its `enabled` attribute to `true` in the application configuration file, as shown in the following example.</span></span>  
  
```xml  
<configuration>  
   <runtime>  
      <relativeBindForResources enabled="true" />  
   </runtime>  
</configuration>  
```  
  
 <span data-ttu-id="4ebb5-198">附屬組件的最佳化探查是選擇性功能。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-198">The optimized probe for satellite assemblies is an opt-in feature.</span></span> <span data-ttu-id="4ebb5-199">也就是說，執行階段會遵循[資源後援處理序](../../../docs/framework/resources/packaging-and-deploying-resources-in-desktop-apps.md#cpconpackagingdeployingresourcesanchor1)中說明的步驟，除非應用程式組態檔中已有 [\<relativeBindForResources>](../../../docs/framework/configure-apps/file-schema/runtime/relativebindforresources-element.md) 項目，而且其 `enabled` 屬性已設定為 `true`。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-199">That is, the runtime follows the steps documented in [The Resource Fallback Process](../../../docs/framework/resources/packaging-and-deploying-resources-in-desktop-apps.md#cpconpackagingdeployingresourcesanchor1) unless the [\<relativeBindForResources>](../../../docs/framework/configure-apps/file-schema/runtime/relativebindforresources-element.md) element is present in the application's configuration file and its `enabled` attribute is set to `true`.</span></span> <span data-ttu-id="4ebb5-200">如果是這種情況，附屬組件的探查程序修改如下：</span><span class="sxs-lookup"><span data-stu-id="4ebb5-200">If this is the case, the process of probing for a satellite assembly is modified as follows:</span></span>  
  
-   <span data-ttu-id="4ebb5-201">執行階段使用父程式碼組件的位置來探查附屬組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-201">The runtime uses the location of the parent code assembly to probe for the satellite assembly.</span></span> <span data-ttu-id="4ebb5-202">如果父組件安裝在全域組件快取中，則執行階段會在快取中探查，而不是在應用程式目錄中探查。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-202">If the parent assembly is installed in the global assembly cache, the runtime probes in the cache but not in the application's directory.</span></span> <span data-ttu-id="4ebb5-203">如果父組件安裝在應用程式目錄中，則執行階段會在應用程式目錄中探查，而不是在全域組件快取中探查。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-203">If the parent assembly is installed in an application directory, the runtime probes in the application directory but not in the global assembly cache.</span></span>  
  
-   <span data-ttu-id="4ebb5-204">執行階段不會查詢 Windows Installer 是否有附屬組件的隨選安裝。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-204">The runtime doesn't query the Windows Installer for on-demand installation of satellite assemblies.</span></span>  
  
-   <span data-ttu-id="4ebb5-205">如果探查特定資源組件失敗，則執行階段不會引發 <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> 事件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-205">If the probe for a particular resource assembly fails, the runtime does not raise the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event.</span></span>  
  
### <a name="ultimate-fallback-to-satellite-assembly"></a><span data-ttu-id="4ebb5-206">附屬組件的最終後援</span><span class="sxs-lookup"><span data-stu-id="4ebb5-206">Ultimate Fallback to Satellite Assembly</span></span>  
 <span data-ttu-id="4ebb5-207">您可以選擇性地從主要組件中移除資源，並指定執行階段應該從對應至特定文化特性的附屬組件中載入最終後援資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-207">You can optionally remove resources from the main assembly and specify that the runtime should load the ultimate fallback resources from a satellite assembly that corresponds to a specific culture.</span></span> <span data-ttu-id="4ebb5-208">若要控制後援程序，請使用 <xref:System.Resources.NeutralResourcesLanguageAttribute.%23ctor%28System.String%2CSystem.Resources.UltimateResourceFallbackLocation%29?displayProperty=nameWithType> 建構函式，並提供 <xref:System.Resources.UltimateResourceFallbackLocation> 參數的值，而此參數指定 Resource Manager 應該從主要組件還是附屬組件擷取後援資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-208">To control the fallback process, you use the <xref:System.Resources.NeutralResourcesLanguageAttribute.%23ctor%28System.String%2CSystem.Resources.UltimateResourceFallbackLocation%29?displayProperty=nameWithType> constructor and supply a value for the <xref:System.Resources.UltimateResourceFallbackLocation> parameter that specifies whether Resource Manager should extract the fallback resources from the main assembly or from a satellite assembly.</span></span>  
  
 <span data-ttu-id="4ebb5-209">下列範例會使用 <xref:System.Resources.NeutralResourcesLanguageAttribute> 屬性，將應用程式的後援資源儲存在法文 (fr) 語言的附屬組件中。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-209">The following example uses the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute to store an application's fallback resources in a satellite assembly for the French (fr) language.</span></span>  <span data-ttu-id="4ebb5-210">此範例有兩個文字型資源檔案定義名為 `Greeting` 的單一字串資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-210">The example has two text-based resource files that define a single string resource named `Greeting`.</span></span> <span data-ttu-id="4ebb5-211">首先，resources.fr.txt 包含法文語言資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-211">The first, resources.fr.txt, contains a French language resource.</span></span>  
  
```  
Greeting=Bon jour!  
```  
  
 <span data-ttu-id="4ebb5-212">其次，resources,ru.txt 包含俄文語言資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-212">The second, resources,ru.txt, contains a Russian language resource.</span></span>  
  
```  
Greeting=Добрый день  
```  
  
 <span data-ttu-id="4ebb5-213">從命令列執行[資源檔產生器 (Resgen.exe)](../../../docs/framework/tools/resgen-exe-resource-file-generator.md)，以將這兩個檔案編譯成 .resources 檔案。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-213">These two files are compiled to .resources files by running the [resource file generator (Resgen.exe)](../../../docs/framework/tools/resgen-exe-resource-file-generator.md) from the command line.</span></span>  <span data-ttu-id="4ebb5-214">法文語言資源的命令為：</span><span class="sxs-lookup"><span data-stu-id="4ebb5-214">For the French language resource, the command is:</span></span>  
  
 <span data-ttu-id="4ebb5-215">**resgen.exe resources.fr.txt**</span><span class="sxs-lookup"><span data-stu-id="4ebb5-215">**resgen.exe resources.fr.txt**</span></span>  
  
 <span data-ttu-id="4ebb5-216">俄文語言資源的命令為：</span><span class="sxs-lookup"><span data-stu-id="4ebb5-216">For the Russian language resource, the command is:</span></span>  
  
 <span data-ttu-id="4ebb5-217">**resgen.exe resources.ru.txt**</span><span class="sxs-lookup"><span data-stu-id="4ebb5-217">**resgen.exe resources.ru.txt**</span></span>  
  
 <span data-ttu-id="4ebb5-218">從法文語言資源的命令列執行[組件連結器 (Al.exe)](../../../docs/framework/tools/al-exe-assembly-linker.md) 以將 .resources 檔案內嵌到動態連結程式庫，如下所示：</span><span class="sxs-lookup"><span data-stu-id="4ebb5-218">The .resources files are embedded into dynamic link libraries by running [assembly linker (Al.exe)](../../../docs/framework/tools/al-exe-assembly-linker.md) from the command line for the French language resource as follows:</span></span>  
  
 <span data-ttu-id="4ebb5-219">**al /t:lib /embed:resources.fr.resources /culture:fr /out:fr\Example1.resources.dll**</span><span class="sxs-lookup"><span data-stu-id="4ebb5-219">**al /t:lib /embed:resources.fr.resources /culture:fr /out:fr\Example1.resources.dll**</span></span>  
  
 <span data-ttu-id="4ebb5-220">而俄文語言資源如下所示：</span><span class="sxs-lookup"><span data-stu-id="4ebb5-220">and for the Russian language resource as follows:</span></span>  
  
 <span data-ttu-id="4ebb5-221">**al /t:lib /embed:resources.ru.resources /culture:ru /out:ru\Example1.resources.dll**</span><span class="sxs-lookup"><span data-stu-id="4ebb5-221">**al /t:lib /embed:resources.ru.resources /culture:ru /out:ru\Example1.resources.dll**</span></span>  
  
 <span data-ttu-id="4ebb5-222">應用程式原始程式碼位在名為 Example1.cs 或 Example1.vb 的檔案中。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-222">The application source code resides in a file named Example1.cs or Example1.vb.</span></span> <span data-ttu-id="4ebb5-223">它會包括 <xref:System.Resources.NeutralResourcesLanguageAttribute> 屬性，指出預設應用程式資源是在 fr 子目錄中。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-223">It includes the <xref:System.Resources.NeutralResourcesLanguageAttribute> attribute to indicate that the default application resource is in the fr subdirectory.</span></span> <span data-ttu-id="4ebb5-224">它會執行個體化 Resource Manager、擷取 `Greeting` 資源的值，並將它顯示到主控台。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-224">It instantiates the Resource Manager, retrieves the value of the `Greeting` resource, and displays it to the console.</span></span>  
  
 [!code-csharp[Conceptual.Resources.Packaging#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.resources.packaging/cs/example1.cs#1)]
 [!code-vb[Conceptual.Resources.Packaging#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.resources.packaging/vb/example1.vb#1)]  
  
 <span data-ttu-id="4ebb5-225">您接著可以從命令列編譯 C# 原始程式碼，如下所示：</span><span class="sxs-lookup"><span data-stu-id="4ebb5-225">You can then compile C# source code from the command line as follows:</span></span>  
  
 <span data-ttu-id="4ebb5-226">**csc Example1.cs**</span><span class="sxs-lookup"><span data-stu-id="4ebb5-226">**csc Example1.cs**</span></span>  
  
 <span data-ttu-id="4ebb5-227">Visual Basic 編譯器的命令十分類似：</span><span class="sxs-lookup"><span data-stu-id="4ebb5-227">The command for the Visual Basic compiler is very similar:</span></span>  
  
 <span data-ttu-id="4ebb5-228">**vbc Example1.vb**</span><span class="sxs-lookup"><span data-stu-id="4ebb5-228">**vbc Example1.vb**</span></span>  
  
 <span data-ttu-id="4ebb5-229">因為主要組件中未內嵌任何資源，所以您不需要使用 `/resource` 切換參數進行編譯。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-229">Because there are no resources embedded in the main assembly, you do not have to compile by using the `/resource` switch.</span></span>  
  
 <span data-ttu-id="4ebb5-230">當您從語言非俄文的系統執行此範例時，會顯示下列輸出：</span><span class="sxs-lookup"><span data-stu-id="4ebb5-230">When you run the example from a system whose language is anything other than Russian, it displays the following output:</span></span>  
  
```  
Bon jour!  
```  
  
## <a name="suggested-packaging-alternative"></a><span data-ttu-id="4ebb5-231">建議的封裝替代方式</span><span class="sxs-lookup"><span data-stu-id="4ebb5-231">Suggested Packaging Alternative</span></span>  
 <span data-ttu-id="4ebb5-232">時間或預算限制可能會讓您無法針對應用程式所支援的每個子文化特性建立一組資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-232">Time or budget constraints might prevent you from creating a set of resources for every subculture that your application supports.</span></span> <span data-ttu-id="4ebb5-233">相反地，您可以建立所有相關子文化特性可使用之父文化特性的單一附屬組件。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-233">Instead, you can create a single satellite assembly for a parent culture that all related subcultures can use.</span></span> <span data-ttu-id="4ebb5-234">例如，您可以提供要求地區特定英文資源之使用者所擷取的單一英文附屬組件 (en)，以及要求地區特定德文資源之使用者的單一德文附屬組件 (de)。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-234">For example, you can provide a single English satellite assembly (en) that is retrieved by users who request region-specific English resources, and a single German satellite assembly (de) for users who request region-specific German resources.</span></span> <span data-ttu-id="4ebb5-235">例如，德國德文 (de-DE)、奧地利德文 (de-AT) 和瑞士德文 (de-CH) 的要求會改為使用德文附屬組件 (de)。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-235">For example, requests for German as spoken in Germany (de-DE), Austria (de-AT), and Switzerland (de-CH) would fall back to the German satellite assembly (de).</span></span> <span data-ttu-id="4ebb5-236">預設資源是最終後援，因此應該是大部分應用程式使用者所要求的資源，請小心選擇這些資源。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-236">The default resources are the final fallback and therefore should be the resources that will be requested by the majority of your application's users, so choose these resources carefully.</span></span> <span data-ttu-id="4ebb5-237">這種方式所部署的資源具有較少的特定文化特性，但可以大幅減少您應用程式的當地語系化成本。</span><span class="sxs-lookup"><span data-stu-id="4ebb5-237">This approach deploys resources that are less culturally specific, but can significantly reduce your application's localization costs.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4ebb5-238">請參閱</span><span class="sxs-lookup"><span data-stu-id="4ebb5-238">See Also</span></span>  
 [<span data-ttu-id="4ebb5-239">桌面應用程式中的資源</span><span class="sxs-lookup"><span data-stu-id="4ebb5-239">Resources in Desktop Apps</span></span>](../../../docs/framework/resources/index.md)  
 [<span data-ttu-id="4ebb5-240">全域組件快取</span><span class="sxs-lookup"><span data-stu-id="4ebb5-240">Global Assembly Cache</span></span>](../../../docs/framework/app-domains/gac.md)  
 [<span data-ttu-id="4ebb5-241">建立資源檔</span><span class="sxs-lookup"><span data-stu-id="4ebb5-241">Creating Resource Files</span></span>](../../../docs/framework/resources/creating-resource-files-for-desktop-apps.md)  
 [<span data-ttu-id="4ebb5-242">建立附屬組件</span><span class="sxs-lookup"><span data-stu-id="4ebb5-242">Creating Satellite Assemblies</span></span>](../../../docs/framework/resources/creating-satellite-assemblies-for-desktop-apps.md)
