---
title: WPF 增益集概觀
ms.date: 03/30/2017
helpviewer_keywords:
- add-ins and XAML browser applications [WPF]
- add-ins overview [WPF]
- add-ins [WPF], performance
- add-ins [WPF], benefits
- .NET Framework add-in model [WPF]
- add-ins [WPF], user interface
- add-ins and the user interface [WPF]
- add-ins [WPF], architecture
- add-ins [WPF], limitations
ms.assetid: 00b4c776-29a8-4dba-b603-280a0cdc2ade
ms.openlocfilehash: 2e5d133a4744124723c0373e3d5974b505936190
ms.sourcegitcommit: efff8f331fd9467f093f8ab8d23a203d6ecb5b60
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/01/2018
ms.locfileid: "43402097"
---
# <a name="wpf-add-ins-overview"></a><span data-ttu-id="13df0-102">WPF 增益集概觀</span><span class="sxs-lookup"><span data-stu-id="13df0-102">WPF Add-Ins Overview</span></span>
<a name="Introduction"></a><span data-ttu-id="13df0-103">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 包含開發人員可用來建立支援增益集擴充性的應用程式增益集模型。</span><span class="sxs-lookup"><span data-stu-id="13df0-103">The [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] includes an add-in model that developers can use to create applications that support add-in extensibility.</span></span> <span data-ttu-id="13df0-104">此增益集模型可讓您建立增益集，整合並擴充應用程式的功能。</span><span class="sxs-lookup"><span data-stu-id="13df0-104">This add-in model allows the creation of add-ins that integrate with and extend application functionality.</span></span> <span data-ttu-id="13df0-105">在某些情況下，應用程式也需要顯示增益集提供的 [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)]。本主題說明 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 如何擴大 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 增益集模型來啟用這些案例、其背後的架構、其優點及其限制。</span><span class="sxs-lookup"><span data-stu-id="13df0-105">In some scenarios, applications also need to display [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] that are provided by add-ins. This topic shows how [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] augments the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] add-in model to enable these scenarios, the architecture behind it, its benefits, and its limitations.</span></span>  
  

  
<a name="Requirements"></a>   
## <a name="prerequisites"></a><span data-ttu-id="13df0-106">必要條件</span><span class="sxs-lookup"><span data-stu-id="13df0-106">Prerequisites</span></span>  
 <span data-ttu-id="13df0-107">熟悉 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 增益集模型是必要的。</span><span class="sxs-lookup"><span data-stu-id="13df0-107">Familiarity with the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] add-in model is required.</span></span> <span data-ttu-id="13df0-108">如需詳細資訊，請參閱[增益集和擴充性](../../../../docs/framework/add-ins/index.md)。</span><span class="sxs-lookup"><span data-stu-id="13df0-108">For more information, see [Add-ins and Extensibility](../../../../docs/framework/add-ins/index.md).</span></span>  
  
<a name="AddInsOverview"></a>   
## <a name="add-ins-overview"></a><span data-ttu-id="13df0-109">增益集概觀</span><span class="sxs-lookup"><span data-stu-id="13df0-109">Add-Ins Overview</span></span>  
 <span data-ttu-id="13df0-110">為避免新功能包含複雜的應用程式重新編譯和重新部署，應用程式會實作擴充性機制，讓開發人員 (第一方和第三方) 建立整合它們的其他應用程式。</span><span class="sxs-lookup"><span data-stu-id="13df0-110">In order to avoid the complexities of application recompilation and redeployment to incorporate new functionality, applications implement extensibility mechanisms that allow developers (both first-party and third-party) to create other applications that integrate with them.</span></span> <span data-ttu-id="13df0-111">支援此擴充性類型最常見的方式是使用增益集 (也稱為「附加元件」和「外掛程式」)。</span><span class="sxs-lookup"><span data-stu-id="13df0-111">The most common way to support this type of extensibility is through the use of add-ins (also known as "add-ons" and "plug-ins").</span></span> <span data-ttu-id="13df0-112">公開增益集擴充性的真實世界應用程式範例包括︰</span><span class="sxs-lookup"><span data-stu-id="13df0-112">Examples of real-world applications that expose extensibility with add-ins include:</span></span>  
  
-   <span data-ttu-id="13df0-113">Internet Explorer 附加元件。</span><span class="sxs-lookup"><span data-stu-id="13df0-113">Internet Explorer add-ons.</span></span>  
  
-   <span data-ttu-id="13df0-114">Windows Media Player 外掛程式。</span><span class="sxs-lookup"><span data-stu-id="13df0-114">Windows Media Player plug-ins.</span></span>  
  
-   <span data-ttu-id="13df0-115">Visual Studio 增益集。</span><span class="sxs-lookup"><span data-stu-id="13df0-115">Visual Studio add-ins.</span></span>  
  
 <span data-ttu-id="13df0-116">例如，Windows Media Player 增益集模型讓協力廠商開發人員實作以各種方式擴充 Windows Media Player 的「外掛程式」，包括建立適用於 Windows Media Player 原本不支援之媒體格式的解碼器和編碼器 (例如 DVD、MP3)、音訊效果和面板。</span><span class="sxs-lookup"><span data-stu-id="13df0-116">For example, the Windows Media Player add-in model allows third-party developers to implement "plug-ins" that extend Windows Media Player in a variety of ways, including creating decoders and encoders for media formats that are not supported natively by Windows Media Player (for example, DVD, MP3), audio effects, and skins.</span></span> <span data-ttu-id="13df0-117">每個增益集模型都是建置來公開對應用程式的獨特功能，雖然有幾個實體和行為通用所有的增益集模型。</span><span class="sxs-lookup"><span data-stu-id="13df0-117">Each add-in model is built to expose the functionality that is unique to an application, although there are several entities and behaviors that are common to all add-in models.</span></span>  
  
 <span data-ttu-id="13df0-118">一般增益集擴充性解決方案的三個主要實體是「合約」、「增益集」和「主應用程式」。</span><span class="sxs-lookup"><span data-stu-id="13df0-118">The three main entities of typical add-in extensibility solutions are *contracts*, *add-ins*, and *host applications*.</span></span> <span data-ttu-id="13df0-119">合約定義增益集與主應用程式整合的兩種方式︰</span><span class="sxs-lookup"><span data-stu-id="13df0-119">Contracts define how add-ins integrate with host applications in two ways:</span></span>  
  
-   <span data-ttu-id="13df0-120">增益集整合主應用程式所實作的功能。</span><span class="sxs-lookup"><span data-stu-id="13df0-120">Add-ins integrate with functionality that is implemented by host applications.</span></span>  
  
-   <span data-ttu-id="13df0-121">主應用程式公開要整合的增益集功能。</span><span class="sxs-lookup"><span data-stu-id="13df0-121">Host applications expose functionality for add-ins to integrate with.</span></span>  
  
 <span data-ttu-id="13df0-122">為能使用增益集，主應用程式需要在執行階段找到並載入它們。</span><span class="sxs-lookup"><span data-stu-id="13df0-122">In order for add-ins to be used, host applications need to find them and load them at run time.</span></span> <span data-ttu-id="13df0-123">因此，支援增益集的應用程式有下列額外的責任︰</span><span class="sxs-lookup"><span data-stu-id="13df0-123">Consequently, applications that support add-ins have the following additional responsibilities:</span></span>  
  
-   <span data-ttu-id="13df0-124">**探索**︰尋找遵守主應用程式所支援合約的增益集。</span><span class="sxs-lookup"><span data-stu-id="13df0-124">**Discovery**: Finding add-ins that adhere to contracts supported by host applications.</span></span>  
  
-   <span data-ttu-id="13df0-125">**啟用**︰載入、執行及建立與增益集的通訊。</span><span class="sxs-lookup"><span data-stu-id="13df0-125">**Activation**: Loading, running, and establishing communication with add-ins.</span></span>  
  
-   <span data-ttu-id="13df0-126">**隔離**︰使用應用程式定義域或處理程序來建立隔離界限，保護應用程式不受增益集的潛在安全性和執行問題影響。</span><span class="sxs-lookup"><span data-stu-id="13df0-126">**Isolation**: Using either application domains or processes to establish isolation boundaries that protect applications from potential security and execution problems with add-ins.</span></span>  
  
-   <span data-ttu-id="13df0-127">**通訊**︰透過呼叫方法及傳送資料，讓增益集及主應用程式跨越隔離界限互相通訊。</span><span class="sxs-lookup"><span data-stu-id="13df0-127">**Communication**: Allowing add-ins and host applications to communicate with each other across isolation boundaries by calling methods and passing data.</span></span>  
  
-   <span data-ttu-id="13df0-128">**存留期管理**︰以簡潔、可預測的方式載入和卸載應用程式定義域和處理程序 (請參閱[應用程式定義域](../../../../docs/framework/app-domains/application-domains.md))。</span><span class="sxs-lookup"><span data-stu-id="13df0-128">**Lifetime Management**: Loading and unloading application domains and processes in a clean, predictable manner (see [Application Domains](../../../../docs/framework/app-domains/application-domains.md)).</span></span>  
  
-   <span data-ttu-id="13df0-129">**版本控制**︰確保建立任一新版本時，主應用程式和增益集仍可通訊。</span><span class="sxs-lookup"><span data-stu-id="13df0-129">**Versioning**: Ensuring that host applications and add-ins can still communicate when new versions of either are created.</span></span>  
  
 <span data-ttu-id="13df0-130">最後，開發強固的增益集模型是重要的工作。</span><span class="sxs-lookup"><span data-stu-id="13df0-130">Ultimately, developing a robust add-in model is a non-trivial undertaking.</span></span> <span data-ttu-id="13df0-131">因此，[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 提供基礎結構以建置增益集模型。</span><span class="sxs-lookup"><span data-stu-id="13df0-131">For this reason, the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] provides an infrastructure for building add-in models.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="13df0-132">如需增益集的詳細資訊，請參閱[增益集和擴充性](../../../../docs/framework/add-ins/index.md)。</span><span class="sxs-lookup"><span data-stu-id="13df0-132">For more detailed information on add-ins, see [Add-ins and Extensibility](../../../../docs/framework/add-ins/index.md).</span></span>  
  
<a name="NETFrameworkAddInModelOverview"></a>   
## <a name="net-framework-add-in-model-overview"></a><span data-ttu-id="13df0-133">.NET Framework 增益集模型概觀</span><span class="sxs-lookup"><span data-stu-id="13df0-133">.NET Framework Add-In Model Overview</span></span>  
 <span data-ttu-id="13df0-134">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]增益集模型中，位於<xref:System.AddIn>命名空間，包含一組專為簡化增益集擴充性的開發工作的類型。</span><span class="sxs-lookup"><span data-stu-id="13df0-134">The [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] add-in model, found in the <xref:System.AddIn> namespace, contains a set of types that are designed to simplify the development of add-in extensibility.</span></span> <span data-ttu-id="13df0-135">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 增益集模型的基本單位是「合約」，它會定義主應用程式和增益集彼此如何通訊。</span><span class="sxs-lookup"><span data-stu-id="13df0-135">The fundamental unit of the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] add-in model is the *contract*, which defines how a host application and an add-in communicate with each other.</span></span> <span data-ttu-id="13df0-136">合約會向使用合約主應用程式特定「檢視」的主應用程式公開。</span><span class="sxs-lookup"><span data-stu-id="13df0-136">A contract is exposed to a host application using a host-application-specific *view* of the contract.</span></span> <span data-ttu-id="13df0-137">同樣地，合約的增益集專用「檢視」也會向增益集公開。</span><span class="sxs-lookup"><span data-stu-id="13df0-137">Likewise, an add-in-specific *view* of the contract is exposed to the add-in.</span></span> <span data-ttu-id="13df0-138">「配接器」用以讓主應用程式和增益集在其各自的合約檢視間進行通訊。</span><span class="sxs-lookup"><span data-stu-id="13df0-138">An *adapter* is used to allow a host application and an add-in to communicate between their respective views of the contract.</span></span> <span data-ttu-id="13df0-139">合約、檢視和配接器稱為區段，一組相關的區段構成「管線」。</span><span class="sxs-lookup"><span data-stu-id="13df0-139">Contracts, views, and adapters are referred to as segments, and a set of related segments constitutes a *pipeline*.</span></span> <span data-ttu-id="13df0-140">管線是 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 增益集模型支援探索、啟動、安全性隔離、執行隔離 (使用應用程式定義域和處理程序)、通訊、生命週期管理和版本控制的基礎。</span><span class="sxs-lookup"><span data-stu-id="13df0-140">Pipelines are the foundation upon which the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] add-in model supports discovery, activation, security isolation, execution isolation (using both application domains and processes), communication, lifetime management, and versioning.</span></span>  
  
 <span data-ttu-id="13df0-141">這項支援的要點是讓開發人員建置增益集，整合主應用程式的功能。</span><span class="sxs-lookup"><span data-stu-id="13df0-141">The sum of this support allows developers to build add-ins that integrate with the functionality of a host application.</span></span> <span data-ttu-id="13df0-142">不過，某些情況下需要主應用程式顯示增益集所提供的 [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)]。因為 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 中每種簡報技術都有用以實作 [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] 的自有模型，所以 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 增益集模型不支援任何特定的簡報技術。</span><span class="sxs-lookup"><span data-stu-id="13df0-142">However, some scenarios require host applications to display [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] provided by add-ins. Because each presentation technology in the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] has its own model for implementing [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)], the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] add-in model does not support any particular presentation technology.</span></span> <span data-ttu-id="13df0-143">而是 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 會擴充 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 增益集模型與增益集 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]支援。</span><span class="sxs-lookup"><span data-stu-id="13df0-143">Instead, [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] extends the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] add-in model with [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] support for add-ins.</span></span>  
  
<a name="WPFAddInModel"></a>   
## <a name="wpf-add-ins"></a><span data-ttu-id="13df0-144">WPF 增益集</span><span class="sxs-lookup"><span data-stu-id="13df0-144">WPF Add-Ins</span></span>  
 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]<span data-ttu-id="13df0-145"> 聯合 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 增益集模型，可讓您處理需要主應用程式從增益集顯示 [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] 的各種情況。特別是，這些案例是由 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 與下面兩個程式設計模型所解決︰</span><span class="sxs-lookup"><span data-stu-id="13df0-145">, in conjunction with the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] add-in model, allows you to address a wide variety of scenarios that require host applications to display [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] from add-ins. In particular, these scenarios are addressed by [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] with the following two programming models:</span></span>  
  
1.  <span data-ttu-id="13df0-146">**增益集傳回 UI**。</span><span class="sxs-lookup"><span data-stu-id="13df0-146">**The add-in returns a UI**.</span></span> <span data-ttu-id="13df0-147">增益集透過方法呼叫將 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 傳回主應用程式，如合約所定義。</span><span class="sxs-lookup"><span data-stu-id="13df0-147">An add-in returns a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] to the host application via a method call, as defined by the contract.</span></span> <span data-ttu-id="13df0-148">此案例用於下列情況︰</span><span class="sxs-lookup"><span data-stu-id="13df0-148">This scenario is used in the following cases:</span></span>  
  
    -   <span data-ttu-id="13df0-149">增益集傳回的 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 外觀相依於只存在於執行階段的資料或條件，例如動態產生的報表。</span><span class="sxs-lookup"><span data-stu-id="13df0-149">The appearance of a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] that is returned by an add-in is dependent on either data or conditions that exist only at run time, such as dynamically generated reports.</span></span>  
  
    -   <span data-ttu-id="13df0-150">增益集所提供服務的 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 不同於可使用增益集之主應用程式的 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="13df0-150">The [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] for services provided by an add-in differs from the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] of the host applications that can use the add-in.</span></span>  
  
    -   <span data-ttu-id="13df0-151">增益集主要執行主應用程式服務，並向具有 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 的主應用程式報告狀態。</span><span class="sxs-lookup"><span data-stu-id="13df0-151">The add-in primarily performs a service for the host application, and reports status to the host application with a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span>  
  
2.  <span data-ttu-id="13df0-152">**增益集為 UI**。</span><span class="sxs-lookup"><span data-stu-id="13df0-152">**The add-in is a UI**.</span></span> <span data-ttu-id="13df0-153">增益集是 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]，如合約所定義。</span><span class="sxs-lookup"><span data-stu-id="13df0-153">An add-in is a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)], as defined by the contract.</span></span> <span data-ttu-id="13df0-154">此案例用於下列情況︰</span><span class="sxs-lookup"><span data-stu-id="13df0-154">This scenario is used in the following cases:</span></span>  
  
    -   <span data-ttu-id="13df0-155">增益集不提供顯示以外的服務，例如廣告。</span><span class="sxs-lookup"><span data-stu-id="13df0-155">An add-in doesn't provide services other than being displayed, such as an advertisement.</span></span>  
  
    -   <span data-ttu-id="13df0-156">增益集所提供服務的 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 對可以使用該增益集的主應用程式而言很普通，例如計算機或色彩選擇器。</span><span class="sxs-lookup"><span data-stu-id="13df0-156">The [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] for services provided by an add-in is common to all host applications that can use that add-in, such as a calculator or color picker.</span></span>  
  
 <span data-ttu-id="13df0-157">這些案例需要 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 物件能在主應用程式和增益集應用程式定義域之間傳遞。</span><span class="sxs-lookup"><span data-stu-id="13df0-157">These scenarios require that [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] objects can be passed between host application and add-in application domains.</span></span> <span data-ttu-id="13df0-158">因為 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 增益集模型仰賴應用程式定義域之間的遠端通訊，所以在它們之間傳遞的物件必須可遠端處理。</span><span class="sxs-lookup"><span data-stu-id="13df0-158">Since the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] add-in model relies on remoting to communicate between application domains, the objects that are passed between them must be remotable.</span></span>  
  
 <span data-ttu-id="13df0-159">可在遠端處理的物件是執行下列一或多個工作的類別執行個體︰</span><span class="sxs-lookup"><span data-stu-id="13df0-159">A remotable object is an instance of a class that does one or more of the following:</span></span>  
  
-   <span data-ttu-id="13df0-160">衍生自<xref:System.MarshalByRefObject>類別。</span><span class="sxs-lookup"><span data-stu-id="13df0-160">Derives from the <xref:System.MarshalByRefObject> class.</span></span>  
  
-   <span data-ttu-id="13df0-161">實作 <xref:System.Runtime.Serialization.ISerializable> 介面。</span><span class="sxs-lookup"><span data-stu-id="13df0-161">Implements the <xref:System.Runtime.Serialization.ISerializable> interface.</span></span>  
  
-   <span data-ttu-id="13df0-162">具有<xref:System.SerializableAttribute>套用的屬性。</span><span class="sxs-lookup"><span data-stu-id="13df0-162">Has the <xref:System.SerializableAttribute> attribute applied.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="13df0-163">如需建立可遠端處理之 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 物件的詳細資訊，請參閱[讓物件變成可遠端處理](https://msdn.microsoft.com/library/01197253-3f13-43b7-894d-9683e431192a)。</span><span class="sxs-lookup"><span data-stu-id="13df0-163">For more information regarding the creation of remotable [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] objects, see [Making Objects Remotable](https://msdn.microsoft.com/library/01197253-3f13-43b7-894d-9683e431192a).</span></span>  
  
 <span data-ttu-id="13df0-164">[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 類型不能從遠端處理。</span><span class="sxs-lookup"><span data-stu-id="13df0-164">The [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] types are not remotable.</span></span> <span data-ttu-id="13df0-165">為解決此問題，[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 會擴充 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 增益集模型，從主應用程式顯示增益集建立的 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)][!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="13df0-165">To solve the problem, [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] extends the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] add-in model to enable [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] created by add-ins to be displayed from host applications.</span></span> <span data-ttu-id="13df0-166">這項支援由提供[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]由兩種類型：<xref:System.AddIn.Contract.INativeHandleContract>介面和實作的兩個靜態方法<xref:System.AddIn.Pipeline.FrameworkElementAdapters>類別：<xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>和<xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>。</span><span class="sxs-lookup"><span data-stu-id="13df0-166">This support is provided by [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] by two types: the <xref:System.AddIn.Contract.INativeHandleContract> interface and two static methods implemented by the <xref:System.AddIn.Pipeline.FrameworkElementAdapters> class: <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A> and <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>.</span></span> <span data-ttu-id="13df0-167">概括而言，這些類型和方法的使用方式如下︰</span><span class="sxs-lookup"><span data-stu-id="13df0-167">At a high level, these types and methods are used in the following manner:</span></span>  
  
1.  [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]<span data-ttu-id="13df0-168"> 要求[!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)]所提供增益集是直接或間接衍生自的類別<xref:System.Windows.FrameworkElement>，例如圖形、 控制項、 使用者控制項、 版面配置面板和頁面。</span><span class="sxs-lookup"><span data-stu-id="13df0-168"> requires that [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] provided by add-ins are classes that derive directly or indirectly from <xref:System.Windows.FrameworkElement>, such as shapes, controls, user controls, layout panels, and pages.</span></span>  
  
2.  <span data-ttu-id="13df0-169">只要合約宣告 UI，將增益集與主應用程式之間傳遞，它必須宣告為<xref:System.AddIn.Contract.INativeHandleContract>(不<xref:System.Windows.FrameworkElement>);<xref:System.AddIn.Contract.INativeHandleContract>增益集可遠端處理表示[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]可以在跨越隔離界限傳遞。</span><span class="sxs-lookup"><span data-stu-id="13df0-169">Wherever the contract declares that a UI will be passed between the add-in and the host application, it must be declared as an <xref:System.AddIn.Contract.INativeHandleContract> (not a <xref:System.Windows.FrameworkElement>); <xref:System.AddIn.Contract.INativeHandleContract> is a remotable representation of the add-in [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] that can be passed across isolation boundaries.</span></span>  
  
3.  <span data-ttu-id="13df0-170">從增益集的應用程式定義域中，在傳遞之前<xref:System.Windows.FrameworkElement>會封裝成<xref:System.AddIn.Contract.INativeHandleContract>藉由呼叫<xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>。</span><span class="sxs-lookup"><span data-stu-id="13df0-170">Before being passed from the add-in's application domain, a <xref:System.Windows.FrameworkElement> is packaged as an <xref:System.AddIn.Contract.INativeHandleContract> by calling <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>.</span></span>  
  
4.  <span data-ttu-id="13df0-171">傳遞至主應用程式的應用程式定義域之後,<xref:System.AddIn.Contract.INativeHandleContract>必須重新封裝為<xref:System.Windows.FrameworkElement>藉由呼叫<xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>。</span><span class="sxs-lookup"><span data-stu-id="13df0-171">After being passed to the host application's application domain, the <xref:System.AddIn.Contract.INativeHandleContract> must be repackaged as a <xref:System.Windows.FrameworkElement> by calling <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>.</span></span>  
  
 <span data-ttu-id="13df0-172">如何<xref:System.AddIn.Contract.INativeHandleContract>， <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>，和<xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>使用取決於特定案例。</span><span class="sxs-lookup"><span data-stu-id="13df0-172">How <xref:System.AddIn.Contract.INativeHandleContract>, <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>, and <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A> are used depends on the specific scenario.</span></span> <span data-ttu-id="13df0-173">下列各節提供每個程式設計模型的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="13df0-173">The following sections provide details for each programming model.</span></span>  
  
<a name="ReturnUIFromAddInContract"></a>   
## <a name="add-in-returns-a-user-interface"></a><span data-ttu-id="13df0-174">增益集傳回使用者介面</span><span class="sxs-lookup"><span data-stu-id="13df0-174">Add-In Returns a User Interface</span></span>  
 <span data-ttu-id="13df0-175">為使增益集將 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 傳回至主應用程式，需要︰</span><span class="sxs-lookup"><span data-stu-id="13df0-175">For an add-in to return a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] to a host application, the following are required:</span></span>  
  
1.  <span data-ttu-id="13df0-176">您必須建立主應用程式、增益集和管線，如[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)][增益集和擴充性](../../../../docs/framework/add-ins/index.md)一文所述。</span><span class="sxs-lookup"><span data-stu-id="13df0-176">The host application, add-in, and pipeline must be created, as described by the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] [Add-ins and Extensibility](../../../../docs/framework/add-ins/index.md) documentation.</span></span>  
  
2.  <span data-ttu-id="13df0-177">合約必須實作<xref:System.AddIn.Contract.IContract>並傳回[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]，合約必須宣告具有型別的傳回值的方法<xref:System.AddIn.Contract.INativeHandleContract>。</span><span class="sxs-lookup"><span data-stu-id="13df0-177">The contract must implement <xref:System.AddIn.Contract.IContract> and, to return a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)], the contract must declare a method with a return value of type <xref:System.AddIn.Contract.INativeHandleContract>.</span></span>  
  
3.  <span data-ttu-id="13df0-178">[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]傳遞增益集與主機之間的應用程式必須直接或間接衍生自<xref:System.Windows.FrameworkElement>。</span><span class="sxs-lookup"><span data-stu-id="13df0-178">The [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] that is passed between the add-in and the host application must directly or indirectly derive from <xref:System.Windows.FrameworkElement>.</span></span>  
  
4.  <span data-ttu-id="13df0-179">[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]傳回的增益集必須轉換從<xref:System.Windows.FrameworkElement>到<xref:System.AddIn.Contract.INativeHandleContract>跨越隔離界限之前。</span><span class="sxs-lookup"><span data-stu-id="13df0-179">The [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] that is returned by the add-in must be converted from a <xref:System.Windows.FrameworkElement> to an <xref:System.AddIn.Contract.INativeHandleContract> before crossing the isolation boundary.</span></span>  
  
5.  <span data-ttu-id="13df0-180">[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]傳回必須從轉換<xref:System.AddIn.Contract.INativeHandleContract>到<xref:System.Windows.FrameworkElement>跨越隔離界限之後。</span><span class="sxs-lookup"><span data-stu-id="13df0-180">The [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] that is returned must be converted from an <xref:System.AddIn.Contract.INativeHandleContract> to a <xref:System.Windows.FrameworkElement> after crossing the isolation boundary.</span></span>  
  
6.  <span data-ttu-id="13df0-181">主應用程式會顯示傳回<xref:System.Windows.FrameworkElement>。</span><span class="sxs-lookup"><span data-stu-id="13df0-181">The host application displays the returned <xref:System.Windows.FrameworkElement>.</span></span>  
  
 <span data-ttu-id="13df0-182">如需示範如何實作會傳回 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 的增益集範例，請參閱[建立傳回 UI 的增益集](../../../../docs/framework/wpf/app-development/how-to-create-an-add-in-that-returns-a-ui.md)。</span><span class="sxs-lookup"><span data-stu-id="13df0-182">For an example that demonstrates how to implement an add-in that returns a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)], see [Create an Add-In That Returns a UI](../../../../docs/framework/wpf/app-development/how-to-create-an-add-in-that-returns-a-ui.md).</span></span>  
  
<a name="AddInIsAUI"></a>   
## <a name="add-in-is-a-user-interface"></a><span data-ttu-id="13df0-183">增益集是使用者介面</span><span class="sxs-lookup"><span data-stu-id="13df0-183">Add-In Is a User Interface</span></span>  
 <span data-ttu-id="13df0-184">當增益集是 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 時，需要︰</span><span class="sxs-lookup"><span data-stu-id="13df0-184">When an add-in is a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)], the following are required:</span></span>  
  
1.  <span data-ttu-id="13df0-185">您必須建立主應用程式、增益集和管線，如[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)][增益集和擴充性](../../../../docs/framework/add-ins/index.md)一文所述。</span><span class="sxs-lookup"><span data-stu-id="13df0-185">The host application, add-in, and pipeline must be created, as described by the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] [Add-ins and Extensibility](../../../../docs/framework/add-ins/index.md) documentation.</span></span>  
  
2.  <span data-ttu-id="13df0-186">增益集的合約介面必須實作<xref:System.AddIn.Contract.INativeHandleContract>。</span><span class="sxs-lookup"><span data-stu-id="13df0-186">The contract interface for the add-in must implement <xref:System.AddIn.Contract.INativeHandleContract>.</span></span>  
  
3.  <span data-ttu-id="13df0-187">傳遞至主應用程式增益集必須直接或間接衍生自<xref:System.Windows.FrameworkElement>。</span><span class="sxs-lookup"><span data-stu-id="13df0-187">The add-in that is passed to the host application must directly or indirectly derive from <xref:System.Windows.FrameworkElement>.</span></span>  
  
4.  <span data-ttu-id="13df0-188">增益集必須從轉換<xref:System.Windows.FrameworkElement>至<xref:System.AddIn.Contract.INativeHandleContract>跨越隔離界限之前。</span><span class="sxs-lookup"><span data-stu-id="13df0-188">The add-in must be converted from a <xref:System.Windows.FrameworkElement> to an <xref:System.AddIn.Contract.INativeHandleContract> before crossing the isolation boundary.</span></span>  
  
5.  <span data-ttu-id="13df0-189">增益集必須從轉換<xref:System.AddIn.Contract.INativeHandleContract>至<xref:System.Windows.FrameworkElement>跨越隔離界限之後。</span><span class="sxs-lookup"><span data-stu-id="13df0-189">The add-in must be converted from an <xref:System.AddIn.Contract.INativeHandleContract> to a <xref:System.Windows.FrameworkElement> after crossing the isolation boundary.</span></span>  
  
6.  <span data-ttu-id="13df0-190">主應用程式會顯示傳回<xref:System.Windows.FrameworkElement>。</span><span class="sxs-lookup"><span data-stu-id="13df0-190">The host application displays the returned <xref:System.Windows.FrameworkElement>.</span></span>  
  
 <span data-ttu-id="13df0-191">如需示範如何實作本身即為 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 的增益集範例，請參閱[建立本身為 UI 的增益集](../../../../docs/framework/wpf/app-development/how-to-create-an-add-in-that-is-a-ui.md)。</span><span class="sxs-lookup"><span data-stu-id="13df0-191">For an example that demonstrates how to implement an add-in that is a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)], see [Create an Add-In That Is a UI](../../../../docs/framework/wpf/app-development/how-to-create-an-add-in-that-is-a-ui.md).</span></span>  
  
<a name="ReturningMultipleUIsFromAnAddIn"></a>   
## <a name="returning-multiple-uis-from-an-add-in"></a><span data-ttu-id="13df0-192">從增益集傳回多個 UI</span><span class="sxs-lookup"><span data-stu-id="13df0-192">Returning Multiple UIs from an Add-In</span></span>  
 <span data-ttu-id="13df0-193">增益集通常會提供多個 [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] 供主應用程式顯示。</span><span class="sxs-lookup"><span data-stu-id="13df0-193">Add-ins often provide multiple [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] for host applications to display.</span></span> <span data-ttu-id="13df0-194">例如，增益集是向主應用程式提供狀態資訊的 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]，也是 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="13df0-194">For example, consider an add-in that is a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] that also provides status information to the host application, also as a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span> <span data-ttu-id="13df0-195">像這樣的增益集的實作方法是，使用[增益集傳回使用者介面](#ReturnUIFromAddInContract)和[增益集是使用者介面](#AddInIsAUI)模型這兩種技術的組合。</span><span class="sxs-lookup"><span data-stu-id="13df0-195">An add-in like this can be implemented by using a combination of techniques from both the [Add-In Returns a User Interface](#ReturnUIFromAddInContract) and [Add-In Is a User Interface](#AddInIsAUI) models.</span></span>  
  
<a name="AddInsAndXBAPs"></a>   
## <a name="add-ins-and-xaml-browser-applications"></a><span data-ttu-id="13df0-196">增益集和 XAML 瀏覽器應用程式</span><span class="sxs-lookup"><span data-stu-id="13df0-196">Add-Ins and XAML Browser Applications</span></span>  
 <span data-ttu-id="13df0-197">在到目前為止的範例中，主應用程式一直是已安裝的獨立應用程式。</span><span class="sxs-lookup"><span data-stu-id="13df0-197">In the examples so far, the host application has been an installed standalone application.</span></span> <span data-ttu-id="13df0-198">但是 [!INCLUDE[TLA#tla_xbap#plural](../../../../includes/tlasharptla-xbapsharpplural-md.md)] 也可以裝載增益集，儘管有下列額外組建和實作需求︰</span><span class="sxs-lookup"><span data-stu-id="13df0-198">But [!INCLUDE[TLA#tla_xbap#plural](../../../../includes/tlasharptla-xbapsharpplural-md.md)] can also host add-ins, albeit with the following additional build and implementation requirements:</span></span>  
  
-   <span data-ttu-id="13df0-199">[!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] 應用程式資訊清單必須特別設定為將管線 (資料夾和組件) 和增益集組件下載至用戶端電腦的 [!INCLUDE[TLA#tla_clickonce](../../../../includes/tlasharptla-clickonce-md.md)] 應用程式快取，和 [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] 在相同的資料夾中。</span><span class="sxs-lookup"><span data-stu-id="13df0-199">The [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] application manifest must be configured specially to download the pipeline (folders and assemblies) and add-in assembly to the [!INCLUDE[TLA#tla_clickonce](../../../../includes/tlasharptla-clickonce-md.md)] application cache on the client machine, in the same folder as the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)].</span></span>  
  
-   <span data-ttu-id="13df0-200">探索及載入增益集的 [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] 程式碼必須使用 [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] 的 [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] 應用程式快取作為管線和增益集位置。</span><span class="sxs-lookup"><span data-stu-id="13df0-200">The [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] code to discover and load add-ins must use the [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] application cache for the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] as the pipeline and add-in location.</span></span>  
  
-   <span data-ttu-id="13df0-201">如果增益集參考位於原始網站的鬆散式檔案，[!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] 必須將增益集載入特殊的安全性內容；為 [!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)] 所裝載時，增益集只能參考位於主應用程式原始網站的鬆散式檔案。</span><span class="sxs-lookup"><span data-stu-id="13df0-201">The [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] must load the add-in into a special security context if the add-in references loose files that are located at the site of origin; when hosted by [!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)], add-ins can only reference loose files that are located at the host application's site of origin.</span></span>  
  
 <span data-ttu-id="13df0-202">下列各小節將詳細說明這些工作。</span><span class="sxs-lookup"><span data-stu-id="13df0-202">These tasks are described in detail in the following subsections.</span></span>  
  
### <a name="configuring-the-pipeline-and-add-in-for-clickonce-deployment"></a><span data-ttu-id="13df0-203">設定 ClickOnce 部署的管線和增益集</span><span class="sxs-lookup"><span data-stu-id="13df0-203">Configuring the Pipeline and Add-In for ClickOnce Deployment</span></span>  
 [!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)]<span data-ttu-id="13df0-204"> 會下載到 [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] 部署快取的安全資料夾中並執行。</span><span class="sxs-lookup"><span data-stu-id="13df0-204"> are downloaded to and run from a safe folder in the [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] deployment cache.</span></span> <span data-ttu-id="13df0-205">為了讓 [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] 裝載增益集，管線和增益集組件必須也下載到安全資料夾。</span><span class="sxs-lookup"><span data-stu-id="13df0-205">In order for an [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] to host an add-in, the pipeline and add-in assembly must also be downloaded to the safe folder.</span></span> <span data-ttu-id="13df0-206">為達到此目的，您需要設定應用程式資訊清單包含管線和增益集組件以供下載。</span><span class="sxs-lookup"><span data-stu-id="13df0-206">To achieve this, you need to configure the application manifest to include both the pipeline and add-in assembly for download.</span></span> <span data-ttu-id="13df0-207">這在 [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)] 最容易完成，雖然管線和增益集組件需要位在裝載 [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] 專案的根資料夾中，才能讓 [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)] 偵測管線組件。</span><span class="sxs-lookup"><span data-stu-id="13df0-207">This is most easily done in [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)], although the pipeline and add-in assembly needs to be in the host [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] project's root folder in order for [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)] to detect the pipeline assemblies.</span></span>  
  
 <span data-ttu-id="13df0-208">因此，第一個步驟是設定每個管線組件和增益集組件專案的組建輸出，組建 [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] 專案根目錄的管線和增益集組件。</span><span class="sxs-lookup"><span data-stu-id="13df0-208">Consequently, the first step is to build the pipeline and add-in assembly to the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] project's root by setting the build output of each pipeline assembly and add-in assembly projects.</span></span> <span data-ttu-id="13df0-209">下表顯示管線組件專案及增益集組件專案的組建輸出路徑，這些專案和裝載 [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] 專案位在相同的解決方案和根資料夾中。</span><span class="sxs-lookup"><span data-stu-id="13df0-209">The following table shows the build output paths for pipeline assembly projects and add-in assembly project that are in the same solution and root folder as the host [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] project.</span></span>  
  
 <span data-ttu-id="13df0-210">表 1：XBAP 裝載之管線組件的組建輸出路徑</span><span class="sxs-lookup"><span data-stu-id="13df0-210">Table 1: Build Output Paths for the Pipeline Assemblies That Are Hosted by an XBAP</span></span>  
  
|<span data-ttu-id="13df0-211">管線組件專案</span><span class="sxs-lookup"><span data-stu-id="13df0-211">Pipeline assembly project</span></span>|<span data-ttu-id="13df0-212">建置輸出路徑</span><span class="sxs-lookup"><span data-stu-id="13df0-212">Build output path</span></span>|  
|-------------------------------|-----------------------|  
|<span data-ttu-id="13df0-213">合約</span><span class="sxs-lookup"><span data-stu-id="13df0-213">Contract</span></span>|`..\HostXBAP\Contracts\`|  
|<span data-ttu-id="13df0-214">增益集檢視</span><span class="sxs-lookup"><span data-stu-id="13df0-214">Add-In View</span></span>|`..\HostXBAP\AddInViews\`|  
|<span data-ttu-id="13df0-215">增益集端配接器</span><span class="sxs-lookup"><span data-stu-id="13df0-215">Add-In-Side Adapter</span></span>|`..\HostXBAP\AddInSideAdapters\`|  
|<span data-ttu-id="13df0-216">主控件端配接器</span><span class="sxs-lookup"><span data-stu-id="13df0-216">Host-Side Adapter</span></span>|`..\HostXBAP\HostSideAdapters\`|  
|<span data-ttu-id="13df0-217">增益集</span><span class="sxs-lookup"><span data-stu-id="13df0-217">Add-In</span></span>|`..\HostXBAP\AddIns\WPFAddIn1`|  
  
 <span data-ttu-id="13df0-218">下一步是執行下列步驟，將管線組件和增益集組件指定為 [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)] 的 [!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)] 內容檔案︰</span><span class="sxs-lookup"><span data-stu-id="13df0-218">The next step is to specify the pipeline assemblies and add-in assembly as the [!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)] content files in [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)] by doing the following:</span></span>  
  
1.  <span data-ttu-id="13df0-219">以滑鼠右鍵按一下方案總管中每個管線資料夾，然後選擇 [加入至專案]，在專案中包含管線和增益集組件。</span><span class="sxs-lookup"><span data-stu-id="13df0-219">Including the pipeline and add-in assembly in the project by right-clicking each pipeline folder in Solution Explorer and choosing **Include In Project**.</span></span>  
  
2.  <span data-ttu-id="13df0-220">從 [屬性] 視窗將每個管線組件和增益集組件的 [建置動作] 設定為 [內容]。</span><span class="sxs-lookup"><span data-stu-id="13df0-220">Setting the **Build Action** of each pipeline assembly and add-in assembly to **Content** from the **Properties** window.</span></span>  
  
 <span data-ttu-id="13df0-221">最後一個步驟，是設定應用程式資訊清單包含管線組件檔和增益集組件檔以供下載。</span><span class="sxs-lookup"><span data-stu-id="13df0-221">The final step is to configure the application manifest to include the pipeline assembly files and add-in assembly file for download.</span></span> <span data-ttu-id="13df0-222">這些檔案應該位於 [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] 應用程式佔用的 [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] 快取根資料夾的資料夾中。</span><span class="sxs-lookup"><span data-stu-id="13df0-222">The files should be located in folders at the root of the folder in the [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] cache that the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] application occupies.</span></span> <span data-ttu-id="13df0-223">執行下列作業可 [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)] 達成設定：</span><span class="sxs-lookup"><span data-stu-id="13df0-223">The configuration can be achieved in [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)] by doing the following:</span></span>  
  
1.  <span data-ttu-id="13df0-224">以滑鼠右鍵按一下 [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] 專案，再依序按一下 [屬性]、[發佈] 和 [應用程式檔案] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="13df0-224">Right-click the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] project, click **Properties**, click **Publish**, and then click the **Application Files** button.</span></span>  
  
2.  <span data-ttu-id="13df0-225">在 [應用程式檔案] 對話方塊中，將每個管線和增益集 DLL 的 [發行狀態] 設成 [Include (Auto)] (包含 (自動))，並將每個管線和增益集 DLL 的 [下載群組] 設成 [(必要項)]。</span><span class="sxs-lookup"><span data-stu-id="13df0-225">In the **Application Files** dialog, set the **Publish Status** of each pipeline and add-in DLL to **Include (Auto)**, and set the **Download Group** for each pipeline and add-in DLL to **(Required)**.</span></span>  
  
### <a name="using-the-pipeline-and-add-in-from-the-application-base"></a><span data-ttu-id="13df0-226">使用來自應用程式基底的管線和增益集</span><span class="sxs-lookup"><span data-stu-id="13df0-226">Using the Pipeline and Add-In from the Application Base</span></span>  
 <span data-ttu-id="13df0-227">針對 [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)]部署設定管線和增益集時，它們會下載到和 [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] 相同的 [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] 快取資料夾。</span><span class="sxs-lookup"><span data-stu-id="13df0-227">When the pipeline and add-in are configured for [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] deployment, they are downloaded to the same [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] cache folder as the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)].</span></span> <span data-ttu-id="13df0-228">若要使用來自 [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] 的管線和增益集，[!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] 程式碼必須從應用程式基底取得它們。</span><span class="sxs-lookup"><span data-stu-id="13df0-228">To use the pipeline and add-in from the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)], the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] code must get them from the application base.</span></span> <span data-ttu-id="13df0-229">使用管線和增益集的 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 增益集模型各種類型和成員為此狀況提供特殊支援。</span><span class="sxs-lookup"><span data-stu-id="13df0-229">The various types and members of the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] add-in model for using pipelines and add-ins provide special support for this scenario.</span></span> <span data-ttu-id="13df0-230">首先，會識別路徑<xref:System.AddIn.Hosting.PipelineStoreLocation.ApplicationBase>列舉值。</span><span class="sxs-lookup"><span data-stu-id="13df0-230">Firstly, the path is identified by the <xref:System.AddIn.Hosting.PipelineStoreLocation.ApplicationBase> enumeration value.</span></span> <span data-ttu-id="13df0-231">您使用此值與相關增益集成員的多載處理使用包含下列各項的管線︰</span><span class="sxs-lookup"><span data-stu-id="13df0-231">You use this value with overloads of the pertinent add-in members for using pipelines that include the following:</span></span>  
  
-   <xref:System.AddIn.Hosting.AddInStore.FindAddIns%28System.Type%2CSystem.AddIn.Hosting.PipelineStoreLocation%29?displayProperty=nameWithType>  
  
-   <xref:System.AddIn.Hosting.AddInStore.FindAddIns%28System.Type%2CSystem.AddIn.Hosting.PipelineStoreLocation%2CSystem.String%5B%5D%29?displayProperty=nameWithType>  
  
-   <xref:System.AddIn.Hosting.AddInStore.Rebuild%28System.AddIn.Hosting.PipelineStoreLocation%29?displayProperty=nameWithType>  
  
-   <xref:System.AddIn.Hosting.AddInStore.Update%28System.AddIn.Hosting.PipelineStoreLocation%29?displayProperty=nameWithType>  
  
### <a name="accessing-the-hosts-site-of-origin"></a><span data-ttu-id="13df0-232">存取裝載的原始網站</span><span class="sxs-lookup"><span data-stu-id="13df0-232">Accessing the Host's Site of Origin</span></span>  
 <span data-ttu-id="13df0-233">為確保增益集能參考原始網站的檔案，必須使用相當於主應用程式的安全性隔離載入增益集。</span><span class="sxs-lookup"><span data-stu-id="13df0-233">To ensure that an add-in can reference files from the site of origin, the add-in must be loaded with security isolation that is equivalent to the host application.</span></span> <span data-ttu-id="13df0-234">此安全性層級由<xref:System.AddIn.Hosting.AddInSecurityLevel.Host?displayProperty=nameWithType>列舉值，並傳遞至<xref:System.AddIn.Hosting.AddInToken.Activate%2A>增益集啟動時的方法。</span><span class="sxs-lookup"><span data-stu-id="13df0-234">This security level is identified by the <xref:System.AddIn.Hosting.AddInSecurityLevel.Host?displayProperty=nameWithType> enumeration value, and passed to the <xref:System.AddIn.Hosting.AddInToken.Activate%2A> method when an add-in is activated.</span></span>  
  
<a name="WPFAddInModelArchitecture"></a>   
## <a name="wpf-add-in-architecture"></a><span data-ttu-id="13df0-235">WPF 增益集架構</span><span class="sxs-lookup"><span data-stu-id="13df0-235">WPF Add-In Architecture</span></span>  
 <span data-ttu-id="13df0-236">在最高的層級，如我們所見，[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]可讓[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]增益集來實作[!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)](直接或間接衍生自<xref:System.Windows.FrameworkElement>) 使用<xref:System.AddIn.Contract.INativeHandleContract>，<xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>並<xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>。</span><span class="sxs-lookup"><span data-stu-id="13df0-236">At the highest level, as we've seen, [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] enables [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] add-ins to implement [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] (that derive directly or indirectly from <xref:System.Windows.FrameworkElement>) using <xref:System.AddIn.Contract.INativeHandleContract>, <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A> and <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>.</span></span> <span data-ttu-id="13df0-237">結果是主應用程式會傳回<xref:System.Windows.FrameworkElement>顯示從[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]主應用程式。</span><span class="sxs-lookup"><span data-stu-id="13df0-237">The result is that the host application is returned a <xref:System.Windows.FrameworkElement> that is displayed from [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] in the host application.</span></span>  
  
 <span data-ttu-id="13df0-238">若為簡單的 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 增益集案例，這是開發人員需要的最詳細資料。</span><span class="sxs-lookup"><span data-stu-id="13df0-238">For simple [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] add-in scenarios, this is as much detail as a developer needs.</span></span> <span data-ttu-id="13df0-239">若為更複雜的案例，特別是嘗試使用其他 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 服務，例如版面配置、資源及資料繫結，需要更深入瞭解 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 如何擴充 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 增益集模型與 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 支援，以瞭解其優點和限制。</span><span class="sxs-lookup"><span data-stu-id="13df0-239">For more complex scenarios, particularly those that try to utilize additional [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] services such as layout, resources, and data binding, more detailed knowledge of how [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] extends the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] add-in model with [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] support is required to understand its benefits and limitations.</span></span>  
  
 <span data-ttu-id="13df0-240">基本上，[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 不會從增益集將 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 傳送到主應用程式；而是 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 使用 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 互通性傳送 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 的 Win32 視窗控制代碼。</span><span class="sxs-lookup"><span data-stu-id="13df0-240">Fundamentally, [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] doesn't pass a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] from an add-in to a host application; instead, [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] passes the Win32 window handle for the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] by using [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] interoperability.</span></span> <span data-ttu-id="13df0-241">因此，當 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 從增益集傳遞至主應用程式時，會發生下列情況︰</span><span class="sxs-lookup"><span data-stu-id="13df0-241">As such, when a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] from an add-in is passed to a host application, the following occurs:</span></span>  
  
-   <span data-ttu-id="13df0-242">在增益集端，[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 取得主應用程式會顯示之 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 的視窗控制代碼。</span><span class="sxs-lookup"><span data-stu-id="13df0-242">On the add-in side, [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] acquires a window handle for the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] that will be displayed by the host application.</span></span> <span data-ttu-id="13df0-243">視窗控制代碼會封裝的內部[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]類別衍生自<xref:System.Windows.Interop.HwndSource>並實作<xref:System.AddIn.Contract.INativeHandleContract>。</span><span class="sxs-lookup"><span data-stu-id="13df0-243">The window handle is encapsulated by an internal [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] class that derives from <xref:System.Windows.Interop.HwndSource> and implements <xref:System.AddIn.Contract.INativeHandleContract>.</span></span> <span data-ttu-id="13df0-244">此類別的執行個體由<xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>並且從增益集的應用程式定義域中主應用程式的應用程式定義域來封送處理。</span><span class="sxs-lookup"><span data-stu-id="13df0-244">An instance of this class is returned by <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A> and is marshaled from the add-in's application domain to the host application's application domain.</span></span>  
  
-   <span data-ttu-id="13df0-245">在主機應用程式端， [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] repackages<xref:System.Windows.Interop.HwndSource>為內部[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]類別衍生自<xref:System.Windows.Interop.HwndHost>並取用<xref:System.AddIn.Contract.INativeHandleContract>。</span><span class="sxs-lookup"><span data-stu-id="13df0-245">On the host application side, [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] repackages the <xref:System.Windows.Interop.HwndSource> as an internal [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] class that derives from <xref:System.Windows.Interop.HwndHost> and consumes <xref:System.AddIn.Contract.INativeHandleContract>.</span></span> <span data-ttu-id="13df0-246">此類別的執行個體由<xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>主應用程式。</span><span class="sxs-lookup"><span data-stu-id="13df0-246">An instance of this class is returned by <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A> to the host application.</span></span>  
  
 <span data-ttu-id="13df0-247"><xref:System.Windows.Interop.HwndHost> 顯示存在於[!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)]，從視窗控制代碼，識別[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="13df0-247"><xref:System.Windows.Interop.HwndHost> exists to display [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)], identified by window handles, from [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)].</span></span> <span data-ttu-id="13df0-248">如需詳細資訊，請參閱 [WPF 和 Win32 互通](../../../../docs/framework/wpf/advanced/wpf-and-win32-interoperation.md)。</span><span class="sxs-lookup"><span data-stu-id="13df0-248">For more information, see [WPF and Win32 Interoperation](../../../../docs/framework/wpf/advanced/wpf-and-win32-interoperation.md).</span></span>  
  
 <span data-ttu-id="13df0-249">在 [摘要] <xref:System.AddIn.Contract.INativeHandleContract>， <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>，並<xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>存在以允許的視窗控制代碼[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)][!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]要從增益集傳遞至主應用程式，它會封裝由<xref:System.Windows.Interop.HwndHost>並顯示主應用程式應用程式的[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="13df0-249">In summary, <xref:System.AddIn.Contract.INativeHandleContract>, <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>, and <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A> exist to allow the window handle for a [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] to be passed from an add-in to a host application, where it is encapsulated by a <xref:System.Windows.Interop.HwndHost> and displayed the host application's [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="13df0-250">因為主應用程式取得<xref:System.Windows.Interop.HwndHost>，主應用程式無法轉換所傳回的物件<xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>型別實作藉由增益集 (比方說， <xref:System.Windows.Controls.UserControl>)。</span><span class="sxs-lookup"><span data-stu-id="13df0-250">Because the host application gets an <xref:System.Windows.Interop.HwndHost>, the host application cannot convert the object that is returned by <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A> to the type it is implemented as by the add-in (for example, a <xref:System.Windows.Controls.UserControl>).</span></span>  
  
 <span data-ttu-id="13df0-251">本質上，<xref:System.Windows.Interop.HwndHost>有某些限制，會影響主應用程式如何使用它們。</span><span class="sxs-lookup"><span data-stu-id="13df0-251">By its nature, <xref:System.Windows.Interop.HwndHost> has certain limitations that affect how host applications can use them.</span></span> <span data-ttu-id="13df0-252">不過，[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]擴充<xref:System.Windows.Interop.HwndHost>與增益集案例的幾項功能。</span><span class="sxs-lookup"><span data-stu-id="13df0-252">However, [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] extends <xref:System.Windows.Interop.HwndHost> with several capabilities for add-in scenarios.</span></span> <span data-ttu-id="13df0-253">下文說明這些優點與限制。</span><span class="sxs-lookup"><span data-stu-id="13df0-253">These benefits and limitations are described below.</span></span>  
  
<a name="WPFAddInModelBenefits"></a>   
## <a name="wpf-add-in-benefits"></a><span data-ttu-id="13df0-254">WPF 增益集的優點</span><span class="sxs-lookup"><span data-stu-id="13df0-254">WPF Add-In Benefits</span></span>  
 <span data-ttu-id="13df0-255">因為[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]增益集[!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)]會顯示從主應用程式使用的內部類別衍生自<xref:System.Windows.Interop.HwndHost>，這些[!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)]會受限於各種<xref:System.Windows.Interop.HwndHost>相對於[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]服務，例如版面配置、 轉譯、 資料繫結、 樣式、 範本和資源。</span><span class="sxs-lookup"><span data-stu-id="13df0-255">Because [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] add-in [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] are displayed from host applications using an internal class that derives from <xref:System.Windows.Interop.HwndHost>, those [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] are constrained by the capabilities of <xref:System.Windows.Interop.HwndHost> with respect to [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] services such as layout, rendering, data binding, styles, templates, and resources.</span></span> <span data-ttu-id="13df0-256">不過，[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]擴大其內部<xref:System.Windows.Interop.HwndHost>子類別與其他功能，包括下列：</span><span class="sxs-lookup"><span data-stu-id="13df0-256">However, [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] augments its internal <xref:System.Windows.Interop.HwndHost> subclass with additional capabilities that include the following:</span></span>  
  
-   <span data-ttu-id="13df0-257">切換主應用程式的 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 和增益集的 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="13df0-257">Tabbing between a host application's [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] and an add-in's [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span> <span data-ttu-id="13df0-258">請注意，「 增益集[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]」 程式設計模型需使用增益集端配接器，來覆寫<xref:System.AddIn.Pipeline.ContractBase.QueryContract%2A>以啟用定位處理，無論增益集是完全受信任或部分信任的。</span><span class="sxs-lookup"><span data-stu-id="13df0-258">Note that the "add-in is a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]" programming model requires the add-in-side adapter to override <xref:System.AddIn.Pipeline.ContractBase.QueryContract%2A> to enable tabbing, whether the add-in is fully trusted or partially trusted.</span></span>  
  
-   <span data-ttu-id="13df0-259">接受從主應用程式 [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] 顯示的增益集 [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] 的協助工具需求。</span><span class="sxs-lookup"><span data-stu-id="13df0-259">Honoring accessibility requirements for add-in [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] that are displayed from host application [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)].</span></span>  
  
-   <span data-ttu-id="13df0-260">讓 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 應用程式在多個應用程式定義域情況下安全執行。</span><span class="sxs-lookup"><span data-stu-id="13df0-260">Enabling [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] applications to run safely in multiple application domain scenarios.</span></span>  
  
-   <span data-ttu-id="13df0-261">在增益集使用安全性隔離執行時 (即部分信任安全性沙箱)，防止不合法存取增益集 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 視窗控制代碼。</span><span class="sxs-lookup"><span data-stu-id="13df0-261">Preventing illegal access to add-in [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] window handles when add-ins run with security isolation (that is, a partial-trust security sandbox).</span></span> <span data-ttu-id="13df0-262">呼叫<xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>可確保此安全性：</span><span class="sxs-lookup"><span data-stu-id="13df0-262">Calling <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A> ensures this security:</span></span>  
  
    -   <span data-ttu-id="13df0-263">針對 「 增益集傳回[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]」 程式設計模型、 傳遞增益集的視窗控制代碼的唯一辦法[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]跨越隔離界限就是呼叫<xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>。</span><span class="sxs-lookup"><span data-stu-id="13df0-263">For the "add-in returns a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]" programming model, the only way to pass the window handle for an add-in [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] across the isolation boundary is to call <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>.</span></span>  
  
    -   <span data-ttu-id="13df0-264">「 增益集是[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]」 程式設計模型，覆寫<xref:System.AddIn.Pipeline.ContractBase.QueryContract%2A>增益集端配接器和呼叫<xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>（如上述範例所示） 是必要的因為呼叫增益集端配接器的`QueryContract`實作從主應用程式端配接器。</span><span class="sxs-lookup"><span data-stu-id="13df0-264">For the "add-in is a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]" programming model, overriding <xref:System.AddIn.Pipeline.ContractBase.QueryContract%2A> on the add-in-side adapter and calling <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A> (as shown in the preceding examples) is required, as is calling the add-in-side adapter's `QueryContract` implementation from the host-side adapter.</span></span>  
  
-   <span data-ttu-id="13df0-265">提供多個應用程式定義域執行保護。</span><span class="sxs-lookup"><span data-stu-id="13df0-265">Providing multiple application domain execution protection.</span></span> <span data-ttu-id="13df0-266">由於應用程式定義域的限制，增益集應用程式定義域中擲回的未處理例外狀況會導致整個應用程式當機，即使有隔離界限。</span><span class="sxs-lookup"><span data-stu-id="13df0-266">Due to limitations with application domains, unhandled exceptions that are thrown in add-in application domains cause the entire application to crash, even though the isolation boundary exists.</span></span> <span data-ttu-id="13df0-267">不過，[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 和 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 增益集模型提供簡單的方式來解決這個問題，並改善應用程式穩定性。</span><span class="sxs-lookup"><span data-stu-id="13df0-267">However, [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] and the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] add-in model provide a simple way to work around this problem and improve application stability.</span></span> <span data-ttu-id="13df0-268">A[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]增益集，會顯示[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]會建立<xref:System.Windows.Threading.Dispatcher>執行緒上，如果主應用程式執行的應用程式定義域[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]應用程式。</span><span class="sxs-lookup"><span data-stu-id="13df0-268">A [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] add-in that displays a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] creates a <xref:System.Windows.Threading.Dispatcher> for the thread that the application domain runs on, if the host application is a [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] application.</span></span> <span data-ttu-id="13df0-269">您可以偵測應用程式定義域處理會發生的所有未處理例外狀況<xref:System.Windows.Threading.Dispatcher.UnhandledException>事件的[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]增益集的<xref:System.Windows.Threading.Dispatcher>。</span><span class="sxs-lookup"><span data-stu-id="13df0-269">You can detect all unhandled exceptions that occur in the application domain by handling the <xref:System.Windows.Threading.Dispatcher.UnhandledException> event of the [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] add-in's <xref:System.Windows.Threading.Dispatcher>.</span></span> <span data-ttu-id="13df0-270">您可以取得<xref:System.Windows.Threading.Dispatcher>從<xref:System.Windows.Threading.Dispatcher.CurrentDispatcher%2A>屬性。</span><span class="sxs-lookup"><span data-stu-id="13df0-270">You can get the <xref:System.Windows.Threading.Dispatcher> from the <xref:System.Windows.Threading.Dispatcher.CurrentDispatcher%2A> property.</span></span>  
  
<a name="WPFAddInModelLimitations"></a>   
## <a name="wpf-add-in-limitations"></a><span data-ttu-id="13df0-271">WPF 增益集限制</span><span class="sxs-lookup"><span data-stu-id="13df0-271">WPF Add-In Limitations</span></span>  
 <span data-ttu-id="13df0-272">優點之外，[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]加入所提供的預設行為<xref:System.Windows.Interop.HwndSource>， <xref:System.Windows.Interop.HwndHost>，和視窗控制代碼，也會在為增益集的限制[!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)]，會顯示從主應用程式：</span><span class="sxs-lookup"><span data-stu-id="13df0-272">Beyond the benefits that [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] adds to the default behaviors supplied by <xref:System.Windows.Interop.HwndSource>, <xref:System.Windows.Interop.HwndHost>, and window handles, there are also limitations for add-in [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] that are displayed from host applications:</span></span>  
  
-   <span data-ttu-id="13df0-273">從主應用程式顯示的增益集 [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] 不遵守主應用程式的裁剪行為。</span><span class="sxs-lookup"><span data-stu-id="13df0-273">Add-in [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] displayed from a host application do not respect the host application's clipping behavior.</span></span>  
  
-   <span data-ttu-id="13df0-274">互通性案例中的「空間」概念也適用於增益集 (請參閱[技術領域概觀](../../../../docs/framework/wpf/advanced/technology-regions-overview.md))。</span><span class="sxs-lookup"><span data-stu-id="13df0-274">The concept of *airspace* in interoperability scenarios also applies to add-ins (see [Technology Regions Overview](../../../../docs/framework/wpf/advanced/technology-regions-overview.md)).</span></span>  
  
-   <span data-ttu-id="13df0-275">主應用程式的 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 服務，例如資源繼承、資料繫結和命令，不會自動提供給增益集 [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="13df0-275">A host application's [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] services, such as resource inheritance, data binding, and commanding, are not automatically available to add-in [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)].</span></span> <span data-ttu-id="13df0-276">若要向增益集提供這些服務，您需要更新管線。</span><span class="sxs-lookup"><span data-stu-id="13df0-276">To provide these services to the add-in, you need to update the pipeline.</span></span>  
  
-   <span data-ttu-id="13df0-277">增益集 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 不能進行旋轉、縮放、扭曲，也不會受到轉換影響 (請參閱[轉換概觀](../../../../docs/framework/wpf/graphics-multimedia/transforms-overview.md))。</span><span class="sxs-lookup"><span data-stu-id="13df0-277">An add-in [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] cannot be rotated, scaled, skewed, or otherwise affected by a transformation (see [Transforms Overview](../../../../docs/framework/wpf/graphics-multimedia/transforms-overview.md)).</span></span>  
  
-   <span data-ttu-id="13df0-278">增益集內的內容[!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)]藉由繪製作業轉譯<xref:System.Drawing>命名空間可以包含 alpha 混色。</span><span class="sxs-lookup"><span data-stu-id="13df0-278">Content inside add-in [!INCLUDE[TLA2#tla_ui#plural](../../../../includes/tla2sharptla-uisharpplural-md.md)] that is rendered by drawing operations from the <xref:System.Drawing> namespace can include alpha blending.</span></span> <span data-ttu-id="13df0-279">不過，包含它的增益集 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 和主應用程式 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]，兩者都必須是 100% 不透明；換句話說，兩者的 `Opacity` 屬性都必須設為 1。</span><span class="sxs-lookup"><span data-stu-id="13df0-279">However, both an add-in [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] and the host application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] that contains it must be 100% opaque; in other words, the `Opacity` property on both must be set to 1.</span></span>  
  
-   <span data-ttu-id="13df0-280">如果<xref:System.Windows.Window.AllowsTransparency%2A>屬性中包含的增益集主應用程式的視窗[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]設定為`true`，增益集是不可見。</span><span class="sxs-lookup"><span data-stu-id="13df0-280">If the <xref:System.Windows.Window.AllowsTransparency%2A> property of a window in the host application that contains an add-in [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] is set to `true`, the add-in is invisible.</span></span> <span data-ttu-id="13df0-281">即使增益集 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 是 100% 不透明 (也就是 `Opacity` 屬性值為 1) 也一樣。</span><span class="sxs-lookup"><span data-stu-id="13df0-281">This is true even if the add-in [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] is 100% opaque (that is, the `Opacity` property has a value of 1).</span></span>  
  
-   <span data-ttu-id="13df0-282">增益集 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 必須出現在相同最上層視窗中其他 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 項目的上方。</span><span class="sxs-lookup"><span data-stu-id="13df0-282">An add-in [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] must appear on top of other [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] elements in the same top-level window.</span></span>  
  
-   <span data-ttu-id="13df0-283">增益集的任何部分[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]可以使用轉譯<xref:System.Windows.Media.VisualBrush>。</span><span class="sxs-lookup"><span data-stu-id="13df0-283">No portion of an add-in's [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] can be rendered using a <xref:System.Windows.Media.VisualBrush>.</span></span> <span data-ttu-id="13df0-284">增益集反倒可能採用所產生之 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 的快照集建立點陣圖，它可以傳遞至使用合約所定義方法的主應用程式。</span><span class="sxs-lookup"><span data-stu-id="13df0-284">Instead, the add-in may take a snapshot of the generated [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] to create a bitmap that can be passed to the host application using methods defined by the contract.</span></span>  
  
-   <span data-ttu-id="13df0-285">無法從播放媒體檔案<xref:System.Windows.Controls.MediaElement>增益集中[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="13df0-285">Media files cannot be played from a <xref:System.Windows.Controls.MediaElement> in an add-in [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span>  
  
-   <span data-ttu-id="13df0-286">主應用程式不接收也不引發針對增益集 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 產生的滑鼠事件，而主應用程式 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 的 `IsMouseOver` 屬性有值 `false`。</span><span class="sxs-lookup"><span data-stu-id="13df0-286">Mouse events generated for the add-in [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] are neither received nor raised by the host application, and the `IsMouseOver` property for host application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] has a value of `false`.</span></span>  
  
-   <span data-ttu-id="13df0-287">當焦點在增益集 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 的控制項之間移動時，主應用程式不接收也不引發 `GotFocus` 和 `LostFocus` 事件。</span><span class="sxs-lookup"><span data-stu-id="13df0-287">When focus shifts between controls in an add-in [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)], the `GotFocus` and `LostFocus` events are neither received nor raised by the host application.</span></span>  
  
-   <span data-ttu-id="13df0-288">包含增益集 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 的主應用程式在列印時有部分會出現白色。</span><span class="sxs-lookup"><span data-stu-id="13df0-288">The portion of a host application that contains an add-in [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] appears white when printed.</span></span>  
  
-   <span data-ttu-id="13df0-289">所有 dispatcher (請參閱<xref:System.Windows.Threading.Dispatcher>) 建立的增益集[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]必須手動關閉的擁有者增益集卸載之前如果主應用程式會繼續執行。</span><span class="sxs-lookup"><span data-stu-id="13df0-289">All dispatchers (see <xref:System.Windows.Threading.Dispatcher>) created by the add-in [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] must be shut down manually before the owner add-in is unloaded if the host application continues execution.</span></span> <span data-ttu-id="13df0-290">合約可以實作讓主應用程式先通知增益集再卸載增益集的方法，藉此讓增益集 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 關閉其 Dispatcher。</span><span class="sxs-lookup"><span data-stu-id="13df0-290">The contract can implement methods that allow the host application to signal the add-in before the add-in is unloaded, thereby allowing the add-in [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] to shut down its dispatchers.</span></span>  
  
-   <span data-ttu-id="13df0-291">如果增益集[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]已<xref:System.Windows.Controls.InkCanvas>，或包含<xref:System.Windows.Controls.InkCanvas>，您不能卸載增益集。</span><span class="sxs-lookup"><span data-stu-id="13df0-291">If an add-in [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] is an <xref:System.Windows.Controls.InkCanvas> or contains an <xref:System.Windows.Controls.InkCanvas>, you cannot unload the add-in.</span></span>  
  
<a name="PerformanceOptimization"></a>   
## <a name="performance-optimization"></a><span data-ttu-id="13df0-292">效能最佳化</span><span class="sxs-lookup"><span data-stu-id="13df0-292">Performance Optimization</span></span>  
 <span data-ttu-id="13df0-293">根據預設，當使用多個應用程式定義域時，每個應用程式需要的各種 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 組件都會載入該應用程式定義域。</span><span class="sxs-lookup"><span data-stu-id="13df0-293">By default, when multiple application domains are used, the various [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] assemblies required by each application are all loaded into that application's domain.</span></span> <span data-ttu-id="13df0-294">如此一來，建立新應用程式定義域以及從其中啟動應用程式所需的時間，可能會影響效能。</span><span class="sxs-lookup"><span data-stu-id="13df0-294">As a result, the time required for creating new application domains and starting applications in them might affect performance.</span></span> <span data-ttu-id="13df0-295">不過，[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 會提供方法讓您降低啟動時間，如已載入，指示應用程式在各應用程式定義域間共用組件。</span><span class="sxs-lookup"><span data-stu-id="13df0-295">However, the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] provides a way for you to reduce start times by instructing applications to share assemblies across application domains if they are already loaded.</span></span> <span data-ttu-id="13df0-296">您可以使用<xref:System.LoaderOptimizationAttribute>屬性，它必須套用至進入點方法 (`Main`)。</span><span class="sxs-lookup"><span data-stu-id="13df0-296">You do this by using the <xref:System.LoaderOptimizationAttribute> attribute, which must be applied to the entry point method (`Main`).</span></span> <span data-ttu-id="13df0-297">在此情況下，您必須只使用程式碼實作您的應用程式定義 (請參閱[應用程式管理概觀](../../../../docs/framework/wpf/app-development/application-management-overview.md))。</span><span class="sxs-lookup"><span data-stu-id="13df0-297">In this case, you must use only code to implement your application definition (see [Application Management Overview](../../../../docs/framework/wpf/app-development/application-management-overview.md)).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="13df0-298">另請參閱</span><span class="sxs-lookup"><span data-stu-id="13df0-298">See Also</span></span>  
 <xref:System.LoaderOptimizationAttribute>  
 [<span data-ttu-id="13df0-299">增益集和擴充性</span><span class="sxs-lookup"><span data-stu-id="13df0-299">Add-ins and Extensibility</span></span>](../../../../docs/framework/add-ins/index.md)  
 [<span data-ttu-id="13df0-300">應用程式定義域</span><span class="sxs-lookup"><span data-stu-id="13df0-300">Application Domains</span></span>](../../../../docs/framework/app-domains/application-domains.md)  
 [<span data-ttu-id="13df0-301">.NET framework 遠端處理概觀</span><span class="sxs-lookup"><span data-stu-id="13df0-301">.NET Framework Remoting Overview</span></span>](https://msdn.microsoft.com/library/eccb1d31-0a22-417a-97fd-f4f1f3aa4462)  
 [<span data-ttu-id="13df0-302">讓物件變成可遠端處理</span><span class="sxs-lookup"><span data-stu-id="13df0-302">Making Objects Remotable</span></span>](https://msdn.microsoft.com/library/01197253-3f13-43b7-894d-9683e431192a)  
 [<span data-ttu-id="13df0-303">HOW-TO 主題</span><span class="sxs-lookup"><span data-stu-id="13df0-303">How-to Topics</span></span>](../../../../docs/framework/wpf/app-development/how-to-topics.md)
