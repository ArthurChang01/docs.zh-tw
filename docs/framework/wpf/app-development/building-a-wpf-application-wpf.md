---
title: "建置 WPF 應用程式 (WPF)"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology:
- dotnet-wpf
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WPF application [WPF], building
ms.assetid: a58696fd-bdad-4b55-9759-136dfdf8b91c
caps.latest.revision: 
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: 87fc77aaa95e2d2de4b0c6eb75484ab9b4006c31
ms.sourcegitcommit: c0dd436f6f8f44dc80dc43b07f6841a00b74b23f
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/19/2018
---
# <a name="building-a-wpf-application-wpf"></a><span data-ttu-id="be66e-102">建置 WPF 應用程式 (WPF)</span><span class="sxs-lookup"><span data-stu-id="be66e-102">Building a WPF Application (WPF)</span></span>
[!INCLUDE[TLA#tla_wpf](../../../../includes/tlasharptla-wpf-md.md)]<span data-ttu-id="be66e-103"> 應用程式可以建置為 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 可執行檔 (.exe)、程式庫 (.dll)，或這兩種組件類型的組合。</span><span class="sxs-lookup"><span data-stu-id="be66e-103"> applications can be built as [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] executables (.exe), libraries (.dll), or a combination of both types of assemblies.</span></span> <span data-ttu-id="be66e-104">本主題介紹如何建置 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 應用程式，並說明建置流程中的主要步驟。</span><span class="sxs-lookup"><span data-stu-id="be66e-104">This topic introduces how to build [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] applications and describes the key steps in the build process.</span></span>  
  
  
<a name="Building_a_WPF_Application_using_Command_Line"></a>   
## <a name="building-a-wpf-application"></a><span data-ttu-id="be66e-105">建置 WPF 應用程式</span><span class="sxs-lookup"><span data-stu-id="be66e-105">Building a WPF Application</span></span>  
 <span data-ttu-id="be66e-106">WPF 應用程式可透過下列方式編譯：</span><span class="sxs-lookup"><span data-stu-id="be66e-106">A WPF application can be compiled in the following ways:</span></span>  
  
-   <span data-ttu-id="be66e-107">命令列。</span><span class="sxs-lookup"><span data-stu-id="be66e-107">Command-line.</span></span> <span data-ttu-id="be66e-108">應用程式只能包含程式碼 (沒有 XAML) 和一個應用程式定義檔。</span><span class="sxs-lookup"><span data-stu-id="be66e-108">The application must contain only code (no XAML) and an application definition file.</span></span> <span data-ttu-id="be66e-109">如需詳細資訊，請參閱[使用 csc.exe 建置命令列](~/docs/csharp/language-reference/compiler-options/command-line-building-with-csc-exe.md)或[從命令列建置 (Visual Basic)](~/docs/visual-basic/reference/command-line-compiler/building-from-the-command-line.md)。</span><span class="sxs-lookup"><span data-stu-id="be66e-109">For more information, see [Command-line Building With csc.exe](~/docs/csharp/language-reference/compiler-options/command-line-building-with-csc-exe.md) or [Building from the Command Line (Visual Basic)](~/docs/visual-basic/reference/command-line-compiler/building-from-the-command-line.md).</span></span>  
  
-   <span data-ttu-id="be66e-110">Microsoft Build Engine (MSBuild)。</span><span class="sxs-lookup"><span data-stu-id="be66e-110">Microsoft Build Engine (MSBuild).</span></span> <span data-ttu-id="be66e-111">除了程式碼和 XAML 檔案，應用程式還必須包含 MSBuild 專案檔。</span><span class="sxs-lookup"><span data-stu-id="be66e-111">In addition to the code and XAML files, the application must contain an MSBuild project file.</span></span> <span data-ttu-id="be66e-112">如需詳細資訊，請參閱＜MSBuild＞。</span><span class="sxs-lookup"><span data-stu-id="be66e-112">For more information, see "MSBuild".</span></span>  
  
-   <span data-ttu-id="be66e-113">Visual Studio。</span><span class="sxs-lookup"><span data-stu-id="be66e-113">Visual Studio.</span></span> <span data-ttu-id="be66e-114">Visual Studio 是整合式開發環境，可使用 MSBuild 編譯 WPF 應用程式，並包含用於建立 UI 的視覺化設計工具。</span><span class="sxs-lookup"><span data-stu-id="be66e-114">Visual Studio is an integrated development environment that compiles WPF applications with MSBuild and includes a visual designer for creating UI.</span></span> <span data-ttu-id="be66e-115">如需詳細資訊，請參閱 [Visual Studio 應用程式開發](http://msdn.microsoft.com/library/97490c1b-a247-41fb-8f2c-bc4c201eff68)和 [WPF 設計工具](http://msdn.microsoft.com/library/c6c65214-8411-4e16-b254-163ed4099c26)。</span><span class="sxs-lookup"><span data-stu-id="be66e-115">For more information, see [Application Development in Visual Studio](http://msdn.microsoft.com/library/97490c1b-a247-41fb-8f2c-bc4c201eff68) and [WPF Designer](http://msdn.microsoft.com/library/c6c65214-8411-4e16-b254-163ed4099c26).</span></span>  
  
<a name="The_Windows_Presentation_Foundation_Build_Pipeline"></a>   
## <a name="wpf-build-pipeline"></a><span data-ttu-id="be66e-116">WPF 組建管線</span><span class="sxs-lookup"><span data-stu-id="be66e-116">WPF Build Pipeline</span></span>  
 <span data-ttu-id="be66e-117">建置 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 專案時，會叫用特定語言和特定 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 之目標的組合。</span><span class="sxs-lookup"><span data-stu-id="be66e-117">When a [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] project is built, the combination of language-specific and [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]-specific targets are invoked.</span></span> <span data-ttu-id="be66e-118">執行這些目標的程序稱為組建管線，下圖說明主要步驟。</span><span class="sxs-lookup"><span data-stu-id="be66e-118">The process of executing these targets is called the build pipeline, and the key steps are illustrated by the following figure.</span></span>  
  
 <span data-ttu-id="be66e-119">![WPF 建置流程](../../../../docs/framework/wpf/app-development/media/wpfbuildsystem-figure1.png "WPFBuildSystem_Figure1")</span><span class="sxs-lookup"><span data-stu-id="be66e-119">![WPF build process](../../../../docs/framework/wpf/app-development/media/wpfbuildsystem-figure1.png "WPFBuildSystem_Figure1")</span></span>  
  
<a name="Pre_Build_Initializations"></a>   
### <a name="pre-build-initializations"></a><span data-ttu-id="be66e-120">建置前初始化</span><span class="sxs-lookup"><span data-stu-id="be66e-120">Pre-Build Initializations</span></span>  
 <span data-ttu-id="be66e-121">建置之前，[!INCLUDE[TLA2#tla_msbuild](../../../../includes/tla2sharptla-msbuild-md.md)] 會判斷重要工具和程式庫的位置，包括：</span><span class="sxs-lookup"><span data-stu-id="be66e-121">Before building, [!INCLUDE[TLA2#tla_msbuild](../../../../includes/tla2sharptla-msbuild-md.md)] determines the location of important tools and libraries, including the following:</span></span>  
  
-   <span data-ttu-id="be66e-122">[!INCLUDE[TLA2#tla_winfx](../../../../includes/tla2sharptla-winfx-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="be66e-122">The [!INCLUDE[TLA2#tla_winfx](../../../../includes/tla2sharptla-winfx-md.md)].</span></span>  
  
-   <span data-ttu-id="be66e-123">[!INCLUDE[TLA2#tla_wcsdk](../../../../includes/tla2sharptla-wcsdk-md.md)] 目錄。</span><span class="sxs-lookup"><span data-stu-id="be66e-123">The [!INCLUDE[TLA2#tla_wcsdk](../../../../includes/tla2sharptla-wcsdk-md.md)] directories.</span></span>  
  
-   <span data-ttu-id="be66e-124">[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 參考組件的位置。</span><span class="sxs-lookup"><span data-stu-id="be66e-124">The location of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] reference assemblies.</span></span>  
  
-   <span data-ttu-id="be66e-125">組件搜尋路徑的屬性。</span><span class="sxs-lookup"><span data-stu-id="be66e-125">The property for the assembly search paths.</span></span>  
  
 <span data-ttu-id="be66e-126">[!INCLUDE[TLA2#tla_msbuild](../../../../includes/tla2sharptla-msbuild-md.md)] 搜尋組件的第一個位置是參考組件目錄 (%ProgramFiles%\Reference Assemblies\Microsoft\Framework\v3.0\\)。</span><span class="sxs-lookup"><span data-stu-id="be66e-126">The first location where [!INCLUDE[TLA2#tla_msbuild](../../../../includes/tla2sharptla-msbuild-md.md)] searches for assemblies is the reference assembly directory (%ProgramFiles%\Reference Assemblies\Microsoft\Framework\v3.0\\).</span></span> <span data-ttu-id="be66e-127">在此步驟期間，建置流程也會初始化各種屬性和項目群組，並執行任何必要的清除工作。</span><span class="sxs-lookup"><span data-stu-id="be66e-127">During this step, the build process also initializes the various properties and item groups and performs any required cleanup work.</span></span>  
  
<a name="Resolving_references"></a>   
### <a name="resolving-references"></a><span data-ttu-id="be66e-128">解析參考</span><span class="sxs-lookup"><span data-stu-id="be66e-128">Resolving References</span></span>  
 <span data-ttu-id="be66e-129">建置流程會找出並繫結建置應用程式專案所需的組件。</span><span class="sxs-lookup"><span data-stu-id="be66e-129">The build process locates and binds the assemblies required to build the application project.</span></span> <span data-ttu-id="be66e-130">此邏輯包含在 `ResolveAssemblyReference` 工作中。</span><span class="sxs-lookup"><span data-stu-id="be66e-130">This logic is contained in the `ResolveAssemblyReference` task.</span></span> <span data-ttu-id="be66e-131">在專案檔中宣告為 `Reference` 的所有組件會連同有關系統上已安裝組件之搜尋路徑和中繼資料的資訊，一起提供給工作。</span><span class="sxs-lookup"><span data-stu-id="be66e-131">All assemblies declared as `Reference` in the project file are provided to the task along with information on the search paths and metadata on assemblies already installed on the system.</span></span> <span data-ttu-id="be66e-132">此工作會尋找組件，然後使用已安裝組件的中繼資料，篩選出不需要顯示在輸出資訊清單中的核心 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 組件。</span><span class="sxs-lookup"><span data-stu-id="be66e-132">The task looks up assemblies and uses the installed assembly's metadata to filter out those core [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] assemblies that need not show up in the output manifests.</span></span> <span data-ttu-id="be66e-133">這樣做是為了避免在 ClickOnce 資訊清單中出現多餘的資訊。</span><span class="sxs-lookup"><span data-stu-id="be66e-133">This is done to avoid redundant information in the ClickOnce manifests.</span></span> <span data-ttu-id="be66e-134">例如，因為 PresentationFramework.dll 可視為針對 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 並在其上建置的應用程式代表，而且在每部已安裝 [!INCLUDE[TLA2#tla_winfx](../../../../includes/tla2sharptla-winfx-md.md)] 的機器上，所有 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 組件都位於相同位置，所以不需要在資訊清單中包含所有 [!INCLUDE[TLA2#tla_winfx](../../../../includes/tla2sharptla-winfx-md.md)] 參考組件的全部資訊。</span><span class="sxs-lookup"><span data-stu-id="be66e-134">For example, since PresentationFramework.dll can be considered representative of an application built on and for the [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] and moreover since all [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] assemblies exist at the same location on every machine that has the [!INCLUDE[TLA2#tla_winfx](../../../../includes/tla2sharptla-winfx-md.md)] installed, there is no need to include all information on all [!INCLUDE[TLA2#tla_winfx](../../../../includes/tla2sharptla-winfx-md.md)] reference assemblies in the manifests.</span></span>  
  
<a name="Markup_Compilation___Pass_1"></a>   
### <a name="markup-compilationpass-1"></a><span data-ttu-id="be66e-135">標記編譯 - 第一階段</span><span class="sxs-lookup"><span data-stu-id="be66e-135">Markup Compilation—Pass 1</span></span>  
 <span data-ttu-id="be66e-136">在此步驟中，[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 檔案會經過剖析及編譯，讓執行階段不需要花時間剖析 [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] 和驗證屬性值。</span><span class="sxs-lookup"><span data-stu-id="be66e-136">In this step, [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files are parsed and compiled so that the runtime does not spend time parsing [!INCLUDE[TLA2#tla_xml](../../../../includes/tla2sharptla-xml-md.md)] and validating property values.</span></span> <span data-ttu-id="be66e-137">已編譯的 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 檔案會預先語彙基元化，因此在執行階段將它載入時，應該會比載入 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 檔案更快。</span><span class="sxs-lookup"><span data-stu-id="be66e-137">The compiled [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file is pre-tokenized so that, at run time, loading it should be much faster than loading a [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file.</span></span>  
  
 <span data-ttu-id="be66e-138">在此步驟期間，以 `Page` 組建項目表示的每個 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 檔案會發生下列活動：</span><span class="sxs-lookup"><span data-stu-id="be66e-138">During this step, the following activities take place for every [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file that is a `Page` build item:</span></span>  
  
1.  <span data-ttu-id="be66e-139">標記編譯器會剖析 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 檔案。</span><span class="sxs-lookup"><span data-stu-id="be66e-139">The [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file is parsed by the markup compiler.</span></span>  
  
2.  <span data-ttu-id="be66e-140">建立該 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 的編譯表示，並複製到 obj\Release 資料夾。</span><span class="sxs-lookup"><span data-stu-id="be66e-140">A compiled representation is created for that [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] and copied to the obj\Release folder.</span></span>  
  
3.  <span data-ttu-id="be66e-141">建立新部分類別的 CodeDOM 表示，並複製到 obj\Release 資料夾。</span><span class="sxs-lookup"><span data-stu-id="be66e-141">A CodeDOM representation of a new partial class is created and copied to the obj\Release folder.</span></span>  
  
 <span data-ttu-id="be66e-142">此外，每個 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 檔案會產生特定語言的程式碼檔。</span><span class="sxs-lookup"><span data-stu-id="be66e-142">In addition, a language-specific code file is generated for every [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file.</span></span> <span data-ttu-id="be66e-143">例如，[!INCLUDE[TLA2#tla_visualb](../../../../includes/tla2sharptla-visualb-md.md)] 專案中的 Page1.xaml 頁面會產生 Page1.g.vb，而 [!INCLUDE[TLA2#tla_cshrp](../../../../includes/tla2sharptla-cshrp-md.md)] 專案中的 Page1.xaml 頁面會產生 Page1.g.cs。</span><span class="sxs-lookup"><span data-stu-id="be66e-143">For example, for a Page1.xaml page in a [!INCLUDE[TLA2#tla_visualb](../../../../includes/tla2sharptla-visualb-md.md)] project, a Page1.g.vb is generated; for a Page1.xaml page in a [!INCLUDE[TLA2#tla_cshrp](../../../../includes/tla2sharptla-cshrp-md.md)] project, a Page1.g.cs is generated.</span></span> <span data-ttu-id="be66e-144">檔案名稱中的 ".g" 表示檔案是產生的程式碼，其具有標記檔案最上層項目 (例如 `Page` 或 `Window`) 的部分類別宣告。</span><span class="sxs-lookup"><span data-stu-id="be66e-144">The ".g" in the file name indicates the file is generated code that has a partial class declaration for the top-level element of the markup file (such as `Page` or `Window`).</span></span> <span data-ttu-id="be66e-145">在 [!INCLUDE[TLA2#tla_cshrp](../../../../includes/tla2sharptla-cshrp-md.md)] 中，此類別是以 `partial` 修飾詞宣告 (在 [!INCLUDE[TLA2#tla_visualb](../../../../includes/tla2sharptla-visualb-md.md)] 中為 `Extends`)，以表示在其他地方有另一個類別宣告，通常是在程式碼後置檔案 Page1.xaml.cs 中。</span><span class="sxs-lookup"><span data-stu-id="be66e-145">The class is declared with the `partial` modifier in [!INCLUDE[TLA2#tla_cshrp](../../../../includes/tla2sharptla-cshrp-md.md)] (`Extends` in [!INCLUDE[TLA2#tla_visualb](../../../../includes/tla2sharptla-visualb-md.md)]) to indicate there is another declaration for the class elsewhere, usually in the code-behind file Page1.xaml.cs.</span></span>  
  
 <span data-ttu-id="be66e-146">部分類別擴充，從適當的基底類別 (例如<xref:System.Windows.Controls.Page>頁面)，並實作<xref:System.Windows.Markup.IComponentConnector?displayProperty=nameWithType>介面。</span><span class="sxs-lookup"><span data-stu-id="be66e-146">The partial class extends from the appropriate base class (such as <xref:System.Windows.Controls.Page> for a page) and implements the <xref:System.Windows.Markup.IComponentConnector?displayProperty=nameWithType> interface.</span></span> <span data-ttu-id="be66e-147"><xref:System.Windows.Markup.IComponentConnector>介面有方法可以初始化元件和連線名稱和其內容中的項目上的事件。</span><span class="sxs-lookup"><span data-stu-id="be66e-147">The <xref:System.Windows.Markup.IComponentConnector> interface has methods to initialize a component and connect names and events on elements in its content.</span></span> <span data-ttu-id="be66e-148">因此，產生的程式碼檔具有如下的方法實作：</span><span class="sxs-lookup"><span data-stu-id="be66e-148">Consequently, the generated code file has a method implementation like the following:</span></span>  
  
```csharp  
public void InitializeComponent() {  
    if (_contentLoaded) {  
        return;  
    }  
    _contentLoaded = true;  
    System.Uri resourceLocater =   
        new System.Uri(  
            "window1.xaml",   
            System.UriKind.RelativeOrAbsolute);  
    System.Windows.Application.LoadComponent(this, resourceLocater);  
}  
```  
  
```vb  
Public Sub InitializeComponent() _  
  
    If _contentLoaded Then  
        Return  
    End If  
  
    _contentLoaded = True  
    Dim resourceLocater As System.Uri = _  
        New System.Uri("mainwindow.xaml", System.UriKind.Relative)  
  
    System.Windows.Application.LoadComponent(Me, resourceLocater)  
  
End Sub  
```  
  
 <span data-ttu-id="be66e-149">根據預設，標記編譯會執行相同<xref:System.AppDomain>為[!INCLUDE[TLA2#tla_msbuild](../../../../includes/tla2sharptla-msbuild-md.md)]引擎。</span><span class="sxs-lookup"><span data-stu-id="be66e-149">By default, markup compilation runs in the same <xref:System.AppDomain> as the [!INCLUDE[TLA2#tla_msbuild](../../../../includes/tla2sharptla-msbuild-md.md)] engine.</span></span> <span data-ttu-id="be66e-150">這會大幅提升效能。</span><span class="sxs-lookup"><span data-stu-id="be66e-150">This provides significant performance gains.</span></span> <span data-ttu-id="be66e-151">您可以使用 `AlwaysCompileMarkupFilesInSeparateDomain` 屬性來切換此行為。</span><span class="sxs-lookup"><span data-stu-id="be66e-151">This behavior can be toggled with the `AlwaysCompileMarkupFilesInSeparateDomain` property.</span></span> <span data-ttu-id="be66e-152">這樣做的好處的卸載個別卸載所有參考組件<xref:System.AppDomain>。</span><span class="sxs-lookup"><span data-stu-id="be66e-152">This has the advantage of unloading all reference assemblies by unloading the separate <xref:System.AppDomain>.</span></span>  
  
<a name="Pass_2_of_Markup_Compilation"></a>   
### <a name="markup-compilationpass-2"></a><span data-ttu-id="be66e-153">標記編譯 - 第二階段</span><span class="sxs-lookup"><span data-stu-id="be66e-153">Markup Compilation—Pass 2</span></span>  
 <span data-ttu-id="be66e-154">並非所有 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 頁面都會在第一階段的標記編譯進行編譯。</span><span class="sxs-lookup"><span data-stu-id="be66e-154">Not all [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages are compiled at during pass 1 of markup compilation.</span></span> <span data-ttu-id="be66e-155">已在本機定義類型參考 (相同專案中任何地方之程式碼中所定義的類型參考) 的 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 檔案就不是在此時編譯。</span><span class="sxs-lookup"><span data-stu-id="be66e-155">[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files that have locally defined type references (references to types defined in code elsewhere in the same project) are exempt from compilation at this time.</span></span> <span data-ttu-id="be66e-156">這是因為這些本機定義的類型只存在於來源中，而且尚未經過編譯。</span><span class="sxs-lookup"><span data-stu-id="be66e-156">This is because those locally defined types exist only in source and have not yet been compiled.</span></span> <span data-ttu-id="be66e-157">為了判斷此情況，剖析器會使用牽涉到在標記檔案中尋找 `x:Name` 等項目的啟發方式。</span><span class="sxs-lookup"><span data-stu-id="be66e-157">In order to determine this, the parser uses heuristics that involve looking for items such as `x:Name` in the markup file.</span></span> <span data-ttu-id="be66e-158">找到這類執行個體之後，就會將標記檔案的編譯延後到程式碼檔編譯完成，在那之後，第二階段的標記編譯才會處理這些檔案。</span><span class="sxs-lookup"><span data-stu-id="be66e-158">When such an instance is found, that markup file’s compilation is postponed until the code files have been compiled, after which, the second markup compilation pass processes these files.</span></span>  
  
<a name="File_Classification"></a>   
### <a name="file-classification"></a><span data-ttu-id="be66e-159">檔案分類</span><span class="sxs-lookup"><span data-stu-id="be66e-159">File Classification</span></span>  
 <span data-ttu-id="be66e-160">建置流程會根據作為目標位置的應用程式組件，將輸出檔案放在不同的資源群組中。</span><span class="sxs-lookup"><span data-stu-id="be66e-160">The build process puts output files into different resource groups based on which application assembly they will be placed in.</span></span> <span data-ttu-id="be66e-161">在一般未當地語系化的應用程式中，所有標記為 `Resource` 的資料檔案會放在主組件 (可執行檔或程式庫) 中。</span><span class="sxs-lookup"><span data-stu-id="be66e-161">In a typical nonlocalized application, all data files marked as `Resource` are placed in the main assembly (executable or library).</span></span> <span data-ttu-id="be66e-162">當專案中已設定 `UICulture` 時，所有編譯的 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 檔案和特別標記為特定語言的資源會放在附屬資源組件中。</span><span class="sxs-lookup"><span data-stu-id="be66e-162">When `UICulture` is set in the project, all compiled [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files and those resources specifically marked as language-specific are placed in the satellite resource assembly.</span></span> <span data-ttu-id="be66e-163">此外，所有非語言相關的資源會放在主組件中。</span><span class="sxs-lookup"><span data-stu-id="be66e-163">Furthermore, all language-neutral resources are placed in the main assembly.</span></span> <span data-ttu-id="be66e-164">在建置流程的這個步驟中，會做出判斷。</span><span class="sxs-lookup"><span data-stu-id="be66e-164">In this step of the build process, that determination is made.</span></span>  
  
 <span data-ttu-id="be66e-165">專案檔中的 `ApplicationDefinition`、`Page` 和 `Resource` 建置動作可以用 `Localizable` 中繼資料 (可接受的值為 `true` 和 `false`) 增強，該中繼資料會指出檔案為特定語言或非語言相關。</span><span class="sxs-lookup"><span data-stu-id="be66e-165">The `ApplicationDefinition`, `Page`, and `Resource` build actions in the project file can be augmented with the `Localizable` metadata (acceptable values are `true` and `false`), which dictates whether the file is language-specific or language-neutral.</span></span>  
  
<a name="Core_Compilation"></a>   
### <a name="core-compilation"></a><span data-ttu-id="be66e-166">核心編譯</span><span class="sxs-lookup"><span data-stu-id="be66e-166">Core Compilation</span></span>  
 <span data-ttu-id="be66e-167">核心編譯步驟牽涉到程式碼檔的編譯。</span><span class="sxs-lookup"><span data-stu-id="be66e-167">The core compile step involves compilation of code files.</span></span> <span data-ttu-id="be66e-168">這是由特定語言之目標檔案 Microsoft.CSharp.targets 和 Microsoft.VisualBasic.targets 的邏輯進行協調。</span><span class="sxs-lookup"><span data-stu-id="be66e-168">This is orchestrated by logic in the language-specific targets files Microsoft.CSharp.targets and Microsoft.VisualBasic.targets.</span></span> <span data-ttu-id="be66e-169">如果啟發方式判斷標記編譯器的單一階段即已足夠，則會產生主組件。</span><span class="sxs-lookup"><span data-stu-id="be66e-169">If heuristics have determined that a single pass of the markup compiler is sufficient, then the main assembly is generated.</span></span> <span data-ttu-id="be66e-170">不過，如果專案中有一或多個 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 檔案參考本機定義的類型，則會產生暫存 .dll 檔案，因此最終的應用程式組件可能會在標記編譯的第二階段完成之後建立。</span><span class="sxs-lookup"><span data-stu-id="be66e-170">However, if one or more [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files in the project have references to locally defined types, then a temporary .dll file is generated so the final application assemblies may be created after the second pass of markup compilation is complete.</span></span>  
  
<a name="Manifest_generation"></a>   
### <a name="manifest-generation"></a><span data-ttu-id="be66e-171">資訊清單產生</span><span class="sxs-lookup"><span data-stu-id="be66e-171">Manifest Generation</span></span>  
 <span data-ttu-id="be66e-172">在建置流程結束，而且所有應用程式組件和內容檔案準備就緒之後，就會產生應用程式的 [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] 資訊清單。</span><span class="sxs-lookup"><span data-stu-id="be66e-172">At the end of the build process, after all the application assemblies and content files are ready, the [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] manifests for the application are generated.</span></span>  
  
 <span data-ttu-id="be66e-173">部署資訊清單檔會描述部署模型︰目前的版本、更新行為，以及發行者身分識別和數位簽章。</span><span class="sxs-lookup"><span data-stu-id="be66e-173">The deployment manifest file describes the deployment model: the current version, update behavior, and publisher identity along with digital signature.</span></span> <span data-ttu-id="be66e-174">此資訊清單預期是由處理部署的系統管理員所撰寫。</span><span class="sxs-lookup"><span data-stu-id="be66e-174">This manifest is intended to be authored by administrators who handle deployment.</span></span> <span data-ttu-id="be66e-175">副檔名為 .xbap (若是 [!INCLUDE[TLA#tla_xbap#plural](../../../../includes/tlasharptla-xbapsharpplural-md.md)]) 和 .application (若是已安裝的應用程式)。</span><span class="sxs-lookup"><span data-stu-id="be66e-175">The file extension is .xbap (for [!INCLUDE[TLA#tla_xbap#plural](../../../../includes/tlasharptla-xbapsharpplural-md.md)]) and .application for installed applications.</span></span> <span data-ttu-id="be66e-176">前者是由 `HostInBrowser` 專案屬性所指定，因此資訊清單會將應用程式識別為由瀏覽器裝載。</span><span class="sxs-lookup"><span data-stu-id="be66e-176">The former is dictated by the `HostInBrowser` project property and as a result the manifest identifies the application as browser-hosted.</span></span>  
  
 <span data-ttu-id="be66e-177">應用程式資訊清單 (.exe.manifest 檔案) 會描述應用程式組件和相依程式庫，並列出應用程式所需的權限。</span><span class="sxs-lookup"><span data-stu-id="be66e-177">The application manifest (an .exe.manifest file) describes the application assemblies and dependent libraries and lists permissions required by the application.</span></span> <span data-ttu-id="be66e-178">此檔案預期是由應用程式開發人員所撰寫。</span><span class="sxs-lookup"><span data-stu-id="be66e-178">This file is intended to be authored by the application developer.</span></span> <span data-ttu-id="be66e-179">為了啟動 [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] 應用程式，使用者會開啟應用程式的部署資訊清單檔。</span><span class="sxs-lookup"><span data-stu-id="be66e-179">In order to launch a [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] application, a user opens the application's deployment manifest file.</span></span>  
  
 <span data-ttu-id="be66e-180">若是 [!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)]，一律會建立這些資訊清單檔。</span><span class="sxs-lookup"><span data-stu-id="be66e-180">These manifest files are always created for [!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)].</span></span> <span data-ttu-id="be66e-181">若是已安裝的應用程式，除非將專案檔中的 `GenerateManifests` 屬性指定為 `true` 值，否則不會建立這些檔案。</span><span class="sxs-lookup"><span data-stu-id="be66e-181">For installed applications, they are not created unless the `GenerateManifests` property is specified in the project file with value `true`.</span></span>  
  
 [!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)]<span data-ttu-id="be66e-182">取得兩個額外的權限，除了一般網際網路區域應用程式來指派這些權限：<xref:System.Security.Permissions.WebBrowserPermission>和<xref:System.Security.Permissions.MediaPermission>。</span><span class="sxs-lookup"><span data-stu-id="be66e-182"> get two additional permissions over and above those permissions assigned to typical Internet zone applications: <xref:System.Security.Permissions.WebBrowserPermission> and <xref:System.Security.Permissions.MediaPermission>.</span></span> <span data-ttu-id="be66e-183">[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 建置系統會在應用程式資訊清單中宣告這些權限。</span><span class="sxs-lookup"><span data-stu-id="be66e-183">The [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] build system declares those permissions in the application manifest.</span></span>  
  
<a name="Incremental_Build_Support"></a>   
## <a name="incremental-build-support"></a><span data-ttu-id="be66e-184">累加建置支援</span><span class="sxs-lookup"><span data-stu-id="be66e-184">Incremental Build Support</span></span>  
 <span data-ttu-id="be66e-185">[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] 建置系統提供累加建置支援。</span><span class="sxs-lookup"><span data-stu-id="be66e-185">The [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] build system provides support for incremental builds.</span></span> <span data-ttu-id="be66e-186">該系統對於偵測標記或程式碼中所做的變更相當明確，而且只會編譯受變更影響的成品。</span><span class="sxs-lookup"><span data-stu-id="be66e-186">It is fairly intelligent about detecting changes made to markup or code, and it compiles only those artifacts affected by the change.</span></span> <span data-ttu-id="be66e-187">累加建置機制使用下列檔案：</span><span class="sxs-lookup"><span data-stu-id="be66e-187">The incremental build mechanism uses the following files:</span></span>  
  
-   <span data-ttu-id="be66e-188">$(*組件名稱*)_MarkupCompiler.Cache 檔案，用於維護目前的編譯器狀態。</span><span class="sxs-lookup"><span data-stu-id="be66e-188">An $(*AssemblyName*)_MarkupCompiler.Cache file to maintain current compiler state.</span></span>  
  
-   <span data-ttu-id="be66e-189">$(*組件名稱*)_MarkupCompiler.lref 檔案，用於快取具有本機定義之類型參考的 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 檔案。</span><span class="sxs-lookup"><span data-stu-id="be66e-189">An $(*AssemblyName*)_MarkupCompiler.lref file to cache the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files with references to locally defined types.</span></span>  
  
 <span data-ttu-id="be66e-190">以下是管理累加建置的一組規則：</span><span class="sxs-lookup"><span data-stu-id="be66e-190">The following is a set of rules governing incremental build:</span></span>  
  
-   <span data-ttu-id="be66e-191">檔案是建置系統偵測變更的最小單位。</span><span class="sxs-lookup"><span data-stu-id="be66e-191">The file is the smallest unit at which the build system detects change.</span></span> <span data-ttu-id="be66e-192">因此對於程式碼檔，建置系統無法得知是否變更類型或是否新增程式碼。</span><span class="sxs-lookup"><span data-stu-id="be66e-192">So, for a code file, the build system cannot tell if a type was changed or if code was added.</span></span> <span data-ttu-id="be66e-193">同樣的情況也適用於專案檔。</span><span class="sxs-lookup"><span data-stu-id="be66e-193">The same holds for project files.</span></span>  
  
-   <span data-ttu-id="be66e-194">累加建置機制必須認定 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 頁面有定義類別或使用其他類別。</span><span class="sxs-lookup"><span data-stu-id="be66e-194">The incremental build mechanism must be cognizant that a [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] page either defines a class or uses other classes.</span></span>  
  
-   <span data-ttu-id="be66e-195">如果 `Reference` 項目變更，則會重新編譯所有頁面。</span><span class="sxs-lookup"><span data-stu-id="be66e-195">If `Reference` entries change, then recompile all pages.</span></span>  
  
-   <span data-ttu-id="be66e-196">如果程式碼檔變更，則會重新編譯所有具有本機定義之類型參考的頁面。</span><span class="sxs-lookup"><span data-stu-id="be66e-196">If a code file changes, recompile all pages with locally defined type references.</span></span>  
  
-   <span data-ttu-id="be66e-197">如果 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 檔案變更：</span><span class="sxs-lookup"><span data-stu-id="be66e-197">If a [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file changes:</span></span>  
  
    -   <span data-ttu-id="be66e-198">如果 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 在專案中宣告為 `Page`：如果 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 沒有本機定義的類型參考，請重新編譯該 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]，再加上所有具有本機參考的 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 頁面；如果 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 有本機參考，請重新編譯所有具有本機參考的 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 頁面。</span><span class="sxs-lookup"><span data-stu-id="be66e-198">If [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] is declared as `Page` in the project: if the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] does not have locally defined type references, recompile that [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] plus all [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages with local references; if the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] has local references, recompile all [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages with local references.</span></span>  
  
    -   <span data-ttu-id="be66e-199">如果[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]宣告為`ApplicationDefinition`專案中： 重新編譯所有[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]頁面 (原因： 每個[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]具有參考<xref:System.Windows.Application>可能已變更的類型)。</span><span class="sxs-lookup"><span data-stu-id="be66e-199">If [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] is declared as `ApplicationDefinition` in the project: recompile all [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages (reason: each [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] has reference to an <xref:System.Windows.Application> type that may have changed).</span></span>  
  
-   <span data-ttu-id="be66e-200">如果專案檔將程式碼檔宣告為應用程式定義，而不是 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 檔案：</span><span class="sxs-lookup"><span data-stu-id="be66e-200">If the project file declares a code file as application definition instead of a [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file:</span></span>  
  
    -   <span data-ttu-id="be66e-201">檢查專案檔中的 `ApplicationClassName` 值是否已變更 (是否有新的應用程式類型)。</span><span class="sxs-lookup"><span data-stu-id="be66e-201">Check if the `ApplicationClassName` value in the project file has changed (is there a new application type?).</span></span> <span data-ttu-id="be66e-202">如果是，請重新編譯整個應用程式。</span><span class="sxs-lookup"><span data-stu-id="be66e-202">If so, recompile the entire application.</span></span>  
  
    -   <span data-ttu-id="be66e-203">否則，請重新編譯所有具有本機參考的 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 頁面。</span><span class="sxs-lookup"><span data-stu-id="be66e-203">Otherwise, recompile all [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages with local references.</span></span>  
  
-   <span data-ttu-id="be66e-204">如果專案檔變更︰請套用所有前述規則，並查看哪些項目需要重新編譯。</span><span class="sxs-lookup"><span data-stu-id="be66e-204">If a project file changes: apply all preceding rules and see what needs to be recompiled.</span></span> <span data-ttu-id="be66e-205">對下列屬性的變更會觸發完整的重新編譯：`AssemblyName`、`IntermediateOutputPath`、`RootNamespace` 和 `HostInBrowser`。</span><span class="sxs-lookup"><span data-stu-id="be66e-205">Changes to the following properties trigger a complete recompile: `AssemblyName`, `IntermediateOutputPath`, `RootNamespace`, and `HostInBrowser`.</span></span>  
  
 <span data-ttu-id="be66e-206">以下是可能發生的重新編譯情節：</span><span class="sxs-lookup"><span data-stu-id="be66e-206">The following recompile scenarios are possible:</span></span>  
  
-   <span data-ttu-id="be66e-207">重新編譯整個應用程式。</span><span class="sxs-lookup"><span data-stu-id="be66e-207">The entire application is recompiled.</span></span>  
  
-   <span data-ttu-id="be66e-208">只重新編譯具有本機定義之類型參考的 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 檔案。</span><span class="sxs-lookup"><span data-stu-id="be66e-208">Only those [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files that have locally defined type references are recompiled.</span></span>  
  
-   <span data-ttu-id="be66e-209">不重新編譯任何項目 (如果專案中沒有任何變更)。</span><span class="sxs-lookup"><span data-stu-id="be66e-209">Nothing is recompiled (if nothing in the project has changed).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="be66e-210">請參閱</span><span class="sxs-lookup"><span data-stu-id="be66e-210">See Also</span></span>  
 [<span data-ttu-id="be66e-211">部署 WPF 應用程式</span><span class="sxs-lookup"><span data-stu-id="be66e-211">Deploying a WPF Application</span></span>](../../../../docs/framework/wpf/app-development/deploying-a-wpf-application-wpf.md)  
 [<span data-ttu-id="be66e-212">WPF MSBuild 參考</span><span class="sxs-lookup"><span data-stu-id="be66e-212">WPF MSBuild Reference</span></span>](/visualstudio/msbuild/wpf-msbuild-reference)  
 [<span data-ttu-id="be66e-213">WPF 中的 Pack URI</span><span class="sxs-lookup"><span data-stu-id="be66e-213">Pack URIs in WPF</span></span>](../../../../docs/framework/wpf/app-development/pack-uris-in-wpf.md)  
 [<span data-ttu-id="be66e-214">WPF 應用程式資源、內容和資料檔案</span><span class="sxs-lookup"><span data-stu-id="be66e-214">WPF Application Resource, Content, and Data Files</span></span>](../../../../docs/framework/wpf/app-development/wpf-application-resource-content-and-data-files.md)
