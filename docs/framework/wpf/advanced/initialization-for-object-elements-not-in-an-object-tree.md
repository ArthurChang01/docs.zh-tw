---
title: 初始化物件樹狀結構以外的物件項目
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- logical tree [WPF]
- visual tree [WPF]
- elements [WPF], initializing
- initializing elements [WPF]
ms.assetid: 7b8dfc9b-46ac-4ce8-b7bb-035734d688b7
ms.openlocfilehash: 1a1d956ee7f41ac1ac0fc9bd051a18b9ff438930
ms.sourcegitcommit: 944ddc52b7f2632f30c668815f92b378efd38eea
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/03/2019
ms.locfileid: "73459840"
---
# <a name="initialization-for-object-elements-not-in-an-object-tree"></a><span data-ttu-id="a5270-102">初始化物件樹狀結構以外的物件項目</span><span class="sxs-lookup"><span data-stu-id="a5270-102">Initialization for Object Elements Not in an Object Tree</span></span>
<span data-ttu-id="a5270-103">[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] 初始化的某些層面會延後處理，因為這些處理通常需要將該項目連接到邏輯樹狀結構或視覺化樹狀結構。</span><span class="sxs-lookup"><span data-stu-id="a5270-103">Some aspects of [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] initialization are deferred to processes that typically rely on that element being connected to either the logical tree or visual tree.</span></span> <span data-ttu-id="a5270-104">本主題說明為了初始化未連接到任一樹狀結構的項目所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="a5270-104">This topic describes the steps that may be necessary in order to initialize an element that is not connected to either tree.</span></span>  

## <a name="elements-and-the-logical-tree"></a><span data-ttu-id="a5270-105">項目和邏輯樹狀結構</span><span class="sxs-lookup"><span data-stu-id="a5270-105">Elements and the Logical Tree</span></span>  
 <span data-ttu-id="a5270-106">當您在程式碼中建立 [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] 類別的執行個體時，您應該注意到 [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] 類別的物件初始化有幾個層面刻意不屬於呼叫類別建構函式時所執行的程式碼。</span><span class="sxs-lookup"><span data-stu-id="a5270-106">When you create an instance of a [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] class in code, you should be aware that several aspects of object initialization for a [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] class are deliberately not a part of the code that is executed when calling the class constructor.</span></span> <span data-ttu-id="a5270-107">特別是控制項類別，該控制項的視覺表示大部分不是由建構函式定義，</span><span class="sxs-lookup"><span data-stu-id="a5270-107">Particularly for a control class, most of the visual representation of that control is not defined by the constructor.</span></span> <span data-ttu-id="a5270-108">而是由控制項的範本來定義視覺表示。</span><span class="sxs-lookup"><span data-stu-id="a5270-108">Instead, the visual representation is defined by the control's template.</span></span> <span data-ttu-id="a5270-109">範本可能來自各種不同的來源，但最常會從佈景主題樣式取得範本。</span><span class="sxs-lookup"><span data-stu-id="a5270-109">The template potentially comes from a variety of sources, but most often the template is obtained from theme styles.</span></span> <span data-ttu-id="a5270-110">範本實際上是晚期繫結；必須等到相關控制項可以開始配置之後，才能將所需的範本附加至該控制項。</span><span class="sxs-lookup"><span data-stu-id="a5270-110">Templates are effectively late-binding; the necessary template is not attached to the control in question until the control is ready for layout.</span></span> <span data-ttu-id="a5270-111">此外，控制項必須等到附加至連接到根目錄之呈現介面的邏輯樹狀結構之後，才能開始配置。</span><span class="sxs-lookup"><span data-stu-id="a5270-111">And the control is not ready for layout until it is attached to a logical tree that connects to a rendering surface at the root.</span></span> <span data-ttu-id="a5270-112">根層級項目會依照邏輯樹狀結構中的定義，來啟始其所有子項目的呈現。</span><span class="sxs-lookup"><span data-stu-id="a5270-112">It is that root-level element that initiates the rendering of all of its child elements as defined in the logical tree.</span></span>  
  
 <span data-ttu-id="a5270-113">視覺化樹狀結構也會參與此程序。</span><span class="sxs-lookup"><span data-stu-id="a5270-113">The visual tree also participates in this process.</span></span> <span data-ttu-id="a5270-114">透過範本成為視覺化樹狀結構一部分的項目，也必須等到連接之後才能完全具現化。</span><span class="sxs-lookup"><span data-stu-id="a5270-114">Elements that are part of the visual tree through the templates are also not fully instantiated until connected.</span></span>  
  
 <span data-ttu-id="a5270-115">此行為的結果是，依賴某個項目之完整視覺特性的特定作業需要額外的步驟。</span><span class="sxs-lookup"><span data-stu-id="a5270-115">The consequences of this behavior are that certain operations that rely on the completed visual characteristics of an element require additional steps.</span></span> <span data-ttu-id="a5270-116">其中一個範例是您嘗試取得某個類別的視覺特性，而此類別已建構但尚未附加至樹狀結構。</span><span class="sxs-lookup"><span data-stu-id="a5270-116">An example is if you are attempting to get the visual characteristics of a class that was constructed but not yet attached to a tree.</span></span> <span data-ttu-id="a5270-117">比方說，如果您想要在 <xref:System.Windows.Media.Imaging.RenderTargetBitmap> 上呼叫 <xref:System.Windows.Media.Imaging.RenderTargetBitmap.Render%2A>，而您所傳遞的視覺效果是未連接到樹狀結構的元素，則在其他初始化步驟完成之前，該元素不會以視覺化方式完成。</span><span class="sxs-lookup"><span data-stu-id="a5270-117">For instance, if you want to call <xref:System.Windows.Media.Imaging.RenderTargetBitmap.Render%2A> on a <xref:System.Windows.Media.Imaging.RenderTargetBitmap> and the visual you are passing is an element not connected to a tree, that element is not visually complete until additional initialization steps are completed.</span></span>  
  
### <a name="using-begininit-and-endinit-to-initialize-the-element"></a><span data-ttu-id="a5270-118">使用 BeginInit 和 EndInit 來初始化項目</span><span class="sxs-lookup"><span data-stu-id="a5270-118">Using BeginInit and EndInit to Initialize the Element</span></span>  
 <span data-ttu-id="a5270-119">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 中的各種類別會執行 <xref:System.ComponentModel.ISupportInitialize> 介面。</span><span class="sxs-lookup"><span data-stu-id="a5270-119">Various classes in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] implement the <xref:System.ComponentModel.ISupportInitialize> interface.</span></span> <span data-ttu-id="a5270-120">您可以使用介面的 <xref:System.ComponentModel.ISupportInitialize.BeginInit%2A> 和 <xref:System.ComponentModel.ISupportInitialize.EndInit%2A> 方法，來表示程式碼中包含初始化步驟的區域（例如，設定會影響轉譯的屬性值）。</span><span class="sxs-lookup"><span data-stu-id="a5270-120">You use the <xref:System.ComponentModel.ISupportInitialize.BeginInit%2A> and <xref:System.ComponentModel.ISupportInitialize.EndInit%2A> methods of the interface to denote a region in your code that contains initialization steps (such as setting property values that affect rendering).</span></span> <span data-ttu-id="a5270-121">在序列中呼叫 <xref:System.ComponentModel.ISupportInitialize.EndInit%2A> 之後，版面配置系統可以處理專案，並開始尋找隱含樣式。</span><span class="sxs-lookup"><span data-stu-id="a5270-121">After <xref:System.ComponentModel.ISupportInitialize.EndInit%2A> is called in the sequence, the layout system can process the element and start looking for an implicit style.</span></span>  
  
 <span data-ttu-id="a5270-122">如果您要設定屬性的專案是 <xref:System.Windows.FrameworkElement> 或 <xref:System.Windows.FrameworkContentElement> 衍生類別，則您可以呼叫 <xref:System.Windows.FrameworkElement.BeginInit%2A> 和 <xref:System.Windows.FrameworkElement.EndInit%2A> 的類別版本，而不是轉換成 <xref:System.ComponentModel.ISupportInitialize>。</span><span class="sxs-lookup"><span data-stu-id="a5270-122">If the element you are setting properties on is a <xref:System.Windows.FrameworkElement> or <xref:System.Windows.FrameworkContentElement> derived class, then you can call the class versions of <xref:System.Windows.FrameworkElement.BeginInit%2A> and <xref:System.Windows.FrameworkElement.EndInit%2A> rather than casting to <xref:System.ComponentModel.ISupportInitialize>.</span></span>  
  
### <a name="sample-code"></a><span data-ttu-id="a5270-123">程式碼範例</span><span class="sxs-lookup"><span data-stu-id="a5270-123">Sample Code</span></span>  
 <span data-ttu-id="a5270-124">下列範例是主控台應用程式的範例程式碼，它會使用轉譯 Api 和鬆散 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 檔案的 <xref:System.Windows.Markup.XamlReader.Load%28System.IO.Stream%29?displayProperty=nameWithType> 來說明如何適當放置 <xref:System.Windows.FrameworkElement.BeginInit%2A> 和 <xref:System.Windows.FrameworkElement.EndInit%2A>，以調整會影響轉譯的屬性。</span><span class="sxs-lookup"><span data-stu-id="a5270-124">The following example is sample code for a console application that uses rendering APIs and <xref:System.Windows.Markup.XamlReader.Load%28System.IO.Stream%29?displayProperty=nameWithType> of a loose [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file to illustrate the proper placement of <xref:System.Windows.FrameworkElement.BeginInit%2A> and <xref:System.Windows.FrameworkElement.EndInit%2A> around other API calls that adjust properties that affect rendering.</span></span>  
  
 <span data-ttu-id="a5270-125">此範例只會說明 main 函式。</span><span class="sxs-lookup"><span data-stu-id="a5270-125">The example illustrates the main function only.</span></span> <span data-ttu-id="a5270-126">`Rasterize` 和 `Save` 函式 (未顯示) 是負責影像處理和 IO 的公用程式函式。</span><span class="sxs-lookup"><span data-stu-id="a5270-126">The functions `Rasterize` and `Save` (not shown) are utility functions that take care of image processing and IO.</span></span>  
  
 [!code-csharp[InitializeElements#Main](~/samples/snippets/csharp/VS_Snippets_Wpf/InitializeElements/CSharp/initializeelements.cs#main)]
 [!code-vb[InitializeElements#Main](~/samples/snippets/visualbasic/VS_Snippets_Wpf/InitializeElements/VisualBasic/initializeelements.vb#main)]  
  
## <a name="see-also"></a><span data-ttu-id="a5270-127">請參閱</span><span class="sxs-lookup"><span data-stu-id="a5270-127">See also</span></span>

- [<span data-ttu-id="a5270-128">WPF 中的樹狀結構</span><span class="sxs-lookup"><span data-stu-id="a5270-128">Trees in WPF</span></span>](trees-in-wpf.md)
- [<span data-ttu-id="a5270-129">WPF 圖形轉譯概觀</span><span class="sxs-lookup"><span data-stu-id="a5270-129">WPF Graphics Rendering Overview</span></span>](../graphics-multimedia/wpf-graphics-rendering-overview.md)
- [<span data-ttu-id="a5270-130">XAML 概觀 (WPF)</span><span class="sxs-lookup"><span data-stu-id="a5270-130">XAML Overview (WPF)</span></span>](../../../desktop-wpf/fundamentals/xaml.md)
