---
title: WPF 和 Win32 互通
ms.date: 03/30/2017
helpviewer_keywords:
- hosting WPF content in Win32 window [WPF]
- HWND interop [WPF]
- Win32 code [WPF], WPF interoperation
- interoperability [WPF], Win32
ms.assetid: 0ffbde0d-701d-45a3-a6fa-dd71f4d9772e
ms.openlocfilehash: 71c454edc6a124f732f1e6b56e25c28671fa11b6
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/23/2019
ms.locfileid: "62053167"
---
# <a name="wpf-and-win32-interoperation"></a><span data-ttu-id="d121e-102">WPF 和 Win32 互通</span><span class="sxs-lookup"><span data-stu-id="d121e-102">WPF and Win32 Interoperation</span></span>
<span data-ttu-id="d121e-103">本主題概述如何交互操作 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 和 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 程式碼。</span><span class="sxs-lookup"><span data-stu-id="d121e-103">This topic provides an overview of how to interoperate [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code.</span></span> [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] <span data-ttu-id="d121e-104">提供用來建立應用程式的豐富環境。</span><span class="sxs-lookup"><span data-stu-id="d121e-104">provides a rich environment for creating applications.</span></span> <span data-ttu-id="d121e-105">不過，如果您已長期開發 [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] 程式碼，則重複使用該程式碼的一部分可能會更有效率。</span><span class="sxs-lookup"><span data-stu-id="d121e-105">However, when you have a substantial investment in [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] code, it might be more effective to reuse some of that code.</span></span>  

<a name="basics"></a>   
## <a name="wpf-and-win32-interoperation-basics"></a><span data-ttu-id="d121e-106">WPF 和 Win32 交互操作基本概念</span><span class="sxs-lookup"><span data-stu-id="d121e-106">WPF and Win32 Interoperation Basics</span></span>  
 <span data-ttu-id="d121e-107">針對 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 與 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 程式碼之間的交互操作，有兩個基本技術。</span><span class="sxs-lookup"><span data-stu-id="d121e-107">There are two basic techniques for interoperation between [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code.</span></span>  
  
- <span data-ttu-id="d121e-108">在 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 視窗中裝載 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容。</span><span class="sxs-lookup"><span data-stu-id="d121e-108">Host [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="d121e-109">使用此技術，您可以使用標準 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 視窗和應用程式架構內 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 的進階圖形功能。</span><span class="sxs-lookup"><span data-stu-id="d121e-109">With this technique, you can use the advanced graphics capabilities of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] within the framework of a standard [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window and application.</span></span>  
  
- <span data-ttu-id="d121e-110">在 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容中裝載 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 視窗。</span><span class="sxs-lookup"><span data-stu-id="d121e-110">Host a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="d121e-111">使用此技術，您可以在其他 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容的內容中使用現有的自訂 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 控制項，並跨界限傳遞資料。</span><span class="sxs-lookup"><span data-stu-id="d121e-111">With this technique, you can use an existing custom [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] control in the context of other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and pass data across the boundaries.</span></span>  
  
 <span data-ttu-id="d121e-112">本主題會在概念上介紹所有這些技術。</span><span class="sxs-lookup"><span data-stu-id="d121e-112">Each of these techniques is conceptually introduced in this topic.</span></span> <span data-ttu-id="d121e-113">如需其他程式碼導向圖例裝載[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]中[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]，請參閱[逐步解說：WPF 內容裝載在 Win32](walkthrough-hosting-wpf-content-in-win32.md)。</span><span class="sxs-lookup"><span data-stu-id="d121e-113">For a more code-oriented illustration of hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)], see [Walkthrough: Hosting WPF Content in Win32](walkthrough-hosting-wpf-content-in-win32.md).</span></span> <span data-ttu-id="d121e-114">如需其他程式碼導向圖例裝載[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]中[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]，請參閱[逐步解說：Win32 控制項裝載在 WPF](walkthrough-hosting-a-win32-control-in-wpf.md)。</span><span class="sxs-lookup"><span data-stu-id="d121e-114">For a more code-oriented illustration of hosting [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], see [Walkthrough: Hosting a Win32 Control in WPF](walkthrough-hosting-a-win32-control-in-wpf.md).</span></span>  
  
<a name="projects"></a>   
## <a name="wpf-interoperation-projects"></a><span data-ttu-id="d121e-115">WPF 交互操作專案</span><span class="sxs-lookup"><span data-stu-id="d121e-115">WPF Interoperation Projects</span></span>  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="d121e-116">[!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] 是 Managed 程式碼，但大部分現有 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 程式都是使用 Unmanaged [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] 所撰寫。</span><span class="sxs-lookup"><span data-stu-id="d121e-116">[!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] are managed code, but most existing [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] programs are written in unmanaged [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)].</span></span>  <span data-ttu-id="d121e-117">您無法從真正的 Unmanaged 程式呼叫 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="d121e-117">You cannot call [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] from a true unmanaged program.</span></span> <span data-ttu-id="d121e-118">不過，搭配使用 `/clr` 選項與 [!INCLUDE[TLA#tla_visualcpp](../../../../includes/tlasharptla-visualcpp-md.md)] 編譯器，即可建立混合式 Managed/Unmanaged 程式，以順暢地混用 Managed 和 Unmanaged [!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] 呼叫。</span><span class="sxs-lookup"><span data-stu-id="d121e-118">However, by using the `/clr` option with the [!INCLUDE[TLA#tla_visualcpp](../../../../includes/tlasharptla-visualcpp-md.md)] compiler, you can create a mixed managed-unmanaged program where you can seamlessly mix managed and unmanaged [!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] calls.</span></span>  
  
 <span data-ttu-id="d121e-119">其中一個專案層級複雜在於您無法將 [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] 檔案編譯至 [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] 專案。</span><span class="sxs-lookup"><span data-stu-id="d121e-119">One project-level complication is that you cannot compile [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] files into a [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] project.</span></span>  <span data-ttu-id="d121e-120">有數個專案部門技術可彌補這一點。</span><span class="sxs-lookup"><span data-stu-id="d121e-120">There are several project division techniques to compensate for this.</span></span>  
  
- <span data-ttu-id="d121e-121">建立 C# DLL，其中包含所有您[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]網頁設為已編譯的組件，然後讓您[!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)]可執行檔加入這個[!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)]做為參考。</span><span class="sxs-lookup"><span data-stu-id="d121e-121">Create a C# DLL that contains all your [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages as a compiled assembly, and then have your [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] executable include that [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] as a reference.</span></span>  
  
- <span data-ttu-id="d121e-122">建立 C# 可執行檔[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容，並讓它參考[!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)][!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)]包含[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]內容。</span><span class="sxs-lookup"><span data-stu-id="d121e-122">Create a C# executable for the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and have it reference a [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] that contains the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] content.</span></span>  
  
- <span data-ttu-id="d121e-123">使用<xref:System.Windows.Markup.XamlReader.Load%2A>載入任何[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]在執行階段，而不是編譯您[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="d121e-123">Use <xref:System.Windows.Markup.XamlReader.Load%2A> to load any [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] at run time, instead of compiling your [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span></span>  
  
- <span data-ttu-id="d121e-124">請勿使用[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]，並寫入所有您[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]在程式碼中建立項目樹狀結構從<xref:System.Windows.Application>。</span><span class="sxs-lookup"><span data-stu-id="d121e-124">Do not use [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] at all, and write all your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in code, building up the element tree from <xref:System.Windows.Application>.</span></span>  
  
 <span data-ttu-id="d121e-125">請使用最適合您的方法。</span><span class="sxs-lookup"><span data-stu-id="d121e-125">Use whatever approach works best for you.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d121e-126">如果您之前未曾使用過 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)]，則會在交互操作程式碼範例中注意到一些「新」關鍵字，例如 `gcnew` 和 `nullptr`。</span><span class="sxs-lookup"><span data-stu-id="d121e-126">If you have not used [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] before, you might notice some "new" keywords such as `gcnew` and `nullptr` in the interoperation code examples.</span></span> <span data-ttu-id="d121e-127">這些關鍵字取代較舊的雙底線語法 (`__gc`)，並提供 [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] 中 Managed 程式碼的更自然語法。</span><span class="sxs-lookup"><span data-stu-id="d121e-127">These keywords supersede the older double-underscore syntax (`__gc`) and provide a more natural syntax for managed code in [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)].</span></span>  <span data-ttu-id="d121e-128">若要深入了解 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] Managed 功能，請參閱[執行階段平台的元件延伸功能](/cpp/windows/component-extensions-for-runtime-platforms)和 [Hello, C++/CLI](https://go.microsoft.com/fwlink/?LinkId=98739)。</span><span class="sxs-lookup"><span data-stu-id="d121e-128">To learn more about the [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] managed features, see [Component Extensions for Runtime Platforms](/cpp/windows/component-extensions-for-runtime-platforms) and [Hello, C++/CLI](https://go.microsoft.com/fwlink/?LinkId=98739).</span></span>  
  
<a name="hwnds"></a>   
## <a name="how-wpf-uses-hwnds"></a><span data-ttu-id="d121e-129">WPF 如何使用 Hwnd</span><span class="sxs-lookup"><span data-stu-id="d121e-129">How WPF Uses Hwnds</span></span>  
 <span data-ttu-id="d121e-130">若要將大部分的 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 設為 "HWND interop"，您需要了解 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 如何使用 HWND。</span><span class="sxs-lookup"><span data-stu-id="d121e-130">To make the most of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] "HWND interop", you need to understand how [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] uses HWNDs.</span></span> <span data-ttu-id="d121e-131">針對任何 HWND，您都無法混合使用 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 轉譯與 [!INCLUDE[TLA2#tla_dx](../../../../includes/tla2sharptla-dx-md.md)] 轉譯或 [!INCLUDE[TLA2#tla_gdi](../../../../includes/tla2sharptla-gdi-md.md)] / [!INCLUDE[TLA2#tla_gdiplus](../../../../includes/tla2sharptla-gdiplus-md.md)] 轉譯。</span><span class="sxs-lookup"><span data-stu-id="d121e-131">For any HWND, you cannot mix [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] rendering with [!INCLUDE[TLA2#tla_dx](../../../../includes/tla2sharptla-dx-md.md)] rendering or [!INCLUDE[TLA2#tla_gdi](../../../../includes/tla2sharptla-gdi-md.md)] / [!INCLUDE[TLA2#tla_gdiplus](../../../../includes/tla2sharptla-gdiplus-md.md)] rendering.</span></span> <span data-ttu-id="d121e-132">這有幾個隱含意義。</span><span class="sxs-lookup"><span data-stu-id="d121e-132">This has a number of implications.</span></span> <span data-ttu-id="d121e-133">主要，若要完全混合使用這些轉譯模型，您必須建立交互操作方案，並使用您選擇使用之每個轉譯模型的指定區段交互操作。</span><span class="sxs-lookup"><span data-stu-id="d121e-133">Primarily, in order to mix these rendering models at all, you must create an interoperation solution, and use designated segments of interoperation for each rendering model that you choose to use.</span></span> <span data-ttu-id="d121e-134">此外，轉譯行為還會建立交互操作方案可完成之作業的「空間」限制。</span><span class="sxs-lookup"><span data-stu-id="d121e-134">Also, the rendering behavior creates an "airspace" restriction for what your interoperation solution can accomplish.</span></span> <span data-ttu-id="d121e-135">[技術領域概觀](technology-regions-overview.md)主題會更詳細地說明「空間」概念。</span><span class="sxs-lookup"><span data-stu-id="d121e-135">The "airspace" concept is explained in greater detail in the topic [Technology Regions Overview](technology-regions-overview.md).</span></span>  
  
 <span data-ttu-id="d121e-136">HWND 最後會支援畫面上的所有 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 項目。</span><span class="sxs-lookup"><span data-stu-id="d121e-136">All [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] elements on the screen are ultimately backed by a HWND.</span></span> <span data-ttu-id="d121e-137">當您建立[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window>，[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]會建立最上層 HWND，並使用<xref:System.Windows.Interop.HwndSource>把<xref:System.Windows.Window>及其[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容放在 HWND 內。</span><span class="sxs-lookup"><span data-stu-id="d121e-137">When you create a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window>, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] creates a top-level HWND, and uses an <xref:System.Windows.Interop.HwndSource> to put the <xref:System.Windows.Window> and its [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content inside the HWND.</span></span>  <span data-ttu-id="d121e-138">應用程式中 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容的其餘部分會共用該單一 HWND。</span><span class="sxs-lookup"><span data-stu-id="d121e-138">The rest of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in the application shares that singular HWND.</span></span> <span data-ttu-id="d121e-139">例外狀況是功能表、下拉式方塊下拉式清單和其他快顯視窗。</span><span class="sxs-lookup"><span data-stu-id="d121e-139">An exception is menus, combo box drop downs, and other pop-ups.</span></span> <span data-ttu-id="d121e-140">這些項目會建立自己的最上層視窗，這就是 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 功能表為什麼可以通過包含它的視窗 HWND 邊緣。</span><span class="sxs-lookup"><span data-stu-id="d121e-140">These elements create their own top-level window, which is why a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] menu can potentially go past the edge of the window HWND that contains it.</span></span> <span data-ttu-id="d121e-141">當您使用<xref:System.Windows.Interop.HwndHost>放在 HWND [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]，[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]通知[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]如何放置到新的子 HWND 相對[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window> HWND。</span><span class="sxs-lookup"><span data-stu-id="d121e-141">When you use <xref:System.Windows.Interop.HwndHost> to put an HWND inside [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] informs [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] how to position the new child HWND relative to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window> HWND.</span></span>  
  
 <span data-ttu-id="d121e-142">在每個 HWND 之內和之間，相關的 HWND 概念都十分清楚。</span><span class="sxs-lookup"><span data-stu-id="d121e-142">A related concept to HWND is transparency within and between each HWND.</span></span> <span data-ttu-id="d121e-143">[技術領域概觀](technology-regions-overview.md)主題也會討論這點。</span><span class="sxs-lookup"><span data-stu-id="d121e-143">This is also discussed in the topic [Technology Regions Overview](technology-regions-overview.md).</span></span>  
  
<a name="hosting_a_wpf_page"></a>   
## <a name="hosting-wpf-content-in-a-microsoft-win32-window"></a><span data-ttu-id="d121e-144">將 WPF 內容裝載在 Microsoft Win32 視窗中</span><span class="sxs-lookup"><span data-stu-id="d121e-144">Hosting WPF Content in a Microsoft Win32 Window</span></span>  
 <span data-ttu-id="d121e-145">要裝載的索引鍵[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]上[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 視窗是<xref:System.Windows.Interop.HwndSource>類別。</span><span class="sxs-lookup"><span data-stu-id="d121e-145">The key to hosting a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] on a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window is the <xref:System.Windows.Interop.HwndSource> class.</span></span> <span data-ttu-id="d121e-146">這個類別會包裝 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 視窗中的 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容，以將 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容併入 [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] 中作為子視窗。</span><span class="sxs-lookup"><span data-stu-id="d121e-146">This class wraps the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window, so that the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content can be incorporated into your [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] as a child window.</span></span> <span data-ttu-id="d121e-147">下列方法會將 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 和 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 合併在單一應用程式中。</span><span class="sxs-lookup"><span data-stu-id="d121e-147">The following approach combines the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in a single application.</span></span>  
  
1. <span data-ttu-id="d121e-148">將 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容 (內容根項目) 實作為 Managed 類別。</span><span class="sxs-lookup"><span data-stu-id="d121e-148">Implement your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content (the content root element) as a managed class.</span></span> <span data-ttu-id="d121e-149">一般而言，類別繼承自一個類別可以包含多個子項目和/或做為根項目，例如<xref:System.Windows.Controls.DockPanel>或<xref:System.Windows.Controls.Page>。</span><span class="sxs-lookup"><span data-stu-id="d121e-149">Typically, the class inherits from one of the classes that can contain multiple child elements and/or used as a root element, such as <xref:System.Windows.Controls.DockPanel> or <xref:System.Windows.Controls.Page>.</span></span> <span data-ttu-id="d121e-150">在後續步驟中，這個類別指的是 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容類別，而且類別的執行個體指的是 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容物件。</span><span class="sxs-lookup"><span data-stu-id="d121e-150">In subsequent steps, this class is referred to as the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class, and instances of the class are referred to as [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content objects.</span></span>  
  
2. <span data-ttu-id="d121e-151">以 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 實作 [!INCLUDE[TLA2#tla_cppcli](../../../../includes/tla2sharptla-cppcli-md.md)] 應用程式。</span><span class="sxs-lookup"><span data-stu-id="d121e-151">Implement a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application with [!INCLUDE[TLA2#tla_cppcli](../../../../includes/tla2sharptla-cppcli-md.md)].</span></span> <span data-ttu-id="d121e-152">如果您是使用現有 Unmanaged [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] 應用程式開始進行，通常只要變更專案設定來包含 `/clr` 編譯器旗標，該應用程式就可以呼叫 Managed 程式碼 (本主題未描述支援 `/clr` 編譯所需項目的完整範圍)。</span><span class="sxs-lookup"><span data-stu-id="d121e-152">If you are starting with an existing unmanaged [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] application, you can usually enable it to call managed code by changing your project settings to include the `/clr` compiler flag (the full scope of what might be necessary to support `/clr` compilation is not described in this topic).</span></span>  
  
3. <span data-ttu-id="d121e-153">將執行緒模型設為單一執行緒 Apartment (STA)。</span><span class="sxs-lookup"><span data-stu-id="d121e-153">Set the threading model to Single Threaded Apartment (STA).</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="d121e-154">使用此執行緒模型。</span><span class="sxs-lookup"><span data-stu-id="d121e-154">uses this threading model.</span></span>  
  
4. <span data-ttu-id="d121e-155">處理視窗程序中的 WM_CREATE 通知。</span><span class="sxs-lookup"><span data-stu-id="d121e-155">Handle the WM_CREATE notification in your window procedure.</span></span>  
  
5. <span data-ttu-id="d121e-156">在此處理常式 (或處理常式所呼叫的函式) 內，執行下列動作︰</span><span class="sxs-lookup"><span data-stu-id="d121e-156">Within the handler (or a function that the handler calls), do the following:</span></span>  
  
    1. <span data-ttu-id="d121e-157">建立新<xref:System.Windows.Interop.HwndSource>物件的父視窗 HWND 作為其`parent`參數。</span><span class="sxs-lookup"><span data-stu-id="d121e-157">Create a new <xref:System.Windows.Interop.HwndSource> object with the parent window HWND as its `parent` parameter.</span></span>  
  
    2. <span data-ttu-id="d121e-158">建立 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="d121e-158">Create an instance of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class.</span></span>  
  
    3. <span data-ttu-id="d121e-159">指定的參考[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容物件<xref:System.Windows.Interop.HwndSource>物件<xref:System.Windows.Interop.HwndSource.RootVisual%2A>屬性。</span><span class="sxs-lookup"><span data-stu-id="d121e-159">Assign a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object to the <xref:System.Windows.Interop.HwndSource> object <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property.</span></span>  
  
    4. <span data-ttu-id="d121e-160"><xref:System.Windows.Interop.HwndSource>物件<xref:System.Windows.Interop.HwndSource.Handle%2A>屬性包含視窗控制代碼 (HWND)。</span><span class="sxs-lookup"><span data-stu-id="d121e-160">The <xref:System.Windows.Interop.HwndSource> object <xref:System.Windows.Interop.HwndSource.Handle%2A> property contains the window handle (HWND).</span></span> <span data-ttu-id="d121e-161">若要取得可用於應用程式 Unmanaged 部分的 HWND，請將 `Handle.ToPointer()` 轉型為 HWND。</span><span class="sxs-lookup"><span data-stu-id="d121e-161">To get an HWND that you can use in the unmanaged part of your application, cast `Handle.ToPointer()` to an HWND.</span></span>  
  
6. <span data-ttu-id="d121e-162">實作 Managed 類別，其中包含靜態欄位來保存 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容物件的參考。</span><span class="sxs-lookup"><span data-stu-id="d121e-162">Implement a managed class that contains a static field that holds a reference to your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object.</span></span> <span data-ttu-id="d121e-163">這個類別可讓您取得的參考[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容的物件，從您[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]程式碼，但更重要的是它會防止您<xref:System.Windows.Interop.HwndSource>防止不小心收集到的記憶體回收。</span><span class="sxs-lookup"><span data-stu-id="d121e-163">This class allows you to get a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code, but more importantly it prevents your <xref:System.Windows.Interop.HwndSource> from being inadvertently garbage collected.</span></span>  
  
7. <span data-ttu-id="d121e-164">將處理常式附加到一或多個 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容物件事件，以接收 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容物件的通知。</span><span class="sxs-lookup"><span data-stu-id="d121e-164">Receive notifications from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object by attaching a handler to one or more of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object events.</span></span>  
  
8. <span data-ttu-id="d121e-165">使用儲存在靜態欄位中的參考來設定屬性及呼叫方法等等，以與 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容物件通訊。</span><span class="sxs-lookup"><span data-stu-id="d121e-165">Communicate with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object by using the reference that you stored in the static field to set properties, call methods, etc.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d121e-166">如果您產生不同的組件，然後參考它，則可以針對使用內容類別之預設部分類別的 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 中的步驟一，執行部分或所有 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容類別定義。</span><span class="sxs-lookup"><span data-stu-id="d121e-166">You can do some or all of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class definition for Step One in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] using the default partial class of the content class, if you produce a separate assembly and then reference it.</span></span> <span data-ttu-id="d121e-167">雖然您通常會包含<xref:System.Windows.Application>編譯的物件[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]組件中，您未抵達用<xref:System.Windows.Application>交互操作的一部分，您只使用一或多個根類別，如[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]參考的檔案若要由應用程式，並參考其部分類別。</span><span class="sxs-lookup"><span data-stu-id="d121e-167">Although you typically include an <xref:System.Windows.Application> object as part of compiling the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] into an assembly, you do not end up using that <xref:System.Windows.Application> as part of the interoperation, you just use one or more of the root classes for [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files referred to by the application and reference their partial classes.</span></span> <span data-ttu-id="d121e-168">此程序的其餘部分基本上與上述類似。</span><span class="sxs-lookup"><span data-stu-id="d121e-168">The remainder of the procedure is essentially similar to that outlined above.</span></span>  
>   
>  <span data-ttu-id="d121e-169">每個步驟說明主題中的程式碼透過[逐步解說：WPF 內容裝載在 Win32](walkthrough-hosting-wpf-content-in-win32.md)。</span><span class="sxs-lookup"><span data-stu-id="d121e-169">Each of these steps is illustrated through code in the topic [Walkthrough: Hosting WPF Content in Win32](walkthrough-hosting-wpf-content-in-win32.md).</span></span>  
  
<a name="hosting_an_hwnd"></a>   
## <a name="hosting-a-microsoft-win32-window-in-wpf"></a><span data-ttu-id="d121e-170">在 WPF 中裝載 Microsoft Win32 視窗</span><span class="sxs-lookup"><span data-stu-id="d121e-170">Hosting a Microsoft Win32 Window in WPF</span></span>  
 <span data-ttu-id="d121e-171">要裝載的索引鍵[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 視窗內其他[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容<xref:System.Windows.Interop.HwndHost>類別。</span><span class="sxs-lookup"><span data-stu-id="d121e-171">The key to hosting a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window within other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is the <xref:System.Windows.Interop.HwndHost> class.</span></span> <span data-ttu-id="d121e-172">此類別會將視窗包裝在 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 項目中，而此項目可以新增至 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 項目樹狀結構。</span><span class="sxs-lookup"><span data-stu-id="d121e-172">This class wraps the window in a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element which can be added to a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element tree.</span></span> <span data-ttu-id="d121e-173"><xref:System.Windows.Interop.HwndHost> 也支援[!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)]，可讓您執行工作，例如處理程序所裝載之視窗的訊息。</span><span class="sxs-lookup"><span data-stu-id="d121e-173"><xref:System.Windows.Interop.HwndHost> also supports [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] that allow you to do such tasks as process messages for the hosted window.</span></span> <span data-ttu-id="d121e-174">基本程序如下：</span><span class="sxs-lookup"><span data-stu-id="d121e-174">The basic procedure is:</span></span>  
  
1. <span data-ttu-id="d121e-175">建立 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 應用程式的項目樹狀結構 (可以透過程式碼或標記)。</span><span class="sxs-lookup"><span data-stu-id="d121e-175">Create an element tree for a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application (can be through code or markup).</span></span> <span data-ttu-id="d121e-176">在元素樹狀結構中尋找適當且允許點其中<xref:System.Windows.Interop.HwndHost>實作可以加入做為子項目。</span><span class="sxs-lookup"><span data-stu-id="d121e-176">Find an appropriate and permissible point in the element tree where the <xref:System.Windows.Interop.HwndHost> implementation can be added as a child element.</span></span> <span data-ttu-id="d121e-177">在後續步驟中，這個項目稱為保留項目。</span><span class="sxs-lookup"><span data-stu-id="d121e-177">In the remainder of these steps, this element is referred to as the reserving element.</span></span>  
  
2. <span data-ttu-id="d121e-178">衍生自<xref:System.Windows.Interop.HwndHost>來建立物件，持有您[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]內容。</span><span class="sxs-lookup"><span data-stu-id="d121e-178">Derive from <xref:System.Windows.Interop.HwndHost> to create an object that holds your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] content.</span></span>  
  
3. <span data-ttu-id="d121e-179">在該主機類別，覆寫<xref:System.Windows.Interop.HwndHost>方法<xref:System.Windows.Interop.HwndHost.BuildWindowCore%2A>。</span><span class="sxs-lookup"><span data-stu-id="d121e-179">In that host class, override the <xref:System.Windows.Interop.HwndHost> method <xref:System.Windows.Interop.HwndHost.BuildWindowCore%2A>.</span></span> <span data-ttu-id="d121e-180">傳回裝載之視窗的 HWND。</span><span class="sxs-lookup"><span data-stu-id="d121e-180">Return the HWND of the hosted window.</span></span> <span data-ttu-id="d121e-181">您可能想要將實際控制項包裝為所傳回視窗的子視窗；在主視窗中包裝控制項可提供簡單方式，讓 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容接收來自控制項的通知。</span><span class="sxs-lookup"><span data-stu-id="d121e-181">You might want to wrap the actual control(s) as a child window of the returned window; wrapping the controls in a host window provides a simple way for your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to receive notifications from the controls.</span></span> <span data-ttu-id="d121e-182">這項技術可協助修正與託管控制項界限的訊息處理相關的一些 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 問題。</span><span class="sxs-lookup"><span data-stu-id="d121e-182">This technique helps correct for some [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] issues regarding message handling at the hosted control boundary.</span></span>  
  
4. <span data-ttu-id="d121e-183">覆寫<xref:System.Windows.Interop.HwndHost>方法<xref:System.Windows.Interop.HwndHost.DestroyWindowCore%2A>和<xref:System.Windows.Interop.HwndHost.WndProc%2A>。</span><span class="sxs-lookup"><span data-stu-id="d121e-183">Override the <xref:System.Windows.Interop.HwndHost> methods <xref:System.Windows.Interop.HwndHost.DestroyWindowCore%2A> and <xref:System.Windows.Interop.HwndHost.WndProc%2A>.</span></span> <span data-ttu-id="d121e-184">這裡的目的是處理裝載之內容的清除和移除參考，特別是您已建立未受管理物件的參考時。</span><span class="sxs-lookup"><span data-stu-id="d121e-184">The intention here is to process cleanup and remove references to the hosted content, particularly if you created references to unmanaged objects.</span></span>  
  
5. <span data-ttu-id="d121e-185">在程式碼後置檔案中，建立控制項裝載類別的執行個體，並將它設定為保留項目的子系。</span><span class="sxs-lookup"><span data-stu-id="d121e-185">In your code-behind file, create an instance of the control hosting class and make it a child of the reserving element.</span></span> <span data-ttu-id="d121e-186">通常您會使用事件處理常式，例如<xref:System.Windows.FrameworkElement.Loaded>，或使用部分類別建構函式。</span><span class="sxs-lookup"><span data-stu-id="d121e-186">Typically you would use an event handler such as <xref:System.Windows.FrameworkElement.Loaded>, or use the partial class constructor.</span></span> <span data-ttu-id="d121e-187">但是，您也可以透過執行階段行為來新增交互操作內容。</span><span class="sxs-lookup"><span data-stu-id="d121e-187">But you could also add the interoperation content through a runtime behavior.</span></span>  
  
6. <span data-ttu-id="d121e-188">處理選取的視窗訊息，例如控制項通知。</span><span class="sxs-lookup"><span data-stu-id="d121e-188">Process selected window messages, such as control notifications.</span></span> <span data-ttu-id="d121e-189">有兩種方法。</span><span class="sxs-lookup"><span data-stu-id="d121e-189">There are two approaches.</span></span> <span data-ttu-id="d121e-190">兩者都提供訊息資料流的相同存取權，因此您的選擇大部分取決於程式設計便利性。</span><span class="sxs-lookup"><span data-stu-id="d121e-190">Both provide identical access to the message stream, so your choice is largely a matter of programming convenience.</span></span>  
  
    - <span data-ttu-id="d121e-191">實作訊息處理中的所有訊息 （不只是關機訊息） 的覆寫<xref:System.Windows.Interop.HwndHost>方法<xref:System.Windows.Interop.HwndHost.WndProc%2A>。</span><span class="sxs-lookup"><span data-stu-id="d121e-191">Implement message processing for all messages (not just shutdown messages) in your override of the <xref:System.Windows.Interop.HwndHost> method <xref:System.Windows.Interop.HwndHost.WndProc%2A>.</span></span>  
  
    - <span data-ttu-id="d121e-192">讓裝載[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]項目處理的訊息處理<xref:System.Windows.Interop.HwndHost.MessageHook>事件。</span><span class="sxs-lookup"><span data-stu-id="d121e-192">Have the hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element process the messages by handling the <xref:System.Windows.Interop.HwndHost.MessageHook> event.</span></span> <span data-ttu-id="d121e-193">針對傳送至裝載視窗之主要視窗程序的每個訊息，都會引發此事件。</span><span class="sxs-lookup"><span data-stu-id="d121e-193">This event is raised for every message that is sent to the main window procedure of the hosted window.</span></span>  
  
    - <span data-ttu-id="d121e-194">您無法處理來自不在此程序使用的 windows 訊息<xref:System.Windows.Interop.HwndHost.WndProc%2A>。</span><span class="sxs-lookup"><span data-stu-id="d121e-194">You cannot process messages from windows that are out of process using <xref:System.Windows.Interop.HwndHost.WndProc%2A>.</span></span>  
  
7. <span data-ttu-id="d121e-195">使用平台叫用來呼叫 Unmanaged `SendMessage` 函式，以與裝載的視窗通訊。</span><span class="sxs-lookup"><span data-stu-id="d121e-195">Communicate with the hosted window by using platform invoke to call the unmanaged `SendMessage` function.</span></span>  
  
 <span data-ttu-id="d121e-196">遵循下列步驟會建立可使用滑鼠輸入的應用程式。</span><span class="sxs-lookup"><span data-stu-id="d121e-196">Following these steps creates an application that works with mouse input.</span></span> <span data-ttu-id="d121e-197">您可以為您裝載的視窗新增定位處理支援，藉由實作<xref:System.Windows.Interop.IKeyboardInputSink>介面。</span><span class="sxs-lookup"><span data-stu-id="d121e-197">You can add tabbing support for your hosted window by implementing the <xref:System.Windows.Interop.IKeyboardInputSink> interface.</span></span>  
  
 <span data-ttu-id="d121e-198">每個步驟說明主題中的程式碼透過[逐步解說：Win32 控制項裝載在 WPF](walkthrough-hosting-a-win32-control-in-wpf.md)。</span><span class="sxs-lookup"><span data-stu-id="d121e-198">Each of these steps is illustrated through code in the topic [Walkthrough: Hosting a Win32 Control in WPF](walkthrough-hosting-a-win32-control-in-wpf.md).</span></span>  
  
### <a name="hwnds-inside-wpf"></a><span data-ttu-id="d121e-199">WPF 內的 Hwnd</span><span class="sxs-lookup"><span data-stu-id="d121e-199">Hwnds Inside WPF</span></span>  
 <span data-ttu-id="d121e-200">您可以將<xref:System.Windows.Interop.HwndHost>視為特殊控制項。</span><span class="sxs-lookup"><span data-stu-id="d121e-200">You can think of <xref:System.Windows.Interop.HwndHost> as a special control.</span></span> <span data-ttu-id="d121e-201">(技術上來說，<xref:System.Windows.Interop.HwndHost>已<xref:System.Windows.FrameworkElement>衍生類別，不<xref:System.Windows.Controls.Control>衍生類別，但它可以視為進行交互操作的控制項。)<xref:System.Windows.Interop.HwndHost>抽象化基礎[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]裝載內容的本質如此的其餘部分[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]會考慮裝載另一個類似控制項的物件，其應該轉譯和處理輸入的內容。</span><span class="sxs-lookup"><span data-stu-id="d121e-201">(Technically, <xref:System.Windows.Interop.HwndHost> is a <xref:System.Windows.FrameworkElement> derived class, not a <xref:System.Windows.Controls.Control> derived class, but it can be considered a control for purposes of interoperation.) <xref:System.Windows.Interop.HwndHost> abstracts the underlying [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] nature of the hosted content such that the remainder of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] considers the hosted content to be another control-like object, which should render and process input.</span></span> <span data-ttu-id="d121e-202"><xref:System.Windows.Interop.HwndHost> 行為通常類似任何其他[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.FrameworkElement>，不過有一些重要差異 （繪圖和圖形） 的輸出和輸入 （滑鼠和鍵盤） 以限制哪些基礎 Hwnd 可支援。</span><span class="sxs-lookup"><span data-stu-id="d121e-202"><xref:System.Windows.Interop.HwndHost> generally behaves like any other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.FrameworkElement>, although there are some important differences around output (drawing and graphics) and input (mouse and keyboard) based on limitations of what the underlying HWNDs can support.</span></span>  
  
#### <a name="notable-differences-in-output-behavior"></a><span data-ttu-id="d121e-203">輸出行為的顯著差異</span><span class="sxs-lookup"><span data-stu-id="d121e-203">Notable Differences in Output Behavior</span></span>  
  
- <span data-ttu-id="d121e-204"><xref:System.Windows.FrameworkElement>這是<xref:System.Windows.Interop.HwndHost>基底類別，有不少屬性表示 UI 的變更。</span><span class="sxs-lookup"><span data-stu-id="d121e-204"><xref:System.Windows.FrameworkElement>, which is the <xref:System.Windows.Interop.HwndHost> base class, has quite a few properties that imply changes to the UI.</span></span> <span data-ttu-id="d121e-205">這包括屬性，例如<xref:System.Windows.FrameworkElement.FlowDirection%2A?displayProperty=nameWithType>，該項目當做父代內的項目配置的變更。</span><span class="sxs-lookup"><span data-stu-id="d121e-205">These include properties such as <xref:System.Windows.FrameworkElement.FlowDirection%2A?displayProperty=nameWithType>, which changes the layout of elements within that element as a parent.</span></span> <span data-ttu-id="d121e-206">不過，這些屬性大部分都不會對應至可能的 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 對等項目，即使這類對等項目可能存在。</span><span class="sxs-lookup"><span data-stu-id="d121e-206">However, most of these properties are not mapped to possible [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] equivalents, even if such equivalents might exist.</span></span> <span data-ttu-id="d121e-207">這些屬性的絶大多數和其意義太特定於轉譯技術，以致對應成為實際。</span><span class="sxs-lookup"><span data-stu-id="d121e-207">Too many of these properties and their meanings are too rendering-technology specific for mappings to be practical.</span></span> <span data-ttu-id="d121e-208">因此，例如設定屬性<xref:System.Windows.FrameworkElement.FlowDirection%2A>上<xref:System.Windows.Interop.HwndHost>沒有任何作用。</span><span class="sxs-lookup"><span data-stu-id="d121e-208">Therefore, setting properties such as <xref:System.Windows.FrameworkElement.FlowDirection%2A> on <xref:System.Windows.Interop.HwndHost> has no effect.</span></span>  
  
- <span data-ttu-id="d121e-209"><xref:System.Windows.Interop.HwndHost> 無法旋轉、 縮放、 扭曲，或藉由轉換會受到影響。</span><span class="sxs-lookup"><span data-stu-id="d121e-209"><xref:System.Windows.Interop.HwndHost> cannot be rotated, scaled, skewed, or otherwise affected by a Transform.</span></span>  
  
- <span data-ttu-id="d121e-210"><xref:System.Windows.Interop.HwndHost> 不支援<xref:System.Windows.UIElement.Opacity%2A>（alpha 透明混色） 的屬性。</span><span class="sxs-lookup"><span data-stu-id="d121e-210"><xref:System.Windows.Interop.HwndHost> does not support the <xref:System.Windows.UIElement.Opacity%2A> property (alpha blending).</span></span> <span data-ttu-id="d121e-211">如果內容內<xref:System.Windows.Interop.HwndHost>會執行<xref:System.Drawing>作業包含 alpha 資訊，本身不是違規，但<xref:System.Windows.Interop.HwndHost>整體僅支援不透明度 = 1.0 （100%)。</span><span class="sxs-lookup"><span data-stu-id="d121e-211">If content inside the <xref:System.Windows.Interop.HwndHost> performs <xref:System.Drawing> operations that include alpha information, that is itself not a violation, but the <xref:System.Windows.Interop.HwndHost> as a whole only supports Opacity = 1.0 (100%).</span></span>  
  
- <span data-ttu-id="d121e-212"><xref:System.Windows.Interop.HwndHost> 將會出現在其他頂端[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]相同的最上層視窗中的項目。</span><span class="sxs-lookup"><span data-stu-id="d121e-212"><xref:System.Windows.Interop.HwndHost> will appear on top of other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] elements in the same top-level window.</span></span> <span data-ttu-id="d121e-213">不過，<xref:System.Windows.Controls.ToolTip>或是<xref:System.Windows.Controls.ContextMenu>產生的功能表是不同的最上層視窗中，並因此會正確運作與<xref:System.Windows.Interop.HwndHost>。</span><span class="sxs-lookup"><span data-stu-id="d121e-213">However, a <xref:System.Windows.Controls.ToolTip> or <xref:System.Windows.Controls.ContextMenu> generated menu is a separate top-level window, and so will behave correctly with <xref:System.Windows.Interop.HwndHost>.</span></span>  
  
- <span data-ttu-id="d121e-214"><xref:System.Windows.Interop.HwndHost> 不接受其父代的裁剪區域<xref:System.Windows.UIElement>。</span><span class="sxs-lookup"><span data-stu-id="d121e-214"><xref:System.Windows.Interop.HwndHost> does not respect the clipping region of its parent <xref:System.Windows.UIElement>.</span></span> <span data-ttu-id="d121e-215">這是可能的問題，如果您嘗試放<xref:System.Windows.Interop.HwndHost>捲動區域內的類別或<xref:System.Windows.Controls.Canvas>。</span><span class="sxs-lookup"><span data-stu-id="d121e-215">This is potentially an issue if you attempt to put an <xref:System.Windows.Interop.HwndHost> class inside a scrolling region or <xref:System.Windows.Controls.Canvas>.</span></span>  
  
#### <a name="notable-differences-in-input-behavior"></a><span data-ttu-id="d121e-216">輸入行為的顯著差異</span><span class="sxs-lookup"><span data-stu-id="d121e-216">Notable Differences in Input Behavior</span></span>  
  
- <span data-ttu-id="d121e-217">一般而言，當輸入的裝置的範圍內<xref:System.Windows.Interop.HwndHost>裝載[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]區域中，輸入的事件直接移至[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="d121e-217">In general, while input devices are scoped within the <xref:System.Windows.Interop.HwndHost> hosted [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] region, input events go directly to [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].</span></span>  
  
- <span data-ttu-id="d121e-218">雖然在滑鼠位於<xref:System.Windows.Interop.HwndHost>，您的應用程式不會收到[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]滑鼠事件，而值[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]屬性<xref:System.Windows.UIElement.IsMouseOver%2A>會`false`。</span><span class="sxs-lookup"><span data-stu-id="d121e-218">While the mouse is over the <xref:System.Windows.Interop.HwndHost>, your application does not receive [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] mouse events, and the value of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property <xref:System.Windows.UIElement.IsMouseOver%2A> will be `false`.</span></span>  
  
- <span data-ttu-id="d121e-219">雖然<xref:System.Windows.Interop.HwndHost>具有鍵盤焦點，您的應用程式將不會收到[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]鍵盤事件，而且值[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]屬性<xref:System.Windows.UIElement.IsKeyboardFocusWithin%2A>會`false`。</span><span class="sxs-lookup"><span data-stu-id="d121e-219">While the <xref:System.Windows.Interop.HwndHost> has keyboard focus, your application will not receive [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] keyboard events and the value of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property <xref:System.Windows.UIElement.IsKeyboardFocusWithin%2A> will be `false`.</span></span>  
  
- <span data-ttu-id="d121e-220">當焦點是在<xref:System.Windows.Interop.HwndHost>並變更到另一個控制項內<xref:System.Windows.Interop.HwndHost>，您的應用程式將不會收到[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]事件<xref:System.Windows.UIElement.GotFocus>或<xref:System.Windows.UIElement.LostFocus>。</span><span class="sxs-lookup"><span data-stu-id="d121e-220">When focus is within the <xref:System.Windows.Interop.HwndHost> and changes to another control inside the <xref:System.Windows.Interop.HwndHost>, your application will not receive the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] events <xref:System.Windows.UIElement.GotFocus> or <xref:System.Windows.UIElement.LostFocus>.</span></span>  
  
- <span data-ttu-id="d121e-221">相關的手寫筆屬性和事件類似，而且不會報告資訊時手寫筆位於<xref:System.Windows.Interop.HwndHost>。</span><span class="sxs-lookup"><span data-stu-id="d121e-221">Related stylus properties and events are analogous, and do not report information while the stylus is over <xref:System.Windows.Interop.HwndHost>.</span></span>  
  
<a name="tabbing_mnemonics_accelerators"></a>   
## <a name="tabbing-mnemonics-and-accelerators"></a><span data-ttu-id="d121e-222">定位處理、助憶鍵和加速器</span><span class="sxs-lookup"><span data-stu-id="d121e-222">Tabbing, Mnemonics, and Accelerators</span></span>  
 <span data-ttu-id="d121e-223"><xref:System.Windows.Interop.IKeyboardInputSink>並<xref:System.Windows.Interop.IKeyboardInputSite>介面可讓您建立的順暢鍵盤體驗，針對混合[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]和[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]應用程式：</span><span class="sxs-lookup"><span data-stu-id="d121e-223">The <xref:System.Windows.Interop.IKeyboardInputSink> and <xref:System.Windows.Interop.IKeyboardInputSite> interfaces allow you to create a seamless keyboard experience for mixed [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] applications:</span></span>  
  
- <span data-ttu-id="d121e-224">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 與 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 元件之間的定位處理</span><span class="sxs-lookup"><span data-stu-id="d121e-224">Tabbing between [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] components</span></span>  
  
- <span data-ttu-id="d121e-225">焦點在 Win32 元件內以及在 WPF 元件內時所使用的助憶鍵和加速器。</span><span class="sxs-lookup"><span data-stu-id="d121e-225">Mnemonics and accelerators that work both when focus is within a Win32 component and when it is within a WPF component.</span></span>  
  
 <span data-ttu-id="d121e-226"><xref:System.Windows.Interop.HwndHost>並<xref:System.Windows.Interop.HwndSource>這兩個類別提供的實作<xref:System.Windows.Interop.IKeyboardInputSink>，但它們可能無法處理所有輸入的訊息所需更進階的案例。</span><span class="sxs-lookup"><span data-stu-id="d121e-226">The <xref:System.Windows.Interop.HwndHost> and <xref:System.Windows.Interop.HwndSource> classes both provide implementations of <xref:System.Windows.Interop.IKeyboardInputSink>, but they may not handle all the input messages that you want for more advanced scenarios.</span></span> <span data-ttu-id="d121e-227">覆寫適當的方法，以取得您想要的鍵盤行為。</span><span class="sxs-lookup"><span data-stu-id="d121e-227">Override the appropriate methods to get the keyboard behavior you want.</span></span>  
  
 <span data-ttu-id="d121e-228">這些介面僅支援在 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 與 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 區域之間轉換時所發生的情況。</span><span class="sxs-lookup"><span data-stu-id="d121e-228">The interfaces only provide support for what happens on the transition between the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] regions.</span></span> <span data-ttu-id="d121e-229">在 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 區域內，定位處理行為完全是透過 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 實作的定位處理邏輯所控制 (如果有的話)。</span><span class="sxs-lookup"><span data-stu-id="d121e-229">Within the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] region, tabbing behavior is entirely controlled by the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] implemented logic for tabbing, if any.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d121e-230">另請參閱</span><span class="sxs-lookup"><span data-stu-id="d121e-230">See also</span></span>

- <xref:System.Windows.Interop.HwndHost>
- <xref:System.Windows.Interop.HwndSource>
- <xref:System.Windows.Interop>
- [<span data-ttu-id="d121e-231">逐步解說：裝載在 WPF 中的 Win32 控制項</span><span class="sxs-lookup"><span data-stu-id="d121e-231">Walkthrough: Hosting a Win32 Control in WPF</span></span>](walkthrough-hosting-a-win32-control-in-wpf.md)
- [<span data-ttu-id="d121e-232">逐步解說：在 Win32 中裝載 WPF 內容</span><span class="sxs-lookup"><span data-stu-id="d121e-232">Walkthrough: Hosting WPF Content in Win32</span></span>](walkthrough-hosting-wpf-content-in-win32.md)
