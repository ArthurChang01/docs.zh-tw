---
title: 逐步解說：在 Win32 中裝載 WPF 內容
ms.date: 03/30/2017
dev_langs:
- cpp
helpviewer_keywords:
- hosting WPF content in Win32 window [WPF]
ms.assetid: 38ce284a-4303-46dd-b699-c9365b22a7dc
ms.openlocfilehash: 1f1ac68e49b5f84a41e3091b1a81010e7aa7cc0b
ms.sourcegitcommit: 0c48191d6d641ce88d7510e319cf38c0e35697d0
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/05/2019
ms.locfileid: "57363159"
---
# <a name="walkthrough-hosting-wpf-content-in-win32"></a><span data-ttu-id="5b4cf-102">逐步解說：在 Win32 中裝載 WPF 內容</span><span class="sxs-lookup"><span data-stu-id="5b4cf-102">Walkthrough: Hosting WPF Content in Win32</span></span>
[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] <span data-ttu-id="5b4cf-103">提供用來建立應用程式的豐富環境。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-103">provides a rich environment for creating applications.</span></span> <span data-ttu-id="5b4cf-104">不過，如果您已長期開發 [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] 程式碼，將 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 功能加入應用程式，可能會比重寫原始程式碼更有效率。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-104">However, when you have a substantial investment in [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] code, it might be more effective to add [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] functionality to your application rather than rewriting your original code.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="5b4cf-105">提供簡單的機制，來裝載[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]中的內容[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]視窗。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-105">provides a straightforward mechanism for hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span>  
  
 <span data-ttu-id="5b4cf-106">本教學課程說明如何撰寫範例應用程式[在 Win32 視窗範例中裝載 WPF 內容](https://go.microsoft.com/fwlink/?LinkID=160004)，、 該主機[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]中的內容[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]視窗。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-106">This tutorial describes how to write a sample application, [Hosting WPF Content in a Win32 Window Sample](https://go.microsoft.com/fwlink/?LinkID=160004), that hosts [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="5b4cf-107">您可以擴充這個範例，以裝載任何 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 視窗。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-107">You can extend this sample to host any [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="5b4cf-108">因為這牽涉到混合 Managed 和 Unmanaged程式碼，所以是以 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] 撰寫應用程式。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-108">Because it involves mixing managed and unmanaged code, the application is written in [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)].</span></span>  
  
 
  
<a name="requirements"></a>   
## <a name="requirements"></a><span data-ttu-id="5b4cf-109">需求</span><span class="sxs-lookup"><span data-stu-id="5b4cf-109">Requirements</span></span>  
 <span data-ttu-id="5b4cf-110">本教學課程假設您對 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 和 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 程式設計已有基本的熟悉度。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-110">This tutorial assumes a basic familiarity with both [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] programming.</span></span> <span data-ttu-id="5b4cf-111">如需基本簡介[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]程式設計，請參閱[快速入門](../getting-started/index.md)。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-111">For a basic introduction to [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] programming, see [Getting Started](../getting-started/index.md).</span></span> <span data-ttu-id="5b4cf-112">如需簡介[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]程式設計，您應該參考書籍嶄新的任何特別*程式設計 Windows* Charles petzold 的。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-112">For an introduction to [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] programming, you should reference any of the numerous books on the subject, in particular *Programming Windows* by Charles Petzold.</span></span>  
  
 <span data-ttu-id="5b4cf-113">因為隨附本教學課程的範例中實作[!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)]，本教學課程假設您使用熟悉[!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)]程式[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] [!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] managed 程式碼的程式設計，並且了解。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-113">Because the sample that accompanies this tutorial is implemented in [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)], this tutorial assumes familiarity with the use of [!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)] to program the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)][!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] plus an understanding of managed code programming.</span></span> <span data-ttu-id="5b4cf-114">熟悉 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] 會有幫助，但並非必要。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-114">Familiarity with [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] is helpful but not essential.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5b4cf-115">本教學課程包含一些來自相關範例的程式碼範例。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-115">This tutorial includes a number of code examples from the associated sample.</span></span> <span data-ttu-id="5b4cf-116">不過，為了方便閱讀，並未包含完整的範例程式碼。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-116">However, for readability, it does not include the complete sample code.</span></span> <span data-ttu-id="5b4cf-117">完整範例程式碼，請參閱[Win32 視窗範例中裝載 WPF 內容](https://go.microsoft.com/fwlink/?LinkID=160004)。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-117">For the complete sample code, see [Hosting WPF Content in a Win32 Window Sample](https://go.microsoft.com/fwlink/?LinkID=160004).</span></span>  
  
<a name="basic_procedure"></a>   
## <a name="the-basic-procedure"></a><span data-ttu-id="5b4cf-118">基本程序</span><span class="sxs-lookup"><span data-stu-id="5b4cf-118">The Basic Procedure</span></span>  
 <span data-ttu-id="5b4cf-119">本節將概述您使用的基本程序主機[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]中的內容[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]視窗。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-119">This section outlines the basic procedure you use to host [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="5b4cf-120">其餘各節將說明每個步驟的詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-120">The remaining sections explain the details of each step.</span></span>  
  
 <span data-ttu-id="5b4cf-121">要裝載的索引鍵[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]上的內容[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 視窗是<xref:System.Windows.Interop.HwndSource>類別。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-121">The key to hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content on a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window is the <xref:System.Windows.Interop.HwndSource> class.</span></span> <span data-ttu-id="5b4cf-122">這個類別會包裝[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]中的內容[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]視窗中，使其併入您[!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)]做為子視窗。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-122">This class wraps the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window, allowing it to be incorporated into your [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] as a child window.</span></span> <span data-ttu-id="5b4cf-123">下列方法會將 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 和 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 合併在單一應用程式中。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-123">The following approach combines the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in a single application.</span></span>  
  
1.  <span data-ttu-id="5b4cf-124">實作您[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容作為 managed 類別。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-124">Implement your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content as a managed class.</span></span>  
  
2.  <span data-ttu-id="5b4cf-125">以 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 實作 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] 應用程式。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-125">Implement a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application with [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)].</span></span> <span data-ttu-id="5b4cf-126">如果您是使用現有的應用程式和 Unmanaged [!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)] 程式碼開始進行，通常只要變更專案設定來包含 `/clr` 編譯器旗標，該應用程式就可以呼叫 Managed 程式碼。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-126">If you are starting with an existing application and unmanaged [!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)] code, you can usually enable it to call managed code by changing your project settings to include the `/clr` compiler flag.</span></span>  
  
3.  <span data-ttu-id="5b4cf-127">將執行緒模型設為單一執行緒 Apartment (STA)。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-127">Set the threading model to single-threaded apartment (STA).</span></span>  
  
4.  <span data-ttu-id="5b4cf-128">處理[WM_CREATE](/windows/desktop/winmsg/wm-create)通知您的視窗程序和執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="5b4cf-128">Handle the [WM_CREATE](/windows/desktop/winmsg/wm-create)notification in your window procedure and do the following:</span></span>  
  
    1.  <span data-ttu-id="5b4cf-129">以父視窗做為 <xref:System.Windows.Interop.HwndSource> 參數，建立新的 `parent` 物件。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-129">Create a new <xref:System.Windows.Interop.HwndSource> object with the parent window as its `parent` parameter.</span></span>  
  
    2.  <span data-ttu-id="5b4cf-130">建立 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容類別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-130">Create an instance of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class.</span></span>  
  
    3.  <span data-ttu-id="5b4cf-131">指定的參考[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容物件<xref:System.Windows.Interop.HwndSource.RootVisual%2A>屬性<xref:System.Windows.Interop.HwndSource>。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-131">Assign a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object to the <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property of the <xref:System.Windows.Interop.HwndSource>.</span></span>  
  
    4.  <span data-ttu-id="5b4cf-132">取得內容的 HWND。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-132">Get the HWND for the content.</span></span> <span data-ttu-id="5b4cf-133"><xref:System.Windows.Interop.HwndSource> 物件的 <xref:System.Windows.Interop.HwndSource.Handle%2A> 屬性包含視窗控制代碼 (HWND)。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-133">The <xref:System.Windows.Interop.HwndSource.Handle%2A> property of the <xref:System.Windows.Interop.HwndSource> object contains the window handle (HWND).</span></span> <span data-ttu-id="5b4cf-134">若要取得可用於應用程式 Unmanaged 部分的 HWND，請將 `Handle.ToPointer()` 轉型為 HWND。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-134">To get an HWND that you can use in the unmanaged part of your application, cast `Handle.ToPointer()` to an HWND.</span></span>  
  
5.  <span data-ttu-id="5b4cf-135">實作 Managed 類別，其中包含靜態欄位來保存 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容的參考。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-135">Implement a managed class that contains a static field to hold a reference to your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="5b4cf-136">這個類別可讓您從 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 程式碼取得 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容的參考。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-136">This class allows you to get a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code.</span></span>  
  
6.  <span data-ttu-id="5b4cf-137">將 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容指派至靜態欄位。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-137">Assign the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to the static field.</span></span>  
  
7.  <span data-ttu-id="5b4cf-138">接收通知[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]處理常式附加至一或多個內容[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]事件。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-138">Receive notifications from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content by attaching a handler to one or more of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] events.</span></span>  
  
8.  <span data-ttu-id="5b4cf-139">使用儲存在靜態欄位中的參考來設定屬性等等，以與 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容通訊。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-139">Communicate with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content by using the reference that you stored in the static field to set properties, and so on.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5b4cf-140">您也可以使用[!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)]來實作您[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-140">You can also use [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] to implement your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="5b4cf-141">不過，您必須另外將它編譯成 [!INCLUDE[TLA#tla_dll](../../../../includes/tlasharptla-dll-md.md)]，並從 [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] 應用程式參考該 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-141">However, you will have to compile it separately as a [!INCLUDE[TLA#tla_dll](../../../../includes/tlasharptla-dll-md.md)] and reference that [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application.</span></span> <span data-ttu-id="5b4cf-142">此程序的其餘部分與上述類似。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-142">The remainder of the procedure is similar to that outlined above.</span></span>

<a name="implementing_the_application"></a>
## <a name="implementing-the-host-application"></a><span data-ttu-id="5b4cf-143">實作主應用程式</span><span class="sxs-lookup"><span data-stu-id="5b4cf-143">Implementing the Host Application</span></span>
 <span data-ttu-id="5b4cf-144">本章節描述如何裝載[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容中基本[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]應用程式。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-144">This section describes how to host [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a basic [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application.</span></span> <span data-ttu-id="5b4cf-145">內容本身實作在 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] 中，做為 Managed 類別。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-145">The content itself is implemented in [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] as a managed class.</span></span> <span data-ttu-id="5b4cf-146">大部分的情況下，這就是 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 程式設計。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-146">For the most part, it is straightforward [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] programming.</span></span> <span data-ttu-id="5b4cf-147">討論內容實作的關鍵環節[實作 WPF 內容](#implementing_the_wpf_page)。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-147">The key aspects of the content implementation are discussed in [Implementing the WPF Content](#implementing_the_wpf_page).</span></span>

<a name="autoNestedSectionsOUTLINE1"></a>
-   [<span data-ttu-id="5b4cf-148">基本應用程式</span><span class="sxs-lookup"><span data-stu-id="5b4cf-148">The Basic Application</span></span>](#the_basic_application)

-   [<span data-ttu-id="5b4cf-149">裝載 WPF 內容</span><span class="sxs-lookup"><span data-stu-id="5b4cf-149">Hosting the WPF Content</span></span>](#hosting_the_wpf_page)

-   [<span data-ttu-id="5b4cf-150">保存 WPF 內容的參考</span><span class="sxs-lookup"><span data-stu-id="5b4cf-150">Holding a Reference to the WPF Content</span></span>](#holding_a_reference)

-   [<span data-ttu-id="5b4cf-151">與 WPF 內容通訊</span><span class="sxs-lookup"><span data-stu-id="5b4cf-151">Communicating with the WPF Content</span></span>](#communicating_with_the_page)

<a name="the_basic_application"></a>
### <a name="the-basic-application"></a><span data-ttu-id="5b4cf-152">基本應用程式</span><span class="sxs-lookup"><span data-stu-id="5b4cf-152">The Basic Application</span></span>
 <span data-ttu-id="5b4cf-153">主應用程式的起點是建立 Visual Studio 2005 範本。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-153">The starting point for the host application was to create a Visual Studio 2005 template.</span></span>

1.  <span data-ttu-id="5b4cf-154">開啟 Visual Studio 2005 中，然後選取**新的專案**從**檔案**功能表。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-154">Open Visual Studio 2005, and select **New Project** from the **File** menu.</span></span>

2.  <span data-ttu-id="5b4cf-155">選取  **Win32**從清單中[!INCLUDE[TLA2#tla_visualcpp](../../../../includes/tla2sharptla-visualcpp-md.md)]專案類型。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-155">Select **Win32** from the list of [!INCLUDE[TLA2#tla_visualcpp](../../../../includes/tla2sharptla-visualcpp-md.md)] project types.</span></span> <span data-ttu-id="5b4cf-156">如果您的預設語言不是[!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)]，您會找到這些專案類型之下**其他語言**。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-156">If your default language is not [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)], you will find these project types under **Other Languages**.</span></span>

3.  <span data-ttu-id="5b4cf-157">選取  **Win32 專案**範本，將名稱指派至專案，然後按一下**確定**來啟動**Win32 應用程式精靈**。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-157">Select a **Win32 Project** template, assign a name to the project and click **OK** to launch the **Win32 Application Wizard**.</span></span>

4.  <span data-ttu-id="5b4cf-158">接受精靈的預設設定，然後按**完成**啟動專案。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-158">Accept the wizard's default settings and click **Finish** to start the project.</span></span>

 <span data-ttu-id="5b4cf-159">此範本會建立基本 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 應用程式，包括：</span><span class="sxs-lookup"><span data-stu-id="5b4cf-159">The template creates a basic [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application, including:</span></span>

-   <span data-ttu-id="5b4cf-160">應用程式的進入點。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-160">An entry point for the application.</span></span>

-   <span data-ttu-id="5b4cf-161">視窗，具有相關聯的視窗程序 (WndProc)。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-161">A window, with an associated window procedure (WndProc).</span></span>

-   <span data-ttu-id="5b4cf-162">包含的功能表**檔案**並**協助**標題。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-162">A menu with **File** and **Help** headings.</span></span> <span data-ttu-id="5b4cf-163">**檔案** 功能表有**結束**關閉應用程式的項目。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-163">The **File** menu has an **Exit** item that closes the application.</span></span> <span data-ttu-id="5b4cf-164">**幫助** 功能表有**有關**啟動簡單對話方塊中的項目。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-164">The **Help** menu has an **About** item that launches a simple dialog box.</span></span>

 <span data-ttu-id="5b4cf-165">在您開始撰寫程式碼來裝載之前[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容，您必須先對基本範本的兩個修改。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-165">Before you start writing code to host the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, you need to make two modifications to the basic template.</span></span>

 <span data-ttu-id="5b4cf-166">第一個是將專案編譯成 Managed 程式碼。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-166">The first is to compile the project as managed code.</span></span> <span data-ttu-id="5b4cf-167">根據預設，專案會編譯成 Unmanaged 程式碼。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-167">By default, the project compiles as unmanaged code.</span></span> <span data-ttu-id="5b4cf-168">不過，因為 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 是以 Managed 程式碼實作，所以專案必須據以編譯。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-168">However, because [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] is implemented in managed code, the project must be compiled accordingly.</span></span>

1.  <span data-ttu-id="5b4cf-169">中的專案名稱上按一下滑鼠右鍵**方案總管**，然後選取**屬性**從內容功能表來啟動**屬性頁** 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-169">Right-click the project name in **Solution Explorer** and select **Properties** from the context menu to launch the **Property Pages** dialog box.</span></span>

2.  <span data-ttu-id="5b4cf-170">選取 **組態屬性**從左窗格中的樹狀檢視。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-170">Select **Configuration Properties** from the tree view in the left pane.</span></span>

3.  <span data-ttu-id="5b4cf-171">選取  **Common Language Runtime**支援從**專案預設值**右窗格中的清單。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-171">Select **Common Language Runtime** support from the **Project Defaults** list in the right pane.</span></span>

4.  <span data-ttu-id="5b4cf-172">選取  **Common Language Runtime 支援 (/ clr)** 從下拉式清單方塊。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-172">Select **Common Language Runtime Support (/clr)** from the drop-down list box.</span></span>

> [!NOTE]
>  <span data-ttu-id="5b4cf-173">此編譯器旗標可讓您在應用程式中使用 Managed 程式碼，但 Unmanaged 程式碼還是會編譯成和之前一樣。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-173">This compiler flag allows you to use managed code in your application, but your unmanaged code will still compile as before.</span></span>

 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="5b4cf-174">使用單一執行緒 Apartment (STA) 執行緒模型。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-174">uses the single-threaded apartment (STA) threading model.</span></span> <span data-ttu-id="5b4cf-175">若要正確使用[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容的程式碼中，您必須設定應用程式的執行緒模型設為 STA 將屬性套用至進入點。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-175">In order to work properly with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content code, you must set the application's threading model to STA by applying an attribute to the entry point.</span></span>

 [!code-cpp[Win32HostingWPFPage#WinMain](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#winmain)]

<a name="hosting_the_wpf_page"></a>
### <a name="hosting-the-wpf-content"></a><span data-ttu-id="5b4cf-176">裝載 WPF 內容</span><span class="sxs-lookup"><span data-stu-id="5b4cf-176">Hosting the WPF Content</span></span>
 <span data-ttu-id="5b4cf-177">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容是簡單的位址輸入應用程式。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-177">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is a simple address entry application.</span></span> <span data-ttu-id="5b4cf-178">它包含數個 <xref:System.Windows.Controls.TextBox> 控制項，以取得使用者名稱、位址等等。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-178">It consists of several <xref:System.Windows.Controls.TextBox> controls to take user name, address, and so on.</span></span> <span data-ttu-id="5b4cf-179">另外還有兩個<xref:System.Windows.Controls.Button>控制項 **[確定]** 並**取消**。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-179">There are also two <xref:System.Windows.Controls.Button> controls, **OK** and **Cancel**.</span></span> <span data-ttu-id="5b4cf-180">當使用者按一下 **[確定]**，按鈕<xref:System.Windows.Controls.Primitives.ButtonBase.Click>事件處理常式會收集的資料<xref:System.Windows.Controls.TextBox>控制、 將它指派給對應的屬性，並引發自訂事件， `OnButtonClicked`。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-180">When the user clicks **OK**, the button's <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event handler collects the data from the <xref:System.Windows.Controls.TextBox> controls, assigns it to corresponding properties, and raises a custom event, `OnButtonClicked`.</span></span> <span data-ttu-id="5b4cf-181">當使用者按一下**取消**，這個處理常式只會引發`OnButtonClicked`。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-181">When the user clicks **Cancel**, the handler simply raises `OnButtonClicked`.</span></span> <span data-ttu-id="5b4cf-182">
  `OnButtonClicked\` 的事件引數物件包含布林值的欄位，指出所點選的按鈕。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-182">The event argument object for `OnButtonClicked` contains a Boolean field that indicates which button was clicked.</span></span>

 <span data-ttu-id="5b4cf-183">主應用程式的程式碼[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容的處理常式中實作[WM_CREATE](/windows/desktop/winmsg/wm-create)主視窗上的通知。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-183">The code to host the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is implemented in a handler for the [WM_CREATE](/windows/desktop/winmsg/wm-create) notification on the host window.</span></span>

 [!code-cpp[Win32HostingWPFPage#WMCreate](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#wmcreate)]

 <span data-ttu-id="5b4cf-184">`GetHwnd`方法會採用大小和位置的資訊，再加上父視窗控制代碼，並傳回所裝載的視窗控制代碼[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-184">The `GetHwnd` method takes size and position information plus the parent window handle and returns the window handle of the hosted [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span>

> [!NOTE]
>  <span data-ttu-id="5b4cf-185">您不能將 `#using` 指示詞用於 `System::Windows::Interop` 命名空間。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-185">You cannot use a `#using` directive for the `System::Windows::Interop` namespace.</span></span> <span data-ttu-id="5b4cf-186">這麼做會在該命名空間中的 <xref:System.Windows.Interop.MSG> 結構與 winuser.h 中宣告的 MSG 結構之間，造成名稱衝突。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-186">Doing so creates a name collision between the <xref:System.Windows.Interop.MSG> structure in that namespace and the MSG structure declared in winuser.h.</span></span> <span data-ttu-id="5b4cf-187">您必須改用完整的名稱來存取該命名空間的內容。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-187">You must instead use fully-qualified names to access the contents of that namespace.</span></span>

 [!code-cpp[Win32HostingWPFPage#GetHwnd](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#gethwnd)]

 <span data-ttu-id="5b4cf-188">您無法將裝載[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]直接在您的應用程式視窗的內容。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-188">You cannot host the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content directly in your application window.</span></span> <span data-ttu-id="5b4cf-189">相反地，您要先建立 <xref:System.Windows.Interop.HwndSource> 物件來包裝 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-189">Instead, you first create an <xref:System.Windows.Interop.HwndSource> object to wrap the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="5b4cf-190">此物件基本上就設計用來裝載的視窗[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-190">This object is basically a window that is designed to host a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="5b4cf-191">您裝載<xref:System.Windows.Interop.HwndSource>藉由建立為子系的父視窗中的物件[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]屬於您的應用程式的視窗。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-191">You host the <xref:System.Windows.Interop.HwndSource> object in the parent window by creating it as a child of a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window that is part of your application.</span></span> <span data-ttu-id="5b4cf-192">
  <xref:System.Windows.Interop.HwndSource> 建構函式參數所包含的資訊，與您建立 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 子視窗時，傳遞至 CreateWindow 的資訊類似。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-192">The <xref:System.Windows.Interop.HwndSource> constructor parameters contain much the same information that you would pass to CreateWindow when you create a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] child window.</span></span>

 <span data-ttu-id="5b4cf-193">您接下來建立的執行個體[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容物件。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-193">You next create an instance of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object.</span></span> <span data-ttu-id="5b4cf-194">在此案例中，[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容使用 `WPFPage` 來實作成個別的類別 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-194">In this case, the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is implemented as a separate class, `WPFPage`, using [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)].</span></span> <span data-ttu-id="5b4cf-195">您也可以使用 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 來實作 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 內容。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-195">You could also implement the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content with [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span></span> <span data-ttu-id="5b4cf-196">不過，若要這樣做您需要設定個別的專案和建置[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容做為[!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-196">However, to do so you need to set up a separate project and build the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content as a [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)].</span></span> <span data-ttu-id="5b4cf-197">您可以將該 [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] 的參考加入您的專案，並使用該參考來建立 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容的執行個體。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-197">You can add a reference to that [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] to your project, and use that reference to create an instance of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span>

 <span data-ttu-id="5b4cf-198">您顯示[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容中子視窗的參考指派[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容<xref:System.Windows.Interop.HwndSource.RootVisual%2A>屬性<xref:System.Windows.Interop.HwndSource>。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-198">You display the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in your child window by assigning a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to the <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property of the <xref:System.Windows.Interop.HwndSource>.</span></span>

 <span data-ttu-id="5b4cf-199">下一行程式碼會將事件處理常式 `WPFButtonClicked` 附加至 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容 `OnButtonClicked` 事件。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-199">The next line of code attaches an event handler, `WPFButtonClicked`, to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content `OnButtonClicked` event.</span></span> <span data-ttu-id="5b4cf-200">當使用者按一下，會呼叫此處理常式**確定**或是**取消** 按鈕。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-200">This handler is called when the user clicks the **OK** or **Cancel** button.</span></span> <span data-ttu-id="5b4cf-201">請參閱[wpf 內容通訊](#communicating_with_the_page)這個事件處理常式的進一步討論。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-201">See [communicating_with_the_WPF content](#communicating_with_the_page) for further discussion of this event handler.</span></span>

 <span data-ttu-id="5b4cf-202">所顯示的最後一行程式碼會傳回與 <xref:System.Windows.Interop.HwndSource> 物件相關聯的視窗控制代碼 (HWND)。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-202">The final line of code shown returns the window handle (HWND) that is associated with the <xref:System.Windows.Interop.HwndSource> object.</span></span> <span data-ttu-id="5b4cf-203">您可以從 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 程式碼使用此控制代碼，將訊息傳送至裝載的視窗，但此範例並沒有這麼做。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-203">You can use this handle from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code to send messages to the hosted window, although the sample does not do so.</span></span> <span data-ttu-id="5b4cf-204"><xref:System.Windows.Interop.HwndSource> 物件每次收到訊息時，都會引發事件。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-204">The <xref:System.Windows.Interop.HwndSource> object raises an event every time it receives a message.</span></span> <span data-ttu-id="5b4cf-205">若要處理這些訊息，請呼叫 <xref:System.Windows.Interop.HwndSource.AddHook%2A> 方法來附加訊息處理常式，然後在該處理常式中處理訊息。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-205">To process the messages, call the <xref:System.Windows.Interop.HwndSource.AddHook%2A> method to attach a message handler and then process the messages in that handler.</span></span>

<a name="holding_a_reference"></a>
### <a name="holding-a-reference-to-the-wpf-content"></a><span data-ttu-id="5b4cf-206">保存 WPF 內容的參考</span><span class="sxs-lookup"><span data-stu-id="5b4cf-206">Holding a Reference to the WPF Content</span></span>
 <span data-ttu-id="5b4cf-207">就許多應用程式而言，您稍後會想要與 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容通訊。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-207">For many applications, you will want to communicate with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content later.</span></span> <span data-ttu-id="5b4cf-208">例如，您可能會想要修改 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容屬性，或是讓 <xref:System.Windows.Interop.HwndSource> 物件裝載不同的 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-208">For example, you might want to modify the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties, or perhaps have the <xref:System.Windows.Interop.HwndSource> object host different [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="5b4cf-209">若要這麼做，您需要 <xref:System.Windows.Interop.HwndSource> 物件或 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容的參考。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-209">To do this, you need a reference to the <xref:System.Windows.Interop.HwndSource> object or the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="5b4cf-210"><xref:System.Windows.Interop.HwndSource> 物件及其相關聯的 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容會保留在記憶體中，直到您終結視窗控制代碼。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-210">The <xref:System.Windows.Interop.HwndSource> object and its associated [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content remain in memory until you destroy the window handle.</span></span> <span data-ttu-id="5b4cf-211">不過，一旦您從視窗程序返回，您指派給 <xref:System.Windows.Interop.HwndSource> 物件的變數就會超出範圍。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-211">However, the variable you assign to the <xref:System.Windows.Interop.HwndSource> object will go out of scope as soon as you return from the window procedure.</span></span> <span data-ttu-id="5b4cf-212">若要以自訂方式來處理 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 應用程式的這個問題，您可以使用靜態或全域變數。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-212">The customary way to handle this issue with [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] applications is to use a static or global variable.</span></span> <span data-ttu-id="5b4cf-213">可惜的是，您無法將 Managed 物件指派給這些類型的變數。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-213">Unfortunately, you cannot assign a managed object to those types of variables.</span></span> <span data-ttu-id="5b4cf-214">您可以將與 <xref:System.Windows.Interop.HwndSource> 物件相關聯的視窗控制代碼指派給全域或靜態變數，但這樣並不能存取物件本身。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-214">You can assign the window handle associated with <xref:System.Windows.Interop.HwndSource> object to a global or static variable, but that doe not provide access to the object itself.</span></span>

 <span data-ttu-id="5b4cf-215">此問題最簡單的解決方案，就是實作 Managed 類別，其中包含一組靜態欄位來保存您需要存取之任何 Managed 物件的參考。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-215">The simplest solution to this issue is to implement a managed class that contains a set of static fields to hold references to any managed objects that you need access to.</span></span> <span data-ttu-id="5b4cf-216">此範例使用 `WPFPageHost` 類別來保存 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容的參考，以及稍後使用者可能變更之一些屬性的起始值。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-216">The sample uses the `WPFPageHost` class to hold a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, plus the initial values of a number of its properties that might be changed later by the user.</span></span> <span data-ttu-id="5b4cf-217">這定義在標頭中。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-217">This is defined in the header.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageHost](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.h#wpfpagehost)]

 <span data-ttu-id="5b4cf-218">
  `GetHwnd\` 函式的後半部會將值指派給這些欄位，以供日後使用，而 `myPage\` 仍在範圍內。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-218">The latter part of the `GetHwnd` function assigns values to those fields for later use while `myPage` is still in scope.</span></span>

<a name="communicating_with_the_page"></a>
### <a name="communicating-with-the-wpf-content"></a><span data-ttu-id="5b4cf-219">與 WPF 內容通訊</span><span class="sxs-lookup"><span data-stu-id="5b4cf-219">Communicating with the WPF Content</span></span>
 <span data-ttu-id="5b4cf-220">有兩種與 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容通訊的類型。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-220">There are two types of communication with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="5b4cf-221">應用程式接收來自[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]當使用者按一下內容 **[確定]** 或是**取消**按鈕。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-221">The application receives information from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content when the user clicks the **OK** or **Cancel** buttons.</span></span> <span data-ttu-id="5b4cf-222">應用程式也有 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]，可讓使用者變更各種 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容屬性，例如背景色彩或預設字型大小。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-222">The application also has a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] that allows the user to change various [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties, such as the background color or default font size.</span></span>

 <span data-ttu-id="5b4cf-223">如上所述，當使用者按一下任一按鈕時，[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容就會引發 `OnButtonClicked` 事件。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-223">As mentioned above, when the user clicks either button the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content raises an `OnButtonClicked` event.</span></span> <span data-ttu-id="5b4cf-224">應用程式會將處理常式附加至這個事件，以接收這些通知。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-224">The application attaches a handler to this event to receive these notifications.</span></span> <span data-ttu-id="5b4cf-225">如果 **[確定]** 所按的按鈕，處理常式會取得使用者資訊從[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容，並在一組靜態控制項中顯示。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-225">If the **OK** button was clicked, the handler gets the user information from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content and displays it in a set of static controls.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFButtonClicked](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#wpfbuttonclicked)]

 <span data-ttu-id="5b4cf-226">處理常式會從 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容 `MyPageEventArgs` 接收自訂事件引數物件。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-226">The handler receives a custom event argument object from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, `MyPageEventArgs`.</span></span> <span data-ttu-id="5b4cf-227">物件的`IsOK`屬性設定為`true`如果 **[確定]** 已按下按鈕，並`false`如果**取消**所按的按鈕。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-227">The object's `IsOK` property is set to `true` if the **OK** button was clicked, and `false` if the **Cancel** button was clicked.</span></span>

 <span data-ttu-id="5b4cf-228">如果 **[確定]** 所按的按鈕，處理常式會取得參考[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容從容器類別。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-228">If the **OK** button was clicked, the handler gets a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content from the container class.</span></span> <span data-ttu-id="5b4cf-229">然後它會收集由相關聯的 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容屬性所保存的使用者資訊，並使用靜態控制項，將資訊顯示在父視窗上。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-229">It then collects the user information that is held by the associated [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties and uses the static controls to display the information on the parent window.</span></span> <span data-ttu-id="5b4cf-230">因為 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容資料是使用 Managed 字串的形式，它必須經過封送處理，以供 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 控制項使用。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-230">Because the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content data is in the form of a managed string, it has to be marshaled for use by a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] control.</span></span> <span data-ttu-id="5b4cf-231">如果**取消**所按的按鈕，處理常式會清除靜態控制項中的資料。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-231">If the **Cancel** button was clicked, the handler clears the data from the static controls.</span></span>

 <span data-ttu-id="5b4cf-232">應用程式 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 提供一組選項按鈕，可讓使用者修改 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容的背景色彩，以及數個與字型相關的屬性。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-232">The application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] provides a set of radio buttons that allow the user to modify the background color of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and several font-related properties.</span></span> <span data-ttu-id="5b4cf-233">下列範例摘錄自應用程式的視窗程序 (WndProc) 及其訊息處理作業，該作業在不同的訊息上設定各種屬性，包括背景色彩。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-233">The following example is an excerpt from the application's window procedure (WndProc) and its message handling that sets various properties on different messages, including the background color.</span></span> <span data-ttu-id="5b4cf-234">其他皆相似，所以不顯示。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-234">The others are similar, and are not shown.</span></span> <span data-ttu-id="5b4cf-235">請參閱完整範例，以了解詳細資料和內容。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-235">See the complete sample for details and context.</span></span>

 [!code-cpp[Win32HostingWPFPage#WMCommandToBG](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#wmcommandtobg)]

 <span data-ttu-id="5b4cf-236">若要設定背景色彩，請從 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 取得 `hostedPage` 內容 (`WPFPageHost`) 的參考，並將背景色彩屬性設為適當的色彩。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-236">To set the background color, get a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content (`hostedPage`) from `WPFPageHost` and set the background color property to the appropriate color.</span></span> <span data-ttu-id="5b4cf-237">此範例使用三種色彩選項：原始色彩、淺綠色或淺橙紅。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-237">The sample uses three color options: the original color, light green, or light salmon.</span></span> <span data-ttu-id="5b4cf-238">原始背景色彩會在 `WPFPageHost` 類別中儲存為靜態欄位。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-238">The original background color is stored as a static field in the `WPFPageHost` class.</span></span> <span data-ttu-id="5b4cf-239">若要設定其他兩個色彩，您要建立新的 <xref:System.Windows.Media.SolidColorBrush> 物件，並從 <xref:System.Windows.Media.Colors> 物件傳遞靜態色彩值給建構函式。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-239">To set the other two, you create a new <xref:System.Windows.Media.SolidColorBrush> object and pass the constructor a static colors value from the <xref:System.Windows.Media.Colors> object.</span></span>

<a name="implementing_the_wpf_page"></a>
## <a name="implementing-the-wpf-page"></a><span data-ttu-id="5b4cf-240">實作 WPF 頁面</span><span class="sxs-lookup"><span data-stu-id="5b4cf-240">Implementing the WPF Page</span></span>
 <span data-ttu-id="5b4cf-241">您即可裝載及使用[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容的實際實作的任何知識。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-241">You can host and use the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content without any knowledge of the actual implementation.</span></span> <span data-ttu-id="5b4cf-242">如果[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容是封裝在個別[!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)]，它可能已建置任何[!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)]語言。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-242">If the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content had been packaged in a separate [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)], it could have been built in any [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] language.</span></span> <span data-ttu-id="5b4cf-243">以下是範例中所使用之 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] 實作的簡短逐步解說。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-243">Following is a brief walkthrough of the [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] implementation that is used in the sample.</span></span> <span data-ttu-id="5b4cf-244">本節包含下列小節。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-244">This section contains the following subsections.</span></span>

<a name="autoNestedSectionsOUTLINE2"></a>
-   [<span data-ttu-id="5b4cf-245">版面配置</span><span class="sxs-lookup"><span data-stu-id="5b4cf-245">Layout</span></span>](#page_layout)

-   [<span data-ttu-id="5b4cf-246">將資料傳回主視窗</span><span class="sxs-lookup"><span data-stu-id="5b4cf-246">Returning the Data to the Host Window</span></span>](#returning_data_to_window)

-   [<span data-ttu-id="5b4cf-247">設定 WPF 屬性</span><span class="sxs-lookup"><span data-stu-id="5b4cf-247">Setting the WPF Properties</span></span>](#set_page_properties)

<a name="page_layout"></a>
### <a name="layout"></a><span data-ttu-id="5b4cf-248">配置</span><span class="sxs-lookup"><span data-stu-id="5b4cf-248">Layout</span></span>
 <span data-ttu-id="5b4cf-249">[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]中的項目[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容包含五個<xref:System.Windows.Controls.TextBox>控制項，與相關聯<xref:System.Windows.Controls.Label>控制項：名稱、 地址、 縣 （市）、 State 和 Zip。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-249">The [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elements in the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content consist of five <xref:System.Windows.Controls.TextBox> controls, with associated <xref:System.Windows.Controls.Label> controls: Name, Address, City, State, and Zip.</span></span> <span data-ttu-id="5b4cf-250">另外還有兩個<xref:System.Windows.Controls.Button>控制項 **[確定]** 和**取消**</span><span class="sxs-lookup"><span data-stu-id="5b4cf-250">There are also two <xref:System.Windows.Controls.Button> controls, **OK** and **Cancel**</span></span>

 <span data-ttu-id="5b4cf-251">
  [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容會在 `WPFPage\` 類別中實作。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-251">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is implemented in the `WPFPage` class.</span></span> <span data-ttu-id="5b4cf-252">配置是以 <xref:System.Windows.Controls.Grid> 配置項目來處理。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-252">Layout is handled with a <xref:System.Windows.Controls.Grid> layout element.</span></span> <span data-ttu-id="5b4cf-253">類別繼承自 <xref:System.Windows.Controls.Grid>，如此能有效使其成為 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容根項目。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-253">The class inherits from <xref:System.Windows.Controls.Grid>, which effectively makes it the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content root element.</span></span>

 <span data-ttu-id="5b4cf-254">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容的建構函式會採用所需的寬度和高度和大小<xref:System.Windows.Controls.Grid>據此。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-254">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content constructor takes the required width and height, and sizes the <xref:System.Windows.Controls.Grid> accordingly.</span></span> <span data-ttu-id="5b4cf-255">然後它會定義基本版面配置建立一份<xref:System.Windows.Controls.ColumnDefinition>並<xref:System.Windows.Controls.RowDefinition>物件，並將它們加入至<xref:System.Windows.Controls.Grid>基底物件<xref:System.Windows.Controls.Grid.ColumnDefinitions%2A>和<xref:System.Windows.Controls.Grid.RowDefinitions%2A>集合，分別。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-255">It then defines the basic layout by creating a set of <xref:System.Windows.Controls.ColumnDefinition> and <xref:System.Windows.Controls.RowDefinition> objects and adding them to the <xref:System.Windows.Controls.Grid> object base <xref:System.Windows.Controls.Grid.ColumnDefinitions%2A> and <xref:System.Windows.Controls.Grid.RowDefinitions%2A> collections, respectively.</span></span> <span data-ttu-id="5b4cf-256">這會定義一個包含五個資料列和七個資料行的格線，維度則取決於儲存格的內容。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-256">This defines a grid of five rows and seven columns, with the dimensions determined by the contents of the cells.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageCtorToGridDef](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectortogriddef)]

 <span data-ttu-id="5b4cf-257">接著，建構函式會將 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 項目加入 <xref:System.Windows.Controls.Grid> 中。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-257">Next, the constructor adds the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elements to the <xref:System.Windows.Controls.Grid>.</span></span> <span data-ttu-id="5b4cf-258">第一個項目是標題文字，它是位於格線第一個資料列中間的 <xref:System.Windows.Controls.Label> 控制項。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-258">The first element is the title text, which is a <xref:System.Windows.Controls.Label> control that is centered in the first row of the grid.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageCtorTitle](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectortitle)]

 <span data-ttu-id="5b4cf-259">下一個資料列包含名稱 <xref:System.Windows.Controls.Label> 控制項及其相關聯的 <xref:System.Windows.Controls.TextBox> 控制項。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-259">The next row contains the Name <xref:System.Windows.Controls.Label> control and its associated <xref:System.Windows.Controls.TextBox> control.</span></span> <span data-ttu-id="5b4cf-260">由於每一個標籤/文字方塊組都是使用相同的程式碼，所以程式碼會放在一個私用方法組中，然後用於所有五個標籤/文字方塊組。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-260">Because the same code is used for each label/textbox pair, it is placed in a pair of private methods and used for all five label/textbox pairs.</span></span> <span data-ttu-id="5b4cf-261">這些方法會建立適當的控制項，並呼叫 <xref:System.Windows.Controls.Grid> 類別靜態 <xref:System.Windows.Controls.Grid.SetColumn%2A> 和 <xref:System.Windows.Controls.Grid.SetRow%2A> 方法，以將控制項放在適當的儲存格中。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-261">The methods create the appropriate control, and call the <xref:System.Windows.Controls.Grid> class static <xref:System.Windows.Controls.Grid.SetColumn%2A> and <xref:System.Windows.Controls.Grid.SetRow%2A> methods to place the controls in the appropriate cell.</span></span> <span data-ttu-id="5b4cf-262">建立控制項之後，此範例會在 <xref:System.Windows.Controls.Grid> 的 <xref:System.Windows.Controls.Panel.Children%2A> 屬性上呼叫 <xref:System.Windows.Controls.UIElementCollection.Add%2A> 方法，以將控制項加入格線中。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-262">After the control is created, the sample calls the <xref:System.Windows.Controls.UIElementCollection.Add%2A> method on the <xref:System.Windows.Controls.Panel.Children%2A> property of the <xref:System.Windows.Controls.Grid> to add the control to the grid.</span></span> <span data-ttu-id="5b4cf-263">用來加入其餘標籤/文字方塊組的程式碼很類似。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-263">The code to add the remaining label/textbox pairs is similar.</span></span> <span data-ttu-id="5b4cf-264">如需詳細資訊，請參閱範例程式碼。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-264">See the sample code for details.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageCtorName](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectorname)]

 <span data-ttu-id="5b4cf-265">這兩個方法的實作如下所示：</span><span class="sxs-lookup"><span data-stu-id="5b4cf-265">The implementation of the two methods is as follows:</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageCreateHelpers](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagecreatehelpers)]

 <span data-ttu-id="5b4cf-266">最後，此範例會將 **[確定]** 並**取消**按鈕，並將附加事件處理常式以其<xref:System.Windows.Controls.Primitives.ButtonBase.Click>事件。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-266">Finally, the sample adds the **OK** and **Cancel** buttons and attaches an event handler to their <xref:System.Windows.Controls.Primitives.ButtonBase.Click> events.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageCtorButtonsEvents](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectorbuttonsevents)]

<a name="returning_data_to_window"></a>
### <a name="returning-the-data-to-the-host-window"></a><span data-ttu-id="5b4cf-267">將資料傳回主視窗</span><span class="sxs-lookup"><span data-stu-id="5b4cf-267">Returning the Data to the Host Window</span></span>
 <span data-ttu-id="5b4cf-268">按一下任一按鈕，就會引發其 <xref:System.Windows.Controls.Primitives.ButtonBase.Click> 事件。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-268">When either button is clicked, its <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event is raised.</span></span> <span data-ttu-id="5b4cf-269">主視窗只要將處理常式附加至這些事件，就可以直接從 <xref:System.Windows.Controls.TextBox> 控制項取得資料。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-269">The host window could simply attach handlers to these events and get the data directly from the <xref:System.Windows.Controls.TextBox> controls.</span></span> <span data-ttu-id="5b4cf-270">此範例使用較不直接的方法。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-270">The sample uses a somewhat less direct approach.</span></span> <span data-ttu-id="5b4cf-271">它會處理<xref:System.Windows.Controls.Primitives.ButtonBase.Click>內[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容，然後引發自訂事件`OnButtonClicked`，以通知[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-271">It handles the <xref:System.Windows.Controls.Primitives.ButtonBase.Click> within the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and then raises a custom event `OnButtonClicked`, to notify the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="5b4cf-272">這可讓[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容先執行一些參數驗證，再通知主機。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-272">This allows the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to do some parameter validation before notifying the host.</span></span> <span data-ttu-id="5b4cf-273">處理常式會從 <xref:System.Windows.Controls.TextBox> 控制項取得文字，再將其指派給公用屬性，然後主機再從中擷取資訊。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-273">The handler gets the text from the <xref:System.Windows.Controls.TextBox> controls and assigns it to public properties, from which the host can retrieve the information.</span></span>

 <span data-ttu-id="5b4cf-274">WPFPage.h 中的事件宣告：</span><span class="sxs-lookup"><span data-stu-id="5b4cf-274">The event declaration, in WPFPage.h:</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageEventDecl](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.h#wpfpageeventdecl)]

 <span data-ttu-id="5b4cf-275">WPFPage.cpp 中的 <xref:System.Windows.Controls.Primitives.ButtonBase.Click> 事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="5b4cf-275">The <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event handler, in WPFPage.cpp:</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageButtonClicked](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagebuttonclicked)]

<a name="set_page_properties"></a>
### <a name="setting-the-wpf-properties"></a><span data-ttu-id="5b4cf-276">設定 WPF 屬性</span><span class="sxs-lookup"><span data-stu-id="5b4cf-276">Setting the WPF Properties</span></span>
 <span data-ttu-id="5b4cf-277">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]主應用程式可讓使用者變更數個[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]內容屬性。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-277">The [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] host allows the user to change several [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties.</span></span> <span data-ttu-id="5b4cf-278">從 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 端來看，這只是變更內容的問題。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-278">From the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] side, it is simply a matter of changing the properties.</span></span> <span data-ttu-id="5b4cf-279">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 內容類別中的實作較為複雜一些，因為沒有單一全域屬性來控制所有控制項的字型。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-279">The implementation in the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class is somewhat more complicated, because there is no single global property that controls the fonts for all controls.</span></span> <span data-ttu-id="5b4cf-280">相反地，每個控制項的適當屬性會在屬性的 set 存取子中變更。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-280">Instead, the appropriate property for each control is changed in the properties' set accessors.</span></span> <span data-ttu-id="5b4cf-281">下列範例顯示的程式碼`DefaultFontFamily`屬性。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-281">The following example shows the code for the `DefaultFontFamily` property.</span></span> <span data-ttu-id="5b4cf-282">設定屬性時會呼叫一個私用方法，它接著會設定各種控制項的 <xref:System.Windows.Controls.Control.FontFamily%2A> 屬性。</span><span class="sxs-lookup"><span data-stu-id="5b4cf-282">Setting the property calls a private method that in turn sets the <xref:System.Windows.Controls.Control.FontFamily%2A> properties for the various controls.</span></span>

 <span data-ttu-id="5b4cf-283">從 WPFPage.h：</span><span class="sxs-lookup"><span data-stu-id="5b4cf-283">From WPFPage.h:</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageFontFamilyProperty](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.h#wpfpagefontfamilyproperty)]

 <span data-ttu-id="5b4cf-284">從 WPFPage.cpp：</span><span class="sxs-lookup"><span data-stu-id="5b4cf-284">From WPFPage.cpp:</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageSetFontFamily](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagesetfontfamily)]

## <a name="see-also"></a><span data-ttu-id="5b4cf-285">另請參閱</span><span class="sxs-lookup"><span data-stu-id="5b4cf-285">See also</span></span>

- <xref:System.Windows.Interop.HwndSource>
- [<span data-ttu-id="5b4cf-286">WPF 和 Win32 交互操作</span><span class="sxs-lookup"><span data-stu-id="5b4cf-286">WPF and Win32 Interoperation</span></span>](wpf-and-win32-interoperation.md)