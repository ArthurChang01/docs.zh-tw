---
title: 代碼背後和XAML
ms.date: 03/30/2017
helpviewer_keywords:
- XAML [WPF], code-behind
- code-behind files [WPF], XAML
ms.assetid: 9df6d3c9-aed3-471c-af36-6859b19d999f
ms.openlocfilehash: 32283d5b81bf92999a97711ded13a8b533ae3028
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/12/2020
ms.locfileid: "79145341"
---
# <a name="code-behind-and-xaml-in-wpf"></a><span data-ttu-id="a3193-102">WPF 中的程式碼後置和 XAML</span><span class="sxs-lookup"><span data-stu-id="a3193-102">Code-Behind and XAML in WPF</span></span>
<a name="introduction"></a><span data-ttu-id="a3193-103">代碼後面是一個術語，用於描述在標記編譯時[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]與標記定義物件聯接的代碼。</span><span class="sxs-lookup"><span data-stu-id="a3193-103">Code-behind is a term used to describe the code that is joined with markup-defined objects, when a [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] page is markup-compiled.</span></span> <span data-ttu-id="a3193-104">本主題介紹代碼後面的要求，以及 中[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]代碼的替代內聯代碼機制。</span><span class="sxs-lookup"><span data-stu-id="a3193-104">This topic describes requirements for code-behind as well as an alternative inline code mechanism for code in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span></span>  
  
 <span data-ttu-id="a3193-105">本主題包含下列幾節：</span><span class="sxs-lookup"><span data-stu-id="a3193-105">This topic contains the following sections:</span></span>  
  
- [<span data-ttu-id="a3193-106">必要條件</span><span class="sxs-lookup"><span data-stu-id="a3193-106">Prerequisites</span></span>](#Prerequisites)  
  
- [<span data-ttu-id="a3193-107">代碼背後和XAML語言</span><span class="sxs-lookup"><span data-stu-id="a3193-107">Code-Behind and the XAML Language</span></span>](#codebehind_and_the_xaml_language)  
  
- [<span data-ttu-id="a3193-108">WPF 中的代碼落後、事件處理常式和部分類要求</span><span class="sxs-lookup"><span data-stu-id="a3193-108">Code-behind, Event Handler, and Partial Class Requirements in WPF</span></span>](#Code_behind__Event_Handler__and_Partial_Class)  
  
- [<span data-ttu-id="a3193-109">x：代碼</span><span class="sxs-lookup"><span data-stu-id="a3193-109">x:Code</span></span>](#x_Code)  
  
- [<span data-ttu-id="a3193-110">內聯代碼限制</span><span class="sxs-lookup"><span data-stu-id="a3193-110">Inline Code Limitations</span></span>](#Inline_Code_Limitations)  
  
<a name="Prerequisites"></a>
## <a name="prerequisites"></a><span data-ttu-id="a3193-111">必要條件</span><span class="sxs-lookup"><span data-stu-id="a3193-111">Prerequisites</span></span>  
 <span data-ttu-id="a3193-112">本主題假定您已閱讀[XAML 概述 （WPF），](../../../desktop-wpf/fundamentals/xaml.md)並且對 CLR 和麵向物件程式設計有一些基本知識。</span><span class="sxs-lookup"><span data-stu-id="a3193-112">This topic assumes that you have read the [XAML Overview (WPF)](../../../desktop-wpf/fundamentals/xaml.md) and have some basic knowledge of the CLR and object-oriented programming.</span></span>  
  
<a name="codebehind_and_the_xaml_language"></a>
## <a name="code-behind-and-the-xaml-language"></a><span data-ttu-id="a3193-113">代碼背後和XAML語言</span><span class="sxs-lookup"><span data-stu-id="a3193-113">Code-Behind and the XAML Language</span></span>  
 <span data-ttu-id="a3193-114">XAML 語言包括語言級功能，這些功能使得可以從標記檔端將代碼檔與標記檔相關聯。</span><span class="sxs-lookup"><span data-stu-id="a3193-114">The XAML language includes language-level features that make it possible to associate code files with markup files, from the markup file side.</span></span> <span data-ttu-id="a3193-115">具體來說，XAML 語言定義了語言功能[x：類指令](../../../desktop-wpf/xaml-services/xclass-directive.md) [、x：子類指令](../../../desktop-wpf/xaml-services/xsubclass-directive.md)和[x：類修改器指令](../../../desktop-wpf/xaml-services/xclassmodifier-directive.md)。</span><span class="sxs-lookup"><span data-stu-id="a3193-115">Specifically, the XAML language defines the language features [x:Class Directive](../../../desktop-wpf/xaml-services/xclass-directive.md), [x:Subclass Directive](../../../desktop-wpf/xaml-services/xsubclass-directive.md), and [x:ClassModifier Directive](../../../desktop-wpf/xaml-services/xclassmodifier-directive.md).</span></span> <span data-ttu-id="a3193-116">代碼的生成方式以及如何集成標記和代碼並不是 XAML 語言指定的部分。</span><span class="sxs-lookup"><span data-stu-id="a3193-116">Exactly how the code should be produced, and how to integrate markup and code, is not part of what the XAML language specifies.</span></span> <span data-ttu-id="a3193-117">由 WPF 等框架來確定如何集成代碼、如何在應用程式和程式設計模型中使用 XAML 以及構建操作或所有所需的其他支援。</span><span class="sxs-lookup"><span data-stu-id="a3193-117">It is left up to frameworks such as WPF to determine how to integrate the code, how to use XAML in the application and programming models, and the build actions or other support that all this requires.</span></span>  
  
<a name="Code_behind__Event_Handler__and_Partial_Class"></a>
## <a name="code-behind-event-handler-and-partial-class-requirements-in-wpf"></a><span data-ttu-id="a3193-118">WPF 中的代碼落後、事件處理常式和部分類要求</span><span class="sxs-lookup"><span data-stu-id="a3193-118">Code-behind, Event Handler, and Partial Class Requirements in WPF</span></span>  
  
- <span data-ttu-id="a3193-119">部分類必須派生自支援根項目的類型。</span><span class="sxs-lookup"><span data-stu-id="a3193-119">The partial class must derive from the type that backs the root element.</span></span>  
  
- <span data-ttu-id="a3193-120">請注意，在標記編譯生成操作的預設行為下，可以將派生留空于代碼後面的部分類定義中。</span><span class="sxs-lookup"><span data-stu-id="a3193-120">Note that under the default behavior of the markup compile build actions, you can leave the derivation blank in the partial class definition on the code-behind side.</span></span> <span data-ttu-id="a3193-121">編譯的結果將假定頁面根的背襯類型是部分類的基礎，即使未指定。</span><span class="sxs-lookup"><span data-stu-id="a3193-121">The compiled result will assume the page root's backing type to be the basis for the partial class, even if it not specified.</span></span> <span data-ttu-id="a3193-122">但是，依賴此行為不是最佳做法。</span><span class="sxs-lookup"><span data-stu-id="a3193-122">However, relying on this behavior is not a best practice.</span></span>  
  
- <span data-ttu-id="a3193-123">在代碼後面編寫的事件處理常式必須是實例方法，不能是靜態方法。</span><span class="sxs-lookup"><span data-stu-id="a3193-123">The event handlers you write in the code-behind must be instance methods and cannot be static methods.</span></span> <span data-ttu-id="a3193-124">這些方法必須由 標識`x:Class`的 CLR 命名空間中的部分類定義。</span><span class="sxs-lookup"><span data-stu-id="a3193-124">These methods must be defined by the partial class within the CLR namespace identified by `x:Class`.</span></span> <span data-ttu-id="a3193-125">不能限定事件處理常式的名稱來指示[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]處理器查找事件處理常式以查找其他類作用域中的事件佈線。</span><span class="sxs-lookup"><span data-stu-id="a3193-125">You cannot qualify the name of an event handler to instruct a [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] processor to look for an event handler for event wiring in a different class scope.</span></span>  
  
- <span data-ttu-id="a3193-126">處理常式必須匹配支援類型系統中相應事件的委託。</span><span class="sxs-lookup"><span data-stu-id="a3193-126">The handler must match the delegate for the appropriate event in the backing type system.</span></span>  
  
- <span data-ttu-id="a3193-127">具體對於 Microsoft Visual Basic 語言，可以使用特定于`Handles`語言的關鍵字將處理常式與處理常式聲明中的實例和事件相關聯，而不是將處理常式附加到 中[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]的屬性。</span><span class="sxs-lookup"><span data-stu-id="a3193-127">For the Microsoft Visual Basic language specifically, you can use the language-specific `Handles` keyword to associate handlers with instances and events in the handler declaration, instead of attaching handlers with attributes in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span></span> <span data-ttu-id="a3193-128">但是，此技術確實有一些限制，`Handles`因為關鍵字不支援[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]事件系統的所有特定功能，例如某些路由事件方案或附加事件。</span><span class="sxs-lookup"><span data-stu-id="a3193-128">However, this technique does have some limitations because the `Handles` keyword cannot support all of the specific features of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] event system, such as certain routed event scenarios or attached events.</span></span> <span data-ttu-id="a3193-129">有關詳細資訊，請參閱[視覺化基本和 WPF 事件處理](visual-basic-and-wpf-event-handling.md)。</span><span class="sxs-lookup"><span data-stu-id="a3193-129">For details, see [Visual Basic and WPF Event Handling](visual-basic-and-wpf-event-handling.md).</span></span>  
  
<a name="x_Code"></a>
## <a name="xcode"></a><span data-ttu-id="a3193-130">x：代碼</span><span class="sxs-lookup"><span data-stu-id="a3193-130">x:Code</span></span>  
 <span data-ttu-id="a3193-131">[x：代碼](../../../desktop-wpf/xaml-services/xcode-intrinsic-xaml-type.md)是在 中[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]定義的指令元素。</span><span class="sxs-lookup"><span data-stu-id="a3193-131">[x:Code](../../../desktop-wpf/xaml-services/xcode-intrinsic-xaml-type.md) is a directive element defined in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span></span> <span data-ttu-id="a3193-132">`x:Code`指令元素可以包含內聯程式設計代碼。</span><span class="sxs-lookup"><span data-stu-id="a3193-132">An `x:Code` directive element can contain inline programming code.</span></span> <span data-ttu-id="a3193-133">內聯定義的代碼可以在同一頁上與 的代碼[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]進行交互。</span><span class="sxs-lookup"><span data-stu-id="a3193-133">The code that is defined inline can interact with the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] on the same page.</span></span> <span data-ttu-id="a3193-134">下面的示例說明了內聯 C# 代碼。</span><span class="sxs-lookup"><span data-stu-id="a3193-134">The following example illustrates inline C# code.</span></span> <span data-ttu-id="a3193-135">請注意，代碼位於元素內`x:Code`，並且代碼必須由 ... `<CDATA[``]]>`以逃避 XML 的內容，以便[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]處理器（解釋[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]架構或[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]架構）不會嘗試將內容從字面上解釋為 XML。</span><span class="sxs-lookup"><span data-stu-id="a3193-135">Notice that the code is inside the `x:Code` element and that the code must be surrounded by `<CDATA[`...`]]>` to escape the contents for XML, so that a [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] processor (interpreting either the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] schema or the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] schema) will not try to interpret the contents literally as XML.</span></span>  
  
 [!code-xaml[XAMLOvwSupport#ButtonWithInlineCode](~/samples/snippets/csharp/VS_Snippets_Wpf/XAMLOvwSupport/CSharp/page4.xaml#buttonwithinlinecode)]  
  
<a name="Inline_Code_Limitations"></a>
## <a name="inline-code-limitations"></a><span data-ttu-id="a3193-136">內聯代碼限制</span><span class="sxs-lookup"><span data-stu-id="a3193-136">Inline Code Limitations</span></span>  
 <span data-ttu-id="a3193-137">應考慮避免或限制內聯代碼的使用。</span><span class="sxs-lookup"><span data-stu-id="a3193-137">You should consider avoiding or limiting the use of inline code.</span></span> <span data-ttu-id="a3193-138">在體系結構和編碼理念方面，保持標記和代碼後面的分離使設計人員和開發人員的角色更加明顯。</span><span class="sxs-lookup"><span data-stu-id="a3193-138">In terms of architecture and coding philosophy, maintaining a separation between markup and code-behind keeps the designer and developer roles much more distinct.</span></span> <span data-ttu-id="a3193-139">在更技術化的層面上，為內聯代碼編寫的代碼可能難以編寫，因為您始終寫入[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]生成的部分類，並且只能使用預設的 XML 命名空間映射。</span><span class="sxs-lookup"><span data-stu-id="a3193-139">On a more technical level, the code that you write for inline code can be awkward to write, because you are always writing into the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] generated partial class, and can only use the default XML namespace mappings.</span></span> <span data-ttu-id="a3193-140">由於無法添加`using`語句，因此必須完全限定您進行的許多 API 呼叫。</span><span class="sxs-lookup"><span data-stu-id="a3193-140">Because you cannot add `using` statements, you must fully qualify many of the API calls that you make.</span></span> <span data-ttu-id="a3193-141">預設[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]映射包括[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]程式集中存在的大多數（但不是所有 CLR 命名空間）;您必須完全限定對其他 CLR 命名空間中包含的類型和成員的調用。</span><span class="sxs-lookup"><span data-stu-id="a3193-141">The default [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] mappings include most but not all CLR namespaces that are present in the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] assemblies; you will have to fully qualify calls to types and members contained within the other CLR namespaces.</span></span> <span data-ttu-id="a3193-142">您也不能在內聯代碼中定義除部分類之外的任何內容，並且引用的所有使用者代碼實體都必須作為成員或變數存在於生成的部分類中。</span><span class="sxs-lookup"><span data-stu-id="a3193-142">You also cannot define anything beyond the partial class in the inline code, and all user code entities you reference must exist as a member or variable within the generated partial class.</span></span> <span data-ttu-id="a3193-143">其他特定于語言的程式設計功能（如宏或`#ifdef`針對全域變數或生成變數）也不可用。</span><span class="sxs-lookup"><span data-stu-id="a3193-143">Other language specific programming features, such as macros or `#ifdef` against global variables or build variables, are also not available.</span></span> <span data-ttu-id="a3193-144">有關詳細資訊，請參閱[x：代碼內部 XAML 類型](../../../desktop-wpf/xaml-services/xcode-intrinsic-xaml-type.md)。</span><span class="sxs-lookup"><span data-stu-id="a3193-144">For more information, see [x:Code Intrinsic XAML Type](../../../desktop-wpf/xaml-services/xcode-intrinsic-xaml-type.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a3193-145">另請參閱</span><span class="sxs-lookup"><span data-stu-id="a3193-145">See also</span></span>

- [<span data-ttu-id="a3193-146">XAML 概觀 (WPF)</span><span class="sxs-lookup"><span data-stu-id="a3193-146">XAML Overview (WPF)</span></span>](../../../desktop-wpf/fundamentals/xaml.md)
- [<span data-ttu-id="a3193-147">x:Code 內建 XAML 類型</span><span class="sxs-lookup"><span data-stu-id="a3193-147">x:Code Intrinsic XAML Type</span></span>](../../../desktop-wpf/xaml-services/xcode-intrinsic-xaml-type.md)
- [<span data-ttu-id="a3193-148">建置 WPF 應用程式</span><span class="sxs-lookup"><span data-stu-id="a3193-148">Building a WPF Application</span></span>](../app-development/building-a-wpf-application-wpf.md)
- [<span data-ttu-id="a3193-149">XAML 語法詳細資料</span><span class="sxs-lookup"><span data-stu-id="a3193-149">XAML Syntax In Detail</span></span>](xaml-syntax-in-detail.md)
