---
title: 資源和程式碼
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- keys [WPF], using objects as
- resources [WPF], accessing from procedural code
- procedural code [WPF], creating resources with
- procedural code [WPF], accessing resources from
- resources [WPF], creating with procedural code
ms.assetid: c1cfcddb-e39c-41c8-a7f3-60984914dfae
ms.openlocfilehash: 8074562ddb865b482cf123743796ac68bb529f85
ms.sourcegitcommit: 62285ec11fa8e8424bab00511a90760c60e63c95
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/20/2020
ms.locfileid: "81646235"
---
# <a name="resources-and-code"></a><span data-ttu-id="cdcb1-102">資源和程式碼</span><span class="sxs-lookup"><span data-stu-id="cdcb1-102">Resources and Code</span></span>
<span data-ttu-id="cdcb1-103">本概觀將著重於如何使用程式碼 (而非 [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] 語法) 來存取 [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] 資源。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-103">This overview concentrates on how [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] resources can be accessed or created using  code rather than [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] syntax.</span></span> <span data-ttu-id="cdcb1-104">如需從 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 語法觀點來了解一般資源使用方式和資源的詳細資訊，請參閱 [XAML 資源](../../../desktop-wpf/fundamentals/xaml-resources-define.md)。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-104">For more information on general resource usage and resources from a [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] syntax perspective, see [XAML Resources](../../../desktop-wpf/fundamentals/xaml-resources-define.md).</span></span>  

<a name="accessing"></a>
## <a name="accessing-resources-from-code"></a><span data-ttu-id="cdcb1-105">從程式碼存取資源</span><span class="sxs-lookup"><span data-stu-id="cdcb1-105">Accessing Resources from Code</span></span>  
 <span data-ttu-id="cdcb1-106">如果您利用程式碼要求資源，則用來識別資源是否要透過 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 所定義之資源的索引鍵，也可用來擷取特定的資源。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-106">The keys that identify resources if they are defined through [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] are also used to retrieve specific resources if you request the resource in code.</span></span> <span data-ttu-id="cdcb1-107">從代碼中檢索資源的最簡單方法是從應用程式中的框架級物件調用<xref:System.Windows.FrameworkElement.FindResource%2A><xref:System.Windows.FrameworkElement.TryFindResource%2A>或 方法。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-107">The simplest way to retrieve a resource from code is to call either the <xref:System.Windows.FrameworkElement.FindResource%2A> or the <xref:System.Windows.FrameworkElement.TryFindResource%2A> method from framework-level objects in your application.</span></span> <span data-ttu-id="cdcb1-108">這些方法之間的行為差異在於，找不到要求的索引鍵時會發生什麼情況。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-108">The behavioral difference between these methods is what happens if the requested key is not found.</span></span> <span data-ttu-id="cdcb1-109"><xref:System.Windows.FrameworkElement.FindResource%2A>提出例外;<xref:System.Windows.FrameworkElement.TryFindResource%2A>不會引發異常,但返回`null`。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-109"><xref:System.Windows.FrameworkElement.FindResource%2A> raises an exception; <xref:System.Windows.FrameworkElement.TryFindResource%2A> will not raise an exception but returns `null`.</span></span> <span data-ttu-id="cdcb1-110">每個方法都會取得資源索引鍵做為輸入參數，並傳回弱類型的物件。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-110">Each method takes the resource key as an input parameter, and returns a loosely typed object.</span></span> <span data-ttu-id="cdcb1-111">一般而言，資源索引鍵是一個字串，但偶而會有非字串的使用方式；如需詳細資訊，請參閱[使用物件做為索引鍵](#objectaskey)一節。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-111">Typically, a resource key is a string, but there are occasional nonstring usages; see the [Using Objects as Keys](#objectaskey) section for details.</span></span> <span data-ttu-id="cdcb1-112">通常您會將傳回的物件轉型為您在要求資源時設定之屬性所需的類型。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-112">Typically you would cast the returned object to the type required by the property that you are setting when requesting the resource.</span></span> <span data-ttu-id="cdcb1-113">程式碼資源解析的查閱邏輯會與動態資源參考 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 案例相同。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-113">The lookup logic for code resource resolution is the same as the dynamic resource reference [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] case.</span></span> <span data-ttu-id="cdcb1-114">資源的搜尋會從呼叫元素開始，然後繼續進行邏輯樹狀結構中後續的父元素。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-114">The search for resources starts from the calling element, then continues to successive parent elements in the logical tree.</span></span> <span data-ttu-id="cdcb1-115">查閱會視需要繼續尋找應用程式資源、主題和系統資源。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-115">The lookup continues onwards into application resources, themes, and system resources if necessary.</span></span> <span data-ttu-id="cdcb1-116">資源的程式碼要求將實際負責處理資源字典中的執行階段變更，這些可能是在從 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 載入該資源字典之後所進行的變更，同時也會負責處理即時系統資源變更。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-116">A code request for a resource will properly account for runtime changes in resource dictionaries that might have been made subsequent to that resource dictionary being loaded from [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)], and also for realtime system resource changes.</span></span>  
  
 <span data-ttu-id="cdcb1-117">下面是一個簡短的代碼示例,該示例通過鍵查找資源並使用返回的值設置屬性,該屬性作為<xref:System.Windows.Controls.Primitives.ButtonBase.Click>事件處理程序實現。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-117">The following is a brief code example that finds a resource by key and uses the returned value to set a property, implemented as a <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event handler.</span></span>  
  
 [!code-csharp[PropertiesOvwSupport#ResourceProceduralGet](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page3.xaml.cs#resourceproceduralget)]
 [!code-vb[PropertiesOvwSupport#ResourceProceduralGet](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page3.xaml.vb#resourceproceduralget)]  
  
 <span data-ttu-id="cdcb1-118">配置資源參考的替代方法是<xref:System.Windows.FrameworkElement.SetResourceReference%2A>。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-118">An alternative method for assigning a resource reference is <xref:System.Windows.FrameworkElement.SetResourceReference%2A>.</span></span> <span data-ttu-id="cdcb1-119">這個方法會採用兩個參數︰資源的索引鍵，以及特殊相依性屬性的識別碼，該屬性會出現在應指派資源值的元素執行個體上。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-119">This method takes two parameters: the key of the resource, and the identifier for a particular dependency property that is present on the element instance to which the resource value should be assigned.</span></span> <span data-ttu-id="cdcb1-120">在功能上，這個方法是一樣的，而且優點是不需要對傳回值進行任何轉型。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-120">Functionally, this method is the same and has the advantage of not requiring any casting of return values.</span></span>  
  
 <span data-ttu-id="cdcb1-121">另一種以程式設計方式訪問資源的方法是作為字典存<xref:System.Windows.FrameworkElement.Resources%2A>取 屬性的內容。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-121">Still another way to access resources programmatically is to access the contents of the <xref:System.Windows.FrameworkElement.Resources%2A> property as a dictionary.</span></span> <span data-ttu-id="cdcb1-122">同樣地，存取這個屬性所包含的字典包括，您如何將新資源新增至現有的集合、檢查以查看是否已經在集合中取得指定的索引鍵名稱，以及其他的字典/集合作業。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-122">Accessing the dictionary contained by this property is also how you can add new resources to existing collections, check to see if a given key name is already taken in the collection, and other dictionary/collection operations.</span></span> <span data-ttu-id="cdcb1-123">如果完全在代碼中[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]編寫應用程式,還可以在代碼中創建整個集合,為其分配鍵,然後將已完成的集合分配給已建立的<xref:System.Windows.FrameworkElement.Resources%2A>元素的屬性。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-123">If you are writing a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application entirely in code, you can also create the entire collection in code, assign keys to it, and then assign the finished collection to the <xref:System.Windows.FrameworkElement.Resources%2A> property of an established element.</span></span> <span data-ttu-id="cdcb1-124">下一節將說明此動作。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-124">This will be described in the next section.</span></span>  
  
 <span data-ttu-id="cdcb1-125">可以使用特定鍵作為索引在任何<xref:System.Windows.FrameworkElement.Resources%2A>給定集合中編製索引,但應注意以這種方式訪問資源並不遵循資源解析的正常運行時規則。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-125">You can index within any given <xref:System.Windows.FrameworkElement.Resources%2A> collection, using a specific key as the index, but you should be aware that accessing the resource in this way does not follow the normal runtime rules of resource resolution.</span></span> <span data-ttu-id="cdcb1-126">您只能存取該特定的集合。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-126">You are only accessing that particular collection.</span></span> <span data-ttu-id="cdcb1-127">如果在要求的索引鍵上在找不到任何有效的物件，資源查閱就不會將範圍周遊至根項目或應用程式。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-127">Resource lookup will not be traversing the scope to the root or the application if no valid object was found at the requested key.</span></span> <span data-ttu-id="cdcb1-128">不過，此方法在某些情況下恰巧具有效能優點，因為索引鍵的搜尋範圍更加限定。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-128">However, this approach may have performance advantages in some cases precisely because the scope of the search for the key is more constrained.</span></span> <span data-ttu-id="cdcb1-129">有關如何直接<xref:System.Windows.ResourceDictionary>使用資源字典的更多詳細資訊,請參閱 該類。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-129">See the <xref:System.Windows.ResourceDictionary> class for more details on how to work with the resource dictionary directly.</span></span>  
  
<a name="creating"></a>
## <a name="creating-resources-with-code"></a><span data-ttu-id="cdcb1-130">使用程式碼建立資源</span><span class="sxs-lookup"><span data-stu-id="cdcb1-130">Creating Resources with Code</span></span>  
 <span data-ttu-id="cdcb1-131">如果您想要使用程式碼來建立整個 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 應用程式，也可以使用程式碼，在該應用程式中建立任何資源。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-131">If you want to create an entire [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application in code, you might also want to create any resources in that application in code.</span></span> <span data-ttu-id="cdcb1-132">為此,請創建一個新<xref:System.Windows.ResourceDictionary>實例,然後使用對<xref:System.Windows.ResourceDictionary.Add%2A?displayProperty=nameWithType>的連續調用將所有資源添加到字典中。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-132">To achieve this, create a new <xref:System.Windows.ResourceDictionary> instance, and then add all the resources to the dictionary using successive calls to <xref:System.Windows.ResourceDictionary.Add%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="cdcb1-133">然後,使用<xref:System.Windows.ResourceDictionary>由此建立的<xref:System.Windows.FrameworkElement.Resources%2A>設定在 頁範圍中的元素<xref:System.Windows.Application.Resources%2A?displayProperty=nameWithType>或 。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-133">Then, use the <xref:System.Windows.ResourceDictionary> thus created to set the <xref:System.Windows.FrameworkElement.Resources%2A> property on an element that is present in a page scope, or the <xref:System.Windows.Application.Resources%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="cdcb1-134">您還可以維護作為<xref:System.Windows.ResourceDictionary>獨立物件,而無需將其添加到元素中。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-134">You could also maintain the <xref:System.Windows.ResourceDictionary> as a standalone object without adding it to an element.</span></span> <span data-ttu-id="cdcb1-135">不過，如果這麼做，您必須依項目索引鍵存取其中的資源，就如同它是泛型字典。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-135">However, if you do this, you must access the resources within it by item key, as if it were a generic dictionary.</span></span> <span data-ttu-id="cdcb1-136">未<xref:System.Windows.ResourceDictionary>附加到`Resources`元素 屬性的 a 不會作為元素樹的一部分存在,並且在查找序列<xref:System.Windows.FrameworkElement.FindResource%2A>中沒有可以由 和相關方法使用的範圍。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-136">A <xref:System.Windows.ResourceDictionary> that is not attached to an element `Resources` property would not  exist as part of the element tree and has no scope in a lookup sequence that can be used by <xref:System.Windows.FrameworkElement.FindResource%2A> and related methods.</span></span>  
  
<a name="objectaskey"></a>
## <a name="using-objects-as-keys"></a><span data-ttu-id="cdcb1-137">使用物件做為索引鍵</span><span class="sxs-lookup"><span data-stu-id="cdcb1-137">Using Objects as Keys</span></span>  
 <span data-ttu-id="cdcb1-138">大多數的資源使用方式會將資源的索引鍵設定為字串。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-138">Most resource usages will set the key of the resource to be a string.</span></span> <span data-ttu-id="cdcb1-139">不過，各種 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 功能刻意不使用字串類型來指定索引鍵，而是此參數就是一個物件。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-139">However, various [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] features deliberately do not use a string type to specify keys, instead this parameter is an object.</span></span> <span data-ttu-id="cdcb1-140">讓物件將資源當成索引鍵的功能，是透過 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 樣式和佈景主題支援來使用。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-140">The capability of having the resource be keyed by an object is used by the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] style and theming support.</span></span> <span data-ttu-id="cdcb1-141">主題中將成為非樣式控制件的預設樣式的樣式由它們應應用於的控制項的<xref:System.Type>鍵控。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-141">The styles in themes which become the default style for an otherwise non-styled control are each keyed by the <xref:System.Type> of the control that they should apply to.</span></span> <span data-ttu-id="cdcb1-142">依類型做為索引鍵，會提供可靠的查閱機制，在每個控制項類型的預設執行個體上運作，而且類型可以依反射來偵測，並用於設定衍生類型的樣式，即使衍生的類型不具預設樣式也一樣。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-142">Being keyed by type provides a reliable lookup mechanism that works on default instances of each control type, and type can be detected by reflection and used for styling derived classes even though the derived type otherwise has no default style.</span></span> <span data-ttu-id="cdcb1-143">可以使用<xref:System.Type>[x:Type 標記擴展](../../../desktop-wpf/xaml-services/xtype-markup-extension.md)為[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]中定義的資源指定鍵。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-143">You can specify a <xref:System.Type> key for a resource defined in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] by using the [x:Type Markup Extension](../../../desktop-wpf/xaml-services/xtype-markup-extension.md).</span></span> <span data-ttu-id="cdcb1-144">還有類似的延伸可供支援 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 功能的其他非字串索引鍵使用方式使用，例如 [ComponentResourceKey 標記延伸](componentresourcekey-markup-extension.md)。</span><span class="sxs-lookup"><span data-stu-id="cdcb1-144">Similar extensions exist for other nonstring key usages that support [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] features, such as [ComponentResourceKey Markup Extension](componentresourcekey-markup-extension.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cdcb1-145">另請參閱</span><span class="sxs-lookup"><span data-stu-id="cdcb1-145">See also</span></span>

- [<span data-ttu-id="cdcb1-146">XAML 資源</span><span class="sxs-lookup"><span data-stu-id="cdcb1-146">XAML Resources</span></span>](../../../desktop-wpf/fundamentals/xaml-resources-define.md)
- [<span data-ttu-id="cdcb1-147">設定樣式和範本</span><span class="sxs-lookup"><span data-stu-id="cdcb1-147">Styling and Templating</span></span>](../../../desktop-wpf/fundamentals/styles-templates-overview.md)
