---
title: "計時事件概觀"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-wpf
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- timelines [WPF]
- timing events [WPF]
ms.assetid: 597e3280-0867-4359-a97b-5b2f4149e350
caps.latest.revision: "14"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 8f50923d9e314d2f677e26416cef59fdf380213e
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/21/2017
---
# <a name="timing-events-overview"></a><span data-ttu-id="b13da-102">計時事件概觀</span><span class="sxs-lookup"><span data-stu-id="b13da-102">Timing Events Overview</span></span>
<span data-ttu-id="b13da-103">本主題描述如何使用五個可用的計時事件<xref:System.Windows.Media.Animation.Timeline>和<xref:System.Windows.Media.Animation.Clock>物件。</span><span class="sxs-lookup"><span data-stu-id="b13da-103">This topic describes how to use the five timing events available on <xref:System.Windows.Media.Animation.Timeline> and <xref:System.Windows.Media.Animation.Clock> objects.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="b13da-104">必要條件</span><span class="sxs-lookup"><span data-stu-id="b13da-104">Prerequisites</span></span>  
 <span data-ttu-id="b13da-105">若要了解本主題，您應該了解如何建立及使用動畫。</span><span class="sxs-lookup"><span data-stu-id="b13da-105">To understand this topic, you should understand how to create and use animations.</span></span> <span data-ttu-id="b13da-106">若要開始使用動畫，請參閱[動畫概觀](../../../../docs/framework/wpf/graphics-multimedia/animation-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="b13da-106">To get started with animation, see the [Animation Overview](../../../../docs/framework/wpf/graphics-multimedia/animation-overview.md).</span></span>  
  
 <span data-ttu-id="b13da-107">有多種方法，以動畫方式顯示在屬性[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="b13da-107">There are multiple ways to animate properties in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]:</span></span>  
  
-   <span data-ttu-id="b13da-108">**使用分鏡腳本物件**（標記和程式碼）： 您可以使用<xref:System.Windows.Media.Animation.Storyboard>排列及散發至一個或多個物件的動畫物件。</span><span class="sxs-lookup"><span data-stu-id="b13da-108">**Using storyboard objects** (markup and code): You can use <xref:System.Windows.Media.Animation.Storyboard> objects to arrange and distribute animations to one or more objects.</span></span> <span data-ttu-id="b13da-109">如需範例，請參閱[使用分鏡腳本建立屬性的動畫](../../../../docs/framework/wpf/graphics-multimedia/how-to-animate-a-property-by-using-a-storyboard.md)。</span><span class="sxs-lookup"><span data-stu-id="b13da-109">For an example, see [Animate a Property by Using a Storyboard](../../../../docs/framework/wpf/graphics-multimedia/how-to-animate-a-property-by-using-a-storyboard.md).</span></span>  
  
-   <span data-ttu-id="b13da-110">**使用本機動畫**（僅程式碼）： 您可以套用<xref:System.Windows.Media.Animation.AnimationTimeline>直接物件所建立動畫的屬性。</span><span class="sxs-lookup"><span data-stu-id="b13da-110">**Using local animations** (code only): You can apply <xref:System.Windows.Media.Animation.AnimationTimeline> objects directly to the properties they animate.</span></span> <span data-ttu-id="b13da-111">如需範例，請參閱[不使用分鏡腳本而建立屬性的動畫](../../../../docs/framework/wpf/graphics-multimedia/how-to-animate-a-property-without-using-a-storyboard.md)。</span><span class="sxs-lookup"><span data-stu-id="b13da-111">For an example, see [Animate a Property Without Using a Storyboard](../../../../docs/framework/wpf/graphics-multimedia/how-to-animate-a-property-without-using-a-storyboard.md).</span></span>  
  
-   <span data-ttu-id="b13da-112">**使用時鐘** (僅程式碼)︰您可以明確管理時鐘的建立，並自行發佈動畫時鐘。</span><span class="sxs-lookup"><span data-stu-id="b13da-112">**Using clocks** (code only): You can explicitly manage clock creation and distribute the animation clocks yourself.</span></span>  <span data-ttu-id="b13da-113">如需範例，請參閱[建立屬性的動畫使用 AnimationClock](../../../../docs/framework/wpf/graphics-multimedia/how-to-animate-a-property-by-using-an-animationclock.md)。</span><span class="sxs-lookup"><span data-stu-id="b13da-113">For an example, see [Animate a Property by Using an AnimationClock](../../../../docs/framework/wpf/graphics-multimedia/how-to-animate-a-property-by-using-an-animationclock.md).</span></span>  
  
 <span data-ttu-id="b13da-114">因為您可以利用這些標記和程式碼中，本概觀中的範例使用<xref:System.Windows.Media.Animation.Storyboard>物件。</span><span class="sxs-lookup"><span data-stu-id="b13da-114">Because you can use them in markup and code, the examples in this overview use <xref:System.Windows.Media.Animation.Storyboard> objects.</span></span> <span data-ttu-id="b13da-115">不過，所述的概念也可以套用到其他建立屬性動畫的方法。</span><span class="sxs-lookup"><span data-stu-id="b13da-115">However, the concepts described can be applied to the other methods of animating properties.</span></span>  
  
### <a name="what-is-a-clock"></a><span data-ttu-id="b13da-116">什麼是時鐘？</span><span class="sxs-lookup"><span data-stu-id="b13da-116">What is a clock?</span></span>  
 <span data-ttu-id="b13da-117">它是時間軸。單獨使用時，它除了描述一段時間之外沒有任何其他功能。</span><span class="sxs-lookup"><span data-stu-id="b13da-117">A timeline, by itself, doesn't actually do anything other than describe a segment of time.</span></span> <span data-ttu-id="b13da-118">它是時間軸的<xref:System.Windows.Media.Animation.Clock>從事實際作業的物件： 其維持的時間軸與時間有關執行階段狀態。</span><span class="sxs-lookup"><span data-stu-id="b13da-118">It's the timeline's <xref:System.Windows.Media.Animation.Clock> object that does the real work: it maintains timing-related run-time state for the timeline.</span></span> <span data-ttu-id="b13da-119">在大部分情況下 (例如使用分鏡腳本時)，系統會自動為時間軸建立時鐘。</span><span class="sxs-lookup"><span data-stu-id="b13da-119">In most cases, such as when using storyboards, a clock is created automatically for your timeline.</span></span> <span data-ttu-id="b13da-120">您也可以建立<xref:System.Windows.Media.Animation.Clock>明確地使用<xref:System.Windows.Media.Animation.Timeline.CreateClock%2A>方法。</span><span class="sxs-lookup"><span data-stu-id="b13da-120">You can also create a <xref:System.Windows.Media.Animation.Clock> explicitly by using the <xref:System.Windows.Media.Animation.Timeline.CreateClock%2A> method.</span></span> <span data-ttu-id="b13da-121">如需有關<xref:System.Windows.Media.Animation.Clock>物件，請參閱[動畫和計時系統概觀](../../../../docs/framework/wpf/graphics-multimedia/animation-and-timing-system-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="b13da-121">For more information about <xref:System.Windows.Media.Animation.Clock> objects, see the [Animation and Timing System Overview](../../../../docs/framework/wpf/graphics-multimedia/animation-and-timing-system-overview.md).</span></span>  
  
## <a name="why-use-events"></a><span data-ttu-id="b13da-122">為何要使用事件？</span><span class="sxs-lookup"><span data-stu-id="b13da-122">Why Use Events?</span></span>  
 <span data-ttu-id="b13da-123">除了一個例外狀況 (對齊最後一個滴答的搜尋) 之外，所有互動式計時作業都是非同步的。</span><span class="sxs-lookup"><span data-stu-id="b13da-123">With the exception of one (seek aligned to last tick), all interactive timing operations are asynchronous.</span></span> <span data-ttu-id="b13da-124">您無法得知它們會在何時執行。</span><span class="sxs-lookup"><span data-stu-id="b13da-124">There is no way for you to know exactly when they will execute.</span></span> <span data-ttu-id="b13da-125">當有其他程式碼需要依賴您的計時作業時，這會構成問題。</span><span class="sxs-lookup"><span data-stu-id="b13da-125">That can be a problem when you have other code that's dependent upon your timing operation.</span></span> <span data-ttu-id="b13da-126">假設您要停止對矩形建立動畫的時間軸。</span><span class="sxs-lookup"><span data-stu-id="b13da-126">Suppose that you wanted to stop a timeline that animated a rectangle.</span></span> <span data-ttu-id="b13da-127">在該時間軸停止之後，您會變更該矩形的色彩。</span><span class="sxs-lookup"><span data-stu-id="b13da-127">After the timeline stops, you change the color of the rectangle.</span></span>  
  
 [!code-csharp[events_procedural#NeedForEventsFragment](../../../../samples/snippets/csharp/VS_Snippets_Wpf/events_procedural/CSharp/EventExample.cs#needforeventsfragment)]
 [!code-vb[events_procedural#NeedForEventsFragment](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/events_procedural/VisualBasic/EventExample.vb#needforeventsfragment)]  
  
 <span data-ttu-id="b13da-128">在上述範例中，第二行的程式碼可能會在分鏡腳本停止前執行。</span><span class="sxs-lookup"><span data-stu-id="b13da-128">In the previous example, the second line of code might execute before the storyboard stops.</span></span> <span data-ttu-id="b13da-129">這是因為停止是一個非同步作業。</span><span class="sxs-lookup"><span data-stu-id="b13da-129">That's because stopping is an asynchronous operation.</span></span> <span data-ttu-id="b13da-130">要求時間軸或時鐘停止，會建立某種「停止要求」，並需要等到計時引擎的下一個滴答才會處理該要求。</span><span class="sxs-lookup"><span data-stu-id="b13da-130">Telling a timeline or clock to stop creates a "stop request" of sorts that isn't processed until the timing engine's next tick.</span></span>  
  
 <span data-ttu-id="b13da-131">若要在時間軸完成之後執行命令，請使用計時事件。</span><span class="sxs-lookup"><span data-stu-id="b13da-131">To execute commands after a timeline completes, use timing events.</span></span> <span data-ttu-id="b13da-132">在下列範例中，在分鏡腳本停止播放之後，會使用事件處理常式來變更矩形的色彩。</span><span class="sxs-lookup"><span data-stu-id="b13da-132">In the following example, an event handler is used to change the color of a rectangle after the storyboard stops playing.</span></span>  
  
 [!code-csharp[events_procedural#RegisterForStoryboardCurrentStateInvalidatedEvent](../../../../samples/snippets/csharp/VS_Snippets_Wpf/events_procedural/CSharp/EventExample.cs#registerforstoryboardcurrentstateinvalidatedevent)]
 [!code-vb[events_procedural#RegisterForStoryboardCurrentStateInvalidatedEvent](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/events_procedural/VisualBasic/EventExample.vb#registerforstoryboardcurrentstateinvalidatedevent)]  
[!code-csharp[events_procedural#StoryboardCurrentStateInvalidatedEvent2](../../../../samples/snippets/csharp/VS_Snippets_Wpf/events_procedural/CSharp/EventExample.cs#storyboardcurrentstateinvalidatedevent2)]
[!code-vb[events_procedural#StoryboardCurrentStateInvalidatedEvent2](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/events_procedural/VisualBasic/EventExample.vb#storyboardcurrentstateinvalidatedevent2)]  
  
 <span data-ttu-id="b13da-133">如需更完整的範例，請參閱[接收通知時時鐘的狀態變更](../../../../docs/framework/wpf/graphics-multimedia/how-to-receive-notification-when-clock-state-changes.md)。</span><span class="sxs-lookup"><span data-stu-id="b13da-133">For a more complete example, see [Receive Notification When a Clock's State Changes](../../../../docs/framework/wpf/graphics-multimedia/how-to-receive-notification-when-clock-state-changes.md).</span></span>  
  
## <a name="public-events"></a><span data-ttu-id="b13da-134">公用事件</span><span class="sxs-lookup"><span data-stu-id="b13da-134">Public Events</span></span>  
 <span data-ttu-id="b13da-135"><xref:System.Windows.Media.Animation.Timeline>和<xref:System.Windows.Media.Animation.Clock>這兩個類別會提供五個計時事件。</span><span class="sxs-lookup"><span data-stu-id="b13da-135">The <xref:System.Windows.Media.Animation.Timeline> and <xref:System.Windows.Media.Animation.Clock> classes both provide five timing events.</span></span> <span data-ttu-id="b13da-136">下表列出這些事件和觸發它們的條件。</span><span class="sxs-lookup"><span data-stu-id="b13da-136">The following table lists these events and the conditions that trigger them.</span></span>  
  
|<span data-ttu-id="b13da-137">事件</span><span class="sxs-lookup"><span data-stu-id="b13da-137">Event</span></span>|<span data-ttu-id="b13da-138">觸發互動式作業</span><span class="sxs-lookup"><span data-stu-id="b13da-138">Triggering interactive operation</span></span>|<span data-ttu-id="b13da-139">其他觸發程序</span><span class="sxs-lookup"><span data-stu-id="b13da-139">Other triggers</span></span>|  
|-----------|--------------------------------------|--------------------|  
|<span data-ttu-id="b13da-140">**Completed**</span><span class="sxs-lookup"><span data-stu-id="b13da-140">**Completed**</span></span>|<span data-ttu-id="b13da-141">跳至填滿</span><span class="sxs-lookup"><span data-stu-id="b13da-141">Skip to fill</span></span>|<span data-ttu-id="b13da-142">時鐘完成。</span><span class="sxs-lookup"><span data-stu-id="b13da-142">The clock completes.</span></span>|  
|<span data-ttu-id="b13da-143">**CurrentGlobalSpeedInvalidated**</span><span class="sxs-lookup"><span data-stu-id="b13da-143">**CurrentGlobalSpeedInvalidated**</span></span>|<span data-ttu-id="b13da-144">暫停、繼續、搜尋、設定速率、跳至填滿、停止</span><span class="sxs-lookup"><span data-stu-id="b13da-144">Pause, resume, seek, set speed ratio, skip to fill, stop</span></span>|<span data-ttu-id="b13da-145">時鐘反轉、加速、啟動或停止。</span><span class="sxs-lookup"><span data-stu-id="b13da-145">The clock reverses, accelerates, starts, or stops.</span></span>|  
|<span data-ttu-id="b13da-146">**CurrentStateInvalidated**</span><span class="sxs-lookup"><span data-stu-id="b13da-146">**CurrentStateInvalidated**</span></span>|<span data-ttu-id="b13da-147">開始、跳至填滿、停止</span><span class="sxs-lookup"><span data-stu-id="b13da-147">Begin, skip to fill, stop</span></span>|<span data-ttu-id="b13da-148">時鐘啟動、停止或填滿。</span><span class="sxs-lookup"><span data-stu-id="b13da-148">The clock starts, stops, or fills.</span></span>|  
|<span data-ttu-id="b13da-149">**CurrentTimeInvalidated**</span><span class="sxs-lookup"><span data-stu-id="b13da-149">**CurrentTimeInvalidated**</span></span>|<span data-ttu-id="b13da-150">開始、搜尋、跳至填滿、停止</span><span class="sxs-lookup"><span data-stu-id="b13da-150">Begin, seek, skip to fill, stop</span></span>|<span data-ttu-id="b13da-151">時鐘進行。</span><span class="sxs-lookup"><span data-stu-id="b13da-151">The clock progresses.</span></span>|  
|<span data-ttu-id="b13da-152">**RemoveRequested**</span><span class="sxs-lookup"><span data-stu-id="b13da-152">**RemoveRequested**</span></span>|<span data-ttu-id="b13da-153">移除</span><span class="sxs-lookup"><span data-stu-id="b13da-153">Remove</span></span>||  
  
## <a name="ticking-and-event-consolidation"></a><span data-ttu-id="b13da-154">滴答和事件彙總</span><span class="sxs-lookup"><span data-stu-id="b13da-154">Ticking and Event Consolidation</span></span>  
 <span data-ttu-id="b13da-155">當您製作物件動畫中[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]，它是計時引擎，可管理您的動畫。</span><span class="sxs-lookup"><span data-stu-id="b13da-155">When you animate objects in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], it’s the timing engine that manages your animations.</span></span> <span data-ttu-id="b13da-156">計時引擎會追蹤時間的進展，並計算每個動畫的狀態。</span><span class="sxs-lookup"><span data-stu-id="b13da-156">The timing engine tracks the progression of time and computes the state of each animation.</span></span> <span data-ttu-id="b13da-157">它在一秒內會做出許多這種評估處理。</span><span class="sxs-lookup"><span data-stu-id="b13da-157">It makes many such evaluation passes in a second.</span></span> <span data-ttu-id="b13da-158">這些評估處理稱為「滴答」。</span><span class="sxs-lookup"><span data-stu-id="b13da-158">These evaluation passes are known as "ticks."</span></span>  
  
 <span data-ttu-id="b13da-159">雖然滴答經常發生，但在滴答之間有可能會發生很多事。</span><span class="sxs-lookup"><span data-stu-id="b13da-159">While ticks occur frequently, it's possible for a lot of things to happen between ticks.</span></span> <span data-ttu-id="b13da-160">例如，時間軸可能會停止，啟動，然後再次停止，在此情況下，它的目前狀態已變更三次。</span><span class="sxs-lookup"><span data-stu-id="b13da-160">For example, a timeline might be stopped, started, and stopped again, in which case its current state will have changed three times.</span></span> <span data-ttu-id="b13da-161">理論上，事件可以在單一滴答中引發很多次，不過，由於計時引擎會彙總事件，所以每個事件在每次滴答中最多只能引發一次。</span><span class="sxs-lookup"><span data-stu-id="b13da-161">In theory, the event could be raised multiple times in a single tick; however, the timing engine consolidates events, so that each event can be raised at most once per tick.</span></span>  
  
## <a name="registering-for-events"></a><span data-ttu-id="b13da-162">註冊事件</span><span class="sxs-lookup"><span data-stu-id="b13da-162">Registering for Events</span></span>  
 <span data-ttu-id="b13da-163">有兩種方式可以註冊計時事件：使用時間軸來註冊，或使用從時間軸建立的時鐘來註冊。</span><span class="sxs-lookup"><span data-stu-id="b13da-163">There are two ways to register for timing events: you can register with the timeline or with the clock created from the timeline.</span></span> <span data-ttu-id="b13da-164">使用時鐘直接註冊事件很簡單，但是只能透過程式碼來完成。</span><span class="sxs-lookup"><span data-stu-id="b13da-164">Registering for an event directly with a clock is fairly straightforward, although it can only be done from code.</span></span> <span data-ttu-id="b13da-165">您可以透過標記或程式碼來使用時間軸註冊事件。</span><span class="sxs-lookup"><span data-stu-id="b13da-165">You can register for events with a timeline from markup or code.</span></span> <span data-ttu-id="b13da-166">下節會說明使用時間軸註冊時鐘事件的方法。</span><span class="sxs-lookup"><span data-stu-id="b13da-166">The next section describes how to register for clock events with a timeline.</span></span>  
  
<a name="registeringforclockeventswithatimeline"></a>   
## <a name="registering-for-clock-events-with-a-timeline"></a><span data-ttu-id="b13da-167">使用時間軸註冊時鐘事件</span><span class="sxs-lookup"><span data-stu-id="b13da-167">Registering for Clock Events with a Timeline</span></span>  
 <span data-ttu-id="b13da-168">雖然時間軸的<xref:System.Windows.Media.Animation.Timeline.Completed>， <xref:System.Windows.Media.Animation.Timeline.CurrentGlobalSpeedInvalidated>， <xref:System.Windows.Media.Animation.Timeline.CurrentStateInvalidated>， <xref:System.Windows.Media.Animation.Timeline.CurrentTimeInvalidated>，和<xref:System.Windows.Media.Animation.Timeline.RemoveRequested>事件似乎是相關聯時間軸，註冊的實際這些事件產生關聯的事件處理常式和<xref:System.Windows.Media.Animation.Clock>建立在時間軸。</span><span class="sxs-lookup"><span data-stu-id="b13da-168">Although a timeline's <xref:System.Windows.Media.Animation.Timeline.Completed>, <xref:System.Windows.Media.Animation.Timeline.CurrentGlobalSpeedInvalidated>, <xref:System.Windows.Media.Animation.Timeline.CurrentStateInvalidated>, <xref:System.Windows.Media.Animation.Timeline.CurrentTimeInvalidated>, and <xref:System.Windows.Media.Animation.Timeline.RemoveRequested> events appear to be associated with the timeline, registering for these events actually associates an event handler with the <xref:System.Windows.Media.Animation.Clock> created for the timeline.</span></span>  
  
 <span data-ttu-id="b13da-169">當您註冊<xref:System.Windows.Media.Animation.Timeline.Completed>時間表上的事件，例如，您正在實際告訴系統註冊<xref:System.Windows.Media.Animation.Clock.Completed>事件的時間軸會建立每個時鐘。</span><span class="sxs-lookup"><span data-stu-id="b13da-169">When you register for the <xref:System.Windows.Media.Animation.Timeline.Completed> event on a timeline, for example, you're actually telling the system to register for the <xref:System.Windows.Media.Animation.Clock.Completed> event of each clock that is created for the timeline.</span></span> <span data-ttu-id="b13da-170">程式碼中，您必須註冊此事件之前<xref:System.Windows.Media.Animation.Clock>建立的這個時間軸中; 否則您不會收到通知。</span><span class="sxs-lookup"><span data-stu-id="b13da-170">In code, you must register for this event before the <xref:System.Windows.Media.Animation.Clock> is created for this timeline; otherwise, you won't receive notification.</span></span> <span data-ttu-id="b13da-171">發生這種情況中自動[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]; 剖析器會自動註冊的事件之前<xref:System.Windows.Media.Animation.Clock>建立。</span><span class="sxs-lookup"><span data-stu-id="b13da-171">This happens automatically in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]; the parser automatically registers for the event before the <xref:System.Windows.Media.Animation.Clock> is created.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b13da-172">另請參閱</span><span class="sxs-lookup"><span data-stu-id="b13da-172">See Also</span></span>  
 [<span data-ttu-id="b13da-173">動畫和計時系統概觀</span><span class="sxs-lookup"><span data-stu-id="b13da-173">Animation and Timing System Overview</span></span>](../../../../docs/framework/wpf/graphics-multimedia/animation-and-timing-system-overview.md)  
 [<span data-ttu-id="b13da-174">動畫概觀</span><span class="sxs-lookup"><span data-stu-id="b13da-174">Animation Overview</span></span>](../../../../docs/framework/wpf/graphics-multimedia/animation-overview.md)  
 [<span data-ttu-id="b13da-175">計時行為概觀</span><span class="sxs-lookup"><span data-stu-id="b13da-175">Timing Behaviors Overview</span></span>](../../../../docs/framework/wpf/graphics-multimedia/timing-behaviors-overview.md)
