---
title: 使用者輸入驗證
ms.date: 03/30/2017
helpviewer_keywords:
- Windows Forms, validating user input
- validation [Windows Forms], Windows Forms user input
- user input [Windows Forms], validating in Windows Forms
- validating user input [Windows Forms], Windows Forms
ms.assetid: 4ec07681-1dee-4bf9-be5e-718f635a33a1
ms.openlocfilehash: eafbf54552566011fef9d2dbeb5e9f9fa3facabd
ms.sourcegitcommit: 62285ec11fa8e8424bab00511a90760c60e63c95
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/20/2020
ms.locfileid: "81646307"
---
# <a name="user-input-validation-in-windows-forms"></a><span data-ttu-id="7f60c-102">Windows Form 中的使用者輸入驗證</span><span class="sxs-lookup"><span data-stu-id="7f60c-102">User Input Validation in Windows Forms</span></span>
<span data-ttu-id="7f60c-103">當使用者在應用程式中輸入數據時,您可能希望在應用程式使用數據之前驗證數據是否有效。</span><span class="sxs-lookup"><span data-stu-id="7f60c-103">When users enter data into your application, you may want to verify that the data is valid before your application uses it.</span></span> <span data-ttu-id="7f60c-104">您可以要求某些文字欄位不是零長度,欄位必須格式化為電話號碼或其他類型的格式良好的資料,或者字串不包含任何可能用於危害資料庫安全性的不安全字元。</span><span class="sxs-lookup"><span data-stu-id="7f60c-104">You may require that certain text fields not be zero-length, that a field be formatted as a telephone number or other type of well-formed data, or that a string not contain any unsafe characters that could be used to compromise the security of a database.</span></span> <span data-ttu-id="7f60c-105">Windows 表單提供測試應用程式中輸入的方法。</span><span class="sxs-lookup"><span data-stu-id="7f60c-105">Windows Forms provides several ways for you to validate input in your application.</span></span>  
  
## <a name="validation-with-the-maskedtextbox-control"></a><span data-ttu-id="7f60c-106">使用遮罩</span><span class="sxs-lookup"><span data-stu-id="7f60c-106">Validation with the MaskedTextBox Control</span></span>  
 <span data-ttu-id="7f60c-107">如果需要要求使用者以定義良好的格式(如電話號碼或部件號)輸入數據,則可以使用<xref:System.Windows.Forms.MaskedTextBox>控制項快速且使用最少的代碼完成此任務。</span><span class="sxs-lookup"><span data-stu-id="7f60c-107">If you need to require users to enter data in a well-defined format, such as a telephone number or a part number, you can accomplish this quickly and with minimal code by using the <xref:System.Windows.Forms.MaskedTextBox> control.</span></span> <span data-ttu-id="7f60c-108">*蒙版*是由掩蔽語言中的字元組成的字串,用於指定可以在文本框中的任何給定位置輸入哪些字元。</span><span class="sxs-lookup"><span data-stu-id="7f60c-108">A *mask* is a string made up of characters from a masking language that specifies which characters can be entered at any given position in the text box.</span></span> <span data-ttu-id="7f60c-109">該控件向用戶顯示一組提示。</span><span class="sxs-lookup"><span data-stu-id="7f60c-109">The control displays a set of prompts to the user.</span></span> <span data-ttu-id="7f60c-110">如果用戶鍵入不正確的條目,例如,當使用者在需要數位時鍵入字母,控件將自動拒絕輸入。</span><span class="sxs-lookup"><span data-stu-id="7f60c-110">If the user types an incorrect entry, for example, the user types a letter when a digit is required, the control will automatically reject the input.</span></span>  
  
 <span data-ttu-id="7f60c-111">所使用的掩蔽語言<xref:System.Windows.Forms.MaskedTextBox>非常靈活。</span><span class="sxs-lookup"><span data-stu-id="7f60c-111">The masking language that is used by <xref:System.Windows.Forms.MaskedTextBox> is very flexible.</span></span> <span data-ttu-id="7f60c-112">它允許您指定所需的字元、可選字元、字面字元(如連字元和括弧、貨幣字元和日期分隔符)。</span><span class="sxs-lookup"><span data-stu-id="7f60c-112">It allows you to specify required characters, optional characters, literal characters, such as hyphens and parentheses, currency characters, and date separators.</span></span> <span data-ttu-id="7f60c-113">綁定到數據源時,該控件也工作正常。</span><span class="sxs-lookup"><span data-stu-id="7f60c-113">The control also works well when bound to a data source.</span></span> <span data-ttu-id="7f60c-114">數據<xref:System.Windows.Forms.Binding.Format>綁定上的事件可用於重格式化傳入數據以符合掩碼,<xref:System.Windows.Forms.Binding.Parse>該事件可用於重格式化傳出數據以符合數據欄位的規範。</span><span class="sxs-lookup"><span data-stu-id="7f60c-114">The <xref:System.Windows.Forms.Binding.Format> event on a data binding can be used to reformat incoming data to comply with the mask, and the <xref:System.Windows.Forms.Binding.Parse> event can be used to reformat outgoing data to comply with the specifications of the data field.</span></span>  
  
 <span data-ttu-id="7f60c-115">關於詳細資訊,請參閱[影像文字盒控制 。](./controls/maskedtextbox-control-windows-forms.md)</span><span class="sxs-lookup"><span data-stu-id="7f60c-115">For more information, see [MaskedTextBox Control](./controls/maskedtextbox-control-windows-forms.md).</span></span>  
  
## <a name="event-driven-validation"></a><span data-ttu-id="7f60c-116">事件驅動驗證</span><span class="sxs-lookup"><span data-stu-id="7f60c-116">Event-Driven Validation</span></span>  
 <span data-ttu-id="7f60c-117">如果要對驗證進行完全程式設計控制,或者需要執行複雜的驗證檢查,則應使用大多數 Windows 窗體控制項中內置的驗證事件。</span><span class="sxs-lookup"><span data-stu-id="7f60c-117">If you want full programmatic control over validation, or need to perform complex validation checks, you should use the validation events built into most Windows Forms controls.</span></span> <span data-ttu-id="7f60c-118">接受自由格式使用者輸入的每個控制項都有一個<xref:System.Windows.Forms.Control.Validating>事件,該事件將在控制項需要數據驗證時發生。</span><span class="sxs-lookup"><span data-stu-id="7f60c-118">Each control that accepts free-form user input has a <xref:System.Windows.Forms.Control.Validating> event that will occur whenever the control requires data validation.</span></span> <span data-ttu-id="7f60c-119">在<xref:System.Windows.Forms.Control.Validating>事件處理方法中,您可以通過多種方式驗證使用者輸入。</span><span class="sxs-lookup"><span data-stu-id="7f60c-119">In the <xref:System.Windows.Forms.Control.Validating> event-handling method, you can validate user input in several ways.</span></span> <span data-ttu-id="7f60c-120">例如,如果您有一個必須包含郵遞區編碼的文本框,則可以通過以下方式執行驗證:</span><span class="sxs-lookup"><span data-stu-id="7f60c-120">For example, if you have a text box that must contain a postal code, you can perform the validation in the following ways:</span></span>  
  
- <span data-ttu-id="7f60c-121">如果郵政編碼必須屬於特定的郵政編碼組,則可以對輸入執行字串比較,以驗證使用者輸入的數據。</span><span class="sxs-lookup"><span data-stu-id="7f60c-121">If the postal code must belong to a specific group of zip codes, you can perform a string comparison on the input to validate the data entered by the user.</span></span> <span data-ttu-id="7f60c-122">例如,如果郵政編碼必須位於集 {10001、10002、10003}中,則可以使用字串比較來驗證數據。</span><span class="sxs-lookup"><span data-stu-id="7f60c-122">For example, if the postal code must be in the set {10001, 10002, 10003}, then you can use a string comparison to validate the data.</span></span>  
  
- <span data-ttu-id="7f60c-123">如果郵政編碼必須採用特定形式,則可以使用正則表達式來驗證使用者輸入的數據。</span><span class="sxs-lookup"><span data-stu-id="7f60c-123">If the postal code must be in a specific form you can use regular expressions to validate the data entered by the user.</span></span> <span data-ttu-id="7f60c-124">例如,要驗證窗體`#####``#####-####`或 ,可以使用正規表示`^(\d{5})(-\d{4})?$`式 。</span><span class="sxs-lookup"><span data-stu-id="7f60c-124">For example, to validate the form `#####` or `#####-####`, you can use the regular expression `^(\d{5})(-\d{4})?$`.</span></span> <span data-ttu-id="7f60c-125">要驗證表單`A#A #A#`,可以使用正規表示式`[A-Z]\d[A-Z] \d[A-Z]\d`。</span><span class="sxs-lookup"><span data-stu-id="7f60c-125">To validate the form `A#A #A#`, you can use the regular expression `[A-Z]\d[A-Z] \d[A-Z]\d`.</span></span> <span data-ttu-id="7f60c-126">有關正規表示式的詳細資訊,請參閱[.NET 框架正規表示式](../../standard/base-types/regular-expressions.md)與[正規表示式範例](../../standard/base-types/regular-expression-example-scanning-for-hrefs.md)。</span><span class="sxs-lookup"><span data-stu-id="7f60c-126">For more information about regular expressions, see [.NET Framework Regular Expressions](../../standard/base-types/regular-expressions.md) and [Regular Expression Examples](../../standard/base-types/regular-expression-example-scanning-for-hrefs.md).</span></span>  
  
- <span data-ttu-id="7f60c-127">如果郵政編碼必須是有效的美國郵政編碼,您可以調用郵政編碼 Web 服務來驗證使用者輸入的數據。</span><span class="sxs-lookup"><span data-stu-id="7f60c-127">If the postal code must be a valid United States Zip code, you could call a Zip code Web service to validate the data entered by the user.</span></span>  
  
 <span data-ttu-id="7f60c-128">事件<xref:System.Windows.Forms.Control.Validating>提供類型的<xref:System.ComponentModel.CancelEventArgs>物件 。</span><span class="sxs-lookup"><span data-stu-id="7f60c-128">The <xref:System.Windows.Forms.Control.Validating> event is supplied an object of type <xref:System.ComponentModel.CancelEventArgs>.</span></span> <span data-ttu-id="7f60c-129">如果確定控制項的數據無效,則可以通過將此物件的<xref:System.Windows.Forms.Control.Validating><xref:System.ComponentModel.CancelEventArgs.Cancel%2A>屬性`true`設置為取消事件。</span><span class="sxs-lookup"><span data-stu-id="7f60c-129">If you determine that the control's data is not valid, you can cancel the <xref:System.Windows.Forms.Control.Validating> event by setting this object's <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> property to `true`.</span></span> <span data-ttu-id="7f60c-130">如果不設置屬性,Windows<xref:System.ComponentModel.CancelEventArgs.Cancel%2A>窗體將假定該控件的驗證成功,並引發<xref:System.Windows.Forms.Control.Validated>該 事件。</span><span class="sxs-lookup"><span data-stu-id="7f60c-130">If you do not set the <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> property, Windows Forms will assume that validation succeeded for that control, and raise the <xref:System.Windows.Forms.Control.Validated> event.</span></span>  
  
 <span data-ttu-id="7f60c-131">認證的電子郵件地址的代碼範例,<xref:System.Windows.Controls.TextBox>請參考<xref:System.Windows.Forms.Control.Validating>。</span><span class="sxs-lookup"><span data-stu-id="7f60c-131">For a code example that validates an email address in a <xref:System.Windows.Controls.TextBox>, see <xref:System.Windows.Forms.Control.Validating>.</span></span>  
  
### <a name="data-binding-and-event-driven-validation"></a><span data-ttu-id="7f60c-132">資料繫結和事件驅動驗證</span><span class="sxs-lookup"><span data-stu-id="7f60c-132">Data Binding and Event-Driven Validation</span></span>  
 <span data-ttu-id="7f60c-133">當您將控制項裝置綁定到資料來源(如資料庫表)時,驗證非常有用。</span><span class="sxs-lookup"><span data-stu-id="7f60c-133">Validation is very useful when you have bound your controls to a data source, such as a database table.</span></span> <span data-ttu-id="7f60c-134">通過使用驗證,可以確保控件的數據滿足數據來源所需的格式,並且不包含任何可能不安全的特殊字元,如引號和斜杠。</span><span class="sxs-lookup"><span data-stu-id="7f60c-134">By using validation, you can make sure that your control's data satisfies the format required by the data source, and that it does not contain any special characters such as quotation marks and back slashes that might be unsafe.</span></span>  
  
 <span data-ttu-id="7f60c-135">使用數據綁定時,控件中的數據在執行<xref:System.Windows.Forms.Control.Validating>事件期間會與數據源同步。</span><span class="sxs-lookup"><span data-stu-id="7f60c-135">When you use data binding, the data in your control is synchronized with the data source during execution of the <xref:System.Windows.Forms.Control.Validating> event.</span></span> <span data-ttu-id="7f60c-136">如果取消該<xref:System.Windows.Forms.Control.Validating>事件,數據將不會與數據源同步。</span><span class="sxs-lookup"><span data-stu-id="7f60c-136">If you cancel the <xref:System.Windows.Forms.Control.Validating> event, the data will not be synchronized with the data source.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="7f60c-137">如果<xref:System.Windows.Forms.Control.Validating>具有在事件發生後進行的自定義驗證,則不會影響數據綁定。</span><span class="sxs-lookup"><span data-stu-id="7f60c-137">If you have custom validation that takes place after the <xref:System.Windows.Forms.Control.Validating> event, it will not affect the data binding.</span></span> <span data-ttu-id="7f60c-138">例如,如果<xref:System.Windows.Forms.Control.Validated>嘗試取消數據綁定的事件有代碼,則數據綁定仍將發生。</span><span class="sxs-lookup"><span data-stu-id="7f60c-138">For example, if you have code in a <xref:System.Windows.Forms.Control.Validated> event that attempts to cancel the data binding, the data binding will still occur.</span></span> <span data-ttu-id="7f60c-139">在這種情況下,要<xref:System.Windows.Forms.Control.Validated>在事件中執行驗證,請將控制項的**資料來源更新模式**屬性(**下(資料綁定)(**\\**進階)** 從**On 驗證**更改為**從不**,並將*控制*`.DataBindings["`*\<YOURFIELD>*`"].WriteValue()`添加到驗證代碼中。</span><span class="sxs-lookup"><span data-stu-id="7f60c-139">In this case, to perform validation in the <xref:System.Windows.Forms.Control.Validated> event, change the control's **Data Source Update Mode** property (**under (Databindings)**\\ **(Advanced)**) from **OnValidation** to **Never**, and add *Control*`.DataBindings["`*\<YOURFIELD>*`"].WriteValue()` to your validation code.</span></span>  
  
### <a name="implicit-and-explicit-validation"></a><span data-ttu-id="7f60c-140">隱含及繪圖型驗證</span><span class="sxs-lookup"><span data-stu-id="7f60c-140">Implicit and Explicit Validation</span></span>  
 <span data-ttu-id="7f60c-141">那麼,控件的數據何時得到驗證?</span><span class="sxs-lookup"><span data-stu-id="7f60c-141">So when does a control's data get validated?</span></span> <span data-ttu-id="7f60c-142">這由您,開發人員決定。</span><span class="sxs-lookup"><span data-stu-id="7f60c-142">This is up to you, the developer.</span></span> <span data-ttu-id="7f60c-143">您可以根據應用程式的需求使用隱式或顯式驗證。</span><span class="sxs-lookup"><span data-stu-id="7f60c-143">You can use either implicit or explicit validation, depending on the needs of your application.</span></span>  
  
#### <a name="implicit-validation"></a><span data-ttu-id="7f60c-144">隱式驗證</span><span class="sxs-lookup"><span data-stu-id="7f60c-144">Implicit Validation</span></span>  
 <span data-ttu-id="7f60c-145">隱式驗證方法在使用者輸入數據時驗證數據。</span><span class="sxs-lookup"><span data-stu-id="7f60c-145">The implicit validation approach validates data as the user enters it.</span></span> <span data-ttu-id="7f60c-146">通過在按鍵時讀取數據輸入數據時驗證數據,或者當使用者將輸入焦點從一個控制項移開並移動到下一個控制項時,更常見的驗證數據。</span><span class="sxs-lookup"><span data-stu-id="7f60c-146">You can validate the data as the data is entered in a control by reading the keys as they are pressed, or more commonly whenever the user takes the input focus away from one control and moves to the next.</span></span> <span data-ttu-id="7f60c-147">當您希望向使用者提供有關數據工作時的即時反饋時,此方法非常有用。</span><span class="sxs-lookup"><span data-stu-id="7f60c-147">This approach is useful when you want to give the user immediate feedback about the data as they are working.</span></span>  
  
 <span data-ttu-id="7f60c-148">如果要對控制項使用隱式驗證,則必須將該控制項的屬性<xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>設定<xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange>為<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>或 。</span><span class="sxs-lookup"><span data-stu-id="7f60c-148">If you want to use implicit validation for a control, you must set that control's <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> property to <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange> or <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>.</span></span> <span data-ttu-id="7f60c-149">如果取消此<xref:System.Windows.Forms.Control.Validating>事件,控制項的行為將由分配給的值<xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>決定 。</span><span class="sxs-lookup"><span data-stu-id="7f60c-149">If you cancel the <xref:System.Windows.Forms.Control.Validating> event, the behavior of the control will be determined by what value that you assigned to <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>.</span></span> <span data-ttu-id="7f60c-150">如果分配<xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange>,取消事件將<xref:System.Windows.Forms.Control.Validated>導致 事件不會發生。</span><span class="sxs-lookup"><span data-stu-id="7f60c-150">If you assigned <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange>, canceling the event will cause the <xref:System.Windows.Forms.Control.Validated> event not to occur.</span></span> <span data-ttu-id="7f60c-151">輸入焦點將保留在當前控制項上,直到使用者將資料更改為有效輸入。</span><span class="sxs-lookup"><span data-stu-id="7f60c-151">Input focus will remain on the current control until the user changes the data to a valid input.</span></span> <span data-ttu-id="7f60c-152">如果分配<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>了<xref:System.Windows.Forms.Control.Validated>,則取消事件時不會發生事件,但焦點仍將更改為下一個控件。</span><span class="sxs-lookup"><span data-stu-id="7f60c-152">If you assigned <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>, the <xref:System.Windows.Forms.Control.Validated> event will not occur when you cancel the event, but focus will still change to the next control.</span></span>  
  
 <span data-ttu-id="7f60c-153">分配給<xref:System.Windows.Forms.AutoValidate.Disable><xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>屬性 可完全防止隱式驗證。</span><span class="sxs-lookup"><span data-stu-id="7f60c-153">Assigning <xref:System.Windows.Forms.AutoValidate.Disable> to the <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> property prevents implicit validation altogether.</span></span> <span data-ttu-id="7f60c-154">要驗證控件,必須使用顯式驗證。</span><span class="sxs-lookup"><span data-stu-id="7f60c-154">To validate your controls, you will have to use explicit validation.</span></span>  
  
#### <a name="explicit-validation"></a><span data-ttu-id="7f60c-155">明確驗證</span><span class="sxs-lookup"><span data-stu-id="7f60c-155">Explicit Validation</span></span>  
 <span data-ttu-id="7f60c-156">顯式驗證方法一次驗證數據。</span><span class="sxs-lookup"><span data-stu-id="7f60c-156">The explicit validation approach validates data at one time.</span></span> <span data-ttu-id="7f60c-157">您可以驗證數據以回應使用者操作,例如按一下「儲存」按鈕或「下一步」連結。</span><span class="sxs-lookup"><span data-stu-id="7f60c-157">You can validate the data in response to a user action, such as clicking a Save button or a Next link.</span></span> <span data-ttu-id="7f60c-158">發生使用者操作時,可以通過以下方式之一觸發顯式驗證:</span><span class="sxs-lookup"><span data-stu-id="7f60c-158">When the user action occurs, you can trigger explicit validation in one of the following ways:</span></span>  
  
- <span data-ttu-id="7f60c-159">調用<xref:System.Windows.Forms.ContainerControl.Validate%2A>以驗證最後一個控件失去焦點。</span><span class="sxs-lookup"><span data-stu-id="7f60c-159">Call <xref:System.Windows.Forms.ContainerControl.Validate%2A> to validate the last control to have lost focus.</span></span>  
  
- <span data-ttu-id="7f60c-160">呼叫<xref:System.Windows.Forms.ContainerControl.ValidateChildren%2A>以驗證表單或容器控制件中的所有子控制件。</span><span class="sxs-lookup"><span data-stu-id="7f60c-160">Call <xref:System.Windows.Forms.ContainerControl.ValidateChildren%2A> to validate all child controls in a form or container control.</span></span>  
  
- <span data-ttu-id="7f60c-161">調用自定義方法以手動驗證控制項中的數據。</span><span class="sxs-lookup"><span data-stu-id="7f60c-161">Call a custom method to validate the data in the controls manually.</span></span>  
  
#### <a name="default-implicit-validation-behavior-for-windows-forms-controls"></a><span data-ttu-id="7f60c-162">Windows 表單控制項的預設隱式驗證行為</span><span class="sxs-lookup"><span data-stu-id="7f60c-162">Default Implicit Validation Behavior for Windows Forms Controls</span></span>  
 <span data-ttu-id="7f60c-163">不同的 Windows 窗體控<xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>件對其 屬性具有不同的預設值。</span><span class="sxs-lookup"><span data-stu-id="7f60c-163">Different Windows Forms controls have different defaults for their <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> property.</span></span> <span data-ttu-id="7f60c-164">下表顯示了最常見的控制件及其預設值。</span><span class="sxs-lookup"><span data-stu-id="7f60c-164">The following table shows the most common controls and their defaults.</span></span>  
  
|<span data-ttu-id="7f60c-165">控制</span><span class="sxs-lookup"><span data-stu-id="7f60c-165">Control</span></span>|<span data-ttu-id="7f60c-166">預設驗證行為</span><span class="sxs-lookup"><span data-stu-id="7f60c-166">Default Validation Behavior</span></span>|  
|-------------|---------------------------------|  
|<xref:System.Windows.Forms.ContainerControl>|<xref:System.Windows.Forms.AutoValidate.Inherit>|  
|<xref:System.Windows.Forms.Form>|<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>|  
|<xref:System.Windows.Forms.PropertyGrid>|<span data-ttu-id="7f60c-167">未在視覺工作室中公開的屬性</span><span class="sxs-lookup"><span data-stu-id="7f60c-167">Property not exposed in Visual Studio</span></span>|  
|<xref:System.Windows.Forms.ToolStripContainer>|<span data-ttu-id="7f60c-168">未在視覺工作室中公開的屬性</span><span class="sxs-lookup"><span data-stu-id="7f60c-168">Property not exposed in Visual Studio</span></span>|  
|<xref:System.Windows.Forms.SplitContainer>|<xref:System.Windows.Forms.AutoValidate.Inherit>|  
|<xref:System.Windows.Forms.UserControl>|<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>|  
  
## <a name="closing-the-form-and-overriding-validation"></a><span data-ttu-id="7f60c-169">關閉表單與覆寫驗證</span><span class="sxs-lookup"><span data-stu-id="7f60c-169">Closing the Form and Overriding Validation</span></span>  
 <span data-ttu-id="7f60c-170">當控件由於它包含的資料無效而保持焦點時,不可能以通常的方式之一關閉父窗體:</span><span class="sxs-lookup"><span data-stu-id="7f60c-170">When a control maintains focus because the data it contains is invalid, it is impossible to close the parent form in one of the usual ways:</span></span>  
  
- <span data-ttu-id="7f60c-171">通過按下 **「關閉**」按鈕。</span><span class="sxs-lookup"><span data-stu-id="7f60c-171">By clicking the **Close** button.</span></span>  
  
- <span data-ttu-id="7f60c-172">通過在 **「系統**」功能表中選擇 **「關閉**」。</span><span class="sxs-lookup"><span data-stu-id="7f60c-172">By selecting **Close** in the **System** menu.</span></span>  
  
- <span data-ttu-id="7f60c-173">通過以程式設計<xref:System.Windows.Forms.Form.Close%2A>方式調用方法。</span><span class="sxs-lookup"><span data-stu-id="7f60c-173">By calling the <xref:System.Windows.Forms.Form.Close%2A> method programmatically.</span></span>  
  
 <span data-ttu-id="7f60c-174">但是,在某些情況下,您可能希望讓使用者關閉窗體,而不管控件中的值是否有效。</span><span class="sxs-lookup"><span data-stu-id="7f60c-174">However, in some cases, you might want to let the user close the form regardless of whether the values in the controls are valid.</span></span> <span data-ttu-id="7f60c-175">您可以透過為表<xref:System.Windows.Forms.Form.FormClosing>單的事件建立處理程式來覆蓋驗證並關閉仍包含無效資料的表單。</span><span class="sxs-lookup"><span data-stu-id="7f60c-175">You can override validation and close a form that still contains invalid data by creating a handler for the form's <xref:System.Windows.Forms.Form.FormClosing> event.</span></span> <span data-ttu-id="7f60c-176">在這種情況下,將<xref:System.ComponentModel.CancelEventArgs.Cancel%2A>屬性設定`false`為 。</span><span class="sxs-lookup"><span data-stu-id="7f60c-176">In the event, set the <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> property to `false`.</span></span> <span data-ttu-id="7f60c-177">這將強制窗體關閉。</span><span class="sxs-lookup"><span data-stu-id="7f60c-177">This forces the form to close.</span></span> <span data-ttu-id="7f60c-178">如需詳細資訊和範例，請參閱 <xref:System.Windows.Forms.Form.FormClosing?displayProperty=nameWithType>。</span><span class="sxs-lookup"><span data-stu-id="7f60c-178">For more information and an example, see <xref:System.Windows.Forms.Form.FormClosing?displayProperty=nameWithType>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="7f60c-179">如果強制以這種方式關閉窗體,則窗體控件中尚未保存的任何數據都將丟失。</span><span class="sxs-lookup"><span data-stu-id="7f60c-179">If you force the form to close in this manner, any data in the form's controls that has not already been saved is lost.</span></span> <span data-ttu-id="7f60c-180">此外,模態窗體在關閉控制項時不會驗證它們的內容。</span><span class="sxs-lookup"><span data-stu-id="7f60c-180">In addition, modal forms do not validate the contents of controls when they are closed.</span></span> <span data-ttu-id="7f60c-181">您仍可以使用控制項驗證將焦點鎖定到控制項,但不必擔心與關閉窗體相關的行為。</span><span class="sxs-lookup"><span data-stu-id="7f60c-181">You can still use control validation to lock focus to a control, but you do not have to be concerned about the behavior associated with closing the form.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7f60c-182">另請參閱</span><span class="sxs-lookup"><span data-stu-id="7f60c-182">See also</span></span>

- <xref:System.Windows.Forms.Control.Validating?displayProperty=nameWithType>
- <xref:System.Windows.Forms.Form.FormClosing?displayProperty=nameWithType>
- <xref:System.Windows.Forms.FormClosingEventArgs?displayProperty=nameWithType>
- [<span data-ttu-id="7f60c-183">MaskedTextBox 控制項</span><span class="sxs-lookup"><span data-stu-id="7f60c-183">MaskedTextBox Control</span></span>](./controls/maskedtextbox-control-windows-forms.md)
- [<span data-ttu-id="7f60c-184">規則運算式範例</span><span class="sxs-lookup"><span data-stu-id="7f60c-184">Regular Expression Examples</span></span>](../../standard/base-types/regular-expression-example-scanning-for-hrefs.md)
