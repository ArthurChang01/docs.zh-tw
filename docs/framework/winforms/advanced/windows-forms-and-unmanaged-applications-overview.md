---
title: Windows Form 和 Unmanaged 應用程式概觀
ms.date: 03/30/2017
helpviewer_keywords:
- COM [Windows Forms]
- Windows Forms, unmanaged
- COM interop
- ActiveX controls [Windows Forms], about ActiveX controls
- Windows Forms, interop
ms.assetid: 0a26d99d-8135-4895-8760-c9a2b5f67f14
ms.openlocfilehash: b2ea15703b09cd722f5c7fd01f8112482f3c04f2
ms.sourcegitcommit: 2eceb05f1a5bb261291a1f6a91c5153727ac1c19
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/04/2018
ms.locfileid: "43501871"
---
# <a name="windows-forms-and-unmanaged-applications-overview"></a><span data-ttu-id="02a1a-102">Windows Form 和 Unmanaged 應用程式概觀</span><span class="sxs-lookup"><span data-stu-id="02a1a-102">Windows Forms and Unmanaged Applications Overview</span></span>
<span data-ttu-id="02a1a-103">伴隨著某些注意事項，Windows Form 應用程式和控制項能與 Unmanaged 應用程式交互操作。</span><span class="sxs-lookup"><span data-stu-id="02a1a-103">Windows Forms applications and controls can interoperate with unmanaged applications, with some caveats.</span></span> <span data-ttu-id="02a1a-104">下列各節描述 Windows Form 應用程式和控制項支援及不支援的案例和組態。</span><span class="sxs-lookup"><span data-stu-id="02a1a-104">The following sections describe the scenarios and configurations that Windows Forms applications and controls support and those that they do not support.</span></span>  
  
## <a name="windows-forms-controls-and-activex-applications"></a><span data-ttu-id="02a1a-105">Windows Form 控制項和 ActiveX 應用程式</span><span class="sxs-lookup"><span data-stu-id="02a1a-105">Windows Forms Controls and ActiveX Applications</span></span>  
 <span data-ttu-id="02a1a-106">在設計來裝載 ActiveX 控制項的應用程式中不支援 Windows Form 控制項，但 Microsoft Internet Explorer 和 Microsoft Foundation Classes (MFC) 例外。</span><span class="sxs-lookup"><span data-stu-id="02a1a-106">With the exception of Microsoft Internet Explorer and Microsoft Foundation Classes (MFC), Windows Forms controls are not supported in applications designed to host ActiveX controls.</span></span> <span data-ttu-id="02a1a-107">其他能夠裝載 ActiveX 控制項的應用程式和開發工具，包含早於 Visual Studio .NET 2003 的 Visual Studio 版本之 ActiveX 測試容器，並不支援裝載 Windows Form 控制項。</span><span class="sxs-lookup"><span data-stu-id="02a1a-107">Other applications and development tools that are capable of hosting ActiveX controls, including the ActiveX test containers from versions of Visual Studio that are earlier than Visual Studio .NET 2003, are not supported hosts for Windows Forms controls.</span></span>  
  
 <span data-ttu-id="02a1a-108">這些條件約束也適用於透過元件物件模型 COM Interop 使用 Windows Form 控制項時。</span><span class="sxs-lookup"><span data-stu-id="02a1a-108">These constraints also apply to the use of Windows Forms controls through Component Object Model COM interop.</span></span> <span data-ttu-id="02a1a-109">只在 Internet Explorer 中支援透過 COM 可呼叫包裝函式 (CCW) 使用 Windows Form 控制項。</span><span class="sxs-lookup"><span data-stu-id="02a1a-109">The use of a Windows Forms control through a COM callable wrapper (CCW) is supported only in Internet Explorer.</span></span> <span data-ttu-id="02a1a-110">如需 COM Interop的詳細資訊，請參閱</span><span class="sxs-lookup"><span data-stu-id="02a1a-110">For more information about COM interop, see</span></span>  
  
 <span data-ttu-id="02a1a-111">[COM Interop](../../../visual-basic/programming-guide/com-interop/index.md).</span><span class="sxs-lookup"><span data-stu-id="02a1a-111">[COM Interop](../../../visual-basic/programming-guide/com-interop/index.md).</span></span>  
  
 <span data-ttu-id="02a1a-112">下表顯示對於 Windows Form 控制項可用的 ActiveX 裝載支援。</span><span class="sxs-lookup"><span data-stu-id="02a1a-112">The following table shows the available ActiveX hosting support for Windows Forms controls.</span></span>  
  
|<span data-ttu-id="02a1a-113">Windows Form 版本</span><span class="sxs-lookup"><span data-stu-id="02a1a-113">Windows Forms version</span></span>|<span data-ttu-id="02a1a-114">支援</span><span class="sxs-lookup"><span data-stu-id="02a1a-114">Support</span></span>|  
|---------------------------|-------------|  
|<span data-ttu-id="02a1a-115">.NET Framework 1.0 版</span><span class="sxs-lookup"><span data-stu-id="02a1a-115">.NET Framework version 1.0</span></span>|<span data-ttu-id="02a1a-116">Internet Explorer 5.01 和更新版本</span><span class="sxs-lookup"><span data-stu-id="02a1a-116">Internet Explorer 5.01 and later versions</span></span>|  
|<span data-ttu-id="02a1a-117">.NET Framework 1.1 和更新版本</span><span class="sxs-lookup"><span data-stu-id="02a1a-117">.NET Framework version 1.1 and later</span></span>|<span data-ttu-id="02a1a-118">Internet Explorer 5.01 和更新版本</span><span class="sxs-lookup"><span data-stu-id="02a1a-118">Internet Explorer 5.01 and later versions</span></span><br /><br /> <span data-ttu-id="02a1a-119">Microsoft Foundation Classes (MFC) 7.0 和更新版本</span><span class="sxs-lookup"><span data-stu-id="02a1a-119">Microsoft Foundation Classes (MFC) 7.0 and later</span></span>|  
  
## <a name="hosting-windows-forms-components-as-activex-controls"></a><span data-ttu-id="02a1a-120">裝載 Windows Form 元件做為 ActiveX 控制項</span><span class="sxs-lookup"><span data-stu-id="02a1a-120">Hosting Windows Forms components as ActiveX controls</span></span>  
 <span data-ttu-id="02a1a-121">在 .NET Framework 1.1，已擴充包含 MFC 7.0 和更新版本的支援。</span><span class="sxs-lookup"><span data-stu-id="02a1a-121">In the .NET Framework 1.1, support was extended to include MFC 7.0 and later versions.</span></span> <span data-ttu-id="02a1a-122">這項支援包含任何與 MFC 7.0 和更新版本 ActiveX 控制項容器完全相容的容器。</span><span class="sxs-lookup"><span data-stu-id="02a1a-122">This support includes any container that is fully compatible with the MFC 7.0 and later ActiveX control container.</span></span>  
  
 <span data-ttu-id="02a1a-123">不過，這並不支援登錄 Windows Form 控制項為 ActiveX 控制項。</span><span class="sxs-lookup"><span data-stu-id="02a1a-123">However, registration of Windows Forms controls as ActiveX controls is not supported.</span></span> <span data-ttu-id="02a1a-124">此外，不支援呼叫 Windows Form 控制項的 `com.ms.win32.Ole32.CoCreateInstance` 方法。</span><span class="sxs-lookup"><span data-stu-id="02a1a-124">Also, calling the `com.ms.win32.Ole32.CoCreateInstance` method for Windows Forms controls is not supported.</span></span> <span data-ttu-id="02a1a-125">僅支援 Windows Form 控制項的 Managed 啟用。</span><span class="sxs-lookup"><span data-stu-id="02a1a-125">Only managed activation of Windows Forms controls is supported.</span></span> <span data-ttu-id="02a1a-126">一旦您建立 Windows Form 控制項，您就可以將它裝載於 MFC 應用程式中，如同 ActiveX 控制項。</span><span class="sxs-lookup"><span data-stu-id="02a1a-126">Once you create a Windows Forms control, you can host it in an MFC application just as with an ActiveX control.</span></span>  
  
 <span data-ttu-id="02a1a-127">若要在 Unmanaged 應用程式中使用 Windows Form 控制項，您必須使用 Unmanaged 的 CLR 裝載應用程式開發介面，或使用 C++ Interop 功能來裝載 CLR。</span><span class="sxs-lookup"><span data-stu-id="02a1a-127">To use Windows Forms controls in your unmanaged application, you must either host the CLR using the unmanaged CLR hosting APIs or use the C++ interop features.</span></span> <span data-ttu-id="02a1a-128">使用 C++ Interop 功能是建議的解決方案。</span><span class="sxs-lookup"><span data-stu-id="02a1a-128">Using the C++ interop features is the recommended solution.</span></span>  
  
## <a name="windows-forms-in-com-client-applications"></a><span data-ttu-id="02a1a-129">COM 用戶端應用程式中的 Windows Form</span><span class="sxs-lookup"><span data-stu-id="02a1a-129">Windows Forms in COM client applications</span></span>  
 <span data-ttu-id="02a1a-130">當您從 COM 用戶端應用程式中開啟 Windows Form，例如從 Visual Basic 6.0 應用程式或 MFC 應用程式中開啟，則表單可能會發生未預期的狀況。</span><span class="sxs-lookup"><span data-stu-id="02a1a-130">When you open a Windows Form from a COM client application, such as a Visual Basic 6.0 application or an MFC application, the form may behave unexpectedly.</span></span> <span data-ttu-id="02a1a-131">例如，當您按 TAB 鍵時，焦點不會從一個控制項變更到另一個控制項。</span><span class="sxs-lookup"><span data-stu-id="02a1a-131">For example, when you press the TAB key, the focus does not change from one control to another control.</span></span> <span data-ttu-id="02a1a-132">當焦點在命令按鈕的時候，當您按 ENTER 鍵，則不會引發按鈕的 <xref:System.Windows.Forms.Control.Click> 事件。</span><span class="sxs-lookup"><span data-stu-id="02a1a-132">When you press the ENTER key while a command button has focus, the button's <xref:System.Windows.Forms.Control.Click> event is not raised.</span></span> <span data-ttu-id="02a1a-133">您也可能會遇到按鍵或滑鼠活動未預期的行為。</span><span class="sxs-lookup"><span data-stu-id="02a1a-133">You may also experience unexpected behavior for keystrokes or mouse activity.</span></span>  
  
 <span data-ttu-id="02a1a-134">因為 Unmanaged 應用程式不會實作 Windows Form 正常運作所需的訊息迴圈支援，所以會發生這種行為。</span><span class="sxs-lookup"><span data-stu-id="02a1a-134">This behavior occurs because the unmanaged application does not implement the message loop support that Windows Forms requires to work correctly.</span></span> <span data-ttu-id="02a1a-135">COM 用戶端應用程式所提供的訊息迴圈本質上不同於 Windows Form 訊息迴圈。</span><span class="sxs-lookup"><span data-stu-id="02a1a-135">The message loop provided by the COM client application is fundamentally different from the Windows Forms message loop.</span></span>  
  
 <span data-ttu-id="02a1a-136">應用程式的訊息迴圈是一種內部程式迴圈，它從執行緒訊息佇列擷取訊息並轉譯，然後傳送到應用程式以進行處理。</span><span class="sxs-lookup"><span data-stu-id="02a1a-136">An application's message loop is an internal program loop that retrieves messages from a thread's message queue, translates them, and then sends them to the application to be handled.</span></span> <span data-ttu-id="02a1a-137">Windows Form 訊息迴圈不具有和舊版應用程式 (例如 Visual Basic 6.0 應用程式和 MFC 應用程式) 提供的訊息迴圈相同的架構。</span><span class="sxs-lookup"><span data-stu-id="02a1a-137">The message loop for a Windows Form does not have the same architecture as message loops that earlier applications, such as Visual Basic 6.0 applications and MFC applications, provide.</span></span> <span data-ttu-id="02a1a-138">張貼至訊息迴圈的視窗訊息可能以和 Windows Form 所預期的不同方式處理。</span><span class="sxs-lookup"><span data-stu-id="02a1a-138">The window messages that are posted to the message loop may be handled differently than the Windows Form expects.</span></span> <span data-ttu-id="02a1a-139">因此，可能會發生未預期的行為。</span><span class="sxs-lookup"><span data-stu-id="02a1a-139">Therefore, unexpected behavior may occur.</span></span> <span data-ttu-id="02a1a-140">某些按鍵組合可能無法運作，或是某些滑鼠活動可能無法運作，或者可能不會如預期般引發某些事件。</span><span class="sxs-lookup"><span data-stu-id="02a1a-140">Some keystroke combinations may not work, some mouse activity may not work, or some events may not be raised as expected.</span></span>  
  
## <a name="resolving-interoperability-issues"></a><span data-ttu-id="02a1a-141">解決互通性問題</span><span class="sxs-lookup"><span data-stu-id="02a1a-141">Resolving Interoperability Issues</span></span>  
 <span data-ttu-id="02a1a-142">藉由顯示使用 <xref:System.Windows.Forms.Application.Run%2A?displayProperty=nameWithType> 方法建立之 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 訊息迴圈上的表單，您可解決這些問題。</span><span class="sxs-lookup"><span data-stu-id="02a1a-142">You can resolve these problems by displaying the form on a [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] message loop, which is created by using the <xref:System.Windows.Forms.Application.Run%2A?displayProperty=nameWithType> method.</span></span>  
  
 <span data-ttu-id="02a1a-143">若要讓 Windows Form 在 COM 用戶端應用程式正確運作，您必須在 Windows Form 訊息迴圈上執行。</span><span class="sxs-lookup"><span data-stu-id="02a1a-143">To make a Windows Form work correctly from a COM client application, you must run it on a Windows Forms message loop.</span></span> <span data-ttu-id="02a1a-144">若要執行此工作，請使用下列的其中一個方法：</span><span class="sxs-lookup"><span data-stu-id="02a1a-144">To do this, use one of the following approaches:</span></span>  
  
-   <span data-ttu-id="02a1a-145">使用 <xref:System.Windows.Forms.Form.ShowDialog%2A?displayProperty=nameWithType> 方法，以顯示 Windows Form。</span><span class="sxs-lookup"><span data-stu-id="02a1a-145">Use the <xref:System.Windows.Forms.Form.ShowDialog%2A?displayProperty=nameWithType> method to display the Windows Form.</span></span> <span data-ttu-id="02a1a-146">如需詳細資訊，請參閱[如何：顯示 Windows Form 和 ShowDialog 方法以支援 COM Interop](../../../../docs/framework/winforms/advanced/com-interop-by-displaying-a-windows-form-shadow.md)。</span><span class="sxs-lookup"><span data-stu-id="02a1a-146">For more information, see [How to: Support COM Interop by Displaying a Windows Form with the ShowDialog Method](../../../../docs/framework/winforms/advanced/com-interop-by-displaying-a-windows-form-shadow.md).</span></span>  
  
-   <span data-ttu-id="02a1a-147">在新的執行緒上顯示每個 Windows Form。</span><span class="sxs-lookup"><span data-stu-id="02a1a-147">Display each Windows Form on a new thread.</span></span> <span data-ttu-id="02a1a-148">如需詳細資訊，請參閱[如何：在自己的執行緒上顯示每個 Windows Form 以支援 COM Interop](../../../../docs/framework/winforms/advanced/how-to-support-com-interop-by-displaying-each-windows-form-on-its-own-thread.md)。</span><span class="sxs-lookup"><span data-stu-id="02a1a-148">For more information, see [How to: Support COM Interop by Displaying Each Windows Form on Its Own Thread](../../../../docs/framework/winforms/advanced/how-to-support-com-interop-by-displaying-each-windows-form-on-its-own-thread.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="02a1a-149">另請參閱</span><span class="sxs-lookup"><span data-stu-id="02a1a-149">See Also</span></span>  
 [<span data-ttu-id="02a1a-150">Windows Forms 和 Unmanaged 應用程式</span><span class="sxs-lookup"><span data-stu-id="02a1a-150">Windows Forms and Unmanaged Applications</span></span>](../../../../docs/framework/winforms/advanced/windows-forms-and-unmanaged-applications.md)  
 [<span data-ttu-id="02a1a-151">COM Interop</span><span class="sxs-lookup"><span data-stu-id="02a1a-151">COM Interop</span></span>](../../../visual-basic/programming-guide/com-interop/index.md)  
 [<span data-ttu-id="02a1a-152">.NET Framework 應用程式中的 COM 互通性</span><span class="sxs-lookup"><span data-stu-id="02a1a-152">COM Interoperability in .NET Framework Applications</span></span>](~/docs/visual-basic/programming-guide/com-interop/com-interoperability-in-net-framework-applications.md)  
 [<span data-ttu-id="02a1a-153">COM 互通性範例</span><span class="sxs-lookup"><span data-stu-id="02a1a-153">COM Interoperability Samples</span></span>](https://msdn.microsoft.com/library/09c38567-6380-4d70-848a-e896a4ca05f4)  
 [<span data-ttu-id="02a1a-154">Aximp.exe (Windows Forms ActiveX 控制項匯入工具)</span><span class="sxs-lookup"><span data-stu-id="02a1a-154">Aximp.exe (Windows Forms ActiveX Control Importer)</span></span>](../../../../docs/framework/tools/aximp-exe-windows-forms-activex-control-importer.md)  
 [<span data-ttu-id="02a1a-155">將 .NET Framework 元件公開給 COM</span><span class="sxs-lookup"><span data-stu-id="02a1a-155">Exposing .NET Framework Components to COM</span></span>](../../../../docs/framework/interop/exposing-dotnet-components-to-com.md)  
 [<span data-ttu-id="02a1a-156">封裝 COM 的組件</span><span class="sxs-lookup"><span data-stu-id="02a1a-156">Packaging an Assembly for COM</span></span>](../../../../docs/framework/interop/packaging-an-assembly-for-com.md)  
 [<span data-ttu-id="02a1a-157">向 COM 註冊組件</span><span class="sxs-lookup"><span data-stu-id="02a1a-157">Registering Assemblies with COM</span></span>](../../../../docs/framework/interop/registering-assemblies-with-com.md)  
 [<span data-ttu-id="02a1a-158">操作說明：顯示 Windows Forms 和 ShowDialog 方法以支援 COM Interop</span><span class="sxs-lookup"><span data-stu-id="02a1a-158">How to: Support COM Interop by Displaying a Windows Form with the ShowDialog Method</span></span>](../../../../docs/framework/winforms/advanced/com-interop-by-displaying-a-windows-form-shadow.md)  
 [<span data-ttu-id="02a1a-159">操作說明：在自己的執行緒上顯示每個 Windows Form 以支援 COM Interop</span><span class="sxs-lookup"><span data-stu-id="02a1a-159">How to: Support COM Interop by Displaying Each Windows Form on Its Own Thread</span></span>](../../../../docs/framework/winforms/advanced/how-to-support-com-interop-by-displaying-each-windows-form-on-its-own-thread.md)
