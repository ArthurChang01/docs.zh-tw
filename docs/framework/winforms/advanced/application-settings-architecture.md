---
title: 應用程式設定架構
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- application settings [Windows Forms], architecture
ms.assetid: c8eb2ad0-fac6-4ea2-9140-675a4a44d562
ms.openlocfilehash: c2a62b61cb7b31c978a84a3d3f41c24f9fafb84d
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/18/2019
ms.locfileid: "59312562"
---
# <a name="application-settings-architecture"></a><span data-ttu-id="295e8-102">應用程式設定架構</span><span class="sxs-lookup"><span data-stu-id="295e8-102">Application Settings Architecture</span></span>
<span data-ttu-id="295e8-103">本主題描述應用程式設定的運作方式，並且瀏覽架構的進階功能 (例如群組設定和設定索引鍵)。</span><span class="sxs-lookup"><span data-stu-id="295e8-103">This topic describes how the Application Settings architecture works, and explores advanced features of the architecture, such as grouped settings and settings keys.</span></span>  
  
 <span data-ttu-id="295e8-104">應用程式設定架構支援以應用程式或使用者範圍定義強型別設定，也支援在應用程式工作階段之間保存設定。</span><span class="sxs-lookup"><span data-stu-id="295e8-104">The application settings architecture supports defining strongly typed settings with either application or user scope, and persisting the settings between application sessions.</span></span> <span data-ttu-id="295e8-105">此架構提供預設持續性引擎，可將設定儲存至本機檔案系統和從中載入設定。</span><span class="sxs-lookup"><span data-stu-id="295e8-105">The architecture provides a default persistence engine for saving settings to and loading them from the local file system.</span></span> <span data-ttu-id="295e8-106">此架構也定義介面來提供自訂持續性引擎。</span><span class="sxs-lookup"><span data-stu-id="295e8-106">The architecture also defines interfaces for supplying a custom persistence engine.</span></span>  
  
 <span data-ttu-id="295e8-107">提供的介面可讓自訂元件裝載於應用程式時，保存自己的設定。</span><span class="sxs-lookup"><span data-stu-id="295e8-107">Interfaces are provided that enable custom components to persist their own settings when they are hosted in an application.</span></span> <span data-ttu-id="295e8-108">元件可以使用設定索引鍵，區隔多個元件執行個體的設定。</span><span class="sxs-lookup"><span data-stu-id="295e8-108">By using settings keys, components can keep settings for multiple instances of the component separate.</span></span>  
  
## <a name="defining-settings"></a><span data-ttu-id="295e8-109">定義設定</span><span class="sxs-lookup"><span data-stu-id="295e8-109">Defining Settings</span></span>  
 <span data-ttu-id="295e8-110">應用程式設定架構同時用於 [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] 和 Windows Forms，且包含數個在這兩種環境之間共用的基底類別。</span><span class="sxs-lookup"><span data-stu-id="295e8-110">The application settings architecture is used within both [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] and Windows Forms, and it contains a number of base classes that are shared across both environments.</span></span> <span data-ttu-id="295e8-111">最重要的是<xref:System.Configuration.SettingsBase>，其提供存取集合，透過設定，並提供低階方法來載入和儲存設定。</span><span class="sxs-lookup"><span data-stu-id="295e8-111">The most important is <xref:System.Configuration.SettingsBase>, which provides access to settings through a collection, and provides low-level methods for loading and saving settings.</span></span> <span data-ttu-id="295e8-112">每個環境會實作自己的類別衍生自<xref:System.Configuration.SettingsBase>該環境提供額外的設定功能。</span><span class="sxs-lookup"><span data-stu-id="295e8-112">Each environment implements its own class derived from <xref:System.Configuration.SettingsBase> to provide additional settings functionality for that environment.</span></span> <span data-ttu-id="295e8-113">在 Windows Form 為基礎的應用程式，所有的應用程式設定必須定義衍生自的類別上<xref:System.Configuration.ApplicationSettingsBase>類別的基底類別新增下列功能：</span><span class="sxs-lookup"><span data-stu-id="295e8-113">In a Windows Forms-based application, all application settings must be defined on a class derived from the <xref:System.Configuration.ApplicationSettingsBase> class, which adds the following functionality to the base class:</span></span>  
  
-   <span data-ttu-id="295e8-114">較高層級的載入和儲存作業</span><span class="sxs-lookup"><span data-stu-id="295e8-114">Higher-level loading and saving operations</span></span>  
  
-   <span data-ttu-id="295e8-115">支援使用者範圍的設定</span><span class="sxs-lookup"><span data-stu-id="295e8-115">Support for user-scoped settings</span></span>  
  
-   <span data-ttu-id="295e8-116">將使用者的設定還原為預先定義的預設值</span><span class="sxs-lookup"><span data-stu-id="295e8-116">Reverting a user's settings to the predefined defaults</span></span>  
  
-   <span data-ttu-id="295e8-117">從舊版應用程式升級設定</span><span class="sxs-lookup"><span data-stu-id="295e8-117">Upgrading settings from a previous application version</span></span>  
  
-   <span data-ttu-id="295e8-118">在設定變更之前或儲存之前驗證設定</span><span class="sxs-lookup"><span data-stu-id="295e8-118">Validating settings, either before they are changed or before they are saved</span></span>  
  
 <span data-ttu-id="295e8-119">可以使用多個定義內的屬性所設定的描述<xref:System.Configuration>命名空間; 這些所述[應用程式設定屬性](application-settings-attributes.md)。</span><span class="sxs-lookup"><span data-stu-id="295e8-119">The settings can be described using a number of attributes defined within the <xref:System.Configuration> namespace; these are described in [Application Settings Attributes](application-settings-attributes.md).</span></span> <span data-ttu-id="295e8-120">當您定義一項設定時，您就必須將它套用以<xref:System.Configuration.ApplicationScopedSettingAttribute>或<xref:System.Configuration.UserScopedSettingAttribute>，其中描述此設定套用至整個應用程式，或只用於目前的使用者。</span><span class="sxs-lookup"><span data-stu-id="295e8-120">When you define a setting, you must apply it with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>, which describes whether the setting applies to the entire application or just to the current user.</span></span>  
  
 <span data-ttu-id="295e8-121">下列程式碼範例定義具有單一設定的自訂設定類別：`BackgroundColor`。</span><span class="sxs-lookup"><span data-stu-id="295e8-121">The following code example defines a custom settings class with a single setting, `BackgroundColor`.</span></span>  
  
 [!code-csharp[ApplicationSettings.Create#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Create/CS/MyAppSettings.cs#1)]
 [!code-vb[ApplicationSettings.Create#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Create/VB/MyAppSettings.vb#1)]  
  
## <a name="settings-persistence"></a><span data-ttu-id="295e8-122">設定持續性</span><span class="sxs-lookup"><span data-stu-id="295e8-122">Settings Persistence</span></span>  
 <span data-ttu-id="295e8-123"><xref:System.Configuration.ApplicationSettingsBase>類別不會自行保存或載入設定，這項工作由設定提供者類別衍生自<xref:System.Configuration.SettingsProvider>。</span><span class="sxs-lookup"><span data-stu-id="295e8-123">The <xref:System.Configuration.ApplicationSettingsBase> class does not itself persist or load settings; this job falls to the settings provider, a class that derives from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="295e8-124">如果在衍生類別的<xref:System.Configuration.ApplicationSettingsBase>未指定設定提供者透過<xref:System.Configuration.SettingsProviderAttribute>，則預設的提供者， <xref:System.Configuration.LocalFileSettingsProvider>，會使用。</span><span class="sxs-lookup"><span data-stu-id="295e8-124">If a derived class of <xref:System.Configuration.ApplicationSettingsBase> does not specify a settings provider through the <xref:System.Configuration.SettingsProviderAttribute>, then the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span>  
  
 <span data-ttu-id="295e8-125">最初隨著 [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 一起發行的組態系統，支援透過本機電腦的 machine.config 檔案，或在您隨著應用程式部署的 `app.`exe.config 檔案內，提供靜態應用程式組態資料。</span><span class="sxs-lookup"><span data-stu-id="295e8-125">The configuration system that was originally released with the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] supports providing static application configuration data through either the local computer's machine.config file or within an `app.`exe.config file that you deploy with your application.</span></span> <span data-ttu-id="295e8-126"><xref:System.Configuration.LocalFileSettingsProvider>類別以下列方式展開此原生支援：</span><span class="sxs-lookup"><span data-stu-id="295e8-126">The <xref:System.Configuration.LocalFileSettingsProvider> class expands this native support in the following ways:</span></span>  
  
-   <span data-ttu-id="295e8-127">應用程式範圍的設定可以儲存在 machine.config 或`app.`exe.config 檔案中。</span><span class="sxs-lookup"><span data-stu-id="295e8-127">Application-scoped settings can be stored in either the machine.config or `app.`exe.config files.</span></span> <span data-ttu-id="295e8-128">Machine.config 永遠唯讀，但 `app`.exe.config 基於安全性考量，對大部分應用程式而言限制為唯讀。</span><span class="sxs-lookup"><span data-stu-id="295e8-128">Machine.config is always read-only, while `app`.exe.config is restricted by security considerations to read-only for most applications.</span></span>  
  
-   <span data-ttu-id="295e8-129">使用者範圍的設定可以儲存在 `app` exe.config 檔案中，在此情況下視為靜態預設值。</span><span class="sxs-lookup"><span data-stu-id="295e8-129">User-scoped settings can be stored in `app`.exe.config files, in which case they are treated as static defaults.</span></span>  
  
-   <span data-ttu-id="295e8-130">非預設使用者範圍的設定儲存在新檔案 *user*config 中，其中 *user* 是目前執行應用程式之人員的使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="295e8-130">Non-default user-scoped settings are stored in a new file, *user*.config, where *user* is the user name of the person currently executing the application.</span></span> <span data-ttu-id="295e8-131">您可以指定的使用者範圍設定的預設值<xref:System.Configuration.DefaultSettingValueAttribute>。</span><span class="sxs-lookup"><span data-stu-id="295e8-131">You can specify a default for a user-scoped setting with <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="295e8-132">因為使用者範圍的設定通常會在應用程式執行期間變更，所以 `user`.config 永遠是可讀寫。</span><span class="sxs-lookup"><span data-stu-id="295e8-132">Because user-scoped settings often change during application execution, `user`.config is always read/write.</span></span>  
  
 <span data-ttu-id="295e8-133">這三個組態檔全部以 XML 格式儲存設定。</span><span class="sxs-lookup"><span data-stu-id="295e8-133">All three configuration files store settings in XML format.</span></span> <span data-ttu-id="295e8-134">應用程式範圍設定的最上層 XML 元素是 `<appSettings>`，而 `<userSettings>` 用於使用者範圍的設定。</span><span class="sxs-lookup"><span data-stu-id="295e8-134">The top-level XML element for application-scoped settings is `<appSettings>`, while `<userSettings>` is used for user-scoped settings.</span></span> <span data-ttu-id="295e8-135">含有應用程式範圍的設定及使用者範圍設定預設值的 `app`.exe.config 檔案如下︰</span><span class="sxs-lookup"><span data-stu-id="295e8-135">An `app`.exe.config file which contains both application-scoped settings and defaults for user-scoped settings would look like this:</span></span>  
  
```xml  
<?xml version="1.0" encoding="utf-8" ?>  
<configuration>  
    <configSections>  
        <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >  
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />  
        </sectionGroup>  
        <sectionGroup name="userSettings" type="System.Configuration.UserSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >  
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" allowExeDefinition="MachineToLocalUser" />  
        </sectionGroup>  
    </configSections>  
    <applicationSettings>  
        <WindowsApplication1.Properties.Settings>  
            <setting name="Cursor" serializeAs="String">  
                <value>Default</value>  
            </setting>  
            <setting name="DoubleBuffering" serializeAs="String">  
                <value>False</value>  
            </setting>  
        </WindowsApplication1.Properties.Settings>  
    </applicationSettings>  
    <userSettings>  
        <WindowsApplication1.Properties.Settings>  
            <setting name="FormTitle" serializeAs="String">  
                <value>Form1</value>  
            </setting>  
            <setting name="FormSize" serializeAs="String">  
                <value>595, 536</value>  
            </setting>  
        </WindowsApplication1.Properties.Settings>  
    </userSettings>  
</configuration>  
```  
  
 <span data-ttu-id="295e8-136">如需組態檔的應用程式設定區段中的元素定義，請參閱[應用程式設定結構描述](../../configure-apps/file-schema/application-settings-schema.md)。</span><span class="sxs-lookup"><span data-stu-id="295e8-136">For a definition of the elements within the application settings section of a configuration file, see [Application Settings Schema](../../configure-apps/file-schema/application-settings-schema.md).</span></span>  
  
### <a name="settings-bindings"></a><span data-ttu-id="295e8-137">設定繫結關係</span><span class="sxs-lookup"><span data-stu-id="295e8-137">Settings Bindings</span></span>  
 <span data-ttu-id="295e8-138">應用程式設定使用 Windows Forms 資料繫結架構，提供設定物件和元件之間設定更新的雙向通訊。</span><span class="sxs-lookup"><span data-stu-id="295e8-138">Application settings uses the Windows Forms data binding architecture to provide two-way communication of settings updates between the settings object and components.</span></span> <span data-ttu-id="295e8-139">如果您使用 Visual Studio 建立應用程式設定，並將它們指派給元件的屬性，則會自動產生這些繫結關係。</span><span class="sxs-lookup"><span data-stu-id="295e8-139">If you use Visual Studio to create application settings and assign them to component properties, these bindings are generated automatically.</span></span>  
  
 <span data-ttu-id="295e8-140">您可以只有繫結應用程式設定支援的元件<xref:System.Windows.Forms.IBindableComponent>介面。</span><span class="sxs-lookup"><span data-stu-id="295e8-140">You can only bind an application setting to a component that supports the <xref:System.Windows.Forms.IBindableComponent> interface.</span></span> <span data-ttu-id="295e8-141">此外，元件必須實作變更事件的特定繫結屬性，或應用程式設定知道屬性已變更透過<xref:System.ComponentModel.INotifyPropertyChanged>介面。</span><span class="sxs-lookup"><span data-stu-id="295e8-141">Also, the component must implement a change event for a specific bound property, or notify application settings that the property has changed through the <xref:System.ComponentModel.INotifyPropertyChanged> interface.</span></span> <span data-ttu-id="295e8-142">如果元件未實作<xref:System.Windows.Forms.IBindableComponent>和您要透過 Visual Studio 的繫結、 繫結的屬性會設定第一次，但不是會更新。</span><span class="sxs-lookup"><span data-stu-id="295e8-142">If the component does not implement <xref:System.Windows.Forms.IBindableComponent> and you are binding through Visual Studio, the bound properties will be set the first time, but will not update.</span></span> <span data-ttu-id="295e8-143">如果元件實作<xref:System.Windows.Forms.IBindableComponent>但不是支援屬性變更通知，則繫結將不會更新設定檔中的屬性變更時。</span><span class="sxs-lookup"><span data-stu-id="295e8-143">If the component implements <xref:System.Windows.Forms.IBindableComponent> but does not support property change notifications, the binding will not update in the settings file when the property is changed.</span></span>  
  
 <span data-ttu-id="295e8-144">某些 Windows Form 元件，例如<xref:System.Windows.Forms.ToolStripItem>，不支援設定繫結。</span><span class="sxs-lookup"><span data-stu-id="295e8-144">Some Windows Forms components, such as <xref:System.Windows.Forms.ToolStripItem>, do not support settings bindings.</span></span>  
  
### <a name="settings-serialization"></a><span data-ttu-id="295e8-145">設定序列化</span><span class="sxs-lookup"><span data-stu-id="295e8-145">Settings Serialization</span></span>  
 <span data-ttu-id="295e8-146">當<xref:System.Configuration.LocalFileSettingsProvider>必須將設定儲存至磁碟，它會執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="295e8-146">When <xref:System.Configuration.LocalFileSettingsProvider> must save settings to disk, it performs the following actions:</span></span>  
  
1. <span data-ttu-id="295e8-147">使用反映來檢查的所有屬性上定義您<xref:System.Configuration.ApplicationSettingsBase>衍生類別中，尋找與所套用<xref:System.Configuration.ApplicationScopedSettingAttribute>或<xref:System.Configuration.UserScopedSettingAttribute>。</span><span class="sxs-lookup"><span data-stu-id="295e8-147">Uses reflection to examine all of the properties defined on your <xref:System.Configuration.ApplicationSettingsBase> derived class, finding those that are applied with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>.</span></span>  
  
2. <span data-ttu-id="295e8-148">將屬性序列化至磁碟。</span><span class="sxs-lookup"><span data-stu-id="295e8-148">Serializes the property to disk.</span></span> <span data-ttu-id="295e8-149">它會先嘗試呼叫<xref:System.ComponentModel.TypeConverter.ConvertToString%2A>或是<xref:System.ComponentModel.TypeConverter.ConvertFromString%2A>上的相關聯的型別<xref:System.ComponentModel.TypeConverter>。</span><span class="sxs-lookup"><span data-stu-id="295e8-149">It first attempts to call the <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> or <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> on the type's associated <xref:System.ComponentModel.TypeConverter>.</span></span> <span data-ttu-id="295e8-150">如果不成功，則改用 XML 序列化。</span><span class="sxs-lookup"><span data-stu-id="295e8-150">If this does not succeed, it uses XML serialization instead.</span></span>  
  
3. <span data-ttu-id="295e8-151">根據設定的屬性，判斷哪些設定在哪些檔案中。</span><span class="sxs-lookup"><span data-stu-id="295e8-151">Determines which settings go in which files, based on the setting's attribute.</span></span>  
  
 <span data-ttu-id="295e8-152">如果您實作您自己的設定類別，您可以使用<xref:System.Configuration.SettingsSerializeAsAttribute>將設定標示為針對二進位或自訂序列化使用<xref:System.Configuration.SettingsSerializeAs>列舉型別。</span><span class="sxs-lookup"><span data-stu-id="295e8-152">If you implement your own settings class, you can use the <xref:System.Configuration.SettingsSerializeAsAttribute> to mark a setting for either binary or custom serialization using the <xref:System.Configuration.SettingsSerializeAs> enumeration.</span></span> <span data-ttu-id="295e8-153">如需有關如何在程式碼中建立您自己的設定類別的詳細資訊，請參閱[How to:建立應用程式設定](how-to-create-application-settings.md)。</span><span class="sxs-lookup"><span data-stu-id="295e8-153">For more information on creating your own settings class in code, see [How to: Create Application Settings](how-to-create-application-settings.md).</span></span>  
  
### <a name="settings-file-locations"></a><span data-ttu-id="295e8-154">設定檔案位置</span><span class="sxs-lookup"><span data-stu-id="295e8-154">Settings File Locations</span></span>  
 <span data-ttu-id="295e8-155">根據應用程式的安裝方式，`app`.exe.config 和 *user*.config 檔案的位置會有所不同。</span><span class="sxs-lookup"><span data-stu-id="295e8-155">The location of the `app`.exe.config and *user*.config files will differ based on how the application is installed.</span></span> <span data-ttu-id="295e8-156">Windows Forms 應用程式複製到本機電腦，如`app`.exe.config 所在相同的目錄，做為基底目錄的應用程式的主要可執行檔，並*使用者*.config 位於所指定的位置<xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType>屬性。</span><span class="sxs-lookup"><span data-stu-id="295e8-156">For a Windows Forms-based application copied onto the local computer, `app`.exe.config will reside in the same directory as the base directory of the application's main executable file, and *user*.config will reside in the location specified by the <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="295e8-157">對於透過 [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] 安裝的應用程式，這兩個檔案都位於 %InstallRoot%\Documents and Settings\\*username*\Local Settings 下的 [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] 資料目錄中。</span><span class="sxs-lookup"><span data-stu-id="295e8-157">For an application installed by means of [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)], both of these files will reside in the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] Data Directory underneath %InstallRoot%\Documents and Settings\\*username*\Local Settings.</span></span>  
  
 <span data-ttu-id="295e8-158">如果使用者啟用漫遊設定檔，這些檔案的儲存位置會稍微不同，這可讓使用者在使用網域內的其他電腦時，定義不同的 Windows 和應用程式設定。</span><span class="sxs-lookup"><span data-stu-id="295e8-158">The storage location of these files is slightly different if a user has enabled roaming profiles, which enables a user to define different Windows and application settings when he or she is using other computers within a domain.</span></span> <span data-ttu-id="295e8-159">在此情況下，[!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] 應用程式和 非 [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] 應用程式的 `app`.exe.config 和 *user*.config 檔案，都儲存在 %InstallRoot%\Documents and Settings\\*username*\Application Data 下。</span><span class="sxs-lookup"><span data-stu-id="295e8-159">In that case, both [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] applications and non-[!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] applications will have their `app`.exe.config and *user*.config files stored under %InstallRoot%\Documents and Settings\\*username*\Application Data.</span></span>  
  
 <span data-ttu-id="295e8-160">如需應用程式設定功能如何搭配新的部署技術的詳細資訊，請參閱 [ClickOnce 和應用程式設定](/visualstudio/deployment/clickonce-and-application-settings)。</span><span class="sxs-lookup"><span data-stu-id="295e8-160">For more information about how the Application Settings feature works with the new deployment technology, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span> <span data-ttu-id="295e8-161">如需 [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)]資料目錄的詳細資訊，請參閱[在 ClickOnce 應用程式中存取本機和遠端資料](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications)。</span><span class="sxs-lookup"><span data-stu-id="295e8-161">For more information about the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] Data Directory, see [Accessing Local and Remote Data in ClickOnce Applications](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span></span>  
  
## <a name="application-settings-and-security"></a><span data-ttu-id="295e8-162">應用程式設定和安全性</span><span class="sxs-lookup"><span data-stu-id="295e8-162">Application Settings and Security</span></span>  
 <span data-ttu-id="295e8-163">應用程式設定設計為在部分信任情況下運作，這是裝載於網際網路或內部網路上的 Windows Forms 應用程式預設的受限制環境。</span><span class="sxs-lookup"><span data-stu-id="295e8-163">Application settings are designed to work in partial trust, a restricted environment that is the default for Windows Forms applications hosted over the Internet or an intranet.</span></span> <span data-ttu-id="295e8-164">使用應用程式設定搭配預設的設定提供者時，不需要任何超過部分信任的特殊權限。</span><span class="sxs-lookup"><span data-stu-id="295e8-164">No special permissions beyond partial trust are needed to use application settings with the default settings provider.</span></span>  
  
 <span data-ttu-id="295e8-165">在 [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] 應用程式中使用應用程式設定時，`user`.config 檔案儲存在 [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] 資料目錄中。</span><span class="sxs-lookup"><span data-stu-id="295e8-165">When application settings are used in a [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] application, the `user`.config file is stored in the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] data directory.</span></span> <span data-ttu-id="295e8-166">應用程式的 `user`.config 檔案大小不能超過 [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] 設定的資料目錄配額。</span><span class="sxs-lookup"><span data-stu-id="295e8-166">The size of the application's `user`.config file cannot exceed the data directory quota set by [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)].</span></span> <span data-ttu-id="295e8-167">如需詳細資訊，請參閱 [ClickOnce 和應用程式設定](/visualstudio/deployment/clickonce-and-application-settings)。</span><span class="sxs-lookup"><span data-stu-id="295e8-167">For more information, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span>  
  
## <a name="custom-settings-providers"></a><span data-ttu-id="295e8-168">自訂設定提供者</span><span class="sxs-lookup"><span data-stu-id="295e8-168">Custom Settings Providers</span></span>  
 <span data-ttu-id="295e8-169">在應用程式設定架構中，為應用程式設定之間的鬆散結合的包裝函式類別衍生自<xref:System.Configuration.ApplicationSettingsBase>，以及相關聯的設定提供者或提供者，衍生自<xref:System.Configuration.SettingsProvider>。</span><span class="sxs-lookup"><span data-stu-id="295e8-169">In the Application Settings architecture, there is a loose coupling between the applications settings wrapper class, derived from <xref:System.Configuration.ApplicationSettingsBase>, and the associated settings provider or providers, derived from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="295e8-170">此關聯會定義只由<xref:System.Configuration.SettingsProviderAttribute>套用至包裝函式類別或其個別的屬性。</span><span class="sxs-lookup"><span data-stu-id="295e8-170">This association is defined only by the <xref:System.Configuration.SettingsProviderAttribute> applied to the wrapper class or its individual properties.</span></span> <span data-ttu-id="295e8-171">如果的設定，提供者未明確指定，預設的提供者， <xref:System.Configuration.LocalFileSettingsProvider>，會使用。</span><span class="sxs-lookup"><span data-stu-id="295e8-171">If a settings provider is not explicitly specified, the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span> <span data-ttu-id="295e8-172">因此，此架構支援建立和使用自訂設定提供者。</span><span class="sxs-lookup"><span data-stu-id="295e8-172">As a result, this architecture supports creating and using custom settings providers.</span></span>  
  
 <span data-ttu-id="295e8-173">例如，假設您想要開發及使用 `SqlSettingsProvider`，此提供者會將所有設定資料儲存在 Microsoft SQL Server 資料庫中。</span><span class="sxs-lookup"><span data-stu-id="295e8-173">For example, suppose that you want to develop and use `SqlSettingsProvider`, a provider that will store all settings data in a Microsoft SQL Server database.</span></span> <span data-ttu-id="295e8-174">您<xref:System.Configuration.SettingsProvider>-在衍生的類別會收到這項資訊在其`Initialize`方法做為參數的型別<xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>。</span><span class="sxs-lookup"><span data-stu-id="295e8-174">Your <xref:System.Configuration.SettingsProvider>-derived class would receive this information in its `Initialize` method as a parameter of type <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>.</span></span> <span data-ttu-id="295e8-175">您會實作<xref:System.Configuration.SettingsProvider.GetPropertyValues%2A>方法，以從資料存放區中，擷取您的設定和<xref:System.Configuration.SettingsProvider.SetPropertyValues%2A>以加以儲存。</span><span class="sxs-lookup"><span data-stu-id="295e8-175">You would then implement the <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> method to retrieve your settings from the data store, and <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> to save them.</span></span> <span data-ttu-id="295e8-176">您的提供者可以使用<xref:System.Configuration.SettingsPropertyCollection>提供給<xref:System.Configuration.SettingsProvider.GetPropertyValues%2A>若要判斷屬性的名稱、 類型和範圍，以及任何其他設定的屬性會定義該屬性。</span><span class="sxs-lookup"><span data-stu-id="295e8-176">Your provider can use the <xref:System.Configuration.SettingsPropertyCollection> supplied to <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> to determine the property's name, type, and scope, as well as any other settings attributes defined for that property.</span></span>  
  
 <span data-ttu-id="295e8-177">您的提供者必須實作一個屬性和一個方法，其實作可能不明顯。</span><span class="sxs-lookup"><span data-stu-id="295e8-177">Your provider will need to implement one property and one method whose implementations may not be obvious.</span></span> <span data-ttu-id="295e8-178"><xref:System.Configuration.SettingsProvider.ApplicationName%2A>屬性是抽象屬性<xref:System.Configuration.SettingsProvider>; 您應設計程式，它會傳回下列：</span><span class="sxs-lookup"><span data-stu-id="295e8-178">The <xref:System.Configuration.SettingsProvider.ApplicationName%2A> property is an abstract property of <xref:System.Configuration.SettingsProvider>; you should program it to return the following:</span></span>  
  
 [!code-csharp[ApplicationSettings.Architecture#2](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#2)]
 [!code-vb[ApplicationSettings.Architecture#2](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#2)]  
  
 <span data-ttu-id="295e8-179">您的衍生類別也必須實作 `Initialize` 方法，不接受任何引數，也不傳回任何值。</span><span class="sxs-lookup"><span data-stu-id="295e8-179">Your derived class must also implement an `Initialize` method that takes no arguments and returns no value.</span></span> <span data-ttu-id="295e8-180">這個方法不由定義<xref:System.Configuration.SettingsProvider>。</span><span class="sxs-lookup"><span data-stu-id="295e8-180">This method is not defined by <xref:System.Configuration.SettingsProvider>.</span></span>  
  
 <span data-ttu-id="295e8-181">最後，您實作<xref:System.Configuration.IApplicationSettingsProvider>上您的提供者提供支援重新整理設定，將設定還原為其預設值，並從一個應用程式的版本升級設定。</span><span class="sxs-lookup"><span data-stu-id="295e8-181">Finally, you implement <xref:System.Configuration.IApplicationSettingsProvider> on your provider to provide support for refreshing settings, reverting settings to their defaults, and upgrading settings from one application version to another.</span></span>  
  
 <span data-ttu-id="295e8-182">實作並編譯您的提供者之後，您必須指示設定類別使用此提供者來代替預設值。</span><span class="sxs-lookup"><span data-stu-id="295e8-182">Once you have implemented and compiled your provider, you need to instruct your settings class to use this provider instead of the default.</span></span> <span data-ttu-id="295e8-183">完成這項工作<xref:System.Configuration.SettingsProviderAttribute>。</span><span class="sxs-lookup"><span data-stu-id="295e8-183">You accomplish this through the <xref:System.Configuration.SettingsProviderAttribute>.</span></span> <span data-ttu-id="295e8-184">如果套用至整個設定類別，提供者用於每個類別定義的設定如果套用至個別的設定，應用程式設定架構的這些設定，請使用該提供者，並使用<xref:System.Configuration.LocalFileSettingsProvider>其餘部分。</span><span class="sxs-lookup"><span data-stu-id="295e8-184">If applied to an entire settings class, the provider is used for each setting that the class defines; if applied to individual settings, Application Settings architecture uses that provider for those settings only, and uses <xref:System.Configuration.LocalFileSettingsProvider> for the rest.</span></span> <span data-ttu-id="295e8-185">下列程式碼範例示範如何指示設定類別來使用您的自訂提供者。</span><span class="sxs-lookup"><span data-stu-id="295e8-185">The following code example shows how to instruct the settings class to use your custom provider.</span></span>  
  
 [!code-csharp[ApplicationSettings.Architecture#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#1)]
 [!code-vb[ApplicationSettings.Architecture#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#1)]  
  
 <span data-ttu-id="295e8-186">一個提供者可供多個執行緒同時呼叫，但永遠寫入相同的儲存位置。因此，應用程式設定架構只會具現化提供者類別的單一執行個體。</span><span class="sxs-lookup"><span data-stu-id="295e8-186">A provider may be called from multiple threads simultaneously, but it will always write to the same storage location; therefore, the Application Settings architecture will only ever instantiate a single instance of your provider class.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="295e8-187">您應該確定您的提供者是安全執行緒，而且一次只允許一個執行緒寫入組態檔。</span><span class="sxs-lookup"><span data-stu-id="295e8-187">You should ensure that your provider is thread-safe, and only allows one thread at a time to write to the configuration files.</span></span>  
  
 <span data-ttu-id="295e8-188">您的提供者不需要支援所有的屬性中定義的設定<xref:System.Configuration?displayProperty=nameWithType>命名空間，但它必須在最小支援<xref:System.Configuration.ApplicationScopedSettingAttribute>並<xref:System.Configuration.UserScopedSettingAttribute>，也應該支援和<xref:System.Configuration.DefaultSettingValueAttribute>。</span><span class="sxs-lookup"><span data-stu-id="295e8-188">Your provider does not need to support all of the settings attributes defined in the <xref:System.Configuration?displayProperty=nameWithType> namespace, though it must at a minimum support <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute>, and should also support <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="295e8-189">對於不支援的屬性，您的提供者應該失敗且不需要通知，也就是不應該擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="295e8-189">For those attributes that it does not support, your provider should just fail without notification; it should not throw an exception.</span></span> <span data-ttu-id="295e8-190">如果設定類別使用無效的屬性組合，但是 — 例如套用<xref:System.Configuration.ApplicationScopedSettingAttribute>和<xref:System.Configuration.UserScopedSettingAttribute>相同的設定 — 您的提供者應該擲回例外狀況，並停止作業。</span><span class="sxs-lookup"><span data-stu-id="295e8-190">If the settings class uses an invalid combination of attributes, however — such as applying <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute> to the same setting — your provider should throw an exception and cease operation.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="295e8-191">另請參閱</span><span class="sxs-lookup"><span data-stu-id="295e8-191">See also</span></span>

- <xref:System.Configuration.ApplicationSettingsBase>
- <xref:System.Configuration.SettingsProvider>
- <xref:System.Configuration.LocalFileSettingsProvider>
- [<span data-ttu-id="295e8-192">應用程式設定概觀</span><span class="sxs-lookup"><span data-stu-id="295e8-192">Application Settings Overview</span></span>](application-settings-overview.md)
- [<span data-ttu-id="295e8-193">Application Settings for Custom Controls</span><span class="sxs-lookup"><span data-stu-id="295e8-193">Application Settings for Custom Controls</span></span>](application-settings-for-custom-controls.md)
- [<span data-ttu-id="295e8-194">ClickOnce 和應用程式設定</span><span class="sxs-lookup"><span data-stu-id="295e8-194">ClickOnce and Application Settings</span></span>](/visualstudio/deployment/clickonce-and-application-settings)
- [<span data-ttu-id="295e8-195">應用程式設定結構描述</span><span class="sxs-lookup"><span data-stu-id="295e8-195">Application Settings Schema</span></span>](../../configure-apps/file-schema/application-settings-schema.md)
