---
title: "await (C# 參考)"
ms.date: 05/22/2017
ms.prod: .net
ms.technology: devlang-csharp
ms.topic: article
f1_keywords: await_CSharpKeyword
helpviewer_keywords:
- await keyword [C#]
- await [C#]
ms.assetid: 50725c24-ac76-4ca7-bca1-dd57642ffedb
caps.latest.revision: "36"
author: BillWagner
ms.author: wiwagn
ms.openlocfilehash: 23a3299492c538963e9a5dceaadc81a44d386b19
ms.sourcegitcommit: 401c4427a3ec0d1263543033b3084039278509dc
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/06/2017
---
# <a name="await-c-reference"></a><span data-ttu-id="63f60-102">await (C# 參考)</span><span class="sxs-lookup"><span data-stu-id="63f60-102">await (C# Reference)</span></span>
<span data-ttu-id="63f60-103">`await` 運算子會套用至非同步方法中的工作，以在執行方法中插入暫停點，直到等候的工作完成為止。</span><span class="sxs-lookup"><span data-stu-id="63f60-103">The `await` operator is applied to a task in an asynchronous method to insert a suspension point in the execution of the method until the awaited task completes.</span></span> <span data-ttu-id="63f60-104">工作代表進行中的工作。</span><span class="sxs-lookup"><span data-stu-id="63f60-104">The task represents ongoing work.</span></span>  
  
<span data-ttu-id="63f60-105">`await` 只能用於 [async](../../../csharp/language-reference/keywords/async.md) 關鍵字所修改的非同步方法中。</span><span class="sxs-lookup"><span data-stu-id="63f60-105">`await` can only be used in an asynchronous method modified by the [async](../../../csharp/language-reference/keywords/async.md) keyword.</span></span> <span data-ttu-id="63f60-106">這種方法是使用 `async` 修飾詞所定義，且通常包含一或多個 `await` 運算式，我們稱之為「非同步方法」。</span><span class="sxs-lookup"><span data-stu-id="63f60-106">Such a method, defined by using the `async` modifier and usually containing one or more `await` expressions, is referred to as an *async method*.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="63f60-107">`async` 和 `await` 關鍵字是在 C# 5 中引入。</span><span class="sxs-lookup"><span data-stu-id="63f60-107">The `async` and `await` keywords were introduced in C# 5.</span></span> <span data-ttu-id="63f60-108">如需非同步程式設計的簡介，請參閱[使用 async 和 await 進行非同步程式設計](../../../csharp/programming-guide/concepts/async/index.md)。</span><span class="sxs-lookup"><span data-stu-id="63f60-108">For an introduction to async programming, see [Asynchronous Programming with async and await](../../../csharp/programming-guide/concepts/async/index.md).</span></span>  
  
<span data-ttu-id="63f60-109">套用了 `await` 運算子的工作，通常是呼叫傳回給實作[工作式非同步模式](../../../standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap.md)的方法。</span><span class="sxs-lookup"><span data-stu-id="63f60-109">The task to which the `await` operator is applied typically is returned by a call to a method that implements the [Task-Based Asynchronous Pattern](../../../standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap.md).</span></span> <span data-ttu-id="63f60-110">它們包括傳回 <xref:System.Threading.Tasks.Task>、<xref:System.Threading.Tasks.Task%601> 和 `System.Threading.Tasks.ValueType<TResult>` 物件的方法。</span><span class="sxs-lookup"><span data-stu-id="63f60-110">They include methods that return <xref:System.Threading.Tasks.Task>, <xref:System.Threading.Tasks.Task%601>, and `System.Threading.Tasks.ValueType<TResult>` objects.</span></span>  

  
 <span data-ttu-id="63f60-111">在下列範例中，<xref:System.Net.Http.HttpClient.GetByteArrayAsync%2A?displayProperty=nameWithType> 方法會傳回 `Task<byte[]>`。</span><span class="sxs-lookup"><span data-stu-id="63f60-111">In the following example, the <xref:System.Net.Http.HttpClient.GetByteArrayAsync%2A?displayProperty=nameWithType> method returns a `Task<byte[]>`.</span></span> <span data-ttu-id="63f60-112">這個工作可保證工作完成時，一定會產生實際位元組陣列。</span><span class="sxs-lookup"><span data-stu-id="63f60-112">The task is a promise to produce the actual byte array when the task is complete.</span></span> <span data-ttu-id="63f60-113">`await` 運算子會暫停執行，直到 <xref:System.Net.Http.HttpClient.GetByteArrayAsync%2A> 方法的工作完成為止。</span><span class="sxs-lookup"><span data-stu-id="63f60-113">The `await` operator suspends execution until the work of the <xref:System.Net.Http.HttpClient.GetByteArrayAsync%2A> method is complete.</span></span> <span data-ttu-id="63f60-114">同時，控制權會返回 `GetPageSizeAsync` 的呼叫端。</span><span class="sxs-lookup"><span data-stu-id="63f60-114">In the meantime, control is returned to the caller of `GetPageSizeAsync`.</span></span> <span data-ttu-id="63f60-115">在工作執行完成後，`await` 運算式評估為位元組陣列。</span><span class="sxs-lookup"><span data-stu-id="63f60-115">When the task finishes execution, the `await` expression evaluates to a byte array.</span></span>  

[!code-csharp[await-example](../../../../samples/snippets/csharp/language-reference/keywords/await/await1.cs)]  

> [!IMPORTANT]
>  <span data-ttu-id="63f60-116">如需完整範例，請參閱[逐步解說：使用 async 和 await 存取 Web](../../../csharp/programming-guide/concepts/async/walkthrough-accessing-the-web-by-using-async-and-await.md)。</span><span class="sxs-lookup"><span data-stu-id="63f60-116">For the complete example, see [Walkthrough: Accessing the Web by Using Async and Await](../../../csharp/programming-guide/concepts/async/walkthrough-accessing-the-web-by-using-async-and-await.md).</span></span> <span data-ttu-id="63f60-117">您可以從 Microsoft 網站的[開發人員程式碼範例](https://code.msdn.microsoft.com/Async-Sample-Accessing-the-9c10497f) 下載此範例。</span><span class="sxs-lookup"><span data-stu-id="63f60-117">You can download the sample from [Developer Code Samples](https://code.msdn.microsoft.com/Async-Sample-Accessing-the-9c10497f) on the Microsoft website.</span></span> <span data-ttu-id="63f60-118">此範例位於 AsyncWalkthrough_HttpClient 專案中。</span><span class="sxs-lookup"><span data-stu-id="63f60-118">The example is in the AsyncWalkthrough_HttpClient project.</span></span>  
  
<span data-ttu-id="63f60-119">如先前範例所示，如果將 `await` 套用至傳回 `Task<TResult>` 之方法呼叫的結果，則 `await` 運算式的類型為 `TResult`。</span><span class="sxs-lookup"><span data-stu-id="63f60-119">As shown in the previous example, if `await` is applied to the result of a method call that returns a `Task<TResult>`, then the type of the `await` expression is `TResult`.</span></span> <span data-ttu-id="63f60-120">如果將 `await` 套用至傳回 `Task` 之方法呼叫的結果，則 `await` 運算式的類型為 `void`。</span><span class="sxs-lookup"><span data-stu-id="63f60-120">If `await` is applied to the result of a method call that returns a `Task`, then the type of the `await` expression is `void`.</span></span> <span data-ttu-id="63f60-121">下列範例會說明其間的差異。</span><span class="sxs-lookup"><span data-stu-id="63f60-121">The following example illustrates the difference.</span></span>  
  
```csharp  
// await keyword used with a method that returns a Task<TResult>.  
TResult result = await AsyncMethodThatReturnsTaskTResult();  
  
// await keyword used with a method that returns a Task.  
await AsyncMethodThatReturnsTask();  

// await keyword used with a method that returns a ValueTask<TResult>.
TResult result = await AsyncMethodThatReturnsValueTaskTResult();
```  
  
<span data-ttu-id="63f60-122">`await` 運算式不會封鎖其執行所在的執行緒。</span><span class="sxs-lookup"><span data-stu-id="63f60-122">An `await` expression does not block the thread on which it is executing.</span></span> <span data-ttu-id="63f60-123">但是它會造成編譯器將其餘非同步方法註冊為所等候工作的接續。</span><span class="sxs-lookup"><span data-stu-id="63f60-123">Instead, it causes the compiler to sign up the rest of the async method as a continuation on the awaited task.</span></span> <span data-ttu-id="63f60-124">控制權接著會返回非同步方法的呼叫端。</span><span class="sxs-lookup"><span data-stu-id="63f60-124">Control then returns to the caller of the async method.</span></span> <span data-ttu-id="63f60-125">當工作完成時，它會叫用其接續，並從中斷處繼續執行非同步方法。</span><span class="sxs-lookup"><span data-stu-id="63f60-125">When the task completes, it invokes its continuation, and execution of the async method resumes where it left off.</span></span>  
  
<span data-ttu-id="63f60-126">`await` 運算式只會出現在必須以 `async` 修飾詞標示的封入方法、Lambda 運算式或匿名方法的主體中。</span><span class="sxs-lookup"><span data-stu-id="63f60-126">An `await` expression can occur only in the body of its enclosing method, lambda expression, or anonymous method, which must be marked with an `async` modifier.</span></span> <span data-ttu-id="63f60-127">*await* 這個詞彙只在該內容中作為關鍵字。</span><span class="sxs-lookup"><span data-stu-id="63f60-127">The term *await* serves as a keyword only in that context.</span></span> <span data-ttu-id="63f60-128">在其他內容中，它會解譯為識別項。</span><span class="sxs-lookup"><span data-stu-id="63f60-128">Elsewhere, it is interpreted as an identifier.</span></span> <span data-ttu-id="63f60-129">在方法、Lambda 運算式或匿名方法中，`await` 運算式不能出現在同步函式、查詢運算式、[lock 陳述式](../../../csharp/language-reference/keywords/lock-statement.md)的區塊，或是 [unsafe](../../../csharp/language-reference/keywords/unsafe.md) 內容中。</span><span class="sxs-lookup"><span data-stu-id="63f60-129">Within the method, lambda expression, or anonymous method, an `await` expression cannot occur in the body of a synchronous function, in a query expression, in the block of a [lock statement](../../../csharp/language-reference/keywords/lock-statement.md), or in an [unsafe](../../../csharp/language-reference/keywords/unsafe.md) context.</span></span>  
  
## <a name="exceptions"></a><span data-ttu-id="63f60-130">例外狀況</span><span class="sxs-lookup"><span data-stu-id="63f60-130">Exceptions</span></span>  
<span data-ttu-id="63f60-131">大部分的非同步方法會傳回 <xref:System.Threading.Tasks.Task> 或 <xref:System.Threading.Tasks.Task%601>。</span><span class="sxs-lookup"><span data-stu-id="63f60-131">Most async methods return a <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601>.</span></span> <span data-ttu-id="63f60-132">傳回的工作屬性會隨附其狀態和記錄的相關資訊，例如工作是否完成、非同步方法是否造成例外狀況或已取消，以及最終結果為何。</span><span class="sxs-lookup"><span data-stu-id="63f60-132">The properties of the returned task carry information about its status and history, such as whether the task is complete, whether the async method caused an exception or was canceled, and what the final result is.</span></span> <span data-ttu-id="63f60-133">`await` 運算子透過呼叫 `GetAwaiter` 方法所傳回之物件上的方法，來存取這些屬性。</span><span class="sxs-lookup"><span data-stu-id="63f60-133">The `await` operator accesses those properties by calling methods on the object returned by the `GetAwaiter` method.</span></span>  
  
<span data-ttu-id="63f60-134">如果您在等候工作傳回非同步方法時導致例外狀況，`await` 運算子會重新擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="63f60-134">If you await a task-returning async method that causes an exception, the `await` operator rethrows the exception.</span></span>  
  
<span data-ttu-id="63f60-135">如果您等候已取消的工作傳回非同步方法，則 `await` 運算子會重新擲回 <xref:System.OperationCanceledException>。</span><span class="sxs-lookup"><span data-stu-id="63f60-135">If you await a task-returning async method that's canceled, the `await` operator rethrows an <xref:System.OperationCanceledException>.</span></span>  
  
<span data-ttu-id="63f60-136">處於錯誤狀態的單一工作可能反映多個例外狀況。</span><span class="sxs-lookup"><span data-stu-id="63f60-136">A single task that is in a faulted state can reflect multiple exceptions.</span></span> <span data-ttu-id="63f60-137">例如，工作可能是對 <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> 呼叫的結果。</span><span class="sxs-lookup"><span data-stu-id="63f60-137">For example, the task might be the result of a call to <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="63f60-138">當您等候這類工作時，await 作業只會重新擲回其中一個例外狀況。</span><span class="sxs-lookup"><span data-stu-id="63f60-138">When you await such a task, the await operation rethrows only one of the exceptions.</span></span> <span data-ttu-id="63f60-139">不過，您無法預測重新擲回哪個例外狀況。</span><span class="sxs-lookup"><span data-stu-id="63f60-139">However, you can't predict which of the exceptions is rethrown.</span></span>  
  
<span data-ttu-id="63f60-140">如需非同步方法中錯誤處理的範例，請參閱 [try-catch](../../../csharp/language-reference/keywords/try-catch.md)。</span><span class="sxs-lookup"><span data-stu-id="63f60-140">For examples of error handling in async methods, see [try-catch](../../../csharp/language-reference/keywords/try-catch.md).</span></span>  
  
## <a name="example"></a><span data-ttu-id="63f60-141">範例</span><span class="sxs-lookup"><span data-stu-id="63f60-141">Example</span></span>  
<span data-ttu-id="63f60-142">下列範例會傳回頁面的總字元數，這些頁面的 URL 會傳遞給它當做命令列引數。</span><span class="sxs-lookup"><span data-stu-id="63f60-142">The following example returns the total number of characters in the pages whose URLs are passed to it as command line arguments.</span></span> <span data-ttu-id="63f60-143">本例會呼叫 `GetPageLengthsAsync` 方法，這會以 `async` 關鍵字標示。</span><span class="sxs-lookup"><span data-stu-id="63f60-143">The example calls the `GetPageLengthsAsync` method, which is marked with the `async` keyword.</span></span> <span data-ttu-id="63f60-144">`GetPageLengthsAsync` 方法接著會使用 `await` 關鍵字來等候對 <xref:System.Net.Http.HttpClient.GetStringAsync%2A?displayProperty=nameWithType> 方法的呼叫。</span><span class="sxs-lookup"><span data-stu-id="63f60-144">The `GetPageLengthsAsync` method in turn uses the `await` keyword to await calls to the <xref:System.Net.Http.HttpClient.GetStringAsync%2A?displayProperty=nameWithType> method.</span></span>  

[!code-csharp[await-example](../../../../samples/snippets/csharp/language-reference/keywords/await/await2.cs)]  

<span data-ttu-id="63f60-145">因為不支援在應用程式進入點中使用 `async` 和 `await`，所以我們無法將 `async` 屬性套用至 `Main` 方法，也不能等候 `GetPageLengthsAsync` 方法呼叫。</span><span class="sxs-lookup"><span data-stu-id="63f60-145">Because the use of `async` and `await` in an application entry point is not supported, we cannot apply the `async` attribute to the `Main` method, nor can we await the `GetPageLengthsAsync` method call.</span></span> <span data-ttu-id="63f60-146">擷取 <xref:System.Threading.Tasks.Task%601.Result?displayProperty=nameWithType> 屬性的值，以確保 `Main` 方法等候非同步作業完成。</span><span class="sxs-lookup"><span data-stu-id="63f60-146">We can ensure that the `Main` method waits for the async operation to complete by retrieving the value of the <xref:System.Threading.Tasks.Task%601.Result?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="63f60-147">針對不傳回值的工作，您可以呼叫 <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> 方法。</span><span class="sxs-lookup"><span data-stu-id="63f60-147">For tasks that do not return a value, you can call the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method.</span></span> 

## <a name="see-also"></a><span data-ttu-id="63f60-148">請參閱</span><span class="sxs-lookup"><span data-stu-id="63f60-148">See also</span></span>  
<span data-ttu-id="63f60-149">[使用 async 和 await 進行非同步程式設計](../../../csharp/programming-guide/concepts/async/index.md) </span><span class="sxs-lookup"><span data-stu-id="63f60-149">[Asynchronous Programming with async and await](../../../csharp/programming-guide/concepts/async/index.md) </span></span>  
<span data-ttu-id="63f60-150">[逐步解說：使用 async 和 await 存取 Web](../../../csharp/programming-guide/concepts/async/walkthrough-accessing-the-web-by-using-async-and-await.md) </span><span class="sxs-lookup"><span data-stu-id="63f60-150">[Walkthrough: Accessing the Web by Using Async and Await](../../../csharp/programming-guide/concepts/async/walkthrough-accessing-the-web-by-using-async-and-await.md) </span></span>  
[<span data-ttu-id="63f60-151">async</span><span class="sxs-lookup"><span data-stu-id="63f60-151">async</span></span>](../../../csharp/language-reference/keywords/async.md)
