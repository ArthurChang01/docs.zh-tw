---
title: 無伺服器架構考慮-無伺服器應用程式
description: 瞭解架構無伺服器應用程式的挑戰, 從狀態管理和持續性儲存體, 到調整、記錄、追蹤和診斷。
author: JEREMYLIKNESS
ms.author: jeliknes
ms.date: 06/26/2018
ms.openlocfilehash: ecbffbbd435b4926608e4def519fdaddddab688d
ms.sourcegitcommit: f20dd18dbcf2275513281f5d9ad7ece6a62644b4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/30/2019
ms.locfileid: "69577431"
---
# <a name="serverless-architecture-considerations"></a>無伺服器架構考量

採用無伺服器架構會帶來一些挑戰。 本節將探討一些要注意的常見考慮。 所有這些挑戰都有解決方案。 就像所有的架構選擇一樣, 只有在仔細考慮優缺點之後, 才應該執行「無伺服器」的決策。 視您應用程式的需求而定, 您可能會決定無伺服器的實作為特定元件的正確解決方案。

## <a name="managing-state"></a>管理狀態

無伺服器函式, 如同一般的微服務, 預設為無狀態。 避免狀態可讓無伺服器暫時、相應放大, 以及提供復原功能而不會有中央失敗點。 在某些情況下, 商務程式需要狀態。 如果您的進程需要狀態, 您有兩個選項。 您可以採用無伺服器的模型, 或與提供狀態的個別服務互動。 新增狀態可能會使解決方案變得複雜, 而且難以調整規模, 而且可能會建立單一失敗點。 請仔細考慮您的函數是否絕對需要狀態。 如果答案為「是」, 請判斷使用無伺服器來執行它是否仍有意義。

有數個解決方案可以採用狀態, 而不會危害無伺服器的優勢。 一些較受歡迎的解決方案包括:

* 使用暫存資料存放區或分散式快取, 例如 Redis
* 將狀態儲存在資料庫中, 例如 SQL 或 CosmosDB
* 透過工作流程引擎 (如長期函數) 處理狀態

重點是, 您應該留意到您正考慮使用無伺服器來執行的進程內的任何狀態管理需求。

## <a name="long-running-processes"></a>長時間執行的進程

無伺服器的許多優點都是以暫時的進程為依據。 較短的執行時間可讓無伺服器提供者更容易釋放資源, 因為函式會在主機間結束和共用函式。 大部分的雲端提供者會將您的函式可執行檔總時間限制為大約10分鐘。 如果您的程式可能需要較長的時間, 您可能會考慮使用替代的執行方式。

有一些例外狀況和解決方案。 其中一個解決方法可能是將您的程式分成較小的元件, 以減少執行的時間。 如果您的進程因為相依性而執行很長的時間, 您也可以考慮使用長期函式等解決方案的非同步工作流程。 長期函式會在等候外部進程完成時暫停及維護進程的狀態。 非同步處理可減少實際進程執行的時間。

## <a name="startup-time"></a>啟動時間

無伺服器的執行有一個可能的顧慮, 就是啟動時間。 為了節省資源, 許多無伺服器提供者會依需求建立基礎結構。 當無伺服器函式在一段時間後觸發時, 可能需要建立或重新開機裝載該函數的資源。 在某些情況下, 冷啟動可能會導致數秒的延遲。 啟動時間會因提供者和服務等級而異。 如果要將應用程式成功降到最低, 有幾種方法可以解決啟動時間。

* 某些提供者可讓使用者支付保證基礎結構為「always on」的服務等級。
* 執行 keep-alive 機制 (ping 端點以保持其「喚醒」狀態)。
* 以容器化函式方法使用 Kubernetes 之類的協調流程 (主機已在執行中, 因此加速新實例的速度非常快)。

## <a name="database-updates-and-migrations"></a>資料庫更新與遷移

無伺服器程式碼的優點是您可以發行新的函式, 而不需要重新部署整個應用程式。 當涉及關係資料庫時, 這種優點可能會變得很有缺點。 資料庫架構的變更很容易與無伺服器更新進行同步處理。 當發生錯誤且必須回復變更時, 會造成額外的挑戰。 資料完整性是微服務和無伺服器函式的最佳做法之一, 就是它們擁有自己的資料。 您可以將變更部署為計算和資料的單一單位。 事實上, 許多舊版系統的功能都是大型後端資料庫, 必須與無伺服器架構進行協調。

解決架構版本控制的常見方法是永遠不要修改現有的屬性和資料行, 而是加入新的資訊。 例如, 請考慮從待辦事項清單的布林值「已完成」旗標移至「完成日期」的變更。 資料庫變更不會移除舊的欄位, 而是會:

1. 加入新的「完成日期」欄位。
1. 將「已完成」的布林值欄位轉換成計算的函式, 以評估已完成的日期是否在目前的日期之後。
1. 加入觸發程式, 以將完成的布林值設定為 true 時, 將完成的日期設定為目前的日期。

這一系列的變更可確保舊版程式碼會繼續以「原樣」執行, 而較新的無伺服器函式可以利用新的欄位。

如需無伺服器架構中資料的詳細資訊, 請參閱[分散式資料管理的挑戰和解決方案](../microservices/architect-microservice-container-applications/distributed-data-management.md)。

## <a name="scaling"></a>縮放

這是一種常見的誤解, 即無伺服器表示「沒有伺服器」。 事實上就是「較少的伺服器」。 事實上, 有一項支援的基礎結構是瞭解調整的時機。 大部分的無伺服器平臺會提供一組控制項, 以處理事件密度增加時基礎結構的調整方式。 您可以從各種不同的選項中選擇, 但您的策略可能會因函數而有所不同。 此外, 函式通常會在相關的主機下執行, 讓相同主機上的函式具有相同的縮放選項。 因此, 您必須根據規模需求來組織和制定要主控的函式。

規則通常會根據不同的參數, 指定要如何向上擴充 (增加主機資源) 和相應放大 (增加主控制項實例的數目)。 規模的觸發程式可能包括排程、要求率、CPU 使用率和記憶體使用量。 較高的效能通常會有較高的成本。 當要求速率突然增加時, 耗用量較低的方法可能不會快速調整。 在預付「保險成本」與「隨用隨付」時, 會有取捨, 且因需求突然增加而造成回應變慢的風險。

## <a name="monitoring-tracing-and-logging"></a>監視、追蹤和記錄

DevOps 的一個經常被忽略的層面, 就是在部署之後監視應用程式。 請務必具備監視無伺服器函式的策略。 最大的挑戰通常是相互關聯, 或辨識使用者在相同互動過程中呼叫多個功能的時間。 大部分的無伺服器平臺都允許主控台記錄功能, 可匯入至協力廠商工具。 另外還有一些選項可自動收集遙測、產生和追蹤相互關聯識別碼, 以及監視特定動作以提供詳細的深入解析。 Azure 提供用於監視和分析的先進[Application Insights 平臺](https://docs.microsoft.com/azure/azure-functions/functions-monitoring)。

## <a name="inter-service-dependencies"></a>服務間相關性

無伺服器架構可能包含依賴其他函數的函式。 事實上, 在無伺服器架構中, 若要讓多個服務在互動或分散式交易中彼此呼叫, 這種情況並不常見。 若要避免強式結合, 建議服務不會直接參考彼此。 當服務的端點需要變更時, 直接參考可能會導致主要重構。 建議的解決方案是提供服務探索機制 (例如登錄), 為要求類型提供適當的結束點。 另一個解決方案是利用訊息服務, 例如佇列或主題, 以在服務之間進行通訊。

## <a name="managing-failure-and-providing-resiliency"></a>管理失敗並提供復原功能

也請務必考慮*斷路器模式*:如果基於某些原因, 服務會繼續失敗, 建議您不要重複呼叫該服務。 相反地, 會呼叫替代服務或傳回訊息, 直到重新建立相依服務的健全狀況為止。 無伺服器架構必須考慮解析和管理服務間相依性的策略。

為了繼續斷路器模式, 服務必須具備容錯能力和復原能力。 容錯指的是, 即使在發生未預期的例外狀況或不正確狀態之後, 應用程式仍能繼續執行的功能。 容錯功能通常是程式碼本身的函式, 以及如何撰寫它來處理例外狀況。 「復原」是指應用程式從失敗中復原的能力。 復原通常是由無伺服器平臺所管理。 當現有的無伺服器函式實例失敗時, 平臺應該能夠加速新的。 平臺也應該有足夠的智慧, 可在每個新的實例失敗時停止啟動新的實例。

如需詳細資訊, 請參閱[執行斷路器模式](../microservices/implement-resilient-applications/implement-circuit-breaker-pattern.md)。

## <a name="versioning-and-greenblue-deployments"></a>版本控制和綠色/藍色部署

無伺服器的主要優點是能夠升級特定的函式, 而不需要重新部署整個應用程式。 若要成功升級, 必須建立函式的版本, 以便將呼叫這些函式的服務路由傳送至正確的程式碼版本。 部署新版本的策略也很重要。 常見的方法是使用「綠色/藍色部署」。 綠色部署是目前的函式。 新的「藍色」版本會部署到生產環境並經過測試。 測試通過時, 會交換綠色和藍色版本, 讓新版本上線。 如果遇到任何問題, 可以將它們交換回來。 支援版本控制和綠色/藍色部署需要撰寫函式以配合版本變更, 並使用無伺服器平臺來處理部署。 其中一種可能的方法是使用 proxy, 如[Azure 無伺服器平臺](azure-functions.md#proxies)一章所述。

>[!div class="step-by-step"]
>[上一頁](serverless-architecture.md)
>[下一頁](serverless-design-examples.md)
