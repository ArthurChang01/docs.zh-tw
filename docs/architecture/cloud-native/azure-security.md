---
title: 雲原生應用的 Azure 安全性
description: 為 Azure 構建雲本機 .NET 應用 |雲本機應用的 Azure 安全性
ms.date: 06/30/2019
ms.openlocfilehash: 13b5ad7a883a83014913fa0a6a020610c28c524f
ms.sourcegitcommit: e3cbf26d67f7e9286c7108a2752804050762d02d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/09/2020
ms.locfileid: "80989138"
---
# <a name="azure-security-for-cloud-native-apps"></a><span data-ttu-id="57e23-103">雲原生應用的 Azure 安全性</span><span class="sxs-lookup"><span data-stu-id="57e23-103">Azure security for cloud-native apps</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="57e23-104">與傳統應用程式相比,雲原生應用程式可能更容易且更難安全。</span><span class="sxs-lookup"><span data-stu-id="57e23-104">Cloud-native applications can be both easier and more difficult to secure than traditional applications.</span></span> <span data-ttu-id="57e23-105">不利的一面是,您需要保護更小的應用程式,並投入更多精力來構建安全基礎架構。</span><span class="sxs-lookup"><span data-stu-id="57e23-105">On the downside, you need to secure more smaller applications and dedicate more energy to build out the security infrastructure.</span></span> <span data-ttu-id="57e23-106">在大多數服務部署中程式設計語言和樣式的異質性也意味著您需要更加關注來自許多不同提供者的安全公告。</span><span class="sxs-lookup"><span data-stu-id="57e23-106">The heterogeneous nature of programming languages and styles in most service deployments also means you need to pay more attention to security bulletins from many different providers.</span></span>

<span data-ttu-id="57e23-107">另一方面,較小的服務(每個服務都有自己的數據存儲)限制了攻擊的範圍。</span><span class="sxs-lookup"><span data-stu-id="57e23-107">On the flip side, smaller services, each with their own data store, limit the scope of an attack.</span></span> <span data-ttu-id="57e23-108">如果攻擊者危及一個系統,攻擊者跳轉到另一個系統可能比在單片應用程式中更難。</span><span class="sxs-lookup"><span data-stu-id="57e23-108">If an attacker compromises one system, it's probably more difficult for the attacker to make the jump to another system than it is in a monolithic application.</span></span> <span data-ttu-id="57e23-109">過程邊界是強邊界。</span><span class="sxs-lookup"><span data-stu-id="57e23-109">Process boundaries are strong boundaries.</span></span> <span data-ttu-id="57e23-110">此外,如果資料庫備份洩漏,則損壞會更加有限,因為該資料庫僅包含一個數據子集,並且不太可能包含個人數據。</span><span class="sxs-lookup"><span data-stu-id="57e23-110">Also, if a database backup leaks, then the damage is more limited, as that database contains only a subset of data and is unlikely to contain personal data.</span></span>

## <a name="threat-modeling"></a><span data-ttu-id="57e23-111">威脅分析模型</span><span class="sxs-lookup"><span data-stu-id="57e23-111">Threat modeling</span></span>

<span data-ttu-id="57e23-112">無論這些優勢是否大於雲原生應用程式的缺點,都必須遵循相同的整體安全思維模式。</span><span class="sxs-lookup"><span data-stu-id="57e23-112">No matter if the advantages outweigh the disadvantages of cloud-native applications, the same holistic security mindset must be followed.</span></span> <span data-ttu-id="57e23-113">安全和安全思維必須成為開發和運營故事的每一步的一部分。</span><span class="sxs-lookup"><span data-stu-id="57e23-113">Security and secure thinking must be part of every step of the development and operations story.</span></span> <span data-ttu-id="57e23-114">規劃應用程式時,會提出這樣的問題:</span><span class="sxs-lookup"><span data-stu-id="57e23-114">When planning an application ask questions like:</span></span>

- <span data-ttu-id="57e23-115">數據丟失將產生什麼影響?</span><span class="sxs-lookup"><span data-stu-id="57e23-115">What would be the impact of this data being lost?</span></span>
- <span data-ttu-id="57e23-116">我們如何限制注入此服務中的不良數據造成的損壞?</span><span class="sxs-lookup"><span data-stu-id="57e23-116">How can we limit the damage from bad data being injected into this service?</span></span>
- <span data-ttu-id="57e23-117">誰應該有權訪問此數據?</span><span class="sxs-lookup"><span data-stu-id="57e23-117">Who should have access to this data?</span></span>
- <span data-ttu-id="57e23-118">在開發和發佈過程中是否有審計政策?</span><span class="sxs-lookup"><span data-stu-id="57e23-118">Are there auditing policies in place around the development and release process?</span></span>

<span data-ttu-id="57e23-119">所有這些問題都是稱為[威脅建模](https://docs.microsoft.com/azure/security/azure-security-threat-modeling-tool)的過程的一部分。</span><span class="sxs-lookup"><span data-stu-id="57e23-119">All these questions are part of a process called [threat modeling](https://docs.microsoft.com/azure/security/azure-security-threat-modeling-tool).</span></span> <span data-ttu-id="57e23-120">此過程試圖回答系統存在哪些威脅、威脅的可能性以及威脅的潛在損害的問題。</span><span class="sxs-lookup"><span data-stu-id="57e23-120">This process tries to answer the question of what threats there are to the system, how likely the threats are, and the potential damage from them.</span></span>

<span data-ttu-id="57e23-121">確定威脅清單后,您需要確定它們是否值得緩解。</span><span class="sxs-lookup"><span data-stu-id="57e23-121">Once the list of threats has been established, you need to decide whether they're worth mitigating.</span></span> <span data-ttu-id="57e23-122">有時,威脅是如此不可能和昂貴,它不值得花費精力。</span><span class="sxs-lookup"><span data-stu-id="57e23-122">Sometimes a threat is so unlikely and expensive to plan for that it isn't worth spending energy on it.</span></span> <span data-ttu-id="57e23-123">例如,某些州級執行元件可能會將更改注入到由數百萬台設備使用的進程的設計中。</span><span class="sxs-lookup"><span data-stu-id="57e23-123">For instance, some state level actor could inject changes into the design of a process that is used by millions of devices.</span></span> <span data-ttu-id="57e23-124">現在,該代碼在環0中運行,而不是在[環3](https://en.wikipedia.org/wiki/Protection_ring)中運行某一段代碼。</span><span class="sxs-lookup"><span data-stu-id="57e23-124">Now, instead of running a certain piece of code in [Ring 3](https://en.wikipedia.org/wiki/Protection_ring), that code is run in Ring 0.</span></span> <span data-ttu-id="57e23-125">這允許繞過虛擬機器管理程式並在裸機電腦上運行攻擊代碼的漏洞,從而允許攻擊該硬體上運行的所有虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="57e23-125">This allows an exploit that can bypass the hypervisor and run the attack code on the bare metal machines, allowing attacks on all the virtual machines that are running on that hardware.</span></span>

<span data-ttu-id="57e23-126">如果沒有顯微鏡和對該處理器的矽設計有高級知識,改變的處理器就很難檢測出來。</span><span class="sxs-lookup"><span data-stu-id="57e23-126">The altered processors are difficult to detect without a microscope and advanced knowledge of the on silicon design of that processor.</span></span> <span data-ttu-id="57e23-127">此方案不太可能發生,且需要緩解的成本很高,因此可能沒有威脅模型會建議為其構建漏洞利用保護。</span><span class="sxs-lookup"><span data-stu-id="57e23-127">This scenario is unlikely to happen and expensive to mitigate, so probably no threat model would recommend building exploit protection for it.</span></span>

<span data-ttu-id="57e23-128">更可能的威脅(如允許`Id`增加攻擊(替換`Id=2``Id=3`為 URL)或 SQL 注入的訪問控制中斷,對構建針對的防護更具吸引力。</span><span class="sxs-lookup"><span data-stu-id="57e23-128">More likely threats, such as broken access controls permitting `Id` incrementing attacks (replacing `Id=2` with `Id=3` in the URL) or SQL injection, are more attractive to build protections against.</span></span> <span data-ttu-id="57e23-129">針對這些威脅的緩解措施相當合理,可以建立和防止影響公司聲譽的尷尬安全漏洞。</span><span class="sxs-lookup"><span data-stu-id="57e23-129">The mitigations for these threats are quite reasonable to build and prevent embarrassing security holes that smear the company's reputation.</span></span>

## <a name="principle-of-least-privilege"></a><span data-ttu-id="57e23-130">最低權限原則</span><span class="sxs-lookup"><span data-stu-id="57e23-130">Principle of least privilege</span></span>

<span data-ttu-id="57e23-131">計算機安全的基本思想之一是最小特權原則 (POLP)。</span><span class="sxs-lookup"><span data-stu-id="57e23-131">One of the founding ideas in computer security is the Principle of Least Privilege (POLP).</span></span> <span data-ttu-id="57e23-132">實際上,在大多數任何形式的安全中,無論是數位化還是物理安全,它都被認為是一個基本的想法。</span><span class="sxs-lookup"><span data-stu-id="57e23-132">It's actually a foundational idea in most any form of security be it digital or physical.</span></span> <span data-ttu-id="57e23-133">簡而言之,原則是,任何使用者或進程都應具有執行其任務的許可權最少。</span><span class="sxs-lookup"><span data-stu-id="57e23-133">In short, the principle is that any user or process should have the smallest number of rights possible to execute its task.</span></span>

<span data-ttu-id="57e23-134">例如,想想銀行的出納員:進入保險箱是一項不常見的活動。</span><span class="sxs-lookup"><span data-stu-id="57e23-134">As an example, think of the tellers at a bank: accessing the safe is an uncommon activity.</span></span> <span data-ttu-id="57e23-135">所以,一般出納員不能自己打開保險箱。</span><span class="sxs-lookup"><span data-stu-id="57e23-135">So, the average teller can't open the safe themselves.</span></span> <span data-ttu-id="57e23-136">要獲得訪問許可權,他們需要通過執行其他安全檢查的銀行經理上報請求。</span><span class="sxs-lookup"><span data-stu-id="57e23-136">To gain access, they need to escalate their request through a bank manager, who performs additional security checks.</span></span>

<span data-ttu-id="57e23-137">在計算機系統中,一個奇妙的範例是連接到資料庫的用戶的許可權。</span><span class="sxs-lookup"><span data-stu-id="57e23-137">In a computer system, a fantastic example is the rights of a user connecting to a database.</span></span> <span data-ttu-id="57e23-138">在許多情況下,有一個使用者帳戶用於生成資料庫結構和運行應用程式。</span><span class="sxs-lookup"><span data-stu-id="57e23-138">In many cases, there's a single user account used to both build the database structure and run the application.</span></span> <span data-ttu-id="57e23-139">除極端情況外,運行應用程式的帳戶不需要更新架構資訊的能力。</span><span class="sxs-lookup"><span data-stu-id="57e23-139">Except in extreme cases, the account running the application doesn't need the ability to update schema information.</span></span> <span data-ttu-id="57e23-140">應該有多個帳戶提供不同級別的許可權。</span><span class="sxs-lookup"><span data-stu-id="57e23-140">There should be several accounts that provide different levels of privilege.</span></span> <span data-ttu-id="57e23-141">應用程式應僅使用授予對表中數據的讀取和寫入存取許可權的許可權等級。</span><span class="sxs-lookup"><span data-stu-id="57e23-141">The application should only use the permission level that grants read and write access to the data in the tables.</span></span> <span data-ttu-id="57e23-142">這種保護將消除旨在刪除資料庫表或引入惡意觸發器的攻擊。</span><span class="sxs-lookup"><span data-stu-id="57e23-142">This kind of protection would eliminate attacks that aimed to drop database tables or introduce malicious triggers.</span></span>

<span data-ttu-id="57e23-143">構建雲原生應用程序的幾乎每個部分都可以從記住最低特權原則中獲益。</span><span class="sxs-lookup"><span data-stu-id="57e23-143">Almost every part of building a cloud-native application can benefit from remembering the principle of least privilege.</span></span> <span data-ttu-id="57e23-144">在基於角色的訪問控制 (RBAC) 中設置防火牆、網路安全組、角色和作用域時,可以找到它在起作用。</span><span class="sxs-lookup"><span data-stu-id="57e23-144">You can find it at play when setting up firewalls, network security groups, roles, and scopes in Role-based access control (RBAC).</span></span>

## <a name="penetration-testing"></a><span data-ttu-id="57e23-145">滲透測試</span><span class="sxs-lookup"><span data-stu-id="57e23-145">Penetration testing</span></span>

<span data-ttu-id="57e23-146">隨著應用程式變得越來越複雜,攻擊媒介的數量以驚人的速度增加。</span><span class="sxs-lookup"><span data-stu-id="57e23-146">As applications become more complicated the number of attack vectors increases at an alarming rate.</span></span> <span data-ttu-id="57e23-147">威脅建模存在缺陷,因為它往往由構建系統的同一人員執行。</span><span class="sxs-lookup"><span data-stu-id="57e23-147">Threat modeling is flawed in that it tends to be executed by the same people building the system.</span></span> <span data-ttu-id="57e23-148">與許多開發人員在設想使用者交互以及構建不可用的用戶介面時遇到困難一樣,大多數開發人員很難看到每個攻擊媒介。</span><span class="sxs-lookup"><span data-stu-id="57e23-148">In the same way that many developers have trouble envisioning user interactions and then build unusable user interfaces, most developers have difficulty seeing every attack vector.</span></span> <span data-ttu-id="57e23-149">構建系統的開發人員可能不太精通攻擊方法,並且忽略了一些關鍵內容。</span><span class="sxs-lookup"><span data-stu-id="57e23-149">It's also possible that the developers building the system aren't well versed in attack methodologies and miss something crucial.</span></span>

<span data-ttu-id="57e23-150">滲透測試或「筆測試」包括引入外部參與者試圖攻擊系統。</span><span class="sxs-lookup"><span data-stu-id="57e23-150">Penetration testing or "pen testing" involves bringing in external actors to attempt to attack the system.</span></span> <span data-ttu-id="57e23-151">這些攻擊者可能是外部諮詢公司或其他開發人員,具有業務其他部分良好的安全知識。</span><span class="sxs-lookup"><span data-stu-id="57e23-151">These attackers may be an external consulting company or other developers with good security knowledge from another part of the business.</span></span> <span data-ttu-id="57e23-152">他們被給予點菜,試圖顛覆系統。</span><span class="sxs-lookup"><span data-stu-id="57e23-152">They're given carte blanche to attempt to subvert the system.</span></span> <span data-ttu-id="57e23-153">通常,他們會發現需要修補的大量安全漏洞。</span><span class="sxs-lookup"><span data-stu-id="57e23-153">Frequently, they'll find extensive security holes that need to be patched.</span></span> <span data-ttu-id="57e23-154">有時,攻擊媒介會完全出乎意料,例如利用對 CEO 的網路釣魚攻擊。</span><span class="sxs-lookup"><span data-stu-id="57e23-154">Sometimes the attack vector will be something totally unexpected like exploiting a phishing attack against the CEO.</span></span>

<span data-ttu-id="57e23-155">Azure 本身不斷受到[微軟內部駭客團隊](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/)的攻擊。</span><span class="sxs-lookup"><span data-stu-id="57e23-155">Azure itself is constantly undergoing attacks from a [team of hackers inside Microsoft](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span></span> <span data-ttu-id="57e23-156">多年來,他們一直是第一個發現幾十個潛在的災難性攻擊媒介,關閉他們之前,他們可以被利用的外部。</span><span class="sxs-lookup"><span data-stu-id="57e23-156">Over the years, they've been the first to find dozens of potentially catastrophic attack vectors, closing them before they can be exploited externally.</span></span> <span data-ttu-id="57e23-157">目標越誘人,永恆的參與者就越有可能試圖利用它,世界上有幾個目標比 Azure 更誘人。</span><span class="sxs-lookup"><span data-stu-id="57e23-157">The more tempting a target, the more likely that eternal actors will attempt to exploit it and there are a few targets in the world more tempting than Azure.</span></span>

## <a name="monitoring"></a><span data-ttu-id="57e23-158">監視</span><span class="sxs-lookup"><span data-stu-id="57e23-158">Monitoring</span></span>

<span data-ttu-id="57e23-159">如果攻擊者試圖滲透應用程式,應該有一些警告。</span><span class="sxs-lookup"><span data-stu-id="57e23-159">Should an attacker attempt to penetrate an application, there should be some warning of it.</span></span> <span data-ttu-id="57e23-160">通常,可以通過檢查服務中的日誌來發現攻擊。</span><span class="sxs-lookup"><span data-stu-id="57e23-160">Frequently, attacks can be spotted by examining the logs from services.</span></span> <span data-ttu-id="57e23-161">攻擊留下的跡象,可以在它們成功之前被發現。</span><span class="sxs-lookup"><span data-stu-id="57e23-161">Attacks leave telltale signs that can be spotted before they succeed.</span></span> <span data-ttu-id="57e23-162">例如,試圖猜測密碼的攻擊者會向登錄系統發出許多請求。</span><span class="sxs-lookup"><span data-stu-id="57e23-162">For instance, an attacker attempting to guess a password will make many requests to a login system.</span></span> <span data-ttu-id="57e23-163">監視登錄系統可以檢測與典型訪問模式不一致奇怪的模式。</span><span class="sxs-lookup"><span data-stu-id="57e23-163">Monitoring around the login system can detect weird patterns that are out of line with the typical access pattern.</span></span> <span data-ttu-id="57e23-164">此監視可以轉換為警報,從而提醒操作人員啟動某種對策。</span><span class="sxs-lookup"><span data-stu-id="57e23-164">This monitoring can be turned into an alert that can, in turn, alert an operations person to activate some sort of countermeasure.</span></span> <span data-ttu-id="57e23-165">高度成熟的監控系統甚至可能根據這些偏差採取主動添加規則以阻止請求或限制回應的操作。</span><span class="sxs-lookup"><span data-stu-id="57e23-165">A highly mature monitoring system might even take action based on these deviations proactively adding rules to block requests or throttle responses.</span></span>

## <a name="securing-the-build"></a><span data-ttu-id="57e23-166">保護產生</span><span class="sxs-lookup"><span data-stu-id="57e23-166">Securing the build</span></span>

<span data-ttu-id="57e23-167">在構建過程中經常忽略安全性的一個位置。</span><span class="sxs-lookup"><span data-stu-id="57e23-167">One place where security is often overlooked is around the build process.</span></span> <span data-ttu-id="57e23-168">生成不僅應運行安全檢查,例如掃描不安全的代碼或簽入憑據,而且生成本身應是安全的。</span><span class="sxs-lookup"><span data-stu-id="57e23-168">Not only should the build run security checks, such as scanning for insecure code or checked-in credentials, but the build itself should be secure.</span></span> <span data-ttu-id="57e23-169">如果生成伺服器遭到破壞,則它提供了一個極好的向量,用於在產品中引入任意代碼。</span><span class="sxs-lookup"><span data-stu-id="57e23-169">If the build server is compromised, then it provides a fantastic vector for introducing arbitrary code into the product.</span></span>

<span data-ttu-id="57e23-170">想像一下,攻擊者希望竊取登錄到 Web 應用程式的用戶的密碼。</span><span class="sxs-lookup"><span data-stu-id="57e23-170">Imagine that an attacker is looking to steal the passwords of people signing into a web application.</span></span> <span data-ttu-id="57e23-171">他們可以引入一個生成步驟,修改簽出的代碼,將任何登錄請求鏡像到另一台伺服器。</span><span class="sxs-lookup"><span data-stu-id="57e23-171">They could introduce a build step that modifies the checked-out code to mirror any login request to another server.</span></span> <span data-ttu-id="57e23-172">下次代碼通過生成時,將靜默更新代碼。</span><span class="sxs-lookup"><span data-stu-id="57e23-172">The next time code goes through the build, it's silently updated.</span></span> <span data-ttu-id="57e23-173">原始程式碼漏洞掃描在生成之前運行時不會捕獲此情況。</span><span class="sxs-lookup"><span data-stu-id="57e23-173">The source code vulnerability scanning won't catch this as it runs before the build.</span></span> <span data-ttu-id="57e23-174">同樣,沒有人會在代碼評審中捕獲它,因為生成步驟位於生成伺服器上。</span><span class="sxs-lookup"><span data-stu-id="57e23-174">Equally, nobody will catch it in a code review because the build steps live on the build server.</span></span> <span data-ttu-id="57e23-175">被利用的代碼將進入生產,在那裡它可以獲取密碼。</span><span class="sxs-lookup"><span data-stu-id="57e23-175">The exploited code will go to production where it can harvest passwords.</span></span> <span data-ttu-id="57e23-176">可能沒有生成過程更改的審核日誌,或者至少沒有人監視審核。</span><span class="sxs-lookup"><span data-stu-id="57e23-176">Probably there's no audit log of the build process changes, or at least nobody monitoring the audit.</span></span>

<span data-ttu-id="57e23-177">這是一個看似低值目標的完美示例,可用於侵入系統。</span><span class="sxs-lookup"><span data-stu-id="57e23-177">This is a perfect example of a seemingly low value target that can be used to break into the system.</span></span> <span data-ttu-id="57e23-178">一旦攻擊者破壞系統週邊,他們可以開始尋找方法,將其許可權提升到他們可以在他們喜歡的任何地方造成實際傷害。</span><span class="sxs-lookup"><span data-stu-id="57e23-178">Once an attacker breaches the perimeter of the system, they can start working on finding ways to elevate their permissions to the point that they can cause real harm anywhere they like.</span></span>

## <a name="building-secure-code"></a><span data-ttu-id="57e23-179">建構安全代碼</span><span class="sxs-lookup"><span data-stu-id="57e23-179">Building secure code</span></span>

<span data-ttu-id="57e23-180">.NET 框架已經是一個相當安全的框架。</span><span class="sxs-lookup"><span data-stu-id="57e23-180">.NET Framework is already a quite secure framework.</span></span> <span data-ttu-id="57e23-181">它避免了非託管代碼的一些陷阱,例如從陣列的末端走開。</span><span class="sxs-lookup"><span data-stu-id="57e23-181">It avoids some of the pitfalls of unmanaged code, such as walking off the ends of arrays.</span></span> <span data-ttu-id="57e23-182">在發現安全漏洞時,正在積極修復這些安全漏洞。</span><span class="sxs-lookup"><span data-stu-id="57e23-182">Work is actively done to fix security holes as they're discovered.</span></span> <span data-ttu-id="57e23-183">甚至有一個錯誤[賞金計劃](https://www.microsoft.com/msrc/bounty),支付研究人員發現框架中的問題,並報告他們,而不是利用他們。</span><span class="sxs-lookup"><span data-stu-id="57e23-183">There's even a [bug bounty program](https://www.microsoft.com/msrc/bounty) that pays researchers to find issues in the framework and report them instead of exploiting them.</span></span>

<span data-ttu-id="57e23-184">有許多方法可以使 .NET 代碼更安全。</span><span class="sxs-lookup"><span data-stu-id="57e23-184">There are many ways to make .NET code more secure.</span></span> <span data-ttu-id="57e23-185">遵循[.NET 文章的安全編碼準則](https://docs.microsoft.com/dotnet/standard/security/secure-coding-guidelines)等準則是一個合理的步驟,可確保代碼從一開始是安全的。</span><span class="sxs-lookup"><span data-stu-id="57e23-185">Following guidelines such as the [Secure coding guidelines for .NET](https://docs.microsoft.com/dotnet/standard/security/secure-coding-guidelines) article is a reasonable step to take to ensure that the code is secure from the ground up.</span></span> <span data-ttu-id="57e23-186">[OWASP 前 10 名](https://owasp.org/www-project-top-ten/)是構建安全代碼的另一個寶貴指南。</span><span class="sxs-lookup"><span data-stu-id="57e23-186">The [OWASP top 10](https://owasp.org/www-project-top-ten/) is another invaluable guide to build secure code.</span></span>

<span data-ttu-id="57e23-187">生成過程是放置掃描工具以在原始程式碼中檢測問題之前將其投入生產的好地方。</span><span class="sxs-lookup"><span data-stu-id="57e23-187">The build process is a good place to put scanning tools to detect problems in source code before they make it into production.</span></span> <span data-ttu-id="57e23-188">大多數項目都依賴於其他一些包。</span><span class="sxs-lookup"><span data-stu-id="57e23-188">Most every project has dependencies on some other packages.</span></span> <span data-ttu-id="57e23-189">可以掃描過期包的工具將在夜間生成中捕獲問題。</span><span class="sxs-lookup"><span data-stu-id="57e23-189">A tool that can scan for outdated packages will catch problems in a nightly build.</span></span> <span data-ttu-id="57e23-190">即使在構建 Docker 映射時,檢查並確保基本映射沒有已知的漏洞也很有用。</span><span class="sxs-lookup"><span data-stu-id="57e23-190">Even when building Docker images, it's useful to check and make sure that the base image doesn't have known vulnerabilities.</span></span> <span data-ttu-id="57e23-191">另一件事要檢查的是,沒有人不小心簽入憑據。</span><span class="sxs-lookup"><span data-stu-id="57e23-191">Another thing to check is that nobody has accidentally checked in credentials.</span></span>

## <a name="built-in-security"></a><span data-ttu-id="57e23-192">內置安全性</span><span class="sxs-lookup"><span data-stu-id="57e23-192">Built-in security</span></span>

<span data-ttu-id="57e23-193">Azure 旨在平衡大多數使用者的可用性和安全性。</span><span class="sxs-lookup"><span data-stu-id="57e23-193">Azure is designed to balance usability and security for the majority of users.</span></span> <span data-ttu-id="57e23-194">不同的使用者將有不同的安全要求,因此他們需要微調其雲安全方法。</span><span class="sxs-lookup"><span data-stu-id="57e23-194">Different users are going to have different security requirements, so they need to fine-tune their approach to cloud security.</span></span> <span data-ttu-id="57e23-195">微軟在[信任中心](https://azure.microsoft.com/support/trust-center/)發佈了大量安全資訊。</span><span class="sxs-lookup"><span data-stu-id="57e23-195">Microsoft publishes a great deal of security information in the [Trust Center](https://azure.microsoft.com/support/trust-center/).</span></span> <span data-ttu-id="57e23-196">對於有興趣瞭解內置攻擊緩解技術工作方式的專業人員來說,此資源應該是第一站。</span><span class="sxs-lookup"><span data-stu-id="57e23-196">This resource should be the first stop for those professionals interested in understanding how the built-in attack mitigation technologies work.</span></span>

<span data-ttu-id="57e23-197">在 Azure 門戶中[,Azure Advisor](https://azure.microsoft.com/services/advisor/)是一個不斷掃描環境並提出建議的系統。</span><span class="sxs-lookup"><span data-stu-id="57e23-197">Within the Azure portal, the [Azure Advisor](https://azure.microsoft.com/services/advisor/) is a system that is constantly scanning an environment and making recommendations.</span></span> <span data-ttu-id="57e23-198">其中一些建議旨在節省用戶資金,但其他建議旨在識別潛在的不安全配置,例如將存儲容器打開給世界,不受虛擬網路的保護。</span><span class="sxs-lookup"><span data-stu-id="57e23-198">Some of these recommendations are designed to save users money, but others are designed to identify potentially insecure configurations, such as having a storage container open to the world and not protected by a Virtual Network.</span></span>

## <a name="azure-network-infrastructure"></a><span data-ttu-id="57e23-199">Azure 網路基礎結構</span><span class="sxs-lookup"><span data-stu-id="57e23-199">Azure network infrastructure</span></span>

<span data-ttu-id="57e23-200">在本地部署環境中,大量精力用於建立網路。</span><span class="sxs-lookup"><span data-stu-id="57e23-200">In an on-premises deployment environment, a great deal of energy is dedicated to setting up networking.</span></span> <span data-ttu-id="57e23-201">設置路由器、交換機等工作很複雜。</span><span class="sxs-lookup"><span data-stu-id="57e23-201">Setting up routers, switches, and the such is complicated work.</span></span> <span data-ttu-id="57e23-202">網路允許某些資源與其他資源對話,並在某些情況下阻止訪問。</span><span class="sxs-lookup"><span data-stu-id="57e23-202">Networks allow certain resources to talk to other resources and prevent access in some cases.</span></span> <span data-ttu-id="57e23-203">頻繁的網路規則是限制從開發環境存取生產環境,因為半開發的代碼運行錯誤並刪除了大量數據。</span><span class="sxs-lookup"><span data-stu-id="57e23-203">A frequent network rule is to restrict access to the production environment from the development environment on the off chance that a half-developed piece of code runs awry and deletes a swath of data.</span></span>

<span data-ttu-id="57e23-204">開箱即用,大多數 PaaS Azure 資源只有最基本和寬鬆的網路設置。</span><span class="sxs-lookup"><span data-stu-id="57e23-204">Out of the box, most PaaS Azure resources have only the most basic and permissive networking setup.</span></span> <span data-ttu-id="57e23-205">例如,Internet 上的任何人都可以訪問應用服務。</span><span class="sxs-lookup"><span data-stu-id="57e23-205">For instance, anybody on the Internet can access an app service.</span></span> <span data-ttu-id="57e23-206">新的 SQL Server 實例通常受到限制,因此外部各方無法訪問它們,但 Azure 本身使用的 IP 位址範圍允許通過。</span><span class="sxs-lookup"><span data-stu-id="57e23-206">New SQL Server instances typically come restricted, so that external parties can't access them, but the IP address ranges used by Azure itself are permitted through.</span></span> <span data-ttu-id="57e23-207">因此,雖然 SQL 伺服器不受外部威脅保護,但攻擊者只需設置 Azure 橋頭,即可對 Azure 上的所有 SQL 實例發起攻擊。</span><span class="sxs-lookup"><span data-stu-id="57e23-207">So, while the SQL server is protected from external threats, an attacker only needs to set up an Azure bridgehead from where they can launch attacks against all SQL instances on Azure.</span></span>

<span data-ttu-id="57e23-208">幸運的是,大多數 Azure 資源都可以放入 Azure 虛擬網路,從而允許更精細的粒度訪問控制。</span><span class="sxs-lookup"><span data-stu-id="57e23-208">Fortunately, most Azure resources can be placed into an Azure Virtual Network that allows finer grained access control.</span></span> <span data-ttu-id="57e23-209">與本地網路建立不受更廣泛保護的專用網路的方式類似,虛擬網路是位於 Azure 網路內的專用 IP 位址孤島。</span><span class="sxs-lookup"><span data-stu-id="57e23-209">Similar to the way that on-premises networks establish private networks that are protected from the wider world, virtual networks are islands of private IP addresses that are located within the Azure network.</span></span>

<span data-ttu-id="57e23-210">![圖 10-1 Azure](./media/virtual-network.png)
圖**10-1**中的虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="57e23-210">![Figure 10-1 A virtual network in Azure](./media/virtual-network.png)
**Figure 10-1**.</span></span> <span data-ttu-id="57e23-211">Azure 中的虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="57e23-211">A virtual network in Azure.</span></span>

<span data-ttu-id="57e23-212">與本地網路具有管理網路訪問的防火牆一樣,您也可以在虛擬網路的邊界處建立類似的防火牆。</span><span class="sxs-lookup"><span data-stu-id="57e23-212">In the same way that on-premises networks have a firewall governing access to the network, you can establish a similar firewall at the boundary of the virtual network.</span></span> <span data-ttu-id="57e23-213">預設情況下,虛擬網路上的所有資源仍可與 Internet 對話。</span><span class="sxs-lookup"><span data-stu-id="57e23-213">By default, all the resources on a virtual network can still talk to the Internet.</span></span> <span data-ttu-id="57e23-214">只有傳入連接需要某種形式的顯式防火牆異常。</span><span class="sxs-lookup"><span data-stu-id="57e23-214">It's only incoming connections that require some form of explicit firewall exception.</span></span>

<span data-ttu-id="57e23-215">建立網路後,可以設置存儲帳戶等內部資源,以便僅允許虛擬網路上的資源進行訪問。</span><span class="sxs-lookup"><span data-stu-id="57e23-215">With the network established, internal resources like storage accounts can be set up to only allow for access by resources that are also on the Virtual Network.</span></span> <span data-ttu-id="57e23-216">此防火牆提供了額外的安全級別,如果該存儲帳戶的密鑰洩露,攻擊者將無法連接到它以利用洩漏的密鑰。</span><span class="sxs-lookup"><span data-stu-id="57e23-216">This firewall provides an extra level of security, should the keys for that storage account be leaked, attackers wouldn't be able to connect to it to exploit the leaked keys.</span></span> <span data-ttu-id="57e23-217">這是最低特權原則的另一個例子。</span><span class="sxs-lookup"><span data-stu-id="57e23-217">This is another example of the principle of least privilege.</span></span>

<span data-ttu-id="57e23-218">Azure Kubernetes 群集中的節點可以像 Azure 更本機的其他資源一樣參與虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="57e23-218">The nodes in an Azure Kubernetes cluster can participate in a virtual network just like other resources that are more native to Azure.</span></span> <span data-ttu-id="57e23-219">此功能稱為[Azure 容器網路介面](https://github.com/Azure/azure-container-networking/blob/master/docs/cni.md)。</span><span class="sxs-lookup"><span data-stu-id="57e23-219">This functionality is called [Azure Container Networking Interface](https://github.com/Azure/azure-container-networking/blob/master/docs/cni.md).</span></span> <span data-ttu-id="57e23-220">實際上,它在虛擬網路中分配了一個子網,在虛擬網路中分配虛擬機和容器映射。</span><span class="sxs-lookup"><span data-stu-id="57e23-220">In effect, it allocates a subnet within the virtual network on which virtual machines and container images are allocated.</span></span>

<span data-ttu-id="57e23-221">繼續沿著展示最小特權原則的道路前進,並不是虛擬網路中的每個資源都需要與所有其他資源進行對話。</span><span class="sxs-lookup"><span data-stu-id="57e23-221">Continuing down the path of illustrating the principle of least privilege, not every resource within a Virtual Network needs to talk to every other resource.</span></span> <span data-ttu-id="57e23-222">例如,在通過存儲帳戶和 SQL 資料庫提供 Web API 的應用程式中,資料庫和儲存帳戶不太可能需要彼此對話。</span><span class="sxs-lookup"><span data-stu-id="57e23-222">For instance, in an application that provides a web API over a storage account and a SQL database, it's unlikely that the database and the storage account need to talk to one another.</span></span> <span data-ttu-id="57e23-223">它們之間的任何數據共享都將通過 Web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="57e23-223">Any data sharing between them would go through the web application.</span></span> <span data-ttu-id="57e23-224">因此,[可以使用網路安全組 (NSG)](https://docs.microsoft.com/azure/virtual-network/security-overview)來拒絕兩個服務之間的流量。</span><span class="sxs-lookup"><span data-stu-id="57e23-224">So, a [network security group (NSG)](https://docs.microsoft.com/azure/virtual-network/security-overview) could be used to deny traffic between the two services.</span></span>

<span data-ttu-id="57e23-225">拒絕資源之間通信的策略可能很令人討厭,尤其是來自使用 Azure 不受流量限制的背景。</span><span class="sxs-lookup"><span data-stu-id="57e23-225">A policy of denying communication between resources can be annoying to implement, especially coming from a background of using Azure without traffic restrictions.</span></span> <span data-ttu-id="57e23-226">在其他一些雲上,網路安全組的概念更為普遍。</span><span class="sxs-lookup"><span data-stu-id="57e23-226">On some other clouds, the concept of network security groups is much more prevalent.</span></span> <span data-ttu-id="57e23-227">例如,AWS 上的預設策略是,資源在 NSG 中的規則啟用之前,無法相互通信。</span><span class="sxs-lookup"><span data-stu-id="57e23-227">For instance, the default policy on AWS is that resources can't communicate among themselves until enabled by rules in an NSG.</span></span> <span data-ttu-id="57e23-228">雖然開發此環境的速度較慢,但限制性更大的環境提供了更安全的預設值。</span><span class="sxs-lookup"><span data-stu-id="57e23-228">While slower to develop this, more restrictive environment provides a more secure default.</span></span> <span data-ttu-id="57e23-229">使用適當的 DevOps 實踐,特別是使用[Azure 資源管理器或 Terraform](infrastructure-as-code.md)管理許可權可以簡化控制規則。</span><span class="sxs-lookup"><span data-stu-id="57e23-229">Making use of proper DevOps practices, especially using [Azure Resource Manager or Terraform](infrastructure-as-code.md) to manage permissions can make controlling the rules easier.</span></span>

<span data-ttu-id="57e23-230">在設置本地和雲端之間的通信時,虛擬網路也很有用。</span><span class="sxs-lookup"><span data-stu-id="57e23-230">Virtual Networks can also be useful when setting up communication between on-premises and cloud resources.</span></span> <span data-ttu-id="57e23-231">虛擬專用網路可用於將兩個網路無縫連接在一起。</span><span class="sxs-lookup"><span data-stu-id="57e23-231">A virtual private network can be used to seamlessly attach the two networks together.</span></span> <span data-ttu-id="57e23-232">這允許運行虛擬網路,而無需任何類型的閘道,因為所有使用者都在現場。</span><span class="sxs-lookup"><span data-stu-id="57e23-232">This allows running a virtual network without any sort of gateway for scenarios where all the users are on-site.</span></span> <span data-ttu-id="57e23-233">有許多技術可用於建立此網路。</span><span class="sxs-lookup"><span data-stu-id="57e23-233">There are a number of technologies that can be used to establish this network.</span></span> <span data-ttu-id="57e23-234">最簡單的方法是使用可在多個路由器和 Azure 之間建立[的網站到網站 VPN。](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#s2smulti)</span><span class="sxs-lookup"><span data-stu-id="57e23-234">The simplest is to use a [site-to-site VPN](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#s2smulti) that can be established between many routers and Azure.</span></span> <span data-ttu-id="57e23-235">流量通過 Internet 加密和隧道,每個位元組的成本與任何其他流量相同。</span><span class="sxs-lookup"><span data-stu-id="57e23-235">Traffic is encrypted and tunneled over the Internet at the same cost per byte as any other traffic.</span></span> <span data-ttu-id="57e23-236">對於需要更多頻寬或安全性的方案,Azure 提供稱為[快速路由](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#ExpressRoute)的服務,該服務使用本地網路和 Azure 之間的專用電路。</span><span class="sxs-lookup"><span data-stu-id="57e23-236">For scenarios where more bandwidth or more security is desirable, Azure offers a service called [Express Route](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#ExpressRoute) that uses a private circuit between an on-premises network and Azure.</span></span> <span data-ttu-id="57e23-237">它的成本更高,更難建立,但也更安全。</span><span class="sxs-lookup"><span data-stu-id="57e23-237">It's more costly and difficult to establish but also more secure.</span></span>

## <a name="role-based-access-control-for-restricting-access-to-azure-resources"></a><span data-ttu-id="57e23-238">限制對 Azure 資源的存取的基於角色的存取控制</span><span class="sxs-lookup"><span data-stu-id="57e23-238">Role-based access control for restricting access to Azure resources</span></span>

<span data-ttu-id="57e23-239">RBAC 是一個向在 Azure 中運行的應用程式提供標識的系統。</span><span class="sxs-lookup"><span data-stu-id="57e23-239">RBAC is a system that provides an identity to applications running in Azure.</span></span> <span data-ttu-id="57e23-240">應用程式可以使用此標識存取資源,而不是使用密鑰或密碼之外。</span><span class="sxs-lookup"><span data-stu-id="57e23-240">Applications can access resources using this identity instead of or in addition to using keys or passwords.</span></span>

## <a name="security-principals"></a><span data-ttu-id="57e23-241">安全性主體</span><span class="sxs-lookup"><span data-stu-id="57e23-241">Security Principals</span></span>

<span data-ttu-id="57e23-242">RBAC 中的第一個元件是安全主體。</span><span class="sxs-lookup"><span data-stu-id="57e23-242">The first component in RBAC is a security principal.</span></span> <span data-ttu-id="57e23-243">安全主體可以是使用者、組、服務主體或託管標識。</span><span class="sxs-lookup"><span data-stu-id="57e23-243">A security principal can be a user, group, service principal, or managed identity.</span></span>

<span data-ttu-id="57e23-244">![圖 10-2 不同類型](./media/rbac-security-principal.png)
的安全主體**圖 10-2**。</span><span class="sxs-lookup"><span data-stu-id="57e23-244">![Figure 10-2 Different types of security principals](./media/rbac-security-principal.png)
**Figure 10-2**.</span></span> <span data-ttu-id="57e23-245">不同類型的安全主體。</span><span class="sxs-lookup"><span data-stu-id="57e23-245">Different types of security principals.</span></span>

- <span data-ttu-id="57e23-246">使用者 - 在 Azure 活動目錄中具有帳戶的任何使用者都是使用者。</span><span class="sxs-lookup"><span data-stu-id="57e23-246">User - Any user who has an account in Azure Active Directory is a user.</span></span>
- <span data-ttu-id="57e23-247">組 - Azure 活動目錄中的使用者集合。</span><span class="sxs-lookup"><span data-stu-id="57e23-247">Group - A collection of users from Azure Active Directory.</span></span> <span data-ttu-id="57e23-248">作為組的成員,使用者除了承擔自己的角色外,還承擔該組的角色。</span><span class="sxs-lookup"><span data-stu-id="57e23-248">As a member of a group, a user takes on the roles of that group in addition to their own.</span></span>
- <span data-ttu-id="57e23-249">服務主體 - 服務或應用程式運行的安全標識。</span><span class="sxs-lookup"><span data-stu-id="57e23-249">Service principal - A security identity under which services or applications run.</span></span>
- <span data-ttu-id="57e23-250">託管識別 - 由 Azure 管理的 Azure 活動目錄識別。</span><span class="sxs-lookup"><span data-stu-id="57e23-250">Managed identity - An Azure Active Directory identity managed by Azure.</span></span> <span data-ttu-id="57e23-251">託管識別通常用於開發管理認證以驗證 Azure 服務的雲端應用程式。</span><span class="sxs-lookup"><span data-stu-id="57e23-251">Managed identities are typically used when developing cloud applications that manage the credentials for authenticating to Azure services.</span></span>

<span data-ttu-id="57e23-252">安全主體可以應用於大多數任何資源。</span><span class="sxs-lookup"><span data-stu-id="57e23-252">The security principal can be applied to most any resource.</span></span> <span data-ttu-id="57e23-253">這意味著可以將安全主體分配給在 Azure Kubernetes 中運行的容器,從而允許它存取記憶體在密鑰保管庫中的機密。</span><span class="sxs-lookup"><span data-stu-id="57e23-253">This means that it's possible to assign a security principal to a container running within Azure Kubernetes, allowing it to access secrets stored in Key Vault.</span></span> <span data-ttu-id="57e23-254">Azure 函數可以具有允許它與活動目錄實例進行對話的許可權,以驗證呼叫使用者的 JWT。</span><span class="sxs-lookup"><span data-stu-id="57e23-254">An Azure Function could take on a permission allowing it to talk to an Active Directory instance to validate a JWT for a calling user.</span></span> <span data-ttu-id="57e23-255">使用服務主體啟用服務后,可以使用角色和作用域對服務的許可權進行精細管理。</span><span class="sxs-lookup"><span data-stu-id="57e23-255">Once services are enabled with a service principal, their permissions can be managed granularly using roles and scopes.</span></span>

## <a name="roles"></a><span data-ttu-id="57e23-256">角色</span><span class="sxs-lookup"><span data-stu-id="57e23-256">Roles</span></span>

<span data-ttu-id="57e23-257">安全主體可以承擔許多角色,或者,用更諷刺的類比,戴許多帽子。</span><span class="sxs-lookup"><span data-stu-id="57e23-257">A security principal can take on many roles or, using a more sartorial analogy, wear many hats.</span></span> <span data-ttu-id="57e23-258">每個角色定義一系列許可權,例如「從 Azure 服務總線終結點讀取消息」。。</span><span class="sxs-lookup"><span data-stu-id="57e23-258">Each role defines a series of permissions such as "Read messages from Azure Service Bus endpoint".</span></span> <span data-ttu-id="57e23-259">安全主體的有效許可權集是分配給安全主體具有的所有角色的所有許可權的組合。</span><span class="sxs-lookup"><span data-stu-id="57e23-259">The effective permission set of a security principal is the combination of all the permissions assigned to all the roles that security principal has.</span></span> <span data-ttu-id="57e23-260">Azure 具有大量內置角色,用戶可以定義自己的角色。</span><span class="sxs-lookup"><span data-stu-id="57e23-260">Azure has a large number of built-in roles and users can define their own roles.</span></span>

<span data-ttu-id="57e23-261">![圖 10-3 RBAC](./media/rbac-role-definition.png)
角色定義 圖**10-3**。</span><span class="sxs-lookup"><span data-stu-id="57e23-261">![Figure 10-3 RBAC role definitions](./media/rbac-role-definition.png)
**Figure 10-3**.</span></span> <span data-ttu-id="57e23-262">RBAC 角色定義。</span><span class="sxs-lookup"><span data-stu-id="57e23-262">RBAC role definitions.</span></span>

<span data-ttu-id="57e23-263">內置於 Azure 中也是許多高級角色,如擁有者、參與者、讀取器和使用者帳戶管理員。</span><span class="sxs-lookup"><span data-stu-id="57e23-263">Built into Azure are also a number of high-level roles such as Owner, Contributor, Reader, and User Account Administrator.</span></span> <span data-ttu-id="57e23-264">使用"擁有者"角色,安全主體可以訪問所有資源並將許可權分配給其他人。</span><span class="sxs-lookup"><span data-stu-id="57e23-264">With the Owner role, a security principal can access all resources and assign permissions to others.</span></span> <span data-ttu-id="57e23-265">參與者對所有資源具有相同級別的訪問許可權,但他們無法分配許可權。</span><span class="sxs-lookup"><span data-stu-id="57e23-265">A contributor has the same level of access to all resources but they can't assign permissions.</span></span> <span data-ttu-id="57e23-266">讀者只能查看現有的 Azure 資源,使用者帳戶管理員可以管理對 Azure 資源的訪問許可權。</span><span class="sxs-lookup"><span data-stu-id="57e23-266">A Reader can only view existing Azure resources and a User Account Administrator can manage access to Azure resources.</span></span>

<span data-ttu-id="57e23-267">更精細的內建角色(如[DNS 區域參與者](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#dns-zone-contributor))的許可權僅限於單個服務。</span><span class="sxs-lookup"><span data-stu-id="57e23-267">More granular built-in roles such as [DNS Zone Contributor](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#dns-zone-contributor) have rights limited to a single service.</span></span> <span data-ttu-id="57e23-268">安全主體可以承擔任意數量的角色。</span><span class="sxs-lookup"><span data-stu-id="57e23-268">Security principals can take on any number of roles.</span></span>

## <a name="scopes"></a><span data-ttu-id="57e23-269">範圍</span><span class="sxs-lookup"><span data-stu-id="57e23-269">Scopes</span></span>

<span data-ttu-id="57e23-270">角色可以應用於 Azure 中的受限制資源集。</span><span class="sxs-lookup"><span data-stu-id="57e23-270">Roles can be applied to a restricted set of resources within Azure.</span></span> <span data-ttu-id="57e23-271">例如,將作用域應用於以前從服務總線佇列讀取的示例,可以將許可權範圍縮小到單個佇列:"從 Azure 服務總線`blah.servicebus.windows.net/queue1`終結點 讀取消息"</span><span class="sxs-lookup"><span data-stu-id="57e23-271">For instance, applying scope to the previous example of reading from a Service Bus queue, you can narrow the permission to a single queue: "Read messages from Azure Service Bus endpoint `blah.servicebus.windows.net/queue1`"</span></span>

<span data-ttu-id="57e23-272">範圍可以像單個資源一樣窄,也可以應用於整個資源組、訂閱甚至管理組。</span><span class="sxs-lookup"><span data-stu-id="57e23-272">The scope can be as narrow as a single resource or it can be applied to an entire resource group, subscription, or even management group.</span></span>

<span data-ttu-id="57e23-273">測試安全主體是否具有特定許可權時,將考慮角色和作用域的組合。</span><span class="sxs-lookup"><span data-stu-id="57e23-273">When testing if a security principal has a certain permission, the combination of role and scope are taken into account.</span></span> <span data-ttu-id="57e23-274">此組合提供了強大的授權機制。</span><span class="sxs-lookup"><span data-stu-id="57e23-274">This combination provides a powerful authorization mechanism.</span></span>

## <a name="deny"></a><span data-ttu-id="57e23-275">拒絕</span><span class="sxs-lookup"><span data-stu-id="57e23-275">Deny</span></span>

<span data-ttu-id="57e23-276">以前,RBAC 只允許使用"允許"規則。</span><span class="sxs-lookup"><span data-stu-id="57e23-276">Previously, only "allow" rules were permitted for RBAC.</span></span> <span data-ttu-id="57e23-277">此行為使一些作用域難以構建。</span><span class="sxs-lookup"><span data-stu-id="57e23-277">This behavior made some scopes complicated to build.</span></span> <span data-ttu-id="57e23-278">例如,允許安全主體訪問所有存儲帳戶,但需要向可能無休止的存儲帳戶清單授予顯式許可權。</span><span class="sxs-lookup"><span data-stu-id="57e23-278">For instance, allowing a security principal access to all storage accounts except one required granting explicit permission to a potentially endless list of storage accounts.</span></span> <span data-ttu-id="57e23-279">每次創建新存儲帳戶時,都必須將其添加到此帳戶清單中。</span><span class="sxs-lookup"><span data-stu-id="57e23-279">Every time a new storage account was created, it would have to be added to this list of accounts.</span></span> <span data-ttu-id="57e23-280">這增加了管理開銷,這當然不可取。</span><span class="sxs-lookup"><span data-stu-id="57e23-280">This added management overhead that certainly wasn't desirable.</span></span>

<span data-ttu-id="57e23-281">拒絕規則優先於允許規則。</span><span class="sxs-lookup"><span data-stu-id="57e23-281">Deny rules take precedence over allow rules.</span></span> <span data-ttu-id="57e23-282">現在,表示相同的"允許所有人,但一個"範圍可以表示為兩個規則"允許所有"和"拒絕這個特定規則"。</span><span class="sxs-lookup"><span data-stu-id="57e23-282">Now representing the same "allow all but one" scope could be represented as two rules "allow all" and "deny this one specific one".</span></span> <span data-ttu-id="57e23-283">拒絕規則不僅簡化了管理,還允許通過拒絕對所有人的訪問來提供額外安全的資源。</span><span class="sxs-lookup"><span data-stu-id="57e23-283">Deny rules not only ease management but allow for resources that are extra secure by denying access to everybody.</span></span>

## <a name="checking-access"></a><span data-ttu-id="57e23-284">檢查存取</span><span class="sxs-lookup"><span data-stu-id="57e23-284">Checking access</span></span>

<span data-ttu-id="57e23-285">可以想像,擁有大量的角色和作用域會使找出服務主體的有效許可權變得相當困難。</span><span class="sxs-lookup"><span data-stu-id="57e23-285">As you can imagine, having a large number of roles and scopes can make figuring out the effective permission of a service principal quite difficult.</span></span> <span data-ttu-id="57e23-286">除此之外,Piling 拒絕規則只會增加複雜性。</span><span class="sxs-lookup"><span data-stu-id="57e23-286">Piling deny rules on top of that, only serves to increase the complexity.</span></span> <span data-ttu-id="57e23-287">幸運的是,有一個許可權計算機可以顯示任何服務主體的有效許可權。</span><span class="sxs-lookup"><span data-stu-id="57e23-287">Fortunately, there's a permissions calculator that can show the effective permissions for any service principal.</span></span> <span data-ttu-id="57e23-288">它通常位於門戶中的 IAM 選項卡下,如圖 10-3 所示。</span><span class="sxs-lookup"><span data-stu-id="57e23-288">It's typically found under the IAM tab in the portal, as shown in Figure 10-3.</span></span>

<span data-ttu-id="57e23-289">![圖 10-4](./media/check-rbac.png)
應用服務 權限計算器 圖**10-4**。</span><span class="sxs-lookup"><span data-stu-id="57e23-289">![Figure 10-4 Permission calculator for an app service](./media/check-rbac.png)
**Figure 10-4**.</span></span> <span data-ttu-id="57e23-290">應用服務的許可權計算機。</span><span class="sxs-lookup"><span data-stu-id="57e23-290">Permission calculator for an app service.</span></span>

## <a name="securing-secrets"></a><span data-ttu-id="57e23-291">保護機密</span><span class="sxs-lookup"><span data-stu-id="57e23-291">Securing secrets</span></span>

<span data-ttu-id="57e23-292">密碼和證書是攻擊者的常見攻擊媒介。</span><span class="sxs-lookup"><span data-stu-id="57e23-292">Passwords and certificates are a common attack vector for attackers.</span></span> <span data-ttu-id="57e23-293">破解密碼的硬體可以進行暴力攻擊,並嘗試每秒猜測數十億個密碼。</span><span class="sxs-lookup"><span data-stu-id="57e23-293">Password-cracking hardware can do a  brute-force attack and try to guess billions of passwords per second.</span></span> <span data-ttu-id="57e23-294">因此,用於訪問資源的密碼必須強大,並且具有繁多的字元,這一點很重要。</span><span class="sxs-lookup"><span data-stu-id="57e23-294">So it's important that the passwords that are used to access resources are strong, with a large variety of characters.</span></span> <span data-ttu-id="57e23-295">這些密碼正是幾乎不可能記住的密碼類型。</span><span class="sxs-lookup"><span data-stu-id="57e23-295">These passwords are exactly the kind of passwords that are near impossible to remember.</span></span> <span data-ttu-id="57e23-296">幸運的是,Azure 中的密碼實際上不需要任何人員知道。</span><span class="sxs-lookup"><span data-stu-id="57e23-296">Fortunately, the passwords in Azure don't actually need to be known by any human.</span></span>

<span data-ttu-id="57e23-297">許多安全[專家建議](https://www.troyhunt.com/password-managers-dont-have-to-be-perfect-they-just-have-to-be-better-than-not-having-one/),使用密碼管理器保留自己的密碼是最好的方法。</span><span class="sxs-lookup"><span data-stu-id="57e23-297">Many security [experts suggest](https://www.troyhunt.com/password-managers-dont-have-to-be-perfect-they-just-have-to-be-better-than-not-having-one/) that using a password manager to keep your own passwords is the best approach.</span></span> <span data-ttu-id="57e23-298">雖然它將密碼集中到一個位置,但它也允許使用高度複雜的密碼,並確保每個帳戶都是唯一的。</span><span class="sxs-lookup"><span data-stu-id="57e23-298">While it centralizes your passwords in one location, it also allows using highly complex passwords and ensuring they're unique for each account.</span></span> <span data-ttu-id="57e23-299">Azure 中存在相同的系統:用於保密的中央存儲。</span><span class="sxs-lookup"><span data-stu-id="57e23-299">The same system exists within Azure: a central store for secrets.</span></span>

## <a name="azure-key-vault"></a><span data-ttu-id="57e23-300">Azure 金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="57e23-300">Azure Key Vault</span></span>

<span data-ttu-id="57e23-301">Azure 密鑰保管庫提供了一個集中位置,用於存儲資料庫、API 密鑰和證書等內容的密碼。</span><span class="sxs-lookup"><span data-stu-id="57e23-301">Azure Key Vault provides a centralized location to store passwords for things such as databases, API keys, and certificates.</span></span> <span data-ttu-id="57e23-302">一旦機密輸入保管庫,它永遠不會再次顯示,提取和查看它的命令是故意複雜的。</span><span class="sxs-lookup"><span data-stu-id="57e23-302">Once a secret is entered into the Vault, it's never shown again and the commands to extract and view it are purposefully complicated.</span></span> <span data-ttu-id="57e23-303">保險箱中的資訊使用軟體加密或 FIPS 140-2 級 2 級驗證的硬體安全模塊進行保護。</span><span class="sxs-lookup"><span data-stu-id="57e23-303">The information in the safe is protected using either software encryption or FIPS 140-2 Level 2 validated Hardware Security Modules.</span></span>

<span data-ttu-id="57e23-304">密鑰保管庫的訪問許可權通過 RbaC 提供,這意味著不僅任何使用者可以訪問保管庫中的資訊。</span><span class="sxs-lookup"><span data-stu-id="57e23-304">Access to the key vault is provided through RBACs, meaning that not just any user can access the information in the vault.</span></span> <span data-ttu-id="57e23-305">假設 Web 應用程式希望存取儲存在 Azure 密鑰保管庫中的資料庫連接字串。</span><span class="sxs-lookup"><span data-stu-id="57e23-305">Say a web application wishes to access the database connection string stored in Azure Key Vault.</span></span> <span data-ttu-id="57e23-306">要獲得訪問許可權,應用程式需要使用服務主體運行。</span><span class="sxs-lookup"><span data-stu-id="57e23-306">To gain access, applications need to run using a service principal.</span></span> <span data-ttu-id="57e23-307">在這個假定的角色下,他們可以從保險箱中讀取秘密。</span><span class="sxs-lookup"><span data-stu-id="57e23-307">Under this assumed role, they can read the secrets from the safe.</span></span> <span data-ttu-id="57e23-308">有許多不同的安全設置可以進一步限制應用程式對保管庫的訪問,以便它無法更新機密,只能讀取它們。</span><span class="sxs-lookup"><span data-stu-id="57e23-308">There are a number of different security settings that can further limit the access that an application has to the vault, so that it can't update secrets but only read them.</span></span>

<span data-ttu-id="57e23-309">可以監視對密鑰保管庫的訪問,以確保只有預期的應用程序訪問保管庫。</span><span class="sxs-lookup"><span data-stu-id="57e23-309">Access to the key vault can be monitored to ensure that only the expected applications are accessing the vault.</span></span> <span data-ttu-id="57e23-310">日誌可以集成到 Azure 監視器中,從而解鎖在遇到意外情況時設置警報的能力。</span><span class="sxs-lookup"><span data-stu-id="57e23-310">The logs can be integrated back into Azure Monitor, unlocking the ability to set up alerts when unexpected conditions are encountered.</span></span>

## <a name="kubernetes"></a><span data-ttu-id="57e23-311">Kubernetes</span><span class="sxs-lookup"><span data-stu-id="57e23-311">Kubernetes</span></span>

<span data-ttu-id="57e23-312">在庫伯內斯,也有類似的服務來維護一小段秘密資訊。</span><span class="sxs-lookup"><span data-stu-id="57e23-312">Within Kubernetes, there's a similar service for maintaining small pieces of secret information.</span></span> <span data-ttu-id="57e23-313">庫伯內斯的秘密可以通過`kubectl`典型的 可執行文件設置。</span><span class="sxs-lookup"><span data-stu-id="57e23-313">Kubernetes Secrets can be set via the typical `kubectl` executable.</span></span>

<span data-ttu-id="57e23-314">建立機密非常簡單,只需查找要儲存的值的 base64 版本:</span><span class="sxs-lookup"><span data-stu-id="57e23-314">Creating a secret is as simple as finding the base64 version of the values to be stored:</span></span>

```console
echo -n 'admin' | base64
YWRtaW4=
echo -n '1f2d1e2e67df' | base64
MWYyZDFlMmU2N2Rm
```

<span data-ttu-id="57e23-315">然後將加入名為「例如」的`secret.yml`機密檔中,該檔案看起來類似於以下範例:</span><span class="sxs-lookup"><span data-stu-id="57e23-315">Then adding it to a secrets file named `secret.yml` for example that looks similar to the following example:</span></span>

```yml
apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
```

<span data-ttu-id="57e23-316">最後,可以通過運行以下命令將此檔載入到 Kubernetes 中:</span><span class="sxs-lookup"><span data-stu-id="57e23-316">Finally, this file can be loaded into Kubernetes by running the following command:</span></span>

```console
kubectl apply -f ./secret.yaml
```

<span data-ttu-id="57e23-317">然後,這些機密可以裝載到卷中,或通過環境變數暴露到容器進程中。</span><span class="sxs-lookup"><span data-stu-id="57e23-317">These secrets can then be mounted into volumes or exposed to container processes through environment variables.</span></span> <span data-ttu-id="57e23-318">構建應用程式的[十二因數應用](https://12factor.net/)方法建議使用最低公共分母將設置傳輸到應用程式。</span><span class="sxs-lookup"><span data-stu-id="57e23-318">The [Twelve-factor app](https://12factor.net/) approach to building applications suggests using the lowest common denominator to transmit settings to an application.</span></span> <span data-ttu-id="57e23-319">環境變數是最低的共同點,因為它們無論操作系統或應用程式都受支援。</span><span class="sxs-lookup"><span data-stu-id="57e23-319">Environment variables are the lowest common denominator, because they're supported no matter the operating system or application.</span></span>

<span data-ttu-id="57e23-320">使用內建 Kubernetes 機密的替代方法是從庫伯內斯內部訪問 Azure 密鑰保管庫中的秘密。</span><span class="sxs-lookup"><span data-stu-id="57e23-320">An alternative to use the built-in Kubernetes secrets is to access the secrets in Azure Key Vault from within Kubernetes.</span></span> <span data-ttu-id="57e23-321">最簡單的方法是為要載入機密的容器分配 RBAC 角色。</span><span class="sxs-lookup"><span data-stu-id="57e23-321">The simplest way to do this is to assign an RBAC role to the container looking to load secrets.</span></span> <span data-ttu-id="57e23-322">然後,應用程式可以使用 Azure 密鑰保管庫 API 來訪問機密。</span><span class="sxs-lookup"><span data-stu-id="57e23-322">The application can then use the Azure Key Vault APIs to access the secrets.</span></span> <span data-ttu-id="57e23-323">但是,此方法需要修改代碼,並且不遵循使用環境變數的模式。</span><span class="sxs-lookup"><span data-stu-id="57e23-323">However, this approach requires modifications to the code and doesn't follow the pattern of using environment variables.</span></span> <span data-ttu-id="57e23-324">相反,可以使用[Azure 密鑰保管庫注入器](https://mrdevops.io/introducing-azure-key-vault-to-kubernetes-931f82364354)將值注入容器。</span><span class="sxs-lookup"><span data-stu-id="57e23-324">Instead, it's possible to inject values into a container through the use of the [Azure Key Vault Injector](https://mrdevops.io/introducing-azure-key-vault-to-kubernetes-931f82364354).</span></span> <span data-ttu-id="57e23-325">實際上,此方法比直接使用 Kubernetes 機密更安全,因為群集上的使用者可以訪問它們。</span><span class="sxs-lookup"><span data-stu-id="57e23-325">This approach is actually more secure than using the Kubernetes secrets directly, as they can be accessed by users on the cluster.</span></span>

## <a name="encryption-in-transit-and-at-rest"></a><span data-ttu-id="57e23-326">傳輸與靜態加密</span><span class="sxs-lookup"><span data-stu-id="57e23-326">Encryption in transit and at rest</span></span>

<span data-ttu-id="57e23-327">無論數據是在磁碟上還是在各種不同的服務之間傳輸,保持數據安全都很重要。</span><span class="sxs-lookup"><span data-stu-id="57e23-327">Keeping data safe is important whether it's on disk or transiting between various different services.</span></span> <span data-ttu-id="57e23-328">防止數據洩漏的最有效方法是將其加密為其他人無法輕易讀取的格式。</span><span class="sxs-lookup"><span data-stu-id="57e23-328">The most effective way to keep data from leaking is to encrypt it into a format that can't be easily read by others.</span></span> <span data-ttu-id="57e23-329">Azure 支援各種加密選項。</span><span class="sxs-lookup"><span data-stu-id="57e23-329">Azure supports a wide range of encryption options.</span></span>

### <a name="in-transit"></a><span data-ttu-id="57e23-330">傳輸中</span><span class="sxs-lookup"><span data-stu-id="57e23-330">In transit</span></span>

<span data-ttu-id="57e23-331">有幾種方法可以加密 Azure 中網路上的流量。</span><span class="sxs-lookup"><span data-stu-id="57e23-331">There are several ways to encrypt traffic on the network in Azure.</span></span> <span data-ttu-id="57e23-332">對 Azure 服務的訪問通常是透過使用傳輸層安全 (TLS) 的連接完成的。</span><span class="sxs-lookup"><span data-stu-id="57e23-332">The access to Azure services is typically done over connections that use Transport Layer Security (TLS).</span></span> <span data-ttu-id="57e23-333">例如,到 Azure API 的所有連接都需要 TLS 連接。</span><span class="sxs-lookup"><span data-stu-id="57e23-333">For instance, all the connections to the Azure APIs require TLS connections.</span></span> <span data-ttu-id="57e23-334">同樣,與 Azure 儲存中的終結點的連接可以限制為僅透過 TLS 加密連接工作。</span><span class="sxs-lookup"><span data-stu-id="57e23-334">Equally, connections to endpoints in Azure storage can be restricted to work only over TLS encrypted connections.</span></span>

<span data-ttu-id="57e23-335">TLS 是一個複雜的協定,只需知道連接使用 TLS 就不足以確保安全性。</span><span class="sxs-lookup"><span data-stu-id="57e23-335">TLS is a complicated protocol and simply knowing that the connection is using TLS isn't sufficient to ensure security.</span></span> <span data-ttu-id="57e23-336">例如,TLS 1.0 長期不安全,TLS 1.1 沒有更好的效果。</span><span class="sxs-lookup"><span data-stu-id="57e23-336">For instance, TLS 1.0 is chronically insecure, and TLS 1.1 isn't much better.</span></span> <span data-ttu-id="57e23-337">即使在 TLS 版本中,也有多種設置,使連接更易於解密。</span><span class="sxs-lookup"><span data-stu-id="57e23-337">Even within the versions of TLS, there are various settings that can make the connections easier to decrypt.</span></span> <span data-ttu-id="57e23-338">最佳操作方案是檢查並查看伺服器連接是否使用最新且配置良好的協定。</span><span class="sxs-lookup"><span data-stu-id="57e23-338">The best course of action is to check and see if the server connection is using up-to-date and well configured protocols.</span></span>

<span data-ttu-id="57e23-339">此檢查可以通過外部服務(如 SSL 實驗室的 SSL 伺服器測試)來完成。</span><span class="sxs-lookup"><span data-stu-id="57e23-339">This check can be done by an external service such as SSL labs' SSL Server Test.</span></span> <span data-ttu-id="57e23-340">針對典型的 Azure 終結點(在本例中為服務總線終結點)的測試運行會產生近乎完美的 A 分數。</span><span class="sxs-lookup"><span data-stu-id="57e23-340">A test run against a typical Azure endpoint, in this case a service bus endpoint, yields a near perfect score of A.</span></span>

<span data-ttu-id="57e23-341">即使是 Azure SQL 資料庫等服務也使用 TLS 加密來隱藏數據。</span><span class="sxs-lookup"><span data-stu-id="57e23-341">Even services like Azure SQL databases use TLS encryption to keep data hidden.</span></span> <span data-ttu-id="57e23-342">使用 TLS 加密傳輸中數據有趣的部分是,即使對於 Microsoft 來說,也不可能偵聽運行 TLS 的電腦之間的連接。</span><span class="sxs-lookup"><span data-stu-id="57e23-342">The interesting part about encrypting the data in transit using TLS is that it isn't possible, even for Microsoft, to listen in on the connection between computers running TLS.</span></span> <span data-ttu-id="57e23-343">這應該為擔心其數據可能面臨來自 Microsoft 專有甚至具有比標準攻擊者資源較多的州行為者帶來風險的公司提供了安慰。</span><span class="sxs-lookup"><span data-stu-id="57e23-343">This should provide comfort for companies concerned that their data may be at risk from Microsoft proper or even a state actor with more resources than the standard attacker.</span></span>

<span data-ttu-id="57e23-344">![圖 10-5 SSL 實驗室報告顯示服務總線終結點的 A 分數。](./media/ssl-report.png)
**圖10-5**。</span><span class="sxs-lookup"><span data-stu-id="57e23-344">![Figure 10-5 SSL labs report showing a score of A for a Service Bus endpoint.](./media/ssl-report.png)
**Figure 10-5**.</span></span> <span data-ttu-id="57e23-345">SSL 實驗室報告顯示服務總線終結點的 A 分數。</span><span class="sxs-lookup"><span data-stu-id="57e23-345">SSL labs report showing a score of A for a Service Bus endpoint.</span></span>

<span data-ttu-id="57e23-346">雖然這種級別的加密不會一直足夠,但它應該激發人們的信心,即 Azure TLS 連接相當安全。</span><span class="sxs-lookup"><span data-stu-id="57e23-346">While this level of encryption isn't going to be sufficient for all time, it should inspire confidence that Azure TLS connections are quite secure.</span></span> <span data-ttu-id="57e23-347">隨著加密的改進,Azure將繼續改進其安全標準。</span><span class="sxs-lookup"><span data-stu-id="57e23-347">Azure will continue to evolve its security standards as encryption improves.</span></span> <span data-ttu-id="57e23-348">很高興知道,有人在查看安全標準並隨著 Azure 的改進而更新 Azure。</span><span class="sxs-lookup"><span data-stu-id="57e23-348">It's nice to know that there's somebody watching the security standards and updating Azure as they improve.</span></span>

### <a name="at-rest"></a><span data-ttu-id="57e23-349">待用</span><span class="sxs-lookup"><span data-stu-id="57e23-349">At rest</span></span>

<span data-ttu-id="57e23-350">在任何應用程式中,數據在磁碟上放置的有很多位置。</span><span class="sxs-lookup"><span data-stu-id="57e23-350">In any application, there are a number of places where data rests on disk.</span></span> <span data-ttu-id="57e23-351">應用程式代碼本身是從某些儲存機制載入的。</span><span class="sxs-lookup"><span data-stu-id="57e23-351">The application code itself is loaded from some storage mechanism.</span></span> <span data-ttu-id="57e23-352">大多數應用程式還使用某種資料庫,如 SQL Server、Cosmos DB,甚至具有驚人的價格效率的表存儲。</span><span class="sxs-lookup"><span data-stu-id="57e23-352">Most applications also use some kind of database such as SQL Server, Cosmos DB, or even the amazingly price-efficient Table Storage.</span></span> <span data-ttu-id="57e23-353">這些資料庫都使用大量加密的存儲,以確保除了具有適當許可權的應用程式之外,任何人都無法讀取您的數據。</span><span class="sxs-lookup"><span data-stu-id="57e23-353">These databases all use heavily encrypted storage to ensure that nobody other than the applications with proper permissions can read your data.</span></span> <span data-ttu-id="57e23-354">甚至系統操作員也不能讀取已加密的數據。</span><span class="sxs-lookup"><span data-stu-id="57e23-354">Even the system operators can't read data that has been encrypted.</span></span> <span data-ttu-id="57e23-355">因此,客戶可以仍然相信他們的秘密資訊仍然是秘密的。</span><span class="sxs-lookup"><span data-stu-id="57e23-355">So customers can remain confident their secret information remains secret.</span></span>

### <a name="storage"></a><span data-ttu-id="57e23-356">儲存體</span><span class="sxs-lookup"><span data-stu-id="57e23-356">Storage</span></span>

<span data-ttu-id="57e23-357">Azure 的大部分基礎是 Azure 儲存引擎。</span><span class="sxs-lookup"><span data-stu-id="57e23-357">The underpinning of much of Azure is the Azure Storage engine.</span></span> <span data-ttu-id="57e23-358">虛擬機器磁碟安裝在 Azure 儲存的頂部。</span><span class="sxs-lookup"><span data-stu-id="57e23-358">Virtual machine disks are mounted on top of Azure Storage.</span></span> <span data-ttu-id="57e23-359">Azure 庫伯奈斯服務運行在虛擬機器上運行,虛擬機器本身託管在 Azure 儲存上。</span><span class="sxs-lookup"><span data-stu-id="57e23-359">Azure Kubernetes Services run on virtual machines that, themselves, are hosted on Azure Storage.</span></span> <span data-ttu-id="57e23-360">即使是無伺服器技術(如 Azure 函數應用和 Azure 容器實例)也耗盡了屬於 Azure 儲存的磁碟。</span><span class="sxs-lookup"><span data-stu-id="57e23-360">Even serverless technologies, such as Azure Functions Apps and Azure Container Instances, run out of disk that is part of Azure Storage.</span></span>

<span data-ttu-id="57e23-361">如果 Azure 儲存已很好地加密,則它為大多數其他內容都提供了一個基礎,以便進行加密。</span><span class="sxs-lookup"><span data-stu-id="57e23-361">If Azure Storage is well encrypted, then it provides for a foundation for most everything else to also be encrypted.</span></span> <span data-ttu-id="57e23-362">Azure 儲存使用[FIPS 140-2](https://en.wikipedia.org/wiki/FIPS_140)相容[256 位元 AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard)[進行加密](https://docs.microsoft.com/azure/storage/common/storage-service-encryption)。</span><span class="sxs-lookup"><span data-stu-id="57e23-362">Azure Storage [is encrypted](https://docs.microsoft.com/azure/storage/common/storage-service-encryption) with [FIPS 140-2](https://en.wikipedia.org/wiki/FIPS_140) compliant [256-bit AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard).</span></span> <span data-ttu-id="57e23-363">這是一項備受推崇的加密技術,在過去 20 年左右的歲月中一直受到廣泛的學術審查。</span><span class="sxs-lookup"><span data-stu-id="57e23-363">This is a well-regarded encryption technology having been the subject of extensive academic scrutiny over the last 20 or so years.</span></span> <span data-ttu-id="57e23-364">目前,沒有已知的實際攻擊,允許一個人不知道密鑰讀取由AES加密的數據。</span><span class="sxs-lookup"><span data-stu-id="57e23-364">At present, there's no known practical attack that would allow someone without knowledge of the key to read data encrypted by AES.</span></span>

<span data-ttu-id="57e23-365">默認情況下,用於加密 Azure 儲存的密鑰由 Microsoft 管理。</span><span class="sxs-lookup"><span data-stu-id="57e23-365">By default, the keys used for encrypting Azure Storage are managed by Microsoft.</span></span> <span data-ttu-id="57e23-366">有廣泛的保護,以確保防止惡意訪問這些密鑰。</span><span class="sxs-lookup"><span data-stu-id="57e23-366">There are extensive protections in place to ensure to prevent malicious access to these keys.</span></span> <span data-ttu-id="57e23-367">但是,具有特定加密要求的使用者也可以提供在 Azure 金鑰保管庫中託管[的儲存金鑰](https://docs.microsoft.com/azure/storage/common/storage-encryption-keys-powershell)。</span><span class="sxs-lookup"><span data-stu-id="57e23-367">However, users with particular encryption requirements can also [provide their own storage keys](https://docs.microsoft.com/azure/storage/common/storage-encryption-keys-powershell) that are managed in Azure Key Vault.</span></span> <span data-ttu-id="57e23-368">可以隨時吊銷這些密鑰,這將有效地使使用它們訪問的存儲帳戶的內容變得不可訪問。</span><span class="sxs-lookup"><span data-stu-id="57e23-368">These keys can be revoked at any time, which would effectively render the contents of the Storage account using them inaccessible.</span></span>

<span data-ttu-id="57e23-369">虛擬機器使用加密儲存,但可以使用 Windows 上的 BitLocker 或 Linux 上的 DM-Crypt 等技術提供另一層加密。</span><span class="sxs-lookup"><span data-stu-id="57e23-369">Virtual machines use encrypted storage, but it's possible to provide another layer of encryption by using technologies like BitLocker on Windows or DM-Crypt on Linux.</span></span> <span data-ttu-id="57e23-370">這些技術意味著,即使磁碟映射從存儲中洩露,也幾乎不可能讀取它。</span><span class="sxs-lookup"><span data-stu-id="57e23-370">These technologies mean that even if the disk image was leaked off of storage, it would remain near impossible to read it.</span></span>

### <a name="azure-sql"></a><span data-ttu-id="57e23-371">Azure SQL</span><span class="sxs-lookup"><span data-stu-id="57e23-371">Azure SQL</span></span>

<span data-ttu-id="57e23-372">在 Azure SQL 上託管的資料庫使用稱為[透明數據加密 (TDE)](/sql/relational-databases/security/encryption/transparent-data-encryption)的技術來確保數據保持加密。</span><span class="sxs-lookup"><span data-stu-id="57e23-372">Databases hosted on Azure SQL use a technology called [Transparent Data Encryption (TDE)](/sql/relational-databases/security/encryption/transparent-data-encryption) to ensure data remains encrypted.</span></span> <span data-ttu-id="57e23-373">默認情況下,它在所有新創建的 SQL 資料庫上啟用,但必須手動為舊資料庫啟用。</span><span class="sxs-lookup"><span data-stu-id="57e23-373">It's enabled by default on all newly created SQL databases, but must be enabled manually for legacy databases.</span></span> <span data-ttu-id="57e23-374">TDE 不僅執行資料庫的即時加密和解密,還執行備份和事務日誌。</span><span class="sxs-lookup"><span data-stu-id="57e23-374">TDE executes real-time encryption and decryption of not just the database, but also the backups and transaction logs.</span></span>

<span data-ttu-id="57e23-375">加密參數存儲在`master`資料庫中,並在啟動時讀取到記憶體中以執行其餘操作。</span><span class="sxs-lookup"><span data-stu-id="57e23-375">The encryption parameters are stored in the `master` database and, on startup, are read into memory for the remaining operations.</span></span> <span data-ttu-id="57e23-376">這意味著`master`資料庫必須保持未加密狀態。</span><span class="sxs-lookup"><span data-stu-id="57e23-376">This means that the `master` database must remain unencrypted.</span></span> <span data-ttu-id="57e23-377">實際金鑰由 Microsoft 管理。</span><span class="sxs-lookup"><span data-stu-id="57e23-377">The actual key is managed by Microsoft.</span></span> <span data-ttu-id="57e23-378">但是,具有嚴格安全要求的使用者在密鑰保管庫中提供自己的密鑰的方式可能與 Azure 存儲的密鑰相同。</span><span class="sxs-lookup"><span data-stu-id="57e23-378">However, users with exacting security requirements may provide their own key in Key Vault in much the same way as is done for Azure Storage.</span></span> <span data-ttu-id="57e23-379">密鑰保管庫提供密鑰輪換和吊銷等服務。</span><span class="sxs-lookup"><span data-stu-id="57e23-379">The Key Vault provides for such services as key rotation and revocation.</span></span>

<span data-ttu-id="57e23-380">TDS 的「透明」部分來自使用加密資料庫不需要用戶端更改這一事實。</span><span class="sxs-lookup"><span data-stu-id="57e23-380">The "Transparent" part of TDS comes from the fact that there aren't client changes needed to use an encrypted database.</span></span> <span data-ttu-id="57e23-381">雖然此方法提供良好的安全性,但泄露資料庫密碼足以讓用戶能夠解密數據。</span><span class="sxs-lookup"><span data-stu-id="57e23-381">While this approach provides for good security, leaking the database password is enough for users to be able to decrypt the data.</span></span> <span data-ttu-id="57e23-382">還有另一種方法對資料庫中的各個列或表進行加密。</span><span class="sxs-lookup"><span data-stu-id="57e23-382">There's another approach that encrypts individual columns or tables in a database.</span></span> <span data-ttu-id="57e23-383">[始終加密](https://docs.microsoft.com/azure/sql-database/sql-database-always-encrypted-azure-key-vault)可確保加密數據在資料庫中的純文本中始終顯示。</span><span class="sxs-lookup"><span data-stu-id="57e23-383">[Always Encrypted](https://docs.microsoft.com/azure/sql-database/sql-database-always-encrypted-azure-key-vault) ensures that at no point the encrypted data appears in plain text inside the database.</span></span>

<span data-ttu-id="57e23-384">設定此加密層需要透過 SQL Server 管理工作室中的精靈運行,以選擇加密類型以及金鑰保管庫中儲存關聯金鑰的位置。</span><span class="sxs-lookup"><span data-stu-id="57e23-384">Setting up this tier of encryption requires running through a wizard in SQL Server Management Studio to select the sort of encryption and where in Key Vault to store the associated keys.</span></span>

<span data-ttu-id="57e23-385">![圖 10-6 選擇表中的列,以便使用](./media/always-encrypted.png)
始終加密**圖 10-6**進行加密。</span><span class="sxs-lookup"><span data-stu-id="57e23-385">![Figure 10-6 Selecting columns in a table to be encrypted using Always Encrypted](./media/always-encrypted.png)
**Figure 10-6**.</span></span> <span data-ttu-id="57e23-386">選擇表中的列,以便使用「始終加密」進行加密。</span><span class="sxs-lookup"><span data-stu-id="57e23-386">Selecting columns in a table to be encrypted using Always Encrypted.</span></span>

<span data-ttu-id="57e23-387">從這些加密列讀取資訊的用戶端應用程式需要特別調整以讀取加密數據。</span><span class="sxs-lookup"><span data-stu-id="57e23-387">Client applications that read information from these encrypted columns need to make special allowances to read encrypted data.</span></span> <span data-ttu-id="57e23-388">連接字串需要更新,`Column Encryption Setting=Enabled`並且必須從密鑰保管庫檢索用戶端憑據。</span><span class="sxs-lookup"><span data-stu-id="57e23-388">Connection strings need to be updated with `Column Encryption Setting=Enabled` and client credentials must be retrieved from the Key Vault.</span></span> <span data-ttu-id="57e23-389">然後,必須使用列加密密鑰來準備 SQL Server 用戶端。</span><span class="sxs-lookup"><span data-stu-id="57e23-389">The SQL Server client must then be primed with the column encryption keys.</span></span> <span data-ttu-id="57e23-390">完成後,其餘操作使用 SQL 客戶端的標準介面。</span><span class="sxs-lookup"><span data-stu-id="57e23-390">Once that is done, the remaining actions use the standard interfaces to SQL Client.</span></span> <span data-ttu-id="57e23-391">也就是說,像 Dapper 和實體框架這樣的工具,它們構建在 SQL 用戶端之上,將繼續在不進行更改的情況下工作。</span><span class="sxs-lookup"><span data-stu-id="57e23-391">That is, tools like Dapper and Entity Framework, which are built on top of SQL Client, will continue to work without changes.</span></span> <span data-ttu-id="57e23-392">對於每種語言的每個 SQL Server 驅動程式,始終未使用加密。</span><span class="sxs-lookup"><span data-stu-id="57e23-392">Always Encrypted may not yet be available for every SQL Server driver on every language.</span></span>

<span data-ttu-id="57e23-393">TDE 和「始終加密」的組合(兩者都可與特定於用戶端的密鑰一起使用)可確保即使是最嚴格的加密要求也得到支援。</span><span class="sxs-lookup"><span data-stu-id="57e23-393">The combination of TDE and Always Encrypted, both of which can be used with client-specific keys, ensures that even the most exacting encryption requirements are supported.</span></span>

### <a name="cosmos-db"></a><span data-ttu-id="57e23-394">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="57e23-394">Cosmos DB</span></span>

<span data-ttu-id="57e23-395">宇宙 DB 是 Microsoft 在 Azure 中提供的最新資料庫。</span><span class="sxs-lookup"><span data-stu-id="57e23-395">Cosmos DB is the newest database provided by Microsoft in Azure.</span></span> <span data-ttu-id="57e23-396">它從一開始就建立了,並考慮到了安全性和密碼學。</span><span class="sxs-lookup"><span data-stu-id="57e23-396">It has been built from the ground up with security and cryptography in mind.</span></span> <span data-ttu-id="57e23-397">AES-256 位元加密是所有Cosmos DB資料庫的標準加密,不能禁用。</span><span class="sxs-lookup"><span data-stu-id="57e23-397">AES-256bit encryption is standard for all Cosmos DB databases and can't be disabled.</span></span> <span data-ttu-id="57e23-398">再加上 TLS 1.2 通訊要求,整個存儲解決方案都是加密的。</span><span class="sxs-lookup"><span data-stu-id="57e23-398">Coupled with the TLS 1.2 requirement for communication, the entire storage solution is encrypted.</span></span>

<span data-ttu-id="57e23-399">![圖10-7 Cosmos](./media/cosmos-encryption.png)
DB 中的數據加密串流圖**10-7**。</span><span class="sxs-lookup"><span data-stu-id="57e23-399">![Figure 10-7 The flow of data encryption within Cosmos DB](./media/cosmos-encryption.png)
**Figure 10-7**.</span></span> <span data-ttu-id="57e23-400">Cosmos DB 中的數據加密流。</span><span class="sxs-lookup"><span data-stu-id="57e23-400">The flow of data encryption within Cosmos DB.</span></span>

<span data-ttu-id="57e23-401">雖然Cosmos DB不提供客戶加密密鑰,但團隊已做了大量工作,以確保在沒有這些密鑰的情況下保持PCI-DSS相容。</span><span class="sxs-lookup"><span data-stu-id="57e23-401">While Cosmos DB doesn't provide for supplying customer encryption keys, there has been significant work done by the team to ensure it remains PCI-DSS compliant without that.</span></span> <span data-ttu-id="57e23-402">Cosmos DB 還不支援任何類似於 Azure SQL 的「始終加密」的單列加密。</span><span class="sxs-lookup"><span data-stu-id="57e23-402">Cosmos DB also doesn't support any sort of single column encryption similar to Azure SQL's Always Encrypted yet.</span></span>

## <a name="keeping-secure"></a><span data-ttu-id="57e23-403">保持安全</span><span class="sxs-lookup"><span data-stu-id="57e23-403">Keeping secure</span></span>

<span data-ttu-id="57e23-404">Azure 具有發佈高度安全產品所需的所有工具。</span><span class="sxs-lookup"><span data-stu-id="57e23-404">Azure has all the tools necessary to release a highly secure product.</span></span> <span data-ttu-id="57e23-405">然而,鏈條只有最薄弱的環節那麼強大。</span><span class="sxs-lookup"><span data-stu-id="57e23-405">However, a chain is only as strong as its weakest link.</span></span> <span data-ttu-id="57e23-406">如果部署在 Azure 之上的應用程式沒有以適當的安全心態和良好的安全審核來開發,那麼它們就成為鏈中的薄弱環節。</span><span class="sxs-lookup"><span data-stu-id="57e23-406">If the applications deployed on top of Azure aren't developed with a proper security mindset and good security audits, then they become the weak link in the chain.</span></span> <span data-ttu-id="57e23-407">有許多出色的靜態分析工具、加密庫和安全實務可用於確保 Azure 上安裝的軟體與 Azure 本身一樣安全。</span><span class="sxs-lookup"><span data-stu-id="57e23-407">There are many great static analysis tools, encryption libraries, and security practices that can be used to ensure that the software installed on Azure is as secure as Azure itself.</span></span> <span data-ttu-id="57e23-408">範例包含[靜態分析工具](https://www.whitesourcesoftware.com/)、[加密庫](https://www.libressl.org/)[與安全實務](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/)。</span><span class="sxs-lookup"><span data-stu-id="57e23-408">Examples include [static analysis tools](https://www.whitesourcesoftware.com/), [encryption libraries](https://www.libressl.org/), and [security practices](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="57e23-409">[前一個](security.md)
>[下一個](devops.md)</span><span class="sxs-lookup"><span data-stu-id="57e23-409">[Previous](security.md)
[Next](devops.md)</span></span>
