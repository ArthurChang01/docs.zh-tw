---
title: 將 eShopOnContainers 部署至 Azure
description: 使用 Azure Kubernetes Service、Helm 和 DevSpaces 部署 eShopOnContainers 應用程式。
ms.date: 06/30/2019
ms.openlocfilehash: 21033cc904dc595193c69f3452ce2522740f8ff6
ms.sourcegitcommit: 55f438d4d00a34b9aca9eedaac3f85590bb11565
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/23/2019
ms.locfileid: "71183270"
---
# <a name="deploying-eshoponcontainers-to-azure"></a><span data-ttu-id="3bea5-103">將 eShopOnContainers 部署至 Azure</span><span class="sxs-lookup"><span data-stu-id="3bea5-103">Deploying eShopOnContainers to Azure</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="3bea5-104">Azure 可以使用各種不同的服務支援支援 eShopOnContainers 應用程式的邏輯。</span><span class="sxs-lookup"><span data-stu-id="3bea5-104">The logic supporting the eShopOnContainers application can be supported by Azure using a variety of services.</span></span> <span data-ttu-id="3bea5-105">建議的方法是使用 Azure Kubernetes Service （AKS）來利用 Kubernetes。</span><span class="sxs-lookup"><span data-stu-id="3bea5-105">The recommended approach is to leverage Kubernetes using Azure Kubernetes Service (AKS).</span></span> <span data-ttu-id="3bea5-106">這可以與 Helm 部署結合，以確保能輕鬆地重複基礎結構設定。</span><span class="sxs-lookup"><span data-stu-id="3bea5-106">This can be combined with Helm deployment to ensure easily repeated infrastructure configuration.</span></span> <span data-ttu-id="3bea5-107">或者，開發人員可以在開發過程中，利用 Kubernetes 的 Azure Dev Spaces。</span><span class="sxs-lookup"><span data-stu-id="3bea5-107">Optionally, developers can leverage Azure Dev Spaces for Kubernetes as part of their development process.</span></span> <span data-ttu-id="3bea5-108">另一個選項是使用 Azure 無伺服器功能（如 Azure Functions 和 Azure Logic Apps）來裝載應用程式的功能。</span><span class="sxs-lookup"><span data-stu-id="3bea5-108">Another option is to host the functionality of the app using Azure Serverless features like Azure Functions and Azure Logic Apps.</span></span>

## <a name="azure-kubernetes-service"></a><span data-ttu-id="3bea5-109">Azure Kubernetes Service</span><span class="sxs-lookup"><span data-stu-id="3bea5-109">Azure Kubernetes Service</span></span>

<span data-ttu-id="3bea5-110">如果您想要在自己的 AKS 叢集中裝載 eShopOnContainers 應用程式，第一個步驟是建立您的叢集。</span><span class="sxs-lookup"><span data-stu-id="3bea5-110">If you'd like to host the eShopOnContainers application in your own AKS cluster, the first step is to create your cluster.</span></span> <span data-ttu-id="3bea5-111">您可以使用 Azure 入口網站來完成此動作，這會引導您完成必要的步驟，或者您可以使用 Azure CLI，以確保您在執行此動作時，啟用以角色為基礎的存取控制（RBAC）和應用程式路由。</span><span class="sxs-lookup"><span data-stu-id="3bea5-111">You can do this using the Azure portal, which will walk you through the required steps, or you can use the Azure CLI, taking care to ensure you enable Role-Based Access Control (RBAC) and application routing when you do so.</span></span> <span data-ttu-id="3bea5-112">EShopOnContainers 的檔說明建立您自己的 AKS 叢集所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="3bea5-112">The eShopOnContainers' documentation describes the steps involved in creating your own AKS cluster.</span></span> <span data-ttu-id="3bea5-113">建立叢集之後，您必須啟用 Kubernetes 儀表板的存取權，此時您應該能夠流覽至 Kubernetes 儀表板來管理叢集。</span><span class="sxs-lookup"><span data-stu-id="3bea5-113">Once the cluster is created, you must enable access to the Kubernetes dashboard, at which point you should be able to browse to the Kubernetes dashboard to manage the cluster.</span></span>

<span data-ttu-id="3bea5-114">建立並設定叢集之後，您就可以使用 Helm 和 Tiller 將應用程式部署至該叢集。</span><span class="sxs-lookup"><span data-stu-id="3bea5-114">Once the cluster has been created and configured, you can deploy the application to it using Helm and Tiller.</span></span>

## <a name="deploying-to-azure-kubernetes-service-using-helm"></a><span data-ttu-id="3bea5-115">使用 Helm 部署到 Azure Kubernetes Service</span><span class="sxs-lookup"><span data-stu-id="3bea5-115">Deploying to Azure Kubernetes Service using Helm</span></span>

<span data-ttu-id="3bea5-116">AKS 的基本部署可以使用自訂 CLI 腳本或簡單的部署檔案，但更複雜的應用程式應該使用相依性管理工具，例如 Helm。</span><span class="sxs-lookup"><span data-stu-id="3bea5-116">Basic deployments to AKS may use custom CLI scripts or simple deployment files, but more complex applications should use a dependency management tool like Helm.</span></span> <span data-ttu-id="3bea5-117">Helm 是由雲端原生運算基礎所維護，可協助您定義、安裝及升級 Kubernetes 應用程式。</span><span class="sxs-lookup"><span data-stu-id="3bea5-117">Helm is maintained by the Cloud-native Computing Foundation and helps you define, install, and upgrade Kubernetes applications.</span></span> <span data-ttu-id="3bea5-118">Helm 是由命令列用戶端、Helm （使用 Helm 圖表）和叢集內元件 Tiller 所組成。</span><span class="sxs-lookup"><span data-stu-id="3bea5-118">Helm is composed of a command-line client, helm, which uses helm charts, and an in-cluster component, Tiller.</span></span> <span data-ttu-id="3bea5-119">Helm 圖會使用標準的 YAML 格式檔案來描述一組相關的 Kubernetes 資源，而且通常會與它們所描述的應用程式一起建立版本。</span><span class="sxs-lookup"><span data-stu-id="3bea5-119">Helm Charts use standard YAML-formatted files to describe a related set of Kubernetes resources and are typically versioned alongside the application they describe.</span></span> <span data-ttu-id="3bea5-120">Helm 圖表的範圍從簡單到複雜，視其所描述的安裝需求而定。</span><span class="sxs-lookup"><span data-stu-id="3bea5-120">Helm Charts range from simple to complex depending on the requirements of the installation they describe.</span></span>

<span data-ttu-id="3bea5-121">您會在/k8s/helm 資料夾中找到 eShopOnContainers helm 圖表。</span><span class="sxs-lookup"><span data-stu-id="3bea5-121">You'll find the eShopOnContainers helm charts in the /k8s/helm folder.</span></span> <span data-ttu-id="3bea5-122">圖2-6 顯示如何將應用程式的不同元件組織成 helm 用來定義和管理部署的資料夾結構。</span><span class="sxs-lookup"><span data-stu-id="3bea5-122">Figure 2-6 shows how the different components of the application are organized into a folder structure used by helm to define and managed deployments.</span></span>

<span data-ttu-id="3bea5-123">![eShopOnContainers 架構](./media/eshoponcontainers-helm-folder.png)
**圖 2-6**。</span><span class="sxs-lookup"><span data-stu-id="3bea5-123">![eShopOnContainers Architecture](./media/eshoponcontainers-helm-folder.png)
**Figure 2-6**.</span></span> <span data-ttu-id="3bea5-124">EShopOnContainers helm 資料夾。</span><span class="sxs-lookup"><span data-stu-id="3bea5-124">The eShopOnContainers helm folder.</span></span>

<span data-ttu-id="3bea5-125">每個個別元件都是使用`helm install`命令來安裝。</span><span class="sxs-lookup"><span data-stu-id="3bea5-125">Each individual component is installed using a `helm install` command.</span></span> <span data-ttu-id="3bea5-126">這些命令很容易編寫腳本，而 eShopOnContainers 提供「部署所有」腳本，它會在不同的元件之間進行迴圈，並使用其各自的 helm 圖表進行安裝。</span><span class="sxs-lookup"><span data-stu-id="3bea5-126">These commands are easily scripted, and eShopOnContainers provides a "deploy all" script that loops through the different components and installs them using their respective helm charts.</span></span> <span data-ttu-id="3bea5-127">結果是可重複的程式，在原始檔控制中使用應用程式進行版本設定，而小組中的任何人都可以使用單行指令碼命令，部署到 AKS 叢集。</span><span class="sxs-lookup"><span data-stu-id="3bea5-127">The result is a repeatable process, versioned with the application in source control, that anyone on the team can deploy to an AKS cluster with a one-line script command.</span></span> <span data-ttu-id="3bea5-128">特別是當與 Azure Dev Spaces 結合時，讓開發人員能夠輕鬆地診斷及測試其微服務型雲端原生應用程式的個別變更。</span><span class="sxs-lookup"><span data-stu-id="3bea5-128">Especially when combined with Azure Dev Spaces, this makes it easy for developers to diagnose and test their individual changes to their microservice-based cloud-native apps.</span></span>

## <a name="azure-dev-spaces"></a><span data-ttu-id="3bea5-129">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="3bea5-129">Azure Dev Spaces</span></span>

<span data-ttu-id="3bea5-130">Azure Dev Spaces 可協助個別開發人員在開發期間，于 Azure 中裝載自己專屬的 AKS 叢集版本。</span><span class="sxs-lookup"><span data-stu-id="3bea5-130">Azure Dev Spaces helps individual developers host their own unique version of AKS clusters in Azure during development.</span></span> <span data-ttu-id="3bea5-131">這可將本機電腦需求降到最低，讓小組成員能夠快速查看其變更在實際 AKS 環境中的行為。</span><span class="sxs-lookup"><span data-stu-id="3bea5-131">This minimizes local machine requirements and allows team members to quickly see how their changes will behave in a real AKS environment.</span></span> <span data-ttu-id="3bea5-132">Azure Dev Spaces 提供 CLI，讓開發人員用來管理其開發人員空間，並視需要部署到特定的子開發人員空間。</span><span class="sxs-lookup"><span data-stu-id="3bea5-132">Azure Dev Spaces offers a CLI for developers to use to manage their dev spaces and to deploy to a specific child dev space as needed.</span></span> <span data-ttu-id="3bea5-133">每個子開發人員空間都會使用唯一的 URL 子域來參考，允許並存部署已修改的叢集，讓個別開發人員可以避免與彼此進行中的工作互相衝突。</span><span class="sxs-lookup"><span data-stu-id="3bea5-133">Each child dev space is referenced using a unique URL subdomain, allowing side-by-side deployments of modified clusters so that individual developers can avoid conflicting with each other's work in progress.</span></span> <span data-ttu-id="3bea5-134">在圖2-7 中，您可以看到開發人員 Susie 如何將自己的自行車微服務版本部署到其開發人員空間。</span><span class="sxs-lookup"><span data-stu-id="3bea5-134">In Figure 2-7 you can see how developer Susie has deployed her own version of the Bikes microservice into her dev space.</span></span> <span data-ttu-id="3bea5-135">然後她就能夠使用自訂 URL （以她的空間名稱（susie.s.dev.myapp.eus.azds.io）開頭）來測試她的變更。</span><span class="sxs-lookup"><span data-stu-id="3bea5-135">She's then able to test her changes using a custom URL starting with the name of her space (susie.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="3bea5-136">![eShopOnContainers 架構](./media/azure-devspaces-one.png)
**圖 2-7**。</span><span class="sxs-lookup"><span data-stu-id="3bea5-136">![eShopOnContainers Architecture](./media/azure-devspaces-one.png)
**Figure 2-7**.</span></span> <span data-ttu-id="3bea5-137">開發人員 Susie 會部署自己的自行車微服務版本，並加以測試。</span><span class="sxs-lookup"><span data-stu-id="3bea5-137">Developer Susie deploys her own version of the Bikes microservice and tests it.</span></span>

<span data-ttu-id="3bea5-138">同時，開發人員 John 會自訂保留微服務，並需要測試其變更。</span><span class="sxs-lookup"><span data-stu-id="3bea5-138">At the same time, developer John is customizing the Reservations microservice and needs to test his changes.</span></span> <span data-ttu-id="3bea5-139">他可以將自己的變更部署到自己的開發人員空間，而不會與 Susie 的變更相衝突，如圖2-8 所示。</span><span class="sxs-lookup"><span data-stu-id="3bea5-139">He's able to deploy his changes to his own dev space without conflicting with Susie's changes as shown in Figure 2-8.</span></span> <span data-ttu-id="3bea5-140">他可以使用自己的 URL 來測試他的變更，其前面會加上他的空間名稱（john.s.dev.myapp.eus.azds.io）。</span><span class="sxs-lookup"><span data-stu-id="3bea5-140">He can test his changes using his own URL which is prefixed with the name of his space (john.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="3bea5-141">![eShopOnContainers 架構](./media/azure-devspaces-two.png)
**圖 2-8**。</span><span class="sxs-lookup"><span data-stu-id="3bea5-141">![eShopOnContainers Architecture](./media/azure-devspaces-two.png)
**Figure 2-8**.</span></span> <span data-ttu-id="3bea5-142">開發人員 John 會部署自己的保留微服務版本，並測試它，而不會與其他開發人員衝突。</span><span class="sxs-lookup"><span data-stu-id="3bea5-142">Developer John deploys his own version of the Reservations microservice and tests it without conflicting with other developers.</span></span>

<span data-ttu-id="3bea5-143">使用 Azure Dev Spaces，小組可以直接處理 AKS，同時獨立變更、部署和測試其變更。</span><span class="sxs-lookup"><span data-stu-id="3bea5-143">Using Azure Dev Spaces, teams can work directly with AKS while independently changing, deploying, and testing their changes.</span></span> <span data-ttu-id="3bea5-144">這種方法可減少個別專用託管環境的需求，因為每位開發人員實際上都有自己的 AKS 環境。</span><span class="sxs-lookup"><span data-stu-id="3bea5-144">This approach reduces the need for separate dedicated hosted environments since every developer effectively has their own AKS environment.</span></span> <span data-ttu-id="3bea5-145">開發人員可以使用其 CLI 來處理 Azure Dev Spaces，或啟動其應用程式直接從 Visual Studio Azure Dev Spaces。</span><span class="sxs-lookup"><span data-stu-id="3bea5-145">Developers can work with Azure Dev Spaces using its CLI or launch their application to Azure Dev Spaces directly from Visual Studio.</span></span> [<span data-ttu-id="3bea5-146">深入瞭解 Azure Dev Spaces 的運作方式和設定。</span><span class="sxs-lookup"><span data-stu-id="3bea5-146">Learn more about how Azure Dev Spaces works and is configured.</span></span>](https://docs.microsoft.com/azure/dev-spaces/how-dev-spaces-works)

## <a name="azure-functions-and-logic-apps-serverless"></a><span data-ttu-id="3bea5-147">Azure Functions 和 Logic Apps （無伺服器）</span><span class="sxs-lookup"><span data-stu-id="3bea5-147">Azure Functions and Logic Apps (Serverless)</span></span>

<span data-ttu-id="3bea5-148">EShopOnContainers 範例包含追蹤線上行銷活動的支援。</span><span class="sxs-lookup"><span data-stu-id="3bea5-148">The eShopOnContainers sample includes support for tracking online marketing campaigns.</span></span> <span data-ttu-id="3bea5-149">Azure 函式是用來針對指定的活動識別碼提取行銷活動詳細資料。</span><span class="sxs-lookup"><span data-stu-id="3bea5-149">An Azure Function is used to pull marketing campaign details for a given campaign ID.</span></span> <span data-ttu-id="3bea5-150">單一 Azure 函式端點比較簡單且足夠，而不是為此目的建立完整的 ASP.NET Core 應用程式。</span><span class="sxs-lookup"><span data-stu-id="3bea5-150">Rather than creating a complete ASP.NET Core application for this purpose, a single Azure Function endpoint is simpler and sufficient.</span></span> <span data-ttu-id="3bea5-151">Azure Functions 具有比完整 ASP.NET Core 應用程式更簡單的組建和部署模型，特別是當設定為在 Kubernetes 中執行時。</span><span class="sxs-lookup"><span data-stu-id="3bea5-151">Azure Functions have a much simpler build and deployment model than full ASP.NET Core applications, especially when configured to run in Kubernetes.</span></span> <span data-ttu-id="3bea5-152">部署函式的功能是使用 Azure Resource Manager （ARM）範本和 Azure CLI。</span><span class="sxs-lookup"><span data-stu-id="3bea5-152">Deploying the function is scripted using Azure Resource Manager (ARM) templates and the Azure CLI.</span></span> <span data-ttu-id="3bea5-153">此活動詳細資料微服務不是面向客戶，而且與線上商店的需求並不相同，因此這是 Azure Functions 的理想候選。</span><span class="sxs-lookup"><span data-stu-id="3bea5-153">This campaign details microservice isn't customer-facing and doesn't have the same requirements as the online store, making it a good candidate for Azure Functions.</span></span> <span data-ttu-id="3bea5-154">函式需要某些設定才能正常運作，例如資料庫連接字串資料和映射基底 URI 設定。</span><span class="sxs-lookup"><span data-stu-id="3bea5-154">The function requires some configuration to work properly, such as database connection string data and image base URI settings.</span></span> <span data-ttu-id="3bea5-155">您會在 Azure 入口網站中設定 Azure Functions。</span><span class="sxs-lookup"><span data-stu-id="3bea5-155">You configure Azure Functions in the Azure Portal.</span></span>

## <a name="references"></a><span data-ttu-id="3bea5-156">reference</span><span class="sxs-lookup"><span data-stu-id="3bea5-156">References</span></span>

- <span data-ttu-id="3bea5-157">[EShopOnContainers在 AKS 中建立 Kubernetes 叢集](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span><span class="sxs-lookup"><span data-stu-id="3bea5-157">[eShopOnContainers: Create Kubernetes cluster in AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span></span>
- [<span data-ttu-id="3bea5-158">EShopOnContainersAzure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="3bea5-158">eShopOnContainers: Azure Dev Spaces</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Azure-Dev-Spaces)
- [<span data-ttu-id="3bea5-159">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="3bea5-159">Azure Dev Spaces</span></span>](https://docs.microsoft.com/azure/dev-spaces/about)

>[!div class="step-by-step"]
><span data-ttu-id="3bea5-160">[上一頁](map-eshoponcontainers-azure-services.md)
>[下一頁](centralized-configuration.md)</span><span class="sxs-lookup"><span data-stu-id="3bea5-160">[Previous](map-eshoponcontainers-azure-services.md)
[Next](centralized-configuration.md)</span></span>
