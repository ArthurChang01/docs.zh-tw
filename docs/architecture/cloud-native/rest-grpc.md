---
title: REST 和 gRPC
description: 瞭解 gRPC、其在雲端原生應用程式中的角色，以及它與 HTTP REST 的差異
author: robvet
ms.date: 09/08/2019
ms.openlocfilehash: c77343e7a594d34cbd2c00ce11281bd6bf4000c1
ms.sourcegitcommit: 30a558d23e3ac5a52071121a52c305c85fe15726
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/25/2019
ms.locfileid: "75337078"
---
# <a name="rest-and-grpc"></a><span data-ttu-id="0ed58-103">REST 和 gRPC</span><span class="sxs-lookup"><span data-stu-id="0ed58-103">REST and gRPC</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="0ed58-104">到目前為止，我們都著重于以[REST 為基礎的](https://docs.microsoft.com/azure/architecture/best-practices/api-design)通訊。</span><span class="sxs-lookup"><span data-stu-id="0ed58-104">So far in this book, we’ve focused on [REST-based](https://docs.microsoft.com/azure/architecture/best-practices/api-design) communication.</span></span> <span data-ttu-id="0ed58-105">REST 是一種架構樣式，可提升分散式運算機系統之間的互通性。</span><span class="sxs-lookup"><span data-stu-id="0ed58-105">REST is an architectural style that promotes interoperability between distributed computer systems.</span></span> <span data-ttu-id="0ed58-106">它會使用要求/回應模型，其中來自伺服器的每個回應都是來自用戶端的要求。</span><span class="sxs-lookup"><span data-stu-id="0ed58-106">It uses a request/response model where every response from the server is to a request from the client.</span></span> <span data-ttu-id="0ed58-107">雖然很普遍，但 REST 並不適合每個問題。</span><span class="sxs-lookup"><span data-stu-id="0ed58-107">While widely popular, REST isn't a perfect fit for every problem.</span></span> <span data-ttu-id="0ed58-108">較新的通訊技術（有權 gRPC）會快速獲得普及，並使其進入雲端原生世界。</span><span class="sxs-lookup"><span data-stu-id="0ed58-108">A newer communication technology, entitled gRPC, is rapidly gaining popularity and making its way into the cloud-native world.</span></span>

## <a name="grpc"></a><span data-ttu-id="0ed58-109">gRPC</span><span class="sxs-lookup"><span data-stu-id="0ed58-109">gRPC</span></span>

<span data-ttu-id="0ed58-110">gRPC 是源自 Google 的開放原始碼通訊。</span><span class="sxs-lookup"><span data-stu-id="0ed58-110">gRPC is an open-source communication that originates from Google.</span></span> <span data-ttu-id="0ed58-111">它是以[遠端程序呼叫（RPC）](https://en.wikipedia.org/wiki/Remote_procedure_call)模型為基礎，在分散式運算中很熱門。</span><span class="sxs-lookup"><span data-stu-id="0ed58-111">It's built upon the [remote procedure call (RPC)](https://en.wikipedia.org/wiki/Remote_procedure_call) model, popular in distributed computing.</span></span> <span data-ttu-id="0ed58-112">在此模型之後，本機用戶端程式會公開同進程方法來執行作業。</span><span class="sxs-lookup"><span data-stu-id="0ed58-112">Following this model, a local client program exposes an in-process method to execute an operation.</span></span> <span data-ttu-id="0ed58-113">在幕後，會在跨分散式網路的跨進程微服務上叫用該呼叫。</span><span class="sxs-lookup"><span data-stu-id="0ed58-113">Behind the scenes, that call is invoked on an out-of-process microservice across a distributed network.</span></span> <span data-ttu-id="0ed58-114">開發人員將作業編碼為本機程序呼叫。</span><span class="sxs-lookup"><span data-stu-id="0ed58-114">The developer codes the operation as a local procedure call.</span></span> <span data-ttu-id="0ed58-115">基礎平臺會將點對點網路通訊、序列化和執行抽象化。</span><span class="sxs-lookup"><span data-stu-id="0ed58-115">The underlying platform abstracts the point-to-point networking communication, serialization, and execution.</span></span>

<span data-ttu-id="0ed58-116">gRPC 是現代化的 RPC 架構，它既輕量又高效能。</span><span class="sxs-lookup"><span data-stu-id="0ed58-116">gRPC is a modern RPC framework that is lightweight and highly performant.</span></span> <span data-ttu-id="0ed58-117">它會使用 HTTP/2 作為其傳輸通訊協定。</span><span class="sxs-lookup"><span data-stu-id="0ed58-117">It uses HTTP/2 for its transport protocol.</span></span> <span data-ttu-id="0ed58-118">與 HTTP 1.1 相容，HTTP/2 具備許多先進的功能：</span><span class="sxs-lookup"><span data-stu-id="0ed58-118">While compatible with HTTP 1.1, HTTP/2 features many advanced capabilities:</span></span>

- <span data-ttu-id="0ed58-119">HTTP 1.1 以純文字傳送資料時，HTTP/2 是二進位通訊協定。</span><span class="sxs-lookup"><span data-stu-id="0ed58-119">While HTTP 1.1 sends data as clear text, HTTP/2 is a binary protocol.</span></span> <span data-ttu-id="0ed58-120">它會使用較少的記憶體，更快地剖析資料、降低網路延遲與速度的相關改善，以及更有效率地管理網路資源。</span><span class="sxs-lookup"><span data-stu-id="0ed58-120">It parses data faster using less memory, reduces network latency with the related improvements to speed, and manages network resources more efficiently.</span></span>
- <span data-ttu-id="0ed58-121">雖然 HTTP 1.1 限制為一次處理一個往返的要求/回應，但 HTTP/2 支援多工傳送，或透過相同連線的多個平行要求。</span><span class="sxs-lookup"><span data-stu-id="0ed58-121">While HTTP 1.1 is limited to processing one round-trip request/response at a time, HTTP/2 supports multiplexing, or multiple parallel requests over the same connection.</span></span>
- <span data-ttu-id="0ed58-122">HTTP/2 支援全雙工或雙向通訊，其中用戶端和伺服器都可以同時進行通訊。</span><span class="sxs-lookup"><span data-stu-id="0ed58-122">HTTP/2 supports full-duplex, or bidirectional communication, where both client and server and can communicate at the same time.</span></span> <span data-ttu-id="0ed58-123">用戶端可以在伺服器送迴響應資料時，同時上傳要求資料。</span><span class="sxs-lookup"><span data-stu-id="0ed58-123">The client can be uploading request data at the same time the server is sending back response data.</span></span>
- <span data-ttu-id="0ed58-124">串流內建于 HTTP/2，這表示要求和回應都可以非同步地串流處理大型資料集。</span><span class="sxs-lookup"><span data-stu-id="0ed58-124">Streaming is built into HTTP/2 meaning that both requests and responses can asynchronously stream large data sets.</span></span>
- <span data-ttu-id="0ed58-125">結合 gRPC 和 HTTP/2，效能會大幅增加。</span><span class="sxs-lookup"><span data-stu-id="0ed58-125">Combining gRPC and HTTP/2, performance dramatically increases.</span></span> <span data-ttu-id="0ed58-126">在[Windows Communication Foundation （WCF）](https://docs.microsoft.com/dotnet/framework/wcf/whats-wcf)用語中中，gRPC 效能符合並超過[NetTCP](https://docs.microsoft.com/dotnet/api/system.servicemodel.nettcpbinding?view=netframework-4.8)系結的速度和效率。</span><span class="sxs-lookup"><span data-stu-id="0ed58-126">In [Windows Communication Foundation (WCF)](https://docs.microsoft.com/dotnet/framework/wcf/whats-wcf) parlance, gRPC performance meets and exceeds the speed and efficiency of [NetTCP bindings](https://docs.microsoft.com/dotnet/api/system.servicemodel.nettcpbinding?view=netframework-4.8).</span></span> <span data-ttu-id="0ed58-127">不過，不同于 NetTCP，gRPC 不受限於 Microsoft 語言， C#例如或 Visual Basic。</span><span class="sxs-lookup"><span data-stu-id="0ed58-127">However, unlike NetTCP, gRPC isn't constrained to Microsoft languages such as C# or Visual Basic.</span></span>

<span data-ttu-id="0ed58-128">所有熱門平臺（包括 JAVA、 C#、Golang 和 NodeJS）都支援 gRPC。</span><span class="sxs-lookup"><span data-stu-id="0ed58-128">gRPC is supported across most popular platforms, including Java, C#, Golang, and NodeJS.</span></span>

## <a name="protocol-buffers"></a><span data-ttu-id="0ed58-129">通訊協定緩衝區</span><span class="sxs-lookup"><span data-stu-id="0ed58-129">Protocol Buffers</span></span>

<span data-ttu-id="0ed58-130">gRPC 採用另一種稱為[通訊協定緩衝區](https://developers.google.com/protocol-buffers/docs/overview)或 Protobuf 訊息的開放原始碼技術，來傳送和接收資料。</span><span class="sxs-lookup"><span data-stu-id="0ed58-130">gRPC embraces another open-source technology called [Protocol Buffers](https://developers.google.com/protocol-buffers/docs/overview) or Protobuf messages to send and receive data.</span></span> <span data-ttu-id="0ed58-131">類似于[WCF 資料合約](https://docs.microsoft.com/dotnet/framework/wcf/feature-details/using-data-contracts)，Protobuf 會將系統的結構化資料序列化，以便進行讀取和寫入。</span><span class="sxs-lookup"><span data-stu-id="0ed58-131">Similar to a [WCF Data Contract](https://docs.microsoft.com/dotnet/framework/wcf/feature-details/using-data-contracts), Protobuf serializes structured data for systems to read and write.</span></span> <span data-ttu-id="0ed58-132">它可降低人類看得懂的格式（例如 XML 或 JSON）所產生的額外負荷。</span><span class="sxs-lookup"><span data-stu-id="0ed58-132">It reduces the overhead that human-readable formats like XML or JSON incur.</span></span>

<span data-ttu-id="0ed58-133">許多物件序列化技術在執行時間會反映在資料物件的結構上。</span><span class="sxs-lookup"><span data-stu-id="0ed58-133">Many object serialization techniques reflect across the structure of data objects at run-time.</span></span> <span data-ttu-id="0ed58-134">Protobuf 需要您預先定義具有平臺中立語言（通訊協定緩衝區語言）的結構。</span><span class="sxs-lookup"><span data-stu-id="0ed58-134">Protobuf requires you to define the structure up front with a platform-agnostic language (Protocol Buffer Language).</span></span> <span data-ttu-id="0ed58-135">每個定義都會儲存在「. proto」檔案中。</span><span class="sxs-lookup"><span data-stu-id="0ed58-135">Each definition is stored in a ".proto" file.</span></span> <span data-ttu-id="0ed58-136">然後使用 Protobuf 編譯器「Proton」，為任何支援的平臺產生用戶端和伺服器程式碼。</span><span class="sxs-lookup"><span data-stu-id="0ed58-136">Then using Protobuf compiler, "Proton," you generate client and server code for any of the supported platforms.</span></span> <span data-ttu-id="0ed58-137">產生的程式碼已針對資料的快速序列化/還原序列化進行優化。</span><span class="sxs-lookup"><span data-stu-id="0ed58-137">The generated code is optimized for fast serialization/deserialization of data.</span></span> <span data-ttu-id="0ed58-138">在執行時間，每個訊息都會包裝在強型別服務合約中，並以標準的 Protobuf 標記法進行序列化。</span><span class="sxs-lookup"><span data-stu-id="0ed58-138">At runtime, each message is wrapped in the strongly-typed service contract and serialized in a standard Protobuf representation.</span></span>

## <a name="grpc-support-in-net"></a><span data-ttu-id="0ed58-139">.NET 中的 gRPC 支援</span><span class="sxs-lookup"><span data-stu-id="0ed58-139">gRPC support in .NET</span></span>

<span data-ttu-id="0ed58-140">Microsoft .NET Core framework 3.0 包含 gRPC 的工具和原生支援。</span><span class="sxs-lookup"><span data-stu-id="0ed58-140">The Microsoft .NET Core framework 3.0 includes tooling and native support for gRPC.</span></span> <span data-ttu-id="0ed58-141">圖4-20 顯示的 Visual Studio 2019 範本會 scaffold gRPC 服務的 gRPC 基本架構專案。</span><span class="sxs-lookup"><span data-stu-id="0ed58-141">Figure 4-20 shows the Visual Studio 2019 template that scaffolds a gRPC skeleton project for a gRPC service.</span></span> <span data-ttu-id="0ed58-142">請注意 .NET Core 如何支援 Windows、Linux 和 macOS 平臺。</span><span class="sxs-lookup"><span data-stu-id="0ed58-142">Note how .NET Core supports the Windows, Linux, and macOS platforms.</span></span>

![Visual Studio 2019 中的 gRPC 支援](./media/visual-studio-2019-grpc-template.png)

<span data-ttu-id="0ed58-144">**圖 4-20**：</span><span class="sxs-lookup"><span data-stu-id="0ed58-144">**Figure 4-20**.</span></span> <span data-ttu-id="0ed58-145">Visual Studio 2019 中的 gRPC 支援</span><span class="sxs-lookup"><span data-stu-id="0ed58-145">gRPC support in Visual Studio 2019</span></span>

<span data-ttu-id="0ed58-146">.NET Core 3.0 順暢地將 gRPC 整合到其架構中，包括端點路由、內建 IoC 支援和記錄。</span><span class="sxs-lookup"><span data-stu-id="0ed58-146">.NET Core 3.0 seamlessly integrates gRPC into its framework, including endpoint routing, built-in IoC support, and logging.</span></span> <span data-ttu-id="0ed58-147">開放原始碼 Kestrel web 伺服器完全支援 HTTP/2 連接。</span><span class="sxs-lookup"><span data-stu-id="0ed58-147">The open-source Kestrel web server fully supports HTTP/2 connections.</span></span>

<span data-ttu-id="0ed58-148">圖4-21 顯示 Visual Studio 2019 中的 gRPC 服務結構。</span><span class="sxs-lookup"><span data-stu-id="0ed58-148">Figure 4-21 shows structure of a gRPC service in Visual Studio 2019.</span></span> <span data-ttu-id="0ed58-149">請注意資料夾結構如何包含適用于 proto 檔案和服務程式代碼的資料夾。</span><span class="sxs-lookup"><span data-stu-id="0ed58-149">Note how the folder structure includes folders for the proto files and service code.</span></span>

![Visual Studio 2019 中的 gRPC 專案](./media/grpc-project.png  )

<span data-ttu-id="0ed58-151">**圖 4-21**：</span><span class="sxs-lookup"><span data-stu-id="0ed58-151">**Figure 4-21**.</span></span> <span data-ttu-id="0ed58-152">Visual Studio 2019 中的 gRPC 專案</span><span class="sxs-lookup"><span data-stu-id="0ed58-152">gRPC project in Visual Studio 2019</span></span>

## <a name="grpc-usage"></a><span data-ttu-id="0ed58-153">gRPC 使用方式</span><span class="sxs-lookup"><span data-stu-id="0ed58-153">gRPC Usage</span></span>

<span data-ttu-id="0ed58-154">gRPC 適用于下列案例：</span><span class="sxs-lookup"><span data-stu-id="0ed58-154">gRPC is well suited for the following scenarios:</span></span>

- <span data-ttu-id="0ed58-155">低延遲和高輸送量的通訊。</span><span class="sxs-lookup"><span data-stu-id="0ed58-155">Low latency and high throughput communication.</span></span> <span data-ttu-id="0ed58-156">gRPC 非常適合用於效率非常重要的輕量微服務。</span><span class="sxs-lookup"><span data-stu-id="0ed58-156">gRPC is great for lightweight microservices where efficiency is critical.</span></span>
- <span data-ttu-id="0ed58-157">點對點即時通訊。</span><span class="sxs-lookup"><span data-stu-id="0ed58-157">Point-to-point real-time communication.</span></span> <span data-ttu-id="0ed58-158">gRPC 有絕佳的雙向串流支援。</span><span class="sxs-lookup"><span data-stu-id="0ed58-158">gRPC has excellent support for bi-directional streaming.</span></span> <span data-ttu-id="0ed58-159">gRPC 服務可以即時推播訊息，而不需要輪詢。</span><span class="sxs-lookup"><span data-stu-id="0ed58-159">gRPC services can push messages in real time without polling.</span></span>
- <span data-ttu-id="0ed58-160">多語言環境– gRPC 工具支援最熱門的開發語言，使其成為多語言環境的理想選擇。</span><span class="sxs-lookup"><span data-stu-id="0ed58-160">Polyglot environments – gRPC tooling supports most popular development languages, making it a good choice for multi-language environments.</span></span>
- <span data-ttu-id="0ed58-161">網路限制環境– gRPC 訊息會使用 Protobuf （輕量訊息格式）進行序列化。</span><span class="sxs-lookup"><span data-stu-id="0ed58-161">Network constrained environments – gRPC messages are serialized with Protobuf, a lightweight message format.</span></span> <span data-ttu-id="0ed58-162">GRPC 訊息一律會小於對等的 JSON 訊息。</span><span class="sxs-lookup"><span data-stu-id="0ed58-162">A gRPC message is always smaller than an equivalent JSON message.</span></span>

<span data-ttu-id="0ed58-163">在本書撰寫本文時，大部分的瀏覽器對於 gRPC 的支援有限。</span><span class="sxs-lookup"><span data-stu-id="0ed58-163">At the time of writing of this book, most browsers have limited support for gRPC.</span></span> <span data-ttu-id="0ed58-164">gRPC 大量使用 HTTP/2 功能，而且沒有瀏覽器提供 web 要求所需的控制層級來支援 gRPC 用戶端。</span><span class="sxs-lookup"><span data-stu-id="0ed58-164">gRPC heavily uses HTTP/2 features and no browser provides the level of control required over web requests to support a gRPC client.</span></span> <span data-ttu-id="0ed58-165">gRPC 通常用於內部微服務以微服務通訊。</span><span class="sxs-lookup"><span data-stu-id="0ed58-165">gRPC is typically used for internal microservice to microservice communication.</span></span> <span data-ttu-id="0ed58-166">圖4-22 顯示簡單但常見的使用模式。</span><span class="sxs-lookup"><span data-stu-id="0ed58-166">Figure 4-22 shows a simple, but common usage pattern.</span></span>

![gRPC 使用模式](./media/grpc-usage.png)

<span data-ttu-id="0ed58-168">**圖 4-22**。</span><span class="sxs-lookup"><span data-stu-id="0ed58-168">**Figure 4-22**.</span></span> <span data-ttu-id="0ed58-169">gRPC 使用模式</span><span class="sxs-lookup"><span data-stu-id="0ed58-169">gRPC usage patterns</span></span>

<span data-ttu-id="0ed58-170">請注意，上圖中的前端流量會以 HTTP 叫用，而後端微服務至微服務會使用 gRPC。</span><span class="sxs-lookup"><span data-stu-id="0ed58-170">Note in the previous figure how front-end traffic is invoked with HTTP while back-end microservice to microservice uses gRPC.</span></span>

<span data-ttu-id="0ed58-171">期待 gRPC，在 dethroning 雲端原生系統的 REST 支配方面，可能扮演著重要的角色。</span><span class="sxs-lookup"><span data-stu-id="0ed58-171">Looking ahead, gRPC could play a major role in dethroning the dominance of REST for cloud-native systems.</span></span> <span data-ttu-id="0ed58-172">效能優勢和開發的便利性也太好了。</span><span class="sxs-lookup"><span data-stu-id="0ed58-172">The performance benefits and ease of development are too good to pass up.</span></span> <span data-ttu-id="0ed58-173">不過，請不要犯任何錯誤，其餘部分仍會持續一段時間。</span><span class="sxs-lookup"><span data-stu-id="0ed58-173">However, make no mistake, REST will still be around for a long time.</span></span> <span data-ttu-id="0ed58-174">它仍然是針對公開公開的 Api 擅長，基於回溯相容性的理由。</span><span class="sxs-lookup"><span data-stu-id="0ed58-174">It still excels for publicly exposed APIs and for backward compatibility reasons.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="0ed58-175">[上一頁](service-to-service-communication.md)
>[下一頁](service-mesh-communication-infrastructure.md)</span><span class="sxs-lookup"><span data-stu-id="0ed58-175">[Previous](service-to-service-communication.md)
[Next](service-mesh-communication-infrastructure.md)</span></span>
