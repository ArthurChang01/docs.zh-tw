---
title: "識別每個微服務的網域模型界限"
description: "容器化的.NET 應用程式的.NET Microservices 架構 |識別每個微服務的網域模型界限"
keywords: "Docker, 微服務, ASP.NET, 容器"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 6fef11e5718706701abb29149c4c4a23ba39bde0
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/22/2017
---
# <a name="identify-domain-model-boundaries-for-each-microservice"></a><span data-ttu-id="2184b-104">識別每個微服務的網域模型界限</span><span class="sxs-lookup"><span data-stu-id="2184b-104">Identify domain-model boundaries for each microservice</span></span>

<span data-ttu-id="2184b-105">目標識別模型界限和每個微服務的大小不是要取得最細微的分隔，雖然應該向小 microservices 傾向的話。</span><span class="sxs-lookup"><span data-stu-id="2184b-105">The goal when identifying model boundaries and size for each microservice is not to get to the most granular separation possible, although you should tend toward small microservices if possible.</span></span> <span data-ttu-id="2184b-106">相反地，您的目標應該是取得最有意義的區隔的定義域知識。</span><span class="sxs-lookup"><span data-stu-id="2184b-106">Instead, your goal should be to get to the most meaningful separation guided by your domain knowledge.</span></span> <span data-ttu-id="2184b-107">重點不是大小，而是商務功能。</span><span class="sxs-lookup"><span data-stu-id="2184b-107">The emphasis is not on the size, but instead on business capabilities.</span></span> <span data-ttu-id="2184b-108">此外，如果沒有清除凝聚力所需的相依性數目為基礎的應用程式的特定區域，則表示單一的微服務，需要太。</span><span class="sxs-lookup"><span data-stu-id="2184b-108">In addition, if there is clear cohesion needed for a certain area of the application based on a high number of dependencies, that indicates the need for a single microservice, too.</span></span> <span data-ttu-id="2184b-109">一致性是找出如何打散這些路徑或群組在一起 microservices 的方法。</span><span class="sxs-lookup"><span data-stu-id="2184b-109">Cohesion is a way to identify how to break apart or group together microservices.</span></span> <span data-ttu-id="2184b-110">最後，同時取得更多有關定義域的知識，您應該反覆地調整您的微服務，大小。</span><span class="sxs-lookup"><span data-stu-id="2184b-110">Ultimately, while you gain more knowledge about the domain, you should adapt the size of your microservice, iteratively.</span></span> <span data-ttu-id="2184b-111">尋找正確的大小，不是單次的程序。</span><span class="sxs-lookup"><span data-stu-id="2184b-111">Finding the right size is not a one-shot process.</span></span>

<span data-ttu-id="2184b-112">[Sam Newman](http://samnewman.io/)，可辨識的升級程式 microservices 及書籍作者[建置 Microservices](http://samnewman.io/books/building_microservices/)，會反白顯示，您應該設計您 microservices 根據繫結的內容 (BC) 模式 （屬於網域導向設計），如稍早導入。</span><span class="sxs-lookup"><span data-stu-id="2184b-112">[Sam Newman](http://samnewman.io/), a recognized promoter of microservices and author of the book [Building Microservices](http://samnewman.io/books/building_microservices/), highlights that you should design your microservices based on the Bounded Context (BC) pattern (part of domain-driven design), as introduced earlier.</span></span> <span data-ttu-id="2184b-113">有時候，BC 無法撰寫的數個實體的服務，但不是反之亦然。</span><span class="sxs-lookup"><span data-stu-id="2184b-113">Sometimes, a BC could be composed of several physical services, but not vice versa.</span></span>

<span data-ttu-id="2184b-114">特定網域實體的網域模型適用於具象 BC 內或微服務。</span><span class="sxs-lookup"><span data-stu-id="2184b-114">A domain model with specific domain entities applies within a concrete BC or microservice.</span></span> <span data-ttu-id="2184b-115">BC 分隔網域模型的適用性，並可讓開發人員小組成員必須凝聚力和項目可以獨立開發清楚且共用了解。</span><span class="sxs-lookup"><span data-stu-id="2184b-115">A BC delimits the applicability of a domain model and gives developer team members a clear and shared understanding of what must be cohesive and what can be developed independently.</span></span> <span data-ttu-id="2184b-116">這些是 microservices 的相同目標。</span><span class="sxs-lookup"><span data-stu-id="2184b-116">These are the same goals for microservices.</span></span>

<span data-ttu-id="2184b-117">會通知您的設計選擇的另一個工具是[Conway 定律](https://en.wikipedia.org/wiki/Conway%27s_law)，其狀態的應用程式會反映社交組織產生它的界限。</span><span class="sxs-lookup"><span data-stu-id="2184b-117">Another tool that informs your design choice is [Conway’s law](https://en.wikipedia.org/wiki/Conway%27s_law), which states that an application will reflect the social boundaries of the organization that produced it.</span></span> <span data-ttu-id="2184b-118">但有時候的情況則相反，公司的組織由軟體所構成。</span><span class="sxs-lookup"><span data-stu-id="2184b-118">But sometimes the opposite is true—the company’s organization is formed by the software.</span></span> <span data-ttu-id="2184b-119">您可能需要反向 Conway 定律和您想要組織，公司的方式建立界限傾向向商務程序諮詢。</span><span class="sxs-lookup"><span data-stu-id="2184b-119">You might need to reverse Conway’s law and build the boundaries the way you want the company to be organized, leaning toward business process consulting.</span></span>

<span data-ttu-id="2184b-120">以找出已繫結的內容，可以用這個 DDD 模式是[內容對應模式](https://www.infoq.com/articles/ddd-contextmapping)。</span><span class="sxs-lookup"><span data-stu-id="2184b-120">In order to identify bounded contexts, a DDD pattern that can be used for this is the [Context Mapping pattern](https://www.infoq.com/articles/ddd-contextmapping).</span></span> <span data-ttu-id="2184b-121">具有內容的對應，您會識別應用程式和其界限中的各種內容。</span><span class="sxs-lookup"><span data-stu-id="2184b-121">With Context Mapping, you identify the various contexts in the application and their boundaries.</span></span> <span data-ttu-id="2184b-122">通常會有不同的內容和界限，每個小型的子系統執行個體。</span><span class="sxs-lookup"><span data-stu-id="2184b-122">It is common to have a different context and boundary for each small subsystem, for instance.</span></span> <span data-ttu-id="2184b-123">內容地圖是以定義使明確這些界限網域之間的方法。</span><span class="sxs-lookup"><span data-stu-id="2184b-123">The Context Map is a way to define and make explicit those boundaries between domains.</span></span> <span data-ttu-id="2184b-124">BC 自發而且包含單一網域的詳細資料： 詳細資料的類似網域實體，並定義與其他 BCs 整合合約。</span><span class="sxs-lookup"><span data-stu-id="2184b-124">A BC is autonomous and includes the details of a single domain—details like the domain entities—and defines integration contracts with other BCs.</span></span> <span data-ttu-id="2184b-125">這是類似的微服務定義： 它是自發它實作特定網域的功能，它必須提供介面。</span><span class="sxs-lookup"><span data-stu-id="2184b-125">This is similar to the definition of a microservice: it is autonomous, it implements certain domain capability, and it must provide interfaces.</span></span> <span data-ttu-id="2184b-126">這是為什麼對應內容和繫結內容模式是識別您 microservices 網域模型界限的好方法。</span><span class="sxs-lookup"><span data-stu-id="2184b-126">This is why Context Mapping and the Bounded Context pattern are good approaches for identifying the domain model boundaries of your microservices.</span></span>

<span data-ttu-id="2184b-127">在設計的大型應用程式時，您會看到分散其網域模型的方式，從類別目錄網域的網域專家 」 會命名實體在類別目錄和清查的網域中比傳送網域專家，以不同的方式執行個體。</span><span class="sxs-lookup"><span data-stu-id="2184b-127">When designing a large application, you will see how its domain model can be fragmented — a domain expert from the catalog domain will name entities differently in the catalog and inventory domains than a shipping domain expert, for instance.</span></span> <span data-ttu-id="2184b-128">或 CRM 專家想要儲存每個詳細比的客戶，排序網域專家使用者只需要客戶相關的部分資料在處理時，使用者網域實體可能是不同的大小和數目的屬性。</span><span class="sxs-lookup"><span data-stu-id="2184b-128">Or the user domain entity might be different in size and number of attributes when dealing with a CRM expert who wants to store every detail about the customer than for an ordering domain expert who just needs partial data about the customer.</span></span> <span data-ttu-id="2184b-129">它是很難區分的大型應用程式相關的所有網域的所有定義域詞彙。</span><span class="sxs-lookup"><span data-stu-id="2184b-129">It is very hard to disambiguate all domain terms across all the domains related to a large application.</span></span> <span data-ttu-id="2184b-130">但最重要的一點是，您不應嘗試統一條款;相反地，接受的差異和每個網域所提供的豐富性。</span><span class="sxs-lookup"><span data-stu-id="2184b-130">But the most important thing is that you should not try to unify the terms; instead, accept the differences and richness provided by each domain.</span></span> <span data-ttu-id="2184b-131">如果您嘗試在有統一整個應用程式資料庫，嘗試在統一的詞彙會造成不便，而且不聽右任何多個網域專家。</span><span class="sxs-lookup"><span data-stu-id="2184b-131">If you try to have a unified database for the whole application, attempts at a unified vocabulary will be awkward and will not sound right to any of the multiple domain experts.</span></span> <span data-ttu-id="2184b-132">因此，會協助您釐清，您可以使用特定的定義域詞彙，而且您必須劃分系統，並使用不同網域中建立其他 BCs BCs （實作為 microservices）。</span><span class="sxs-lookup"><span data-stu-id="2184b-132">Therefore, BCs (implemented as microservices) will help you to clarify where you can use certain domain terms and where you will need to split the system and create additional BCs with different domains.</span></span>

<span data-ttu-id="2184b-133">您將知道所得的右界限和每個 BC 大小，而網域模型，如果您有幾個不同的網域模型的強式關聯性，而且您通常不需要執行一般的應用程式時，合併來自多個網域模型的資訊作業。</span><span class="sxs-lookup"><span data-stu-id="2184b-133">You will know that you got the right boundaries and sizes of each BC and domain model if you have few strong relationships between domain models, and you do not usually need to merge information from multiple domain models when performing typical application operations.</span></span>

<span data-ttu-id="2184b-134">每個微服務的網域模型應該有多大的問題的最佳答案可能如下所示： 應有自發的 BC 越好，可讓您處理而不需要不斷切換到其他內容 （其他為隔離微服務的模型）。</span><span class="sxs-lookup"><span data-stu-id="2184b-134">Perhaps the best answer to the question of how big a domain model for each microservice should be is the following: it should have an autonomous BC, as isolated as possible, that enables you to work without having to constantly switch to other contexts (other microservice’s models).</span></span> <span data-ttu-id="2184b-135">您可以查看圖 4-10 多個 microservices (多個 BCs) 每個有自己的模型和其實體可以定義方式，根據每個應用程式中的識別網域的特定需求的方式。</span><span class="sxs-lookup"><span data-stu-id="2184b-135">In Figure 4-10 you can see how multiple microservices (multiple BCs) each have their own model and how their entities can be defined, depending on the specific requirements for each of the identified domains in your application.</span></span>

![](./media/image10.png)

<span data-ttu-id="2184b-136">**圖 4-10**。</span><span class="sxs-lookup"><span data-stu-id="2184b-136">**Figure 4-10**.</span></span> <span data-ttu-id="2184b-137">識別的實體和微服務模型界限</span><span class="sxs-lookup"><span data-stu-id="2184b-137">Identifying entities and microservice model boundaries</span></span>

<span data-ttu-id="2184b-138">圖 4-10 說明相關的線上會議管理系統的範例案例。</span><span class="sxs-lookup"><span data-stu-id="2184b-138">Figure 4-10 illustrates a sample scenario related to an online conference management system.</span></span> <span data-ttu-id="2184b-139">您已識別可能會實作為 microservices，按照您定義網域專家的網域的數個 BCs。</span><span class="sxs-lookup"><span data-stu-id="2184b-139">You have identified several BCs that could be implemented as microservices, based on domains that domain experts defined for you.</span></span> <span data-ttu-id="2184b-140">如您所見，有只在單一的微服務模型中，例如付款付款微服務中出現的實體。</span><span class="sxs-lookup"><span data-stu-id="2184b-140">As you can see, there are entities that are present just in a single microservice model, like Payments in the Payment microservice.</span></span> <span data-ttu-id="2184b-141">這些就很容易實作。</span><span class="sxs-lookup"><span data-stu-id="2184b-141">Those will be easy to implement.</span></span>

<span data-ttu-id="2184b-142">不過，您也可能會有不同的形狀，但跨多個網域模型從多個 microservices 共用相同的身分識別的實體。</span><span class="sxs-lookup"><span data-stu-id="2184b-142">However, you might also have entities that have a different shape but share the same identity across the multiple domain models from the multiple microservices.</span></span> <span data-ttu-id="2184b-143">例如，「 使用者 」 實體中所做的心得管理微服務識別。</span><span class="sxs-lookup"><span data-stu-id="2184b-143">For example, the User entity is identified in the Conferences Management microservice.</span></span> <span data-ttu-id="2184b-144">該相同的使用者，具有相同的識別，是一個購買者命名訂購微服務或一個付費者中付款微服務，即使一個具名的客戶在客戶服務微服務。</span><span class="sxs-lookup"><span data-stu-id="2184b-144">That same user, with the same identity, is the one named Buyers in the Ordering microservice, or the one named Payer in the Payment microservice, and even the one named Customer in the Customer Service microservice.</span></span> <span data-ttu-id="2184b-145">這是因為取決於[通用語言](https://martinfowler.com/bliki/UbiquitousLanguage.html)，使用每個網域專家，使用者可能會有不同的觀點來看，即使使用不同的屬性。</span><span class="sxs-lookup"><span data-stu-id="2184b-145">This is because, depending on the [ubiquitous language](https://martinfowler.com/bliki/UbiquitousLanguage.html) that each domain expert is using, a user might have a different perspective even with different attributes.</span></span> <span data-ttu-id="2184b-146">名為所做的心得管理的微服務模型中的使用者實體可能有大部分的個人資料屬性。</span><span class="sxs-lookup"><span data-stu-id="2184b-146">The user entity in the microservice model named Conferences Management might have most of its personal data attributes.</span></span> <span data-ttu-id="2184b-147">不過，該相同的使用者付費者的圖形，在微服務付款或客戶的微服務客戶服務的圖形中可能不需要相同的屬性清單。</span><span class="sxs-lookup"><span data-stu-id="2184b-147">However, that same user in the shape of Payer in the microservice Payment or in the shape of Customer in the microservice Customer Service might not need the same list of attributes.</span></span>

<span data-ttu-id="2184b-148">類似的方法說明圖 4-11。</span><span class="sxs-lookup"><span data-stu-id="2184b-148">A similar approach is illustrated in Figure 4-11.</span></span>

![](./media/image11.png)

<span data-ttu-id="2184b-149">**圖 4-11**。</span><span class="sxs-lookup"><span data-stu-id="2184b-149">**Figure 4-11**.</span></span> <span data-ttu-id="2184b-150">將傳統的資料模型分解成多個網域模型</span><span class="sxs-lookup"><span data-stu-id="2184b-150">Decomposing traditional data models into multiple domain models</span></span>

<span data-ttu-id="2184b-151">您可以查看如何使用者當做使用者實體所做的心得管理微服務模型中，並且也會出現在 [買方] 實體中定價微服務，以替代屬性或使用者時，它實際上買方詳細表單。</span><span class="sxs-lookup"><span data-stu-id="2184b-151">You can see how the user is present in the Conferences Management microservice model as the User entity and is also present in the form of the Buyer entity in the Pricing microservice, with alternate attributes or details about the user when it is actually a buyer.</span></span> <span data-ttu-id="2184b-152">每個微服務 」 或 「 BC 可能不需要與使用者的實體，為部分，根據以解決問題或內容相關的所有資料。</span><span class="sxs-lookup"><span data-stu-id="2184b-152">Each microservice or BC might not need all the data related to a User entity, just part of it, depending on the problem to solve or the context.</span></span> <span data-ttu-id="2184b-153">比方說，在價格微服務模型中，您不需要的位址或使用者，只要 （身分識別） 的識別碼和狀態，將會影響的折扣價格每買方的座位時的識別碼。</span><span class="sxs-lookup"><span data-stu-id="2184b-153">For instance, in the Pricing microservice model, you do not need the address or the ID of the user, just ID (as identity) and Status, which will have an impact on discounts when pricing the seats per buyer.</span></span>

<span data-ttu-id="2184b-154">基座實體有相同名稱但不同的屬性，每個網域模型中。</span><span class="sxs-lookup"><span data-stu-id="2184b-154">The Seat entity has the same name but different attributes in each domain model.</span></span> <span data-ttu-id="2184b-155">不過，基座共用相同的識別碼，為基礎的身分識別與使用者和買方發生，因此。</span><span class="sxs-lookup"><span data-stu-id="2184b-155">However, Seat shares identity based on the same ID, as happens with User and Buyer.</span></span>

<span data-ttu-id="2184b-156">基本上，是使用者的存在於多個服務 （網域），這些全都共用該使用者的身分識別共用的概念。</span><span class="sxs-lookup"><span data-stu-id="2184b-156">Basically, there is a shared concept of a user that exists in multiple services (domains), which all share the identity of that user.</span></span> <span data-ttu-id="2184b-157">但是，每個網域模型中可能有其他或不同的使用者實體的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="2184b-157">But in each domain model there might be additional or different details about the user entity.</span></span> <span data-ttu-id="2184b-158">因此，需要具備以便對應到另一個網域 （微服務） 的使用者實體。</span><span class="sxs-lookup"><span data-stu-id="2184b-158">Therefore, there needs to be a way to map a user entity from one domain (microservice) to another.</span></span>

<span data-ttu-id="2184b-159">有幾個好處不在跨網域的相同數目的屬性與共用相同的使用者實體。</span><span class="sxs-lookup"><span data-stu-id="2184b-159">There are several benefits to not sharing the same user entity with the same number of attributes across domains.</span></span> <span data-ttu-id="2184b-160">其中一個優點是減少重複，因此微服務模型不會有任何不需要的資料。</span><span class="sxs-lookup"><span data-stu-id="2184b-160">One benefit is to reduce duplication, so that microservice models do not have any data that they do not need.</span></span> <span data-ttu-id="2184b-161">另一項優點有主要的微服務擁有特定類型的每個實體的資料，以便更新和查詢，該類型的資料驅動型只能由該微服務。</span><span class="sxs-lookup"><span data-stu-id="2184b-161">Another benefit is having a master microservice that owns a certain type of data per entity so that updates and queries for that type of data are driven only by that microservice.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="2184b-162">[上一個](分散式的資料-management.md) [下一步] (direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md)</span><span class="sxs-lookup"><span data-stu-id="2184b-162">[Previous] (distributed-data-management.md) [Next] (direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md)</span></span>
