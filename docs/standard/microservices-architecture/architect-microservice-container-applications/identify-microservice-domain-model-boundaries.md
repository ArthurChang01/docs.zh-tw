---
title: 識別每個微服務的領域模型界限
description: 容器化 .NET 應用程式的 .NET 微服務架構 | 識別每個微服務的領域模型界限
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.openlocfilehash: b11d2838539b8ddbe21bcfcb77845a10e466c760
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/04/2018
ms.locfileid: "33578105"
---
# <a name="identify-domain-model-boundaries-for-each-microservice"></a><span data-ttu-id="0dbb9-103">識別每個微服務的領域模型界限</span><span class="sxs-lookup"><span data-stu-id="0dbb9-103">Identify domain-model boundaries for each microservice</span></span>

<span data-ttu-id="0dbb9-104">識別每個微服務的模型界限和大小時，其目標不是為了取得可能最細微的分離，不過您應該盡可能傾向小型微服務。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-104">The goal when identifying model boundaries and size for each microservice is not to get to the most granular separation possible, although you should tend toward small microservices if possible.</span></span> <span data-ttu-id="0dbb9-105">相反地，您的目標應該是在您的領域知識引導下取得最有意義的分離。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-105">Instead, your goal should be to get to the most meaningful separation guided by your domain knowledge.</span></span> <span data-ttu-id="0dbb9-106">重點不是大小，而是商務功能。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-106">The emphasis is not on the size, but instead on business capabilities.</span></span> <span data-ttu-id="0dbb9-107">此外，如果以大量相依性為基礎的應用程式有某部分需要明確內聚，這也表示需要單一微服務。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-107">In addition, if there is clear cohesion needed for a certain area of the application based on a high number of dependencies, that indicates the need for a single microservice, too.</span></span> <span data-ttu-id="0dbb9-108">內聚是指定如何將微服務分開或群組在一起的方式。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-108">Cohesion is a way to identify how to break apart or group together microservices.</span></span> <span data-ttu-id="0dbb9-109">基本上，當您取得更多有關領域的知識時，您應該反覆地調整微服務的大小。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-109">Ultimately, while you gain more knowledge about the domain, you should adapt the size of your microservice, iteratively.</span></span> <span data-ttu-id="0dbb9-110">您不會一次就找到正確的大小。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-110">Finding the right size is not a one-shot process.</span></span>

<span data-ttu-id="0dbb9-111">[Sam Newman](https://samnewman.io/) 是公認的微服務推動者，也是 [Building Microservices](https://samnewman.io/books/building_microservices/) 一書的作者，他強調您應該根據稍早所介紹的限定內容 (Bounded Context，BC) 模式 (領域導向設計的一部分)，來設計您的微服務。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-111">[Sam Newman](https://samnewman.io/), a recognized promoter of microservices and author of the book [Building Microservices](https://samnewman.io/books/building_microservices/), highlights that you should design your microservices based on the Bounded Context (BC) pattern (part of domain-driven design), as introduced earlier.</span></span> <span data-ttu-id="0dbb9-112">有時候，BC 可能是由數個實體服務所組成，但反之則不亦然。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-112">Sometimes, a BC could be composed of several physical services, but not vice versa.</span></span>

<span data-ttu-id="0dbb9-113">具有特定領域實體的領域模型會在實體 BC 或微服務內套用。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-113">A domain model with specific domain entities applies within a concrete BC or microservice.</span></span> <span data-ttu-id="0dbb9-114">BC 會界定領域模型的適用性，讓開發人員小組成員對於哪些項目必須內聚、哪些項目可以獨立開發有清楚的共識。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-114">A BC delimits the applicability of a domain model and gives developer team members a clear and shared understanding of what must be cohesive and what can be developed independently.</span></span> <span data-ttu-id="0dbb9-115">所有微服務都有這些相同目標。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-115">These are the same goals for microservices.</span></span>

<span data-ttu-id="0dbb9-116">另一個左右設計選擇的工具是 [Conway 定律](https://en.wikipedia.org/wiki/Conway%27s_law)，其指出應用程式會反映產生該應用程式之組織的社交界限。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-116">Another tool that informs your design choice is [Conway’s law](https://en.wikipedia.org/wiki/Conway%27s_law), which states that an application will reflect the social boundaries of the organization that produced it.</span></span> <span data-ttu-id="0dbb9-117">但有時候則是相反的情況，公司的組織是由軟體所構成。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-117">But sometimes the opposite is true—the company’s organization is formed by the software.</span></span> <span data-ttu-id="0dbb9-118">您可能需要反轉 Conway 定律，並以您想要的公司組織方式來建立界限 (傾向業務程序諮詢)。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-118">You might need to reverse Conway’s law and build the boundaries the way you want the company to be organized, leaning toward business process consulting.</span></span>

<span data-ttu-id="0dbb9-119">為了識別限定內容，[內容對應 (Context Mapping) 模式](https://www.infoq.com/articles/ddd-contextmapping)是可用來執行此作業的 DDD 模式。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-119">In order to identify bounded contexts, a DDD pattern that can be used for this is the [Context Mapping pattern](https://www.infoq.com/articles/ddd-contextmapping).</span></span> <span data-ttu-id="0dbb9-120">透過內容對應，您可以識別應用程式及其界限內的各種內容。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-120">With Context Mapping, you identify the various contexts in the application and their boundaries.</span></span> <span data-ttu-id="0dbb9-121">例如，每個小型子系統通常會有不同的內容和界限。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-121">It is common to have a different context and boundary for each small subsystem, for instance.</span></span> <span data-ttu-id="0dbb9-122">內容對應可讓您定義並明確化領域之間界限。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-122">The Context Map is a way to define and make explicit those boundaries between domains.</span></span> <span data-ttu-id="0dbb9-123">BC 是自主的，並包含單一領域的詳細資料 (領域實體等詳細資料)，而且會定義與其他 BC 的整合合約。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-123">A BC is autonomous and includes the details of a single domain—details like the domain entities—and defines integration contracts with other BCs.</span></span> <span data-ttu-id="0dbb9-124">這與微服務的定義類似：它是自主的、實作特定領域功能，而且必須提供介面。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-124">This is similar to the definition of a microservice: it is autonomous, it implements certain domain capability, and it must provide interfaces.</span></span> <span data-ttu-id="0dbb9-125">因此，內容對應和限定內容模式是識別微服務之領域模型界限的好方法。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-125">This is why Context Mapping and the Bounded Context pattern are good approaches for identifying the domain model boundaries of your microservices.</span></span>

<span data-ttu-id="0dbb9-126">設計大型應用程式時，您會看到其領域模型的分割方式。例如，來自目錄領域的領域專家在命名目錄和庫存領域中的實體時，會與運送領域專家不同。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-126">When designing a large application, you will see how its domain model can be fragmented — a domain expert from the catalog domain will name entities differently in the catalog and inventory domains than a shipping domain expert, for instance.</span></span> <span data-ttu-id="0dbb9-127">或者，面對想要儲存客戶所有詳細資料的 CRM 專家時，與面對只需要客戶部分資料的訂購領域專家時，使用者領域實體可能會有不同的大小和屬性數目。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-127">Or the user domain entity might be different in size and number of attributes when dealing with a CRM expert who wants to store every detail about the customer than for an ordering domain expert who just needs partial data about the customer.</span></span> <span data-ttu-id="0dbb9-128">您很難釐清大型應用程式之所有相關領域的所有領域詞彙。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-128">It is very hard to disambiguate all domain terms across all the domains related to a large application.</span></span> <span data-ttu-id="0dbb9-129">但最重要的是，您不應該嘗試統一詞彙；相反地，請接受每個領域所提供的差異和豐富度。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-129">But the most important thing is that you should not try to unify the terms; instead, accept the differences and richness provided by each domain.</span></span> <span data-ttu-id="0dbb9-130">如果您想要讓整個應用程式有統一的資料庫，嘗試統一詞彙並不容易，而且對任何多重領域專家而言也不正確。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-130">If you try to have a unified database for the whole application, attempts at a unified vocabulary will be awkward and will not sound right to any of the multiple domain experts.</span></span> <span data-ttu-id="0dbb9-131">因此，BC (實作成微服務) 會協助您釐清哪裡可以使用特定領域詞彙，而哪裡需要分割系統並使用不同的領域來建立其他 BC。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-131">Therefore, BCs (implemented as microservices) will help you to clarify where you can use certain domain terms and where you will need to split the system and create additional BCs with different domains.</span></span>

<span data-ttu-id="0dbb9-132">您會知道，只要領域模型之間有幾個強固的關聯性，每個 BC 和領域模型的界限和大小就正確，而且您通常不需要在執行一般應用程式作業時，合併多個領域模型的資訊。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-132">You will know that you got the right boundaries and sizes of each BC and domain model if you have few strong relationships between domain models, and you do not usually need to merge information from multiple domain models when performing typical application operations.</span></span>

<span data-ttu-id="0dbb9-133">對於每個微服務的領域模型該有多大的這個問題，最佳答案或許如下：它應該具有自主的 BC 並盡可能隔離，以便您能夠持續工作而不需要經常切換至其他內容 (其他微服務的模型)。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-133">Perhaps the best answer to the question of how big a domain model for each microservice should be is the following: it should have an autonomous BC, as isolated as possible, that enables you to work without having to constantly switch to other contexts (other microservice’s models).</span></span> <span data-ttu-id="0dbb9-134">在圖 4-10 中，您會看到多個微服務 (多個 BC) 各自擁有自己的模型，以及根據您應用程式中每個識別領域的特定需求，可如何定義這些微服務的實體。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-134">In Figure 4-10 you can see how multiple microservices (multiple BCs) each have their own model and how their entities can be defined, depending on the specific requirements for each of the identified domains in your application.</span></span>

![](./media/image10.png)

<span data-ttu-id="0dbb9-135">**圖 4-10**：</span><span class="sxs-lookup"><span data-stu-id="0dbb9-135">**Figure 4-10**.</span></span> <span data-ttu-id="0dbb9-136">識別實體和微服務模型界限</span><span class="sxs-lookup"><span data-stu-id="0dbb9-136">Identifying entities and microservice model boundaries</span></span>

<span data-ttu-id="0dbb9-137">圖 4-10 說明與線上會議管理系統相關的範例案例。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-137">Figure 4-10 illustrates a sample scenario related to an online conference management system.</span></span> <span data-ttu-id="0dbb9-138">您已根據領域專家為您定義的領域，識別可實作成微服務的數個 BC。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-138">You have identified several BCs that could be implemented as microservices, based on domains that domain experts defined for you.</span></span> <span data-ttu-id="0dbb9-139">如您所見，單一微服務模型中就有多個實體，例如「付款」微服務中有多個「付款」。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-139">As you can see, there are entities that are present just in a single microservice model, like Payments in the Payment microservice.</span></span> <span data-ttu-id="0dbb9-140">這些實體實作起來很容易。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-140">Those will be easy to implement.</span></span>

<span data-ttu-id="0dbb9-141">不過，您也可能會有多個形狀不同的實體，但在來自多個微服務的多個領域模型之間共用相同的身分識別。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-141">However, you might also have entities that have a different shape but share the same identity across the multiple domain models from the multiple microservices.</span></span> <span data-ttu-id="0dbb9-142">例如，在「會議管理」微服務中已識別「使用者」實體。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-142">For example, the User entity is identified in the Conferences Management microservice.</span></span> <span data-ttu-id="0dbb9-143">具有相同身分識別的相同使用者也是「訂購」微服務中的「購買者」，或「付款」微服務中的「付款者」，甚至是「客戶服務」微服務中的「客戶」。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-143">That same user, with the same identity, is the one named Buyers in the Ordering microservice, or the one named Payer in the Payment microservice, and even the one named Customer in the Customer Service microservice.</span></span> <span data-ttu-id="0dbb9-144">這是因為根據每個領域專家所使用的[通用語言](https://martinfowler.com/bliki/UbiquitousLanguage.html)，使用者可能會有不同的檢視方塊，甚至會有不同的屬性。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-144">This is because, depending on the [ubiquitous language](https://martinfowler.com/bliki/UbiquitousLanguage.html) that each domain expert is using, a user might have a different perspective even with different attributes.</span></span> <span data-ttu-id="0dbb9-145">名為「會議管理」之微服務模型中的使用者實體可能會有其大多數的個人資料屬性。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-145">The user entity in the microservice model named Conferences Management might have most of its personal data attributes.</span></span> <span data-ttu-id="0dbb9-146">不過，在「付款」微服務中作為「付款者」或在「客戶服務」微服務中作為「客戶」的相同使用者不一定需要相同的屬性清單。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-146">However, that same user in the shape of Payer in the microservice Payment or in the shape of Customer in the microservice Customer Service might not need the same list of attributes.</span></span>

<span data-ttu-id="0dbb9-147">圖 4-11 說明類似的方法。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-147">A similar approach is illustrated in Figure 4-11.</span></span>

![](./media/image11.png)

<span data-ttu-id="0dbb9-148">**圖 4-11**：</span><span class="sxs-lookup"><span data-stu-id="0dbb9-148">**Figure 4-11**.</span></span> <span data-ttu-id="0dbb9-149">將傳統資料模型分解成多個領域模型</span><span class="sxs-lookup"><span data-stu-id="0dbb9-149">Decomposing traditional data models into multiple domain models</span></span>

<span data-ttu-id="0dbb9-150">如您所見，使用者會以「使用者」實體出現在「會議管理」微服務模型中，也會以「購買者」實體形式出現在「定價」微服務中，當使用者實際上是購買者時，就會替換成該使用者的相關屬性或詳細資料。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-150">You can see how the user is present in the Conferences Management microservice model as the User entity and is also present in the form of the Buyer entity in the Pricing microservice, with alternate attributes or details about the user when it is actually a buyer.</span></span> <span data-ttu-id="0dbb9-151">視要解決的問題或內容而定，每個微服務或 BC 不一定需要與「使用者」實體相關的所有資料。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-151">Each microservice or BC might not need all the data related to a User entity, just part of it, depending on the problem to solve or the context.</span></span> <span data-ttu-id="0dbb9-152">例如，在「定價」微服務模型中，您不需要使用者的地址或識別碼，只需要識別碼 (作為身分識別) 和狀態，這會影響每個購買者席次的定價折扣。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-152">For instance, in the Pricing microservice model, you do not need the address or the ID of the user, just ID (as identity) and Status, which will have an impact on discounts when pricing the seats per buyer.</span></span>

<span data-ttu-id="0dbb9-153">每個領域模型中的「席次」實體會有相同的名稱但不同的屬性。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-153">The Seat entity has the same name but different attributes in each domain model.</span></span> <span data-ttu-id="0dbb9-154">不過，「席次」會依據相同的識別碼來共用身分識別，如同「使用者」與「購買者」的情況。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-154">However, Seat shares identity based on the same ID, as happens with User and Buyer.</span></span>

<span data-ttu-id="0dbb9-155">基本上，存在於多個服務 (領域) 的使用者具有共用概念，因此所有服務會共用該使用者的身分識別。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-155">Basically, there is a shared concept of a user that exists in multiple services (domains), which all share the identity of that user.</span></span> <span data-ttu-id="0dbb9-156">但在每個領域模型中，可能會有使用者實體的其他或不同詳細資料。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-156">But in each domain model there might be additional or different details about the user entity.</span></span> <span data-ttu-id="0dbb9-157">因此，您必須能夠將使用者實體從一個領域 (微服務) 對應至另一個。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-157">Therefore, there needs to be a way to map a user entity from one domain (microservice) to another.</span></span>

<span data-ttu-id="0dbb9-158">不要跨領域共用具有相同屬性數目的相同使用者實體有幾個優點。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-158">There are several benefits to not sharing the same user entity with the same number of attributes across domains.</span></span> <span data-ttu-id="0dbb9-159">一個優點是減少重複，讓微服務模型不會有任何不必要的資料。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-159">One benefit is to reduce duplication, so that microservice models do not have any data that they do not need.</span></span> <span data-ttu-id="0dbb9-160">另一個優點是具有主要微服務，以針對每個實體擁有一種資料類型，讓該資料類型的更新和查詢完全取決於該微服務。</span><span class="sxs-lookup"><span data-stu-id="0dbb9-160">Another benefit is having a master microservice that owns a certain type of data per entity so that updates and queries for that type of data are driven only by that microservice.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="0dbb9-161">[上一個] (distributed-data-management.md) [下一個] (direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md)</span><span class="sxs-lookup"><span data-stu-id="0dbb9-161">[Previous] (distributed-data-management.md) [Next] (direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md)</span></span>
