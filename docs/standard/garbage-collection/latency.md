---
title: 延遲模式
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- garbage collection, intrusiveness
- garbage collection, latency modes
ms.assetid: 96278bb7-6eab-4612-8594-ceebfc887d81
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 3440e0869bfd131f8a57a74af6105716d4b72935
ms.sourcegitcommit: a885cc8c3e444ca6471348893d5373c6e9e49a47
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/06/2018
ms.locfileid: "43883718"
---
# <a name="latency-modes"></a><span data-ttu-id="3cc9b-102">延遲模式</span><span class="sxs-lookup"><span data-stu-id="3cc9b-102">Latency Modes</span></span>
<span data-ttu-id="3cc9b-103">為了回收物件，記憶體回收行程必須停止應用程式中所有正在執行的執行緒。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-103">To reclaim objects, the garbage collector must stop all the executing threads in an application.</span></span> <span data-ttu-id="3cc9b-104">在某些情況下，例如當應用程式擷取資料或顯示內容時，完整記憶體回收會在關鍵時刻進行，而妨礙效能。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-104">In some situations, such as when an application retrieves data or displays content, a full garbage collection can occur at a critical time and impede performance.</span></span> <span data-ttu-id="3cc9b-105">您可以藉由設定 <xref:System.Runtime.GCSettings.LatencyMode%2A?displayProperty=nameWithType> 屬性為 <xref:System.Runtime.GCLatencyMode?displayProperty=nameWithType> 值的其中一個，來調整記憶體回收行程的干擾程度。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-105">You can adjust the intrusiveness of the garbage collector by setting the <xref:System.Runtime.GCSettings.LatencyMode%2A?displayProperty=nameWithType> property to one of the <xref:System.Runtime.GCLatencyMode?displayProperty=nameWithType> values.</span></span>  
  
 <span data-ttu-id="3cc9b-106">延遲指的是記憶體回收行程干擾應用程式的時間。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-106">Latency refers to the time that the garbage collector intrudes in your application.</span></span> <span data-ttu-id="3cc9b-107">在低延遲期間，記憶體回收行程會更加保守，也較不干擾啟用物件。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-107">During low latency periods, the garbage collector is more conservative and less intrusive in reclaiming objects.</span></span> <span data-ttu-id="3cc9b-108"><xref:System.Runtime.GCLatencyMode?displayProperty=nameWithType> 列舉會提供兩個低延遲設定：</span><span class="sxs-lookup"><span data-stu-id="3cc9b-108">The <xref:System.Runtime.GCLatencyMode?displayProperty=nameWithType> enumeration provides two low latency settings:</span></span>  
  
-   <span data-ttu-id="3cc9b-109"><xref:System.Runtime.GCLatencyMode.LowLatency> 會隱藏層代 2 回收，並且只執行層代 0 和 1 回收。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-109"><xref:System.Runtime.GCLatencyMode.LowLatency> suppresses generation 2 collections and performs only generation 0 and 1 collections.</span></span> <span data-ttu-id="3cc9b-110">它只適合短時間使用。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-110">It can be used only for short periods of time.</span></span> <span data-ttu-id="3cc9b-111">經過一段較長的時間後，如果系統記憶體吃緊，則記憶體回收行程將會觸發回收，該回收可能會短暫暫停應用程式，並且中斷時間關鍵的作業。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-111">Over longer periods, if the system is under memory pressure, the garbage collector will trigger a collection, which can briefly pause the application and disrupt a time-critical operation.</span></span> <span data-ttu-id="3cc9b-112">這項設定僅適用於工作站記憶體回收。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-112">This setting is available only for workstation garbage collection.</span></span>  
  
-   <span data-ttu-id="3cc9b-113"><xref:System.Runtime.GCLatencyMode.SustainedLowLatency> 會隱藏前景層代 2 回收，並且只執行層代 0、1 和背景層代 2 回收。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-113"><xref:System.Runtime.GCLatencyMode.SustainedLowLatency> suppresses foreground generation 2 collections and performs only generation 0, 1, and background generation 2 collections.</span></span> <span data-ttu-id="3cc9b-114">它可以長時間使用，並且可用於工作站和伺服器記憶體回收。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-114">It can be used for longer periods of time, and is available for both workstation and server garbage collection.</span></span> <span data-ttu-id="3cc9b-115">如果已停用[並行記憶體回收](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md)，則無法使用這個設定。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-115">This setting cannot be used if [concurrent garbage collection](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) is disabled.</span></span>  
  
 <span data-ttu-id="3cc9b-116">在低延遲期間，會隱藏層代 2 回收，除非發生下列情況：</span><span class="sxs-lookup"><span data-stu-id="3cc9b-116">During low latency periods, generation 2 collections are suppressed unless the following occurs:</span></span>  
  
-   <span data-ttu-id="3cc9b-117">系統從作業系統接收到記憶體不足的通知。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-117">The system receives a low memory notification from the operating system.</span></span>  
  
-   <span data-ttu-id="3cc9b-118">應用程式程式碼會呼叫 <xref:System.GC.Collect%2A?displayProperty=nameWithType> 方法並指定 `generation` 參數為 2 來進行回收。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-118">Your application code induces a collection by calling the <xref:System.GC.Collect%2A?displayProperty=nameWithType> method and specifying 2 for the `generation` parameter.</span></span>  
  
 <span data-ttu-id="3cc9b-119">下表列出使用 <xref:System.Runtime.GCLatencyMode> 值的應用程式案例。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-119">The following table lists the application scenarios for using the <xref:System.Runtime.GCLatencyMode> values.</span></span>  
  
|<span data-ttu-id="3cc9b-120">延遲模式</span><span class="sxs-lookup"><span data-stu-id="3cc9b-120">Latency mode</span></span>|<span data-ttu-id="3cc9b-121">應用程式案例</span><span class="sxs-lookup"><span data-stu-id="3cc9b-121">Application scenarios</span></span>|  
|------------------|---------------------------|  
|<xref:System.Runtime.GCLatencyMode.Batch>|<span data-ttu-id="3cc9b-122">對於沒有 UI 或伺服器端作業的應用程式。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-122">For applications that have no UI or server-side operations.</span></span><br /><br /> <span data-ttu-id="3cc9b-123">這是[並行記憶體回收](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md)停用時的預設模式。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-123">This is the default mode when [concurrent garbage collection](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) is disabled.</span></span>|  
|<xref:System.Runtime.GCLatencyMode.Interactive>|<span data-ttu-id="3cc9b-124">對於大部分有使用者介面的應用程式，</span><span class="sxs-lookup"><span data-stu-id="3cc9b-124">For most applications that have a UI.</span></span><br /><br /> <span data-ttu-id="3cc9b-125">這是[並行記憶體回收](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md)啟用時的預設模式。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-125">This is the default mode when [concurrent garbage collection](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) is enabled.</span></span>|  
|<xref:System.Runtime.GCLatencyMode.LowLatency>|<span data-ttu-id="3cc9b-126">對於具有短期、對時間敏感作業的應用程式，其執行期間可能受到記憶體回收行程中斷的干擾。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-126">For applications that have short-term, time-sensitive operations during which interruptions from the garbage collector could be disruptive.</span></span> <span data-ttu-id="3cc9b-127">例如，應用程式使用動畫呈現或資料擷取的函式。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-127">For example, applications that do animation rendering or data acquisition functions.</span></span>|  
|<xref:System.Runtime.GCLatencyMode.SustainedLowLatency>|<span data-ttu-id="3cc9b-128">適合的應用程式具有對時間敏感的作業，這些作業可能長時間持續執行，且這段執行時間內可能經常受到記憶體回收行程中斷的干擾。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-128">For applications that have time-sensitive operations for a contained but potentially longer duration of time during which interruptions from the garbage collector could be disruptive.</span></span> <span data-ttu-id="3cc9b-129">例如，因為交易時間內市場資料不斷變化，而需要迅速回應的應用程式。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-129">For example, applications that need quick response times as market data changes during trading hours.</span></span><br /><br /> <span data-ttu-id="3cc9b-130">這個模式會所產生的 Managed 堆積大小會比其他模式更大。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-130">This mode results in a larger managed heap size than other modes.</span></span> <span data-ttu-id="3cc9b-131">由於它不會壓縮 Managed 堆積，因此磁碟可能會高度分割。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-131">Because it does not compact the managed heap, higher fragmentation is possible.</span></span> <span data-ttu-id="3cc9b-132">確定有足夠的記憶體可供使用。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-132">Ensure that sufficient memory is available.</span></span>|  
  
## <a name="guidelines-for-using-low-latency"></a><span data-ttu-id="3cc9b-133">使用低延遲的指導方針</span><span class="sxs-lookup"><span data-stu-id="3cc9b-133">Guidelines for Using Low Latency</span></span>  
 <span data-ttu-id="3cc9b-134">當您使用 <xref:System.Runtime.GCLatencyMode.LowLatency> 模式時，請考慮下列指導方針：</span><span class="sxs-lookup"><span data-stu-id="3cc9b-134">When you use <xref:System.Runtime.GCLatencyMode.LowLatency> mode, consider the following guidelines:</span></span>  
  
-   <span data-ttu-id="3cc9b-135">盡可能縮短這段低延遲的時間。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-135">Keep the period of time in low latency as short as possible.</span></span>  
  
-   <span data-ttu-id="3cc9b-136">請避免在低延遲期間配置大量記憶體。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-136">Avoid allocating high amounts of memory during low latency periods.</span></span> <span data-ttu-id="3cc9b-137">因為記憶體回收較少物件時，會造成記憶體不足的通知。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-137">Low memory notifications can occur because garbage collection reclaims fewer objects.</span></span>  
  
-   <span data-ttu-id="3cc9b-138">在低延遲模式時，盡量減少配置數目，特別是配置到大型物件堆積和 Pin 物件的數目。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-138">While in the low latency mode, minimize the number of allocations you make, in particular allocations onto the Large Object Heap and pinned objects.</span></span>  
  
-   <span data-ttu-id="3cc9b-139">請注意無法配置的執行緒。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-139">Be aware of threads that could be allocating.</span></span> <span data-ttu-id="3cc9b-140">因為 <xref:System.Runtime.GCSettings.LatencyMode%2A> 屬性設定為整個處理序，或許會在可能配置的任何執行緒中產生 <xref:System.OutOfMemoryException>。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-140">Because the <xref:System.Runtime.GCSettings.LatencyMode%2A> property setting is process-wide, you could generate an <xref:System.OutOfMemoryException> on any thread that may be allocating.</span></span>  
  
-   <span data-ttu-id="3cc9b-141">將低度延遲的程式碼包裝在限制執行區域 (如需詳細資訊，請參閱[限制執行區域](../../../docs/framework/performance/constrained-execution-regions.md))。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-141">Wrap the low latency code in constrained execution regions (for more information, see [Constrained Execution Regions](../../../docs/framework/performance/constrained-execution-regions.md)).</span></span>  
  
-   <span data-ttu-id="3cc9b-142">您也可以呼叫 <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%29?displayProperty=nameWithType> 方法，在低延遲期間強制層代 2 回收。</span><span class="sxs-lookup"><span data-stu-id="3cc9b-142">You can force generation 2 collections during a low latency period by calling the <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%29?displayProperty=nameWithType> method.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3cc9b-143">另請參閱</span><span class="sxs-lookup"><span data-stu-id="3cc9b-143">See also</span></span>

- <xref:System.GC?displayProperty=nameWithType>  
- [<span data-ttu-id="3cc9b-144">引發的收集</span><span class="sxs-lookup"><span data-stu-id="3cc9b-144">Induced Collections</span></span>](../../../docs/standard/garbage-collection/induced.md)  
- [<span data-ttu-id="3cc9b-145">記憶體回收</span><span class="sxs-lookup"><span data-stu-id="3cc9b-145">Garbage Collection</span></span>](../../../docs/standard/garbage-collection/index.md)
