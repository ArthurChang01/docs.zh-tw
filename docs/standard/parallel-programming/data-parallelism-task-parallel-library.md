---
title: 資料平行處理原則 (工作平行程式庫)
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- parallelism, data
ms.assetid: 3f05f33f-f1da-4b16-81c2-9ceff1bef449
ms.openlocfilehash: 72696a41cd3b71f47fdcf43e4ece70ebeb7d34d1
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/15/2020
ms.locfileid: "73123165"
---
# <a name="data-parallelism-task-parallel-library"></a><span data-ttu-id="f5f78-102">資料平行處理原則 (工作平行程式庫)</span><span class="sxs-lookup"><span data-stu-id="f5f78-102">Data Parallelism (Task Parallel Library)</span></span>
<span data-ttu-id="f5f78-103">「資料平行處理原則」\*\* 是指在來源集合或陣列中的元素上，同時 (也就是平行) 執行相同作業的情節。</span><span class="sxs-lookup"><span data-stu-id="f5f78-103">*Data parallelism* refers to scenarios in which the same operation is performed concurrently (that is, in parallel) on elements in a source collection or array.</span></span> <span data-ttu-id="f5f78-104">在資料平行作業中，會將來源集合分割，讓多個執行緒可以同時在不同區段上操作。</span><span class="sxs-lookup"><span data-stu-id="f5f78-104">In data parallel operations, the source collection is partitioned so that multiple threads can operate on different segments concurrently.</span></span>  
  
 <span data-ttu-id="f5f78-105">工作平行程式庫 (TPL) 會透過 <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> 類別支援資料平行處理原則。</span><span class="sxs-lookup"><span data-stu-id="f5f78-105">The Task Parallel Library (TPL) supports data parallelism through the <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> class.</span></span> <span data-ttu-id="f5f78-106">這個類別針對 [for](../../csharp/language-reference/keywords/for.md) 和 [foreach](../../csharp/language-reference/keywords/foreach-in.md) 迴圈 (在 Visual Basic 中為 `For` 和 `For Each`)，提供以方法為基礎的平行實作。</span><span class="sxs-lookup"><span data-stu-id="f5f78-106">This class provides method-based parallel implementations of [for](../../csharp/language-reference/keywords/for.md) and [foreach](../../csharp/language-reference/keywords/foreach-in.md) loops (`For` and `For Each` in Visual Basic).</span></span> <span data-ttu-id="f5f78-107">針對 <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> 或 <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> 迴圈撰寫迴圈邏輯的方式，和撰寫循序迴圈很像。</span><span class="sxs-lookup"><span data-stu-id="f5f78-107">You write the loop logic for a <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> or <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> loop much as you would write a sequential loop.</span></span> <span data-ttu-id="f5f78-108">您不必建立執行緒或佇列工作項目。</span><span class="sxs-lookup"><span data-stu-id="f5f78-108">You do not have to create threads or queue work items.</span></span> <span data-ttu-id="f5f78-109">在基本迴圈中，您不必採用鎖定。</span><span class="sxs-lookup"><span data-stu-id="f5f78-109">In basic loops, you do not have to take locks.</span></span> <span data-ttu-id="f5f78-110">TPL 會為您處理所有低階工作。</span><span class="sxs-lookup"><span data-stu-id="f5f78-110">The TPL handles all the low-level work for you.</span></span> <span data-ttu-id="f5f78-111">如需有關 <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> 和 <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> 之用途的深入資訊，請下載這份文件：[平行程式設計模式：了解及套用 .NET Framework 4 中的平行模式](https://www.microsoft.com/download/details.aspx?id=19222) \(英文\)。</span><span class="sxs-lookup"><span data-stu-id="f5f78-111">For in-depth information about the use of <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType>, download the document [Patterns for Parallel Programming: Understanding and Applying Parallel Patterns with the .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=19222).</span></span> <span data-ttu-id="f5f78-112">下列程式碼範例顯示簡單的 `foreach` 迴圈及其平行對等項目。</span><span class="sxs-lookup"><span data-stu-id="f5f78-112">The following code example shows a simple `foreach` loop and its parallel equivalent.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="f5f78-113">本文件使用 Lambda 運算式來定義 TPL 中的委派。</span><span class="sxs-lookup"><span data-stu-id="f5f78-113">This documentation uses lambda expressions to define delegates in TPL.</span></span> <span data-ttu-id="f5f78-114">如果您不熟悉 C# 或 Visual Basic 中的 Lambda 運算式，請參閱 [PLINQ 和 TPL 中的 Lambda 運算式](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md)。</span><span class="sxs-lookup"><span data-stu-id="f5f78-114">If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).</span></span>  
  
 [!code-csharp[TPL#20](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl/cs/tpl.cs#20)]
 [!code-vb[TPL#20](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl/vb/tpl_vb.vb#20)]  
  
 <span data-ttu-id="f5f78-115">當平行迴圈執行時，TPL 會分割資料來源，讓迴圈可以同時在多個部分上操作。</span><span class="sxs-lookup"><span data-stu-id="f5f78-115">When a parallel loop runs, the TPL partitions the data source so that the loop can operate on multiple parts concurrently.</span></span> <span data-ttu-id="f5f78-116">在幕後，工作排程器會依據系統資源和工作負載來分割工作。</span><span class="sxs-lookup"><span data-stu-id="f5f78-116">Behind the scenes, the Task Scheduler partitions the task based on system resources and workload.</span></span> <span data-ttu-id="f5f78-117">如果工作負載變得不平衡，在可能的情況下，排程器會在多個執行緒與處理器之間轉散發工作。</span><span class="sxs-lookup"><span data-stu-id="f5f78-117">When possible, the scheduler redistributes work among multiple threads and processors if the workload becomes unbalanced.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="f5f78-118">您也可以提供您自己的自訂 Partitioner 或排程器。</span><span class="sxs-lookup"><span data-stu-id="f5f78-118">You can also supply your own custom partitioner or scheduler.</span></span> <span data-ttu-id="f5f78-119">如需詳細資訊，請參閱 [PLINQ 和 TPL 的自訂 Partitioner](../../../docs/standard/parallel-programming/custom-partitioners-for-plinq-and-tpl.md) 和[工作排程器](xref:System.Threading.Tasks.TaskScheduler)。</span><span class="sxs-lookup"><span data-stu-id="f5f78-119">For more information, see [Custom Partitioners for PLINQ and TPL](../../../docs/standard/parallel-programming/custom-partitioners-for-plinq-and-tpl.md) and [Task Schedulers](xref:System.Threading.Tasks.TaskScheduler).</span></span>  
  
 <span data-ttu-id="f5f78-120"><xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> 和 <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> 方法都有數個多載，可讓您停止或中斷迴圈執行、監視其他執行緒上的迴圈狀態、維護執行緒區域狀態、完成執行緒區域物件、控制並行程度等等。</span><span class="sxs-lookup"><span data-stu-id="f5f78-120">Both the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> methods have several overloads that let you stop or break loop execution, monitor the state of the loop on other threads, maintain thread-local state, finalize thread-local objects, control the degree of concurrency, and so on.</span></span> <span data-ttu-id="f5f78-121">啟用這個功能的 Helper 類型包括 <xref:System.Threading.Tasks.ParallelLoopState>、<xref:System.Threading.Tasks.ParallelOptions>、<xref:System.Threading.Tasks.ParallelLoopResult>、<xref:System.Threading.CancellationToken> 和 <xref:System.Threading.CancellationTokenSource>。</span><span class="sxs-lookup"><span data-stu-id="f5f78-121">The helper types that enable this functionality include <xref:System.Threading.Tasks.ParallelLoopState>, <xref:System.Threading.Tasks.ParallelOptions>, <xref:System.Threading.Tasks.ParallelLoopResult>, <xref:System.Threading.CancellationToken>, and <xref:System.Threading.CancellationTokenSource>.</span></span>  
  
 <span data-ttu-id="f5f78-122">如需詳細資訊，請參閱[平行程式設計模式：了解及套用使用 .NET Framework 4 的平行模式](https://www.microsoft.com/download/details.aspx?id=19222)。</span><span class="sxs-lookup"><span data-stu-id="f5f78-122">For more information, see [Patterns for Parallel Programming: Understanding and Applying Parallel Patterns with the .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=19222).</span></span>  
  
 <span data-ttu-id="f5f78-123">PLINQ 可支援使用宣告式 (或類似查詢) 語法的資料平行處理原則。</span><span class="sxs-lookup"><span data-stu-id="f5f78-123">Data parallelism with declarative, or query-like, syntax is supported by PLINQ.</span></span> <span data-ttu-id="f5f78-124">如需詳細資訊，請參閱 [Parallel LINQ (PLINQ)](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)。</span><span class="sxs-lookup"><span data-stu-id="f5f78-124">For more information, see [Parallel LINQ (PLINQ)](../../../docs/standard/parallel-programming/parallel-linq-plinq.md).</span></span>  
  
## <a name="related-topics"></a><span data-ttu-id="f5f78-125">相關主題</span><span class="sxs-lookup"><span data-stu-id="f5f78-125">Related Topics</span></span>  
  
|<span data-ttu-id="f5f78-126">Title</span><span class="sxs-lookup"><span data-stu-id="f5f78-126">Title</span></span>|<span data-ttu-id="f5f78-127">描述</span><span class="sxs-lookup"><span data-stu-id="f5f78-127">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="f5f78-128">操作說明：撰寫簡單的 Parallel.For 迴圈</span><span class="sxs-lookup"><span data-stu-id="f5f78-128">How to: Write a Simple Parallel.For Loop</span></span>](../../../docs/standard/parallel-programming/how-to-write-a-simple-parallel-for-loop.md)|<span data-ttu-id="f5f78-129">說明如何透過任何陣列或可建立索引的 <xref:System.Collections.Generic.IEnumerable%601> 來源集合，撰寫 <xref:System.Threading.Tasks.Parallel.For%2A> 迴圈。</span><span class="sxs-lookup"><span data-stu-id="f5f78-129">Describes how to write a <xref:System.Threading.Tasks.Parallel.For%2A> loop over any array or indexable <xref:System.Collections.Generic.IEnumerable%601> source collection.</span></span>|  
|[<span data-ttu-id="f5f78-130">操作說明：撰寫簡單的 Parallel.ForEach 迴圈</span><span class="sxs-lookup"><span data-stu-id="f5f78-130">How to: Write a Simple Parallel.ForEach Loop</span></span>](../../../docs/standard/parallel-programming/how-to-write-a-simple-parallel-foreach-loop.md)|<span data-ttu-id="f5f78-131">說明如何透過任何 <xref:System.Collections.Generic.IEnumerable%601> 來源集合，撰寫 <xref:System.Threading.Tasks.Parallel.ForEach%2A> 迴圈。</span><span class="sxs-lookup"><span data-stu-id="f5f78-131">Describes how to write a <xref:System.Threading.Tasks.Parallel.ForEach%2A> loop over any <xref:System.Collections.Generic.IEnumerable%601> source collection.</span></span>|  
|<span data-ttu-id="f5f78-132">[如何：停止或中斷 Parallel.For 迴圈](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd460721(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="f5f78-132">[How to: Stop or Break from a Parallel.For Loop](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd460721(v=vs.100))</span></span>|<span data-ttu-id="f5f78-133">描述如何停止或中斷平行迴圈，讓所有執行緒都能收到動作的通知。</span><span class="sxs-lookup"><span data-stu-id="f5f78-133">Describes how to stop or break from a parallel loop so that all threads are informed of the action.</span></span>|  
|[<span data-ttu-id="f5f78-134">如何：撰寫含有執行緒區域變數的 Parallel.For 迴圈</span><span class="sxs-lookup"><span data-stu-id="f5f78-134">How to: Write a Parallel.For Loop with Thread-Local Variables</span></span>](../../../docs/standard/parallel-programming/how-to-write-a-parallel-for-loop-with-thread-local-variables.md)|<span data-ttu-id="f5f78-135">說明如何撰寫 <xref:System.Threading.Tasks.Parallel.For%2A> 迴圈 (其中每個執行緒各維護一個任何其他執行緒都看不到的私用變數)，以及當迴圈完成時，如何同步處理所有執行緒的結果。</span><span class="sxs-lookup"><span data-stu-id="f5f78-135">Describes how to write a <xref:System.Threading.Tasks.Parallel.For%2A> loop in which each thread maintains a private variable that is not visible to any other threads, and how to synchronize the results from all threads when the loop completes.</span></span>|  
|[<span data-ttu-id="f5f78-136">如何：使用分區區域變數編寫一個 Parallel.foreach 迴圈</span><span class="sxs-lookup"><span data-stu-id="f5f78-136">How to: Write a Parallel.ForEach Loop with Partition-Local Variables</span></span>](../../../docs/standard/parallel-programming/how-to-write-a-parallel-foreach-loop-with-partition-local-variables.md)|<span data-ttu-id="f5f78-137">說明如何撰寫 <xref:System.Threading.Tasks.Parallel.ForEach%2A> 迴圈 (其中每個執行緒各維護一個任何其他執行緒都看不到的私用變數)，以及當迴圈完成時，如何同步處理所有執行緒的結果。</span><span class="sxs-lookup"><span data-stu-id="f5f78-137">Describes how to write a <xref:System.Threading.Tasks.Parallel.ForEach%2A> loop in which each thread maintains a private variable that is not visible to any other threads, and how to synchronize the results from all threads when the loop completes.</span></span>|  
|[<span data-ttu-id="f5f78-138">如何：取消 Parallel.For 或 ForEach 迴圈</span><span class="sxs-lookup"><span data-stu-id="f5f78-138">How to: Cancel a Parallel.For or ForEach Loop</span></span>](../../../docs/standard/parallel-programming/how-to-cancel-a-parallel-for-or-foreach-loop.md)|<span data-ttu-id="f5f78-139">說明如何使用 <xref:System.Threading.CancellationToken?displayProperty=nameWithType> 來取消平行迴圈</span><span class="sxs-lookup"><span data-stu-id="f5f78-139">Describes how to cancel a parallel loop by using a <xref:System.Threading.CancellationToken?displayProperty=nameWithType></span></span>|  
|[<span data-ttu-id="f5f78-140">如何：加速小型迴圈主體</span><span class="sxs-lookup"><span data-stu-id="f5f78-140">How to: Speed Up Small Loop Bodies</span></span>](../../../docs/standard/parallel-programming/how-to-speed-up-small-loop-bodies.md)|<span data-ttu-id="f5f78-141">說明當迴圈主體非常小時，用來加速執行的一種方法。</span><span class="sxs-lookup"><span data-stu-id="f5f78-141">Describes one way to speed up execution when a loop body is very small.</span></span>|  
|[<span data-ttu-id="f5f78-142">工作平行程式庫 (TPL)</span><span class="sxs-lookup"><span data-stu-id="f5f78-142">Task Parallel Library (TPL)</span></span>](../../../docs/standard/parallel-programming/task-parallel-library-tpl.md)|<span data-ttu-id="f5f78-143">提供工作平行程式庫的概觀。</span><span class="sxs-lookup"><span data-stu-id="f5f78-143">Provides an overview of the Task Parallel Library.</span></span>|  
|[<span data-ttu-id="f5f78-144">並行程式設計</span><span class="sxs-lookup"><span data-stu-id="f5f78-144">Parallel Programming</span></span>](../../../docs/standard/parallel-programming/index.md)|<span data-ttu-id="f5f78-145">介紹如何以 .NET Framework 進行平行程式設計。</span><span class="sxs-lookup"><span data-stu-id="f5f78-145">Introduces Parallel Programming in the .NET Framework.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="f5f78-146">另請參閱</span><span class="sxs-lookup"><span data-stu-id="f5f78-146">See also</span></span>

- [<span data-ttu-id="f5f78-147">並行程式設計</span><span class="sxs-lookup"><span data-stu-id="f5f78-147">Parallel Programming</span></span>](../../../docs/standard/parallel-programming/index.md)
