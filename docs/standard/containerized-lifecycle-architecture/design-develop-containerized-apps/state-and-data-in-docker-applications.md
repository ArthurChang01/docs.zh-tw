---
title: Docker 應用程式中的狀態和資料
description: 了解可用的選項，以將狀態儲存在容器化應用程式。
ms.date: 02/15/2019
ms.openlocfilehash: bc171a419632f2ac61c7c9bf6b201b84e0691c3a
ms.sourcegitcommit: 8699383914c24a0df033393f55db3369db728a7b
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/15/2019
ms.locfileid: "65641255"
---
# <a name="state-and-data-in-docker-applications"></a>Docker 應用程式中的狀態和資料

在大多數情況下，您可以將容器視為處理序執行個體。 處理序不會保留持續性狀態。 雖然容器可以寫入其本機存放區，假設執行個體將會解決無限期地就像是假設記憶體中的單一位置會持久中。 容器映像，例如處理序應該假設多個執行個體，而且它們會最後終究會終止;如果它們由容器協調器管理，則應該假設，它們可能會取得一個節點或 VM 之間移動。

下列解決方案可用來管理 Docker 應用程式中的持續性資料：

從 Docker 主機，透過 [Docker Volumes](https://docs.docker.com/engine/admin/volumes/) (Docker 磁碟區)：

- **磁碟區**會儲存在主機檔案系統中由 Docker 管理的一個區域內。

- **繫結掛接**可以對應至主機檔案系統中任何資料夾中，以便存取無法控制從 Docker 處理序，而且可能會造成安全性風險，容器可能存取機密的作業系統資料夾。

- **tmpfs 裝載**則與虛擬資料夾相似，只存在於主機的記憶體中，永遠不會寫入檔案系統。

從遠端存放：

- [Azure 儲存體](https://azure.microsoft.com/documentation/services/storage/)提供備有異地分散式儲存體，適用於容器提供很好的長期持續性解決方案。

- 遠端關聯式資料庫喜歡[Azure SQL Database](https://azure.microsoft.com/services/sql-database/)，例如 NoSQL 資料庫[Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/introduction)，或快取服務，例如[Redis](https://redis.io/)。

從 Docker 容器：

- Docker 提供一項功能，稱為「重疊檔案系統」。 這項功能會實作寫入時複製工作存放區更新容器的根檔案系統的資訊。 該資訊"配置的最上層顯示 」 容器所依據的原始映像。 如果從系統中刪除容器，這些變更將會遺失。 因此，雖然您可以儲存在其本機儲存體容器的狀態，設計這項功能為基礎的系統容器的設計，其預設值是無狀態的內部部署與會衝突。

- 不過，Docker 磁碟區現在是慣用的方法來處理本機在 Docker 中的資料。 如果您需要在容器中的儲存體的詳細資訊，請檢查[Docker 存放裝置驅動程式](https://docs.docker.com/engine/userguide/storagedriver/)並[映像、 容器和存放裝置驅動程式的相關](https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/)。

以下提供有關這些選項的其他詳細資料。

**磁碟區**是從主機 OS 對應至容器內目錄的目錄。 當容器中的程式碼具有目錄的存取權時，該存取權實際上就是主機 OS 上的目錄存取權。 此目錄不會和容器本身的存留期繫結，且目錄會由 Docker 管理，且和主機電腦的核心功能隔離。 因此，資料磁碟區設計成可無視於容器的存留期來保存資料。 如果您從 Docker 主機中刪除容器或映像，則不會刪除保存在資料磁碟區中的資料。

磁碟區可以具名，也可以是匿名 (預設)。 具名磁碟區是**資料磁碟區容器**的演進，可輕鬆的在容器間共用資料。 磁碟區也支援可讓您將資料儲存在其他選項之間的遠端主機上的磁碟區驅動程式。

**繫結掛接**已提供了很長的時間，並允許在容器中的掛接點資料夾的對應。 繫結裝載的限制比磁碟區更多，且具有某些重要的安全性問題，因此磁碟區是建議的選項。

**`tmpfs` 掛接**是 live 只在主機的記憶體中，永遠不會寫到檔案系統的虛擬資料夾。 它們既快速又安全，但會使用記憶體，且僅適用於非持續性資料。

如圖 4-5 所示，一般 Docker 磁碟區可儲存在容器本身之外，但必須在主機伺服器或 VM 的實體界限內。 不過，Docker 容器無法從一部主機伺服器或 VM 存取另一部主機伺服器或 VM 的磁碟區。 換句話說，使用這些磁碟區，將無法管理在不同 Docker 主機上執行容器間所共用的資料，雖然仍可透過支援遠端主機的磁碟區驅動程式來達到此目的。

![磁碟區可以在容器間共用，但僅限位於相同的主機，除非您使用支援遠端主機的遠端驅動程式。 ](./media/image5.png)

**圖 4-5**： 容器式應用程式的磁碟區和外部資料來源

此外，當 Docker 容器是由協調器所管理時，容器可能會根據叢集所執行的最佳化，在主機之間「移動」。 因此，不建議您使用資料磁碟區來儲存商務資料。 但它們的好方法來使用追蹤檔案、 時態性檔案，或類似，可將不會影響商務資料的一致性。

**遠端資料來源和快取**工具 (例如 Azure SQL Database、Azure Cosmos DB) 或遠端快取 (例如 Redis) 可用於容器化應用程式，就像是在沒有容器時用於開發一樣。 此方法經過實證，可儲存商務應用程式資料。

**Azure 儲存體。** 商務資料通常需要放在外部資源或資料庫，例如 Azure 儲存體。 Azure 儲存體提供雲端中的下列服務：

- Blob 儲存體可儲存非結構化的物件資料。 Blob 可以是任何類型的文字或二進位資料，例如文件或媒體檔案 (影像、音訊和視訊檔案)。 Blob 儲存體也稱為物件儲存體。

- 檔案儲存體提供使用標準 SMB 通訊協定的舊版應用程式的共用存放裝置。 Azure 虛擬機器和雲端服務可透過掛接共用，在應用程式元件之間共用檔案資料。 在內部部署應用程式可以存取檔案共用，以透過檔案服務 REST API 中的資料。

- 表格儲存體可儲存結構化的資料集。 表格儲存體是 NoSQL 索引鍵屬性資料存放區，可快速開發及存取大量資料。

**關聯式資料庫和 NoSQL 資料庫。** 外部資料庫的選擇有許多，從關聯式資料庫 (例如 SQL Server、PostgreSQL、Oracle) 到 NoSQL 資料庫 (例如 Azure Cosmos DB、MongoDB) 等等。這些資料庫不會說明本指南的一部分，因為它們是完全不同的主題。

>[!div class="step-by-step"]
>[上一頁](monolithic-applications.md)
>[下一頁](soa-applications.md)
