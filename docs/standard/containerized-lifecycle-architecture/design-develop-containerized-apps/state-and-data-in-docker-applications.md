---
title: Docker 應用程式中的狀態和資料
description: Microsoft 平台和工具的容器化 Docker 應用程式生命週期
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 09/22/2017
ms.openlocfilehash: 78db191bdec4c25c11728d819d89eaaaff4bd7da
ms.sourcegitcommit: ad99773e5e45068ce03b99518008397e1299e0d1
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/22/2018
ms.locfileid: "46586033"
---
# <a name="state-and-data-in-docker-applications"></a><span data-ttu-id="6ca05-103">Docker 應用程式中的狀態和資料</span><span class="sxs-lookup"><span data-stu-id="6ca05-103">State and data in Docker applications</span></span>

<span data-ttu-id="6ca05-104">基本類型的容器是不變性。</span><span class="sxs-lookup"><span data-stu-id="6ca05-104">A primitive of containers is immutability.</span></span> <span data-ttu-id="6ca05-105">相較於 VM，容器不會經常為會消失。</span><span class="sxs-lookup"><span data-stu-id="6ca05-105">When compared to a VM, containers don't disappear as a common occurrence.</span></span> <span data-ttu-id="6ca05-106">VM 可能會以不同的形式從終止程序、 多載的 CPU 或完整或失敗的磁碟失敗。</span><span class="sxs-lookup"><span data-stu-id="6ca05-106">A VM might fail in various forms from dead processes, overloaded CPU, or a full or failed disk.</span></span> <span data-ttu-id="6ca05-107">但是，我們預期可用的 VM，並 RAID 磁碟機是以確保磁碟機失敗維護資料的老生常談。</span><span class="sxs-lookup"><span data-stu-id="6ca05-107">Yet, we expect the VM to be available and RAID drives are commonplace to assure drive failures maintain data.</span></span>

<span data-ttu-id="6ca05-108">不過，容器會認為的處理序的執行個體。</span><span class="sxs-lookup"><span data-stu-id="6ca05-108">However, containers are thought to be instances of processes.</span></span> <span data-ttu-id="6ca05-109">處理程序不會維護持久狀態。</span><span class="sxs-lookup"><span data-stu-id="6ca05-109">A process doesn't maintain durable state.</span></span> <span data-ttu-id="6ca05-110">即使容器可以寫入其本機存放區，假設該執行個體將會解決無限期會等於假設單一複本的記憶體會持久。</span><span class="sxs-lookup"><span data-stu-id="6ca05-110">Even though a container can write to its local storage, assuming that that instance will be around indefinitely would be equivalent to assuming a single-copy memory will be durable.</span></span> <span data-ttu-id="6ca05-111">您應該假設容器，例如處理序會重複，刪除，或管理由容器協調器，可能會移動。</span><span class="sxs-lookup"><span data-stu-id="6ca05-111">You should assume that containers, like processes, are duplicated, killed, or, when managed with a container orchestrator, they might be moved.</span></span>

<span data-ttu-id="6ca05-112">Docker 使用的功能，稱為*重疊檔案系統*實作寫入時複製程序，會儲存任何容器，相較於原始的映像所依據的根檔案系統以更新的資訊。</span><span class="sxs-lookup"><span data-stu-id="6ca05-112">Docker uses a feature known as an *overlay file system* to implement a copy-on-write process that stores any updated information to the root file system of a container, compared to the original image on which it is based.</span></span> <span data-ttu-id="6ca05-113">如果之後從系統刪除容器時，會遺失這些變更。</span><span class="sxs-lookup"><span data-stu-id="6ca05-113">These changes are lost if the container is subsequently deleted from the system.</span></span> <span data-ttu-id="6ca05-114">容器，因此，不會預設不具有永續性儲存體。</span><span class="sxs-lookup"><span data-stu-id="6ca05-114">A container, therefore, does not have persistent storage by default.</span></span> <span data-ttu-id="6ca05-115">雖然可以儲存容器的狀態，但設計系統，以解決這個問題是與容器架構的原則衝突。</span><span class="sxs-lookup"><span data-stu-id="6ca05-115">Although it's possible to save the state of a container, designing a system around this would be in conflict with the principle of container architecture.</span></span>

<span data-ttu-id="6ca05-116">若要管理 Docker 應用程式中的永續性資料，有常見的解決方案：</span><span class="sxs-lookup"><span data-stu-id="6ca05-116">To manage persistent data in Docker applications, there are common solutions:</span></span>

-   <span data-ttu-id="6ca05-117">[**資料磁碟區**](https://docs.docker.com/engine/tutorials/dockervolumes/) 這些掛接至主機，如剛才所述。</span><span class="sxs-lookup"><span data-stu-id="6ca05-117">[**Data volumes**](https://docs.docker.com/engine/tutorials/dockervolumes/) These mount to the host, as just noted.</span></span>

-   <span data-ttu-id="6ca05-118">[**資料磁碟區容器**](https://docs.docker.com/engine/tutorials/dockervolumes/#/creating-and-mounting-a-data-volume-container) 這些容器，使用可以循環的外部容器提供共用存放裝置。</span><span class="sxs-lookup"><span data-stu-id="6ca05-118">[**Data volume containers**](https://docs.docker.com/engine/tutorials/dockervolumes/#/creating-and-mounting-a-data-volume-container) These provide shared storage across containers, using an external container that can cycle.</span></span>

-   <span data-ttu-id="6ca05-119">[**磁碟區外掛程式**](https://docs.docker.com/engine/tutorials/dockervolumes/#/mount-a-shared-storage-volume-as-a-data-volume) 這些掛接至遠端位置，並提供長期持續性磁碟區。</span><span class="sxs-lookup"><span data-stu-id="6ca05-119">[**Volume Plugins**](https://docs.docker.com/engine/tutorials/dockervolumes/#/mount-a-shared-storage-volume-as-a-data-volume) These mount volumes to remote locations, providing long-term persistence.</span></span>

-   <span data-ttu-id="6ca05-120">**遠端資料來源** 範例包含 SQL 和 NO SQL 資料庫或快取服務，例如 Redis。</span><span class="sxs-lookup"><span data-stu-id="6ca05-120">**Remote data sources** Examples include SQL and NO-SQL databases or cache services like Redis.</span></span>

-   <span data-ttu-id="6ca05-121">[**Azure 儲存體**](https://docs.microsoft.com/azure/storage/) 這做為服務 (PaaS) 的儲存體，提供最佳的容器，長期持續性提供異地散發平台。</span><span class="sxs-lookup"><span data-stu-id="6ca05-121">[**Azure Storage**](https://docs.microsoft.com/azure/storage/) This provides geo distributable platform as a service (PaaS) storage, providing the best of containers as long-term persistence.</span></span>

<span data-ttu-id="6ca05-122">資料磁碟區特別會指定略過的一或多個容器內的目錄[等位的檔案系統](https://docs.docker.com/glossary/?term=Union%20file%20system)。</span><span class="sxs-lookup"><span data-stu-id="6ca05-122">Data volumes are specially designated directories within one or more containers that bypass the [Union File System](https://docs.docker.com/glossary/?term=Union%20file%20system).</span></span> <span data-ttu-id="6ca05-123">資料磁碟區被設計來維護資料，容器的生命週期無關。</span><span class="sxs-lookup"><span data-stu-id="6ca05-123">Data volumes are designed to maintain data, independent of the container's life cycle.</span></span> <span data-ttu-id="6ca05-124">Docker 因此永遠不會自動刪除磁碟區時您移除容器，也無法將它容器所不再參考的 「 記憶體回收收集 「 磁碟區。</span><span class="sxs-lookup"><span data-stu-id="6ca05-124">Docker therefore never automatically deletes volumes when you remove a container, nor will it "garbage collect" volumes that are no longer referenced by a container.</span></span> <span data-ttu-id="6ca05-125">主機作業系統可以瀏覽並編輯任何磁碟區中的資料，這是要盡量不要使用資料磁碟區的只是另一個原因。</span><span class="sxs-lookup"><span data-stu-id="6ca05-125">The host operating system can browse and edit the data in any volume freely, which is just another reason to use data volumes sparingly.</span></span>

<span data-ttu-id="6ca05-126">A[的資料磁碟區容器](https://docs.docker.com/glossary/?term=volume)一般資料磁碟區是一大改進。</span><span class="sxs-lookup"><span data-stu-id="6ca05-126">A [data volume container](https://docs.docker.com/glossary/?term=volume) is an improvement over regular data volumes.</span></span> <span data-ttu-id="6ca05-127">它本質上是休眠容器具有一個或多個資料磁碟區，在其中建立 （如先前所述）。</span><span class="sxs-lookup"><span data-stu-id="6ca05-127">It is essentially a dormant container that has one or more data volumes created within it (as described earlier).</span></span> <span data-ttu-id="6ca05-128">資料磁碟區容器可讓您從中央掛接點存取容器。</span><span class="sxs-lookup"><span data-stu-id="6ca05-128">The data volume container provides access to containers from a central mount point.</span></span> <span data-ttu-id="6ca05-129">這種存取方法的優點是，它會擷取原始的資料，讓資料容器的邏輯的掛接點的位置。</span><span class="sxs-lookup"><span data-stu-id="6ca05-129">The benefit of this method of access is that it abstracts the location of the original data, making the data container a logical mount point.</span></span> <span data-ttu-id="6ca05-130">它也允許存取資料容器的而建立和終結同時專用容器中的永續性資料磁碟區的 [應用程式] 容器。</span><span class="sxs-lookup"><span data-stu-id="6ca05-130">It also allows "application" containers accessing the data container volumes to be created and destroyed while keeping the data persistent in a dedicated container.</span></span>

<span data-ttu-id="6ca05-131">[圖 4-5] 顯示一般 Docker 磁碟區可置於容器本身錯亂但在主應用程式伺服器 VM/實體界限內的儲存體。</span><span class="sxs-lookup"><span data-stu-id="6ca05-131">Figure 4-5 shows that regular Docker volumes can be placed on storage out of the containers themselves but within the host server/VM physical boundaries.</span></span> <span data-ttu-id="6ca05-132">*Docker 磁碟區沒有使用到另一個 從一部主機伺服器/VM 的磁碟區的能力*。</span><span class="sxs-lookup"><span data-stu-id="6ca05-132">*Docker volumes don't have the ability to use a volume from one host server/VM to another*.</span></span>

![](./media/image5.png)

<span data-ttu-id="6ca05-133">圖 4-5： 資料磁碟區和容器應用程式/容器的外部資料來源</span><span class="sxs-lookup"><span data-stu-id="6ca05-133">Figure 4-5: Data volumes and external data sources for containers apps/containers</span></span>

<span data-ttu-id="6ca05-134">因為無法管理在不同的實體主機執行的容器之間共用的資料，建議，除非您不使用磁碟區的商務資料的 Docker 主機已固定的主機/VM，因為當協調器時，在使用 Docker 容器容器應要移動一到另一部主機，根據叢集所執行的最佳化。</span><span class="sxs-lookup"><span data-stu-id="6ca05-134">Due to the inability to manage data shared between containers that run on separate physical hosts, it is recommended that you not use volumes for business data unless the Docker host is a fixed host/VM, because when using Docker containers in an orchestrator, containers are expected to be moved from one to another host, depending on the optimizations to be performed by the cluster.</span></span>

<span data-ttu-id="6ca05-135">因此，一般資料磁碟區會使用追蹤檔案、 時態性檔案或任何類似的概念，或如果您的容器移動遍及多部主機時不會影響商務資料一致性的良好機制。</span><span class="sxs-lookup"><span data-stu-id="6ca05-135">Therefore, regular data volumes are a good mechanism to work with trace files, temporal files, or any similar concept that won't affect the business data consistency if or when your containers are moved across multiple hosts.</span></span>

<span data-ttu-id="6ca05-136">[磁碟區外掛程式](https://docs.docker.com/engine/extend/plugins_volume/)跨叢集中的所有主機提供的資料。</span><span class="sxs-lookup"><span data-stu-id="6ca05-136">[Volume plug-ins](https://docs.docker.com/engine/extend/plugins_volume/) provide data across all hosts in a cluster.</span></span> <span data-ttu-id="6ca05-137">雖然並非所有的磁碟區外掛程式會建立方式都相同，但磁碟區外掛程式通常會提供已外部化永續性可靠的儲存體從不可變的容器。</span><span class="sxs-lookup"><span data-stu-id="6ca05-137">Although not all volume plug-ins are created equally, volume plug-ins typically provide externalized persistent reliable storage from the immutable containers.</span></span>

<span data-ttu-id="6ca05-138">遠端資料來源，例如 SQL Database、 DocumentDB 或遠端的快取，例如 Redis 快取會是不含容器開發相同。</span><span class="sxs-lookup"><span data-stu-id="6ca05-138">Remote data sources and caches like SQL Database, DocumentDB, or a remote cache like Redis would be the same as developing without containers.</span></span> <span data-ttu-id="6ca05-139">這是其中一種慣用，且經過實證，來儲存商務應用程式資料。</span><span class="sxs-lookup"><span data-stu-id="6ca05-139">This is one of the preferred, and proven, ways to store business application data.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="6ca05-140">[上一頁](monolithic-applications.md)
[下一頁](soa-applications.md)</span><span class="sxs-lookup"><span data-stu-id="6ca05-140">[Previous](monolithic-applications.md)
[Next](soa-applications.md)</span></span>
