---
title: For Each...Next 陳述式 (Visual Basic)
ms.date: 07/20/2015
f1_keywords:
- vb.ForEach
- vb.ForEachNext
- vb.Each
- ForEachNext
helpviewer_keywords:
- infinite loops
- Next statement [Visual Basic], For Each...Next
- endless loops
- loop structures [Visual Basic], For Each...Next
- loops, endless
- Each keyword [Visual Basic]
- instructions, repeating
- For Each statement [Visual Basic]
- collections, instruction repetition
- loops, infinite
- For Each...Next statements
- For keyword [Visual Basic], For Each...Next statements
- Exit statement [Visual Basic], For Each...Next statements
- iteration
ms.assetid: ebce3120-95c3-42b1-b70b-fa7da40c75e2
ms.openlocfilehash: 5081f80ad0da738ebb950bcd649af7a593582356
ms.sourcegitcommit: bce0586f0cccaae6d6cbd625d5a7b824d1d3de4b
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/02/2019
ms.locfileid: "58824332"
---
# <a name="for-eachnext-statement-visual-basic"></a><span data-ttu-id="9585c-102">For Each...Next 陳述式 (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="9585c-102">For Each...Next Statement (Visual Basic)</span></span>
<span data-ttu-id="9585c-103">每個項目集合中，會重複一組陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-103">Repeats a group of statements for each element in a collection.</span></span>  
  
## <a name="syntax"></a><span data-ttu-id="9585c-104">語法</span><span class="sxs-lookup"><span data-stu-id="9585c-104">Syntax</span></span>  
  
```  
For Each element [ As datatype ] In group  
    [ statements ]  
    [ Continue For ]  
    [ statements ]  
    [ Exit For ]  
    [ statements ]  
Next [ element ]  
```  
  
## <a name="parts"></a><span data-ttu-id="9585c-105">組件</span><span class="sxs-lookup"><span data-stu-id="9585c-105">Parts</span></span>  
  
|<span data-ttu-id="9585c-106">詞彙</span><span class="sxs-lookup"><span data-stu-id="9585c-106">Term</span></span>|<span data-ttu-id="9585c-107">定義</span><span class="sxs-lookup"><span data-stu-id="9585c-107">Definition</span></span>|  
|---|---|  
|`element`|<span data-ttu-id="9585c-108">需要`For Each`陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-108">Required in the `For Each` statement.</span></span> <span data-ttu-id="9585c-109">選擇性在`Next`陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-109">Optional in the `Next` statement.</span></span> <span data-ttu-id="9585c-110">變數。</span><span class="sxs-lookup"><span data-stu-id="9585c-110">Variable.</span></span> <span data-ttu-id="9585c-111">用來逐一查看集合的元素。</span><span class="sxs-lookup"><span data-stu-id="9585c-111">Used to iterate through the elements of the collection.</span></span>|  
|`datatype`|<span data-ttu-id="9585c-112">需要`element`不已宣告。</span><span class="sxs-lookup"><span data-stu-id="9585c-112">Required if `element` isn't already declared.</span></span> <span data-ttu-id="9585c-113">資料類型的`element`。</span><span class="sxs-lookup"><span data-stu-id="9585c-113">Data type of `element`.</span></span>|  
|`group`|<span data-ttu-id="9585c-114">必要項。</span><span class="sxs-lookup"><span data-stu-id="9585c-114">Required.</span></span> <span data-ttu-id="9585c-115">是集合型別或物件類型的變數。</span><span class="sxs-lookup"><span data-stu-id="9585c-115">A variable with a type that's a collection type or Object.</span></span> <span data-ttu-id="9585c-116">哪些是指集合`statements`會重複執行。</span><span class="sxs-lookup"><span data-stu-id="9585c-116">Refers to the collection over which the `statements` are to be repeated.</span></span>|  
|`statements`|<span data-ttu-id="9585c-117">選擇性。</span><span class="sxs-lookup"><span data-stu-id="9585c-117">Optional.</span></span> <span data-ttu-id="9585c-118">一或多個陳述式之間`For Each`並`Next`中的每個項目上執行`group`。</span><span class="sxs-lookup"><span data-stu-id="9585c-118">One or more statements between `For Each` and `Next` that run on each item in `group`.</span></span>|  
|`Continue For`|<span data-ttu-id="9585c-119">選擇性。</span><span class="sxs-lookup"><span data-stu-id="9585c-119">Optional.</span></span> <span data-ttu-id="9585c-120">將控制權傳輸至開頭`For Each`迴圈。</span><span class="sxs-lookup"><span data-stu-id="9585c-120">Transfers control to the start of the `For Each` loop.</span></span>|  
|`Exit For`|<span data-ttu-id="9585c-121">選擇性。</span><span class="sxs-lookup"><span data-stu-id="9585c-121">Optional.</span></span> <span data-ttu-id="9585c-122">控制權轉移共`For Each`迴圈。</span><span class="sxs-lookup"><span data-stu-id="9585c-122">Transfers control out of the `For Each` loop.</span></span>|  
|`Next`|<span data-ttu-id="9585c-123">必要項。</span><span class="sxs-lookup"><span data-stu-id="9585c-123">Required.</span></span> <span data-ttu-id="9585c-124">結束的定義`For Each`迴圈。</span><span class="sxs-lookup"><span data-stu-id="9585c-124">Terminates the definition of the `For Each` loop.</span></span>|  
  
## <a name="simple-example"></a><span data-ttu-id="9585c-125">簡單的範例</span><span class="sxs-lookup"><span data-stu-id="9585c-125">Simple Example</span></span>  
 <span data-ttu-id="9585c-126">使用`For Each`...`Next`循環播放，當您想要針對集合或陣列的每個項目重複一組陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-126">Use a `For Each`...`Next` loop when you want to repeat a set of statements for each element of a collection or array.</span></span>  
  
> [!TIP]
>  <span data-ttu-id="9585c-127">A [For...下一個陳述式](../../../visual-basic/language-reference/statements/for-next-statement.md)運作良好時，您便可以控制變數相關聯的迴圈的每個反覆項目上，並判斷該變數的初始和最終值。</span><span class="sxs-lookup"><span data-stu-id="9585c-127">A [For...Next Statement](../../../visual-basic/language-reference/statements/for-next-statement.md) works well when you can associate each iteration of a loop with a control variable and determine that variable's initial and final values.</span></span> <span data-ttu-id="9585c-128">不過，當您處理集合時，初始和最終值的概念沒有意義，而且您不一定要知道集合的項目數目。</span><span class="sxs-lookup"><span data-stu-id="9585c-128">However, when you are dealing with a collection, the concept of initial and final values isn't meaningful, and you don't necessarily know how many elements the collection has.</span></span> <span data-ttu-id="9585c-129">在這種情況下， `For Each`...`Next`迴圈通常是較好的選擇。</span><span class="sxs-lookup"><span data-stu-id="9585c-129">In this kind of case, a `For Each`...`Next` loop is often a better choice.</span></span>  
  
 <span data-ttu-id="9585c-130">在下列範例中， `For Each`...`Next`</span><span class="sxs-lookup"><span data-stu-id="9585c-130">In the following example, the `For Each`…`Next`</span></span> <span data-ttu-id="9585c-131">陳述式逐一查看清單集合中的所有項目。</span><span class="sxs-lookup"><span data-stu-id="9585c-131">statement iterates through all the elements of a List collection.</span></span>  
  
 [!code-vb[VbVbalrStatements#121](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/class9.vb#121)]  
  
 <span data-ttu-id="9585c-132">如需其他範例，請參閱 <<c0> [ 集合](../../../standard/collections/index.md)並[陣列](../../../visual-basic/programming-guide/language-features/arrays/index.md)。</span><span class="sxs-lookup"><span data-stu-id="9585c-132">For more examples, see [Collections](../../../standard/collections/index.md) and [Arrays](../../../visual-basic/programming-guide/language-features/arrays/index.md).</span></span>  
  
## <a name="nested-loops"></a><span data-ttu-id="9585c-133">巢狀的迴圈</span><span class="sxs-lookup"><span data-stu-id="9585c-133">Nested Loops</span></span>  
 <span data-ttu-id="9585c-134">您可以巢狀`For Each`放在另一個迴圈的迴圈。</span><span class="sxs-lookup"><span data-stu-id="9585c-134">You can nest `For Each` loops by putting one loop within another.</span></span>  
  
 <span data-ttu-id="9585c-135">下列範例會示範巢狀`For Each`...`Next`</span><span class="sxs-lookup"><span data-stu-id="9585c-135">The following example demonstrates nested `For Each`…`Next`</span></span> <span data-ttu-id="9585c-136">結構。</span><span class="sxs-lookup"><span data-stu-id="9585c-136">structures.</span></span>  
  
 [!code-vb[VbVbalrStatements#122](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/class9.vb#122)]  
  
 <span data-ttu-id="9585c-137">當您使用巢狀迴圈時，每個迴圈必須具有唯一`element`變數。</span><span class="sxs-lookup"><span data-stu-id="9585c-137">When you nest loops, each loop must have a unique `element` variable.</span></span>  
  
 <span data-ttu-id="9585c-138">您也可以巢狀不同種類的控制結構彼此。</span><span class="sxs-lookup"><span data-stu-id="9585c-138">You can also nest different kinds of control structures within each other.</span></span> <span data-ttu-id="9585c-139">如需詳細資訊，請參閱 <<c0> [ 巢狀控制結構](../../../visual-basic/programming-guide/language-features/control-flow/nested-control-structures.md)。</span><span class="sxs-lookup"><span data-stu-id="9585c-139">For more information, see [Nested Control Structures](../../../visual-basic/programming-guide/language-features/control-flow/nested-control-structures.md).</span></span>  
  
## <a name="exit-for-and-continue-for"></a><span data-ttu-id="9585c-140">針對結束後繼續</span><span class="sxs-lookup"><span data-stu-id="9585c-140">Exit For and Continue For</span></span>  
 <span data-ttu-id="9585c-141">[Exit For](../../../visual-basic/language-reference/statements/exit-statement.md)陳述式會結束執行`For`...`Next`</span><span class="sxs-lookup"><span data-stu-id="9585c-141">The [Exit For](../../../visual-basic/language-reference/statements/exit-statement.md) statement causes execution to exit the `For`…`Next`</span></span> <span data-ttu-id="9585c-142">後面的陳述式的迴圈和傳輸控制項`Next`陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-142">loop and transfers control to the statement that follows the `Next` statement.</span></span>  
  
 <span data-ttu-id="9585c-143">`Continue For`陳述式控制將立即轉移到迴圈的下一個反覆項目。</span><span class="sxs-lookup"><span data-stu-id="9585c-143">The `Continue For` statement transfers control immediately to the next iteration of the loop.</span></span> <span data-ttu-id="9585c-144">如需詳細資訊，請參閱 < [Continue 陳述式](../../../visual-basic/language-reference/statements/continue-statement.md)。</span><span class="sxs-lookup"><span data-stu-id="9585c-144">For more information, see [Continue Statement](../../../visual-basic/language-reference/statements/continue-statement.md).</span></span>  
  
 <span data-ttu-id="9585c-145">下列範例示範如何使用`Continue For`和`Exit For`陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-145">The following example shows how to use the `Continue For` and `Exit For` statements.</span></span>  
  
 [!code-vb[VbVbalrStatements#123](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/class9.vb#123)]  
  
 <span data-ttu-id="9585c-146">您可以將任意數目的放`Exit For`中的陳述式`For Each`迴圈。</span><span class="sxs-lookup"><span data-stu-id="9585c-146">You can put any number of `Exit For` statements in a `For Each` loop.</span></span> <span data-ttu-id="9585c-147">使用時內巢狀`For Each`迴圈，`Exit For`導致執行動作的巢狀下一個較高的等級結束最內層的迴圈和傳輸控制項。</span><span class="sxs-lookup"><span data-stu-id="9585c-147">When used within nested `For Each` loops, `Exit For` causes execution to exit the innermost loop and transfers control to the next higher level of nesting.</span></span>  
  
 <span data-ttu-id="9585c-148">`Exit For` 在某些狀況中，評估後通常用在`If`...`Then`...`Else`結構。</span><span class="sxs-lookup"><span data-stu-id="9585c-148">`Exit For` is often used after an evaluation of some condition, for example, in an `If`...`Then`...`Else` structure.</span></span> <span data-ttu-id="9585c-149">您可能想要使用`Exit For`下列條件：</span><span class="sxs-lookup"><span data-stu-id="9585c-149">You might want to use `Exit For` for the following conditions:</span></span>  
  
-   <span data-ttu-id="9585c-150">繼續向逐一查看是不必要或不可能。</span><span class="sxs-lookup"><span data-stu-id="9585c-150">Continuing to iterate is unnecessary or impossible.</span></span> <span data-ttu-id="9585c-151">這可能被造成錯誤的數值或終止要求。</span><span class="sxs-lookup"><span data-stu-id="9585c-151">This might be caused by an erroneous value or a termination request.</span></span>  
  
-   <span data-ttu-id="9585c-152">在攔截到例外狀況`Try`...`Catch`...`Finally`.您可以使用`Exit For`結尾的`Finally`區塊。</span><span class="sxs-lookup"><span data-stu-id="9585c-152">An exception is caught in a `Try`...`Catch`...`Finally`. You might use `Exit For` at the end of the `Finally` block.</span></span>  
  
-   <span data-ttu-id="9585c-153">該處永無止盡的迴圈，也就是無法執行大型或甚至是無限次數的迴圈。</span><span class="sxs-lookup"><span data-stu-id="9585c-153">There an endless loop, which is a loop that could run a large or even infinite number of times.</span></span> <span data-ttu-id="9585c-154">如果您偵測到這種情況，您可以使用`Exit For`來逸出迴圈。</span><span class="sxs-lookup"><span data-stu-id="9585c-154">If you detect such a condition, you can use `Exit For` to escape the loop.</span></span> <span data-ttu-id="9585c-155">如需詳細資訊，請參閱[執行...迴圈陳述式](../../../visual-basic/language-reference/statements/do-loop-statement.md)。</span><span class="sxs-lookup"><span data-stu-id="9585c-155">For more information, see [Do...Loop Statement](../../../visual-basic/language-reference/statements/do-loop-statement.md).</span></span>  
  
## <a name="iterators"></a><span data-ttu-id="9585c-156">迭代器</span><span class="sxs-lookup"><span data-stu-id="9585c-156">Iterators</span></span>  
 <span data-ttu-id="9585c-157">您使用*迭代器*若要在集合上執行自訂反覆項目。</span><span class="sxs-lookup"><span data-stu-id="9585c-157">You use an *iterator* to perform a custom iteration over a collection.</span></span> <span data-ttu-id="9585c-158">迭代器可以是函式或`Get`存取子。</span><span class="sxs-lookup"><span data-stu-id="9585c-158">An iterator can be a function or a `Get` accessor.</span></span> <span data-ttu-id="9585c-159">它會使用`Yield`陳述式來傳回一次一個集合的每個項目。</span><span class="sxs-lookup"><span data-stu-id="9585c-159">It uses a `Yield` statement to return each element of the collection one at a time.</span></span>  
  
 <span data-ttu-id="9585c-160">您可以使用呼叫迭代器`For Each...Next`陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-160">You call an iterator by using a `For Each...Next` statement.</span></span> <span data-ttu-id="9585c-161">`For Each` 迴圈的每個反覆項目都會呼叫迭代器。</span><span class="sxs-lookup"><span data-stu-id="9585c-161">Each iteration of the `For Each` loop calls the iterator.</span></span> <span data-ttu-id="9585c-162">當`Yield`到達陳述式時的迭代器，在運算式中`Yield`陳述式會傳回，而且會保留在程式碼中的目前位置。</span><span class="sxs-lookup"><span data-stu-id="9585c-162">When a `Yield` statement is reached in the iterator, the expression in the `Yield` statement is returned, and the current location in code is retained.</span></span> <span data-ttu-id="9585c-163">下一次呼叫迭代器時，便會從這個位置重新開始執行。</span><span class="sxs-lookup"><span data-stu-id="9585c-163">Execution is restarted from that location the next time that the iterator is called.</span></span>  
  
 <span data-ttu-id="9585c-164">下列範例會使用迭代器函式。</span><span class="sxs-lookup"><span data-stu-id="9585c-164">The following example uses an iterator function.</span></span> <span data-ttu-id="9585c-165">迭代器函式具有`Yield`內的陳述式[For...下一步](../../../visual-basic/language-reference/statements/for-next-statement.md)迴圈。</span><span class="sxs-lookup"><span data-stu-id="9585c-165">The iterator function has a `Yield` statement that's inside a [For…Next](../../../visual-basic/language-reference/statements/for-next-statement.md) loop.</span></span> <span data-ttu-id="9585c-166">在 `ListEvenNumbers`方法中，每次反覆運算`For Each`陳述式主體會建立迭代器，才能繼續進行下一個呼叫`Yield`陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-166">In the `ListEvenNumbers` method, each iteration of the `For Each` statement body creates a call to the iterator function, which proceeds to the next `Yield` statement.</span></span>  
  
 [!code-vb[VbVbalrStatements#127](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/class9.vb#127)]  
  
 <span data-ttu-id="9585c-167">如需詳細資訊，請參閱 <<c0> [ 迭代器](../../programming-guide/concepts/iterators.md)， [Yield 陳述式](../../../visual-basic/language-reference/statements/yield-statement.md)，並[迭代器](../../../visual-basic/language-reference/modifiers/iterator.md)。</span><span class="sxs-lookup"><span data-stu-id="9585c-167">For more information, see [Iterators](../../programming-guide/concepts/iterators.md), [Yield Statement](../../../visual-basic/language-reference/statements/yield-statement.md), and [Iterator](../../../visual-basic/language-reference/modifiers/iterator.md).</span></span>  
  
## <a name="technical-implementation"></a><span data-ttu-id="9585c-168">技術實作</span><span class="sxs-lookup"><span data-stu-id="9585c-168">Technical Implementation</span></span>  
 <span data-ttu-id="9585c-169">當`For Each`...`Next`</span><span class="sxs-lookup"><span data-stu-id="9585c-169">When a `For Each`…`Next`</span></span> <span data-ttu-id="9585c-170">陳述式執行時，Visual Basic 會評估集合只有一個之前在迴圈開始的時間。</span><span class="sxs-lookup"><span data-stu-id="9585c-170">statement runs, Visual Basic evaluates the collection only one time, before the loop starts.</span></span> <span data-ttu-id="9585c-171">如果陳述式區塊變更`element`或`group`，這些變更不會影響在迴圈的反覆項目。</span><span class="sxs-lookup"><span data-stu-id="9585c-171">If your statement block changes `element` or `group`, these changes don't affect the iteration of the loop.</span></span>  
  
 <span data-ttu-id="9585c-172">當集合中的所有項目連續指派給`element`，則`For Each`迴圈停駐點，並控制傳遞到之後的陳述式`Next`陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-172">When all the elements in the collection have been successively assigned to `element`, the `For Each` loop stops and control passes to the statement following the `Next` statement.</span></span>  
  
 <span data-ttu-id="9585c-173">如果`element`尚未已外宣告此迴圈中，您必須將其宣告中`For Each`陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-173">If `element` hasn't been declared outside this loop, you must declare it in the `For Each` statement.</span></span> <span data-ttu-id="9585c-174">您可以宣告的型別`element`明確地使用`As`陳述式，或者您可以依賴指派類型的型別推斷。</span><span class="sxs-lookup"><span data-stu-id="9585c-174">You can declare the type of `element` explicitly by using an `As` statement, or you can rely on type inference to assign the type.</span></span> <span data-ttu-id="9585c-175">在任一情況下，範圍`element`是迴圈的主體。</span><span class="sxs-lookup"><span data-stu-id="9585c-175">In either case, the scope of `element` is the body of the loop.</span></span> <span data-ttu-id="9585c-176">不過，您不能宣告`element`同時內部和外部迴圈。</span><span class="sxs-lookup"><span data-stu-id="9585c-176">However, you cannot declare `element` both outside and inside the loop.</span></span>  
  
 <span data-ttu-id="9585c-177">您可以選擇性地指定`element`在`Next`陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-177">You can optionally specify `element` in the `Next` statement.</span></span> <span data-ttu-id="9585c-178">這有助於改善您的程式的可讀性，尤其是如果您有巢狀`For Each`迴圈。</span><span class="sxs-lookup"><span data-stu-id="9585c-178">This improves the readability of your program, especially if you have nested `For Each` loops.</span></span> <span data-ttu-id="9585c-179">您必須指定相同的變數會出現在對應的`For Each`陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-179">You must specify the same variable as the one that appears in the corresponding `For Each` statement.</span></span>  
  
 <span data-ttu-id="9585c-180">您可能想要避免變更的值`element`迴圈內。</span><span class="sxs-lookup"><span data-stu-id="9585c-180">You might want to avoid changing the value of `element` inside a loop.</span></span> <span data-ttu-id="9585c-181">如此一來，可以讓更難閱讀及偵錯您的程式碼。</span><span class="sxs-lookup"><span data-stu-id="9585c-181">Doing this can make it more difficult to read and debug your code.</span></span> <span data-ttu-id="9585c-182">值變更`group`不會影響集合或其項目迴圈的第一次輸入時所決定。</span><span class="sxs-lookup"><span data-stu-id="9585c-182">Changing the value of `group` doesn't affect the collection or its elements, which were determined when the loop was first entered.</span></span>  
  
 <span data-ttu-id="9585c-183">當您要建立巢狀迴圈，如果`Next`外部的巢狀層級的陳述式之前就遇到`Next`內部層級，編譯器會發出錯誤信號。</span><span class="sxs-lookup"><span data-stu-id="9585c-183">When you're nesting loops, if a `Next` statement of an outer nesting level is encountered before the `Next` of an inner level, the compiler signals an error.</span></span> <span data-ttu-id="9585c-184">不過，編譯器可以偵測此重疊錯誤，只有當您指定`element`在每個`Next`陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-184">However, the compiler can detect this overlapping error only if you specify `element` in every `Next` statement.</span></span>  
  
 <span data-ttu-id="9585c-185">如果您的程式碼相依於周遊集合中特定的順序， `For Each`...`Next`迴圈不是最好的選擇，除非您知道的特性，列舉值物件的集合會公開。</span><span class="sxs-lookup"><span data-stu-id="9585c-185">If your code depends on traversing a collection in a particular order, a `For Each`...`Next` loop isn't the best choice, unless you know the characteristics of the enumerator object the collection exposes.</span></span> <span data-ttu-id="9585c-186">周遊順序不取決於 Visual Basic 中，但取決<xref:System.Collections.IEnumerator.MoveNext%2A>列舉值物件的方法。</span><span class="sxs-lookup"><span data-stu-id="9585c-186">The order of traversal isn't determined by Visual Basic, but by the <xref:System.Collections.IEnumerator.MoveNext%2A> method of the enumerator object.</span></span> <span data-ttu-id="9585c-187">因此，您可能會無法預測哪些項目集合中傳回的第一個`element`，或這是要傳回在指定的項目之後的下一步。</span><span class="sxs-lookup"><span data-stu-id="9585c-187">Therefore, you might not be able to predict which element of the collection is the first to be returned in `element`, or which is the next to be returned after a given element.</span></span> <span data-ttu-id="9585c-188">您可能會達到更可靠的結果，使用不同的迴圈結構，例如`For`...`Next`或`Do`...`Loop`.</span><span class="sxs-lookup"><span data-stu-id="9585c-188">You might achieve more reliable results using a different loop structure, such as `For`...`Next` or `Do`...`Loop`.</span></span>  
  
 <span data-ttu-id="9585c-189">資料類型`element`使的資料類型的項目必須是`group`可以轉換成它。</span><span class="sxs-lookup"><span data-stu-id="9585c-189">The data type of `element` must be such that the data type of the elements of `group` can be converted to it.</span></span>  
  
 <span data-ttu-id="9585c-190">資料類型`group`必須是指的是集合或陣列，是可列舉的參考型別。</span><span class="sxs-lookup"><span data-stu-id="9585c-190">The data type of `group` must be a reference type that refers to a collection or an array that's enumerable.</span></span> <span data-ttu-id="9585c-191">通常這表示`group`實作的物件是指<xref:System.Collections.IEnumerable>介面`System.Collections`命名空間或<xref:System.Collections.Generic.IEnumerable%601>介面`System.Collections.Generic`命名空間。</span><span class="sxs-lookup"><span data-stu-id="9585c-191">Most commonly this means that `group` refers to an object that implements the <xref:System.Collections.IEnumerable> interface of the `System.Collections` namespace or the <xref:System.Collections.Generic.IEnumerable%601> interface of the `System.Collections.Generic` namespace.</span></span> <span data-ttu-id="9585c-192">`System.Collections.IEnumerable` 定義<xref:System.Collections.IEnumerable.GetEnumerator%2A>方法，以傳回集合的列舉值物件。</span><span class="sxs-lookup"><span data-stu-id="9585c-192">`System.Collections.IEnumerable` defines the <xref:System.Collections.IEnumerable.GetEnumerator%2A> method, which returns an enumerator object for the collection.</span></span> <span data-ttu-id="9585c-193">列舉值物件會實作`System.Collections.IEnumerator`介面`System.Collections`命名空間，並公開<xref:System.Collections.IEnumerator.Current%2A>屬性並<xref:System.Collections.IEnumerator.Reset%2A>和<xref:System.Collections.IEnumerator.MoveNext%2A>方法。</span><span class="sxs-lookup"><span data-stu-id="9585c-193">The enumerator object implements the `System.Collections.IEnumerator` interface of the `System.Collections` namespace and exposes the <xref:System.Collections.IEnumerator.Current%2A> property and the <xref:System.Collections.IEnumerator.Reset%2A> and <xref:System.Collections.IEnumerator.MoveNext%2A> methods.</span></span> <span data-ttu-id="9585c-194">Visual Basic 會使用這些來周遊集合。</span><span class="sxs-lookup"><span data-stu-id="9585c-194">Visual Basic uses these to traverse the collection.</span></span>  
  
### <a name="narrowing-conversions"></a><span data-ttu-id="9585c-195">縮小轉換</span><span class="sxs-lookup"><span data-stu-id="9585c-195">Narrowing Conversions</span></span>  
 <span data-ttu-id="9585c-196">當`Option Strict`設為`On`，縮小轉換通常會導致編譯器錯誤。</span><span class="sxs-lookup"><span data-stu-id="9585c-196">When `Option Strict` is set to `On`, narrowing conversions ordinarily cause compiler errors.</span></span> <span data-ttu-id="9585c-197">在`For Each`陳述式，不過中的項目從不`group`到`element`評估和執行在執行階段，而造成的縮小轉換的編譯器錯誤受到抑制。</span><span class="sxs-lookup"><span data-stu-id="9585c-197">In a `For Each` statement, however, conversions from the elements in `group` to `element` are evaluated and performed at run time, and compiler errors caused by narrowing conversions are suppressed.</span></span>  
  
 <span data-ttu-id="9585c-198">在下列範例中，指派`m`做為初始的值`n`不會進行編譯時`Option Strict`是上，因為轉換`Long`到`Integer`是縮小轉換。</span><span class="sxs-lookup"><span data-stu-id="9585c-198">In the following example, the assignment of `m` as the initial value for `n` doesn't compile when `Option Strict` is on because the conversion of a `Long` to an `Integer` is a narrowing conversion.</span></span> <span data-ttu-id="9585c-199">在`For Each`陳述式，不過，沒有編譯器錯誤會報告，即使指派給`number`需要從相同的轉換`Long`至`Integer`。</span><span class="sxs-lookup"><span data-stu-id="9585c-199">In the `For Each` statement, however, no compiler error is reported, even though the assignment to `number` requires the same conversion from `Long` to `Integer`.</span></span> <span data-ttu-id="9585c-200">在 `For Each`包含大量的陳述式，執行階段錯誤發生時<xref:Microsoft.VisualBasic.CompilerServices.Conversions.ToInteger%2A>套用大的數字。</span><span class="sxs-lookup"><span data-stu-id="9585c-200">In the `For Each` statement that contains a large number, a run-time error occurs when <xref:Microsoft.VisualBasic.CompilerServices.Conversions.ToInteger%2A> is applied to the large number.</span></span>  
  
 [!code-vb[VbVbalrStatements#89](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/Class3.vb#89)]  
  
### <a name="ienumerator-calls"></a><span data-ttu-id="9585c-201">IEnumerator 呼叫</span><span class="sxs-lookup"><span data-stu-id="9585c-201">IEnumerator Calls</span></span>  
 <span data-ttu-id="9585c-202">當執行`For Each`...`Next`迴圈開始，Visual Basic 會確認`group`指的是有效的集合物件。</span><span class="sxs-lookup"><span data-stu-id="9585c-202">When execution of a `For Each`...`Next` loop starts, Visual Basic verifies that `group` refers to a valid collection object.</span></span> <span data-ttu-id="9585c-203">如果沒有，就會擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="9585c-203">If not, it throws an exception.</span></span> <span data-ttu-id="9585c-204">否則，它會呼叫<xref:System.Collections.IEnumerator.MoveNext%2A>方法和<xref:System.Collections.IEnumerator.Current%2A>要傳回的第一個元素的列舉值物件的屬性。</span><span class="sxs-lookup"><span data-stu-id="9585c-204">Otherwise, it calls the <xref:System.Collections.IEnumerator.MoveNext%2A> method and the <xref:System.Collections.IEnumerator.Current%2A> property of the enumerator object to return the first element.</span></span> <span data-ttu-id="9585c-205">如果`MoveNext`指出，沒有下一個項目，也就是這個集合是空的如果`For Each`迴圈停駐點，並控制傳遞到之後的陳述式`Next`陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-205">If `MoveNext` indicates that there is no next element, that is, if the collection is empty, the `For Each` loop stops and control passes to the statement following the `Next` statement.</span></span> <span data-ttu-id="9585c-206">否則，Visual Basic 會將設定`element`第一個項目並執行陳述式區塊。</span><span class="sxs-lookup"><span data-stu-id="9585c-206">Otherwise, Visual Basic sets `element` to the first element and runs the statement block.</span></span>  
  
 <span data-ttu-id="9585c-207">每次 Visual Basic 遇到`Next`陳述式，它會返回`For Each`陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-207">Each time Visual Basic encounters the `Next` statement, it returns to the `For Each` statement.</span></span> <span data-ttu-id="9585c-208">它會呼叫一次`MoveNext`和`Current`傳回下一個項目，再執行此區塊或根據結果迴圈就會停止。</span><span class="sxs-lookup"><span data-stu-id="9585c-208">Again it calls `MoveNext` and `Current` to return the next element, and again it either runs the block or stops the loop depending on the result.</span></span> <span data-ttu-id="9585c-209">此程序一直`MoveNext`表示沒有下一個項目或`Exit For`遇到陳述式。</span><span class="sxs-lookup"><span data-stu-id="9585c-209">This process continues until `MoveNext` indicates that there is no next element or an `Exit For` statement is encountered.</span></span>  
  
 <span data-ttu-id="9585c-210">**修改集合。**</span><span class="sxs-lookup"><span data-stu-id="9585c-210">**Modifying the Collection.**</span></span> <span data-ttu-id="9585c-211">所傳回的列舉值物件<xref:System.Collections.IEnumerable.GetEnumerator%2A>通常不會讓您新增、 刪除、 取代或重新排列任何項目來變更集合。</span><span class="sxs-lookup"><span data-stu-id="9585c-211">The enumerator object returned by <xref:System.Collections.IEnumerable.GetEnumerator%2A> normally doesn't let you change the collection by adding, deleting, replacing, or reordering any elements.</span></span> <span data-ttu-id="9585c-212">如果您已起始之後，變更集合`For Each`...`Next`迴圈 」 列舉值物件就會變成無效，和下一步 嘗試存取的項目，會造成<xref:System.InvalidOperationException>例外狀況。</span><span class="sxs-lookup"><span data-stu-id="9585c-212">If you change the collection after you have initiated a `For Each`...`Next` loop, the enumerator object becomes invalid, and the next attempt to access an element causes an <xref:System.InvalidOperationException> exception.</span></span>  
  
 <span data-ttu-id="9585c-213">不過，修改這個封鎖不取決於 Visual basic，而是只要實作<xref:System.Collections.IEnumerable>介面。</span><span class="sxs-lookup"><span data-stu-id="9585c-213">However, this blocking of modification isn't determined by Visual Basic, but rather by the implementation of the <xref:System.Collections.IEnumerable> interface.</span></span> <span data-ttu-id="9585c-214">它是可以實作`IEnumerable`反覆項目期間，修改允許的方式。</span><span class="sxs-lookup"><span data-stu-id="9585c-214">It is possible to implement `IEnumerable` in a way that allows for modification during iteration.</span></span> <span data-ttu-id="9585c-215">如果您正在考慮進行這類動態修改，請確定您了解特性`IEnumerable`對您使用的集合物件的實作。</span><span class="sxs-lookup"><span data-stu-id="9585c-215">If you are considering doing such dynamic modification, make sure that you understand the characteristics of the `IEnumerable` implementation on the collection you are using.</span></span>  
  
 <span data-ttu-id="9585c-216">**修改集合的項目。**</span><span class="sxs-lookup"><span data-stu-id="9585c-216">**Modifying Collection Elements.**</span></span> <span data-ttu-id="9585c-217"><xref:System.Collections.IEnumerator.Current%2A>列舉值物件的屬性是[ReadOnly](../../../visual-basic/language-reference/modifiers/readonly.md)，並傳回每個集合項目的本機副本。</span><span class="sxs-lookup"><span data-stu-id="9585c-217">The <xref:System.Collections.IEnumerator.Current%2A> property of the enumerator object is [ReadOnly](../../../visual-basic/language-reference/modifiers/readonly.md), and it returns a local copy of each collection element.</span></span> <span data-ttu-id="9585c-218">這表示您無法修改項目本身中`For Each`...`Next`迴圈。</span><span class="sxs-lookup"><span data-stu-id="9585c-218">This means that you cannot modify the elements themselves in a `For Each`...`Next` loop.</span></span> <span data-ttu-id="9585c-219">您進行任何修改會影響本機複本從`Current`而不反映回基礎的集合。</span><span class="sxs-lookup"><span data-stu-id="9585c-219">Any modification you make affects only the local copy from `Current` and isn't reflected back into the underlying collection.</span></span> <span data-ttu-id="9585c-220">不過，如果項目是參考型別，您可以修改它所指向的執行個體的成員。</span><span class="sxs-lookup"><span data-stu-id="9585c-220">However, if an element is a reference type, you can modify the members of the instance to which it points.</span></span> <span data-ttu-id="9585c-221">下列範例會修改`BackColor`的每個成員`thisControl`項目。</span><span class="sxs-lookup"><span data-stu-id="9585c-221">The following example modifies the `BackColor` member of each `thisControl` element.</span></span> <span data-ttu-id="9585c-222">不過，您不能修改`thisControl`本身。</span><span class="sxs-lookup"><span data-stu-id="9585c-222">You cannot, however, modify `thisControl` itself.</span></span>  
  
```vb  
Sub lightBlueBackground(ByVal thisForm As System.Windows.Forms.Form)  
    For Each thisControl As System.Windows.Forms.Control In thisForm.Controls  
        thisControl.BackColor = System.Drawing.Color.LightBlue  
    Next thisControl  
End Sub  
```  
  
 <span data-ttu-id="9585c-223">前一個範例可以修改`BackColor`的每個成員`thisControl`項目，雖然它不能修改`thisControl`本身。</span><span class="sxs-lookup"><span data-stu-id="9585c-223">The previous example can modify the `BackColor` member of each `thisControl` element, although it cannot modify `thisControl` itself.</span></span>  
  
 <span data-ttu-id="9585c-224">**周遊的陣列。**</span><span class="sxs-lookup"><span data-stu-id="9585c-224">**Traversing Arrays.**</span></span> <span data-ttu-id="9585c-225">因為<xref:System.Array>類別會實作<xref:System.Collections.IEnumerable>介面，所有陣列都公開<xref:System.Array.GetEnumerator%2A>方法。</span><span class="sxs-lookup"><span data-stu-id="9585c-225">Because the <xref:System.Array> class implements the <xref:System.Collections.IEnumerable> interface, all arrays expose the <xref:System.Array.GetEnumerator%2A> method.</span></span> <span data-ttu-id="9585c-226">這表示，您可以逐一查看陣列`For Each`...`Next`迴圈。</span><span class="sxs-lookup"><span data-stu-id="9585c-226">This means that you can iterate through an array with a `For Each`...`Next` loop.</span></span> <span data-ttu-id="9585c-227">不過，您可以只讀取陣列項目。</span><span class="sxs-lookup"><span data-stu-id="9585c-227">However, you can only read the array elements.</span></span> <span data-ttu-id="9585c-228">您無法變更它們。</span><span class="sxs-lookup"><span data-stu-id="9585c-228">You cannot change them.</span></span>  
  
## <a name="example"></a><span data-ttu-id="9585c-229">範例</span><span class="sxs-lookup"><span data-stu-id="9585c-229">Example</span></span>  
 <span data-ttu-id="9585c-230">下列範例會列出在 C:\ 目錄中的所有資料夾使用<xref:System.IO.DirectoryInfo>類別。</span><span class="sxs-lookup"><span data-stu-id="9585c-230">The following example lists all the folders in the C:\ directory by using the <xref:System.IO.DirectoryInfo> class.</span></span>  
  
 [!code-vb[VbVbalrStatements#124](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/class9.vb#124)]  
  
## <a name="example"></a><span data-ttu-id="9585c-231">範例</span><span class="sxs-lookup"><span data-stu-id="9585c-231">Example</span></span>  
 <span data-ttu-id="9585c-232">下列範例說明排序集合的程序。</span><span class="sxs-lookup"><span data-stu-id="9585c-232">The following example illustrates a procedure for sorting a collection.</span></span> <span data-ttu-id="9585c-233">此範例排序的執行個體`Car`類別，會儲存在<xref:System.Collections.Generic.List%601>。</span><span class="sxs-lookup"><span data-stu-id="9585c-233">The example sorts instances of a `Car` class that are stored in a <xref:System.Collections.Generic.List%601>.</span></span> <span data-ttu-id="9585c-234">`Car` 類別實作 <xref:System.IComparable%601> 介面，而這個介面要求實作 <xref:System.IComparable%601.CompareTo%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="9585c-234">The `Car` class implements the <xref:System.IComparable%601> interface, which requires that the <xref:System.IComparable%601.CompareTo%2A> method be implemented.</span></span>  
  
 <span data-ttu-id="9585c-235">每次呼叫<xref:System.IComparable%601.CompareTo%2A>方法可用於排序的單一比較。</span><span class="sxs-lookup"><span data-stu-id="9585c-235">Each call to the <xref:System.IComparable%601.CompareTo%2A> method makes a single comparison that's used for sorting.</span></span> <span data-ttu-id="9585c-236">當目前物件和另一個物件比較時，在 `CompareTo` 方法中的使用者撰寫程式碼會傳回值。</span><span class="sxs-lookup"><span data-stu-id="9585c-236">User-written code in the `CompareTo` method returns a value for each comparison of the current object with another object.</span></span> <span data-ttu-id="9585c-237">如果目前物件比另一個物件小則傳回的值小於零，如果目前物件比另一個物件大則傳回的值大於零，如果它們相等則傳回零。</span><span class="sxs-lookup"><span data-stu-id="9585c-237">The value returned is less than zero if the current object is less than the other object, greater than zero if the current object is greater than the other object, and zero if they are equal.</span></span> <span data-ttu-id="9585c-238">這可讓您以程式碼定義大於、小於、等於的準則。</span><span class="sxs-lookup"><span data-stu-id="9585c-238">This enables you to define in code the criteria for greater than, less than, and equal.</span></span>  
  
 <span data-ttu-id="9585c-239">在 `ListCars` 方法中，`cars.Sort()` 陳述式會排序清單。</span><span class="sxs-lookup"><span data-stu-id="9585c-239">In the `ListCars` method, the `cars.Sort()` statement sorts the list.</span></span> <span data-ttu-id="9585c-240">對 <xref:System.Collections.Generic.List%601> 之 <xref:System.Collections.Generic.List%601.Sort%2A> 方法的這個呼叫，會導致 `CompareTo` 方法對 `List` 的 `Car` 物件自動呼叫。</span><span class="sxs-lookup"><span data-stu-id="9585c-240">This call to the <xref:System.Collections.Generic.List%601.Sort%2A> method of the <xref:System.Collections.Generic.List%601> causes the `CompareTo` method to be called automatically for the `Car` objects in the `List`.</span></span>  
  
 [!code-vb[VbVbalrStatements#125](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/class9.vb#125)]  
  
## <a name="see-also"></a><span data-ttu-id="9585c-241">另請參閱</span><span class="sxs-lookup"><span data-stu-id="9585c-241">See also</span></span>

- [<span data-ttu-id="9585c-242">集合</span><span class="sxs-lookup"><span data-stu-id="9585c-242">Collections</span></span>](../../../standard/collections/index.md)
- [<span data-ttu-id="9585c-243">For...Next 陳述式</span><span class="sxs-lookup"><span data-stu-id="9585c-243">For...Next Statement</span></span>](../../../visual-basic/language-reference/statements/for-next-statement.md)
- [<span data-ttu-id="9585c-244">迴圈結構</span><span class="sxs-lookup"><span data-stu-id="9585c-244">Loop Structures</span></span>](../../../visual-basic/programming-guide/language-features/control-flow/loop-structures.md)
- [<span data-ttu-id="9585c-245">While...End While 陳述式</span><span class="sxs-lookup"><span data-stu-id="9585c-245">While...End While Statement</span></span>](../../../visual-basic/language-reference/statements/while-end-while-statement.md)
- [<span data-ttu-id="9585c-246">Do...Loop 陳述式</span><span class="sxs-lookup"><span data-stu-id="9585c-246">Do...Loop Statement</span></span>](../../../visual-basic/language-reference/statements/do-loop-statement.md)
- [<span data-ttu-id="9585c-247">擴展和縮小轉換</span><span class="sxs-lookup"><span data-stu-id="9585c-247">Widening and Narrowing Conversions</span></span>](../../../visual-basic/programming-guide/language-features/data-types/widening-and-narrowing-conversions.md)
- [<span data-ttu-id="9585c-248">物件初始設定式：具名和匿名類型</span><span class="sxs-lookup"><span data-stu-id="9585c-248">Object Initializers: Named and Anonymous Types</span></span>](../../../visual-basic/programming-guide/language-features/objects-and-classes/object-initializers-named-and-anonymous-types.md)
- [<span data-ttu-id="9585c-249">集合初始設定式</span><span class="sxs-lookup"><span data-stu-id="9585c-249">Collection Initializers</span></span>](../../../visual-basic/programming-guide/language-features/collection-initializers/index.md)
- [<span data-ttu-id="9585c-250">陣列</span><span class="sxs-lookup"><span data-stu-id="9585c-250">Arrays</span></span>](../../../visual-basic/programming-guide/language-features/arrays/index.md)
